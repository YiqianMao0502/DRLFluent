<!DOCTYPE html>
<html >
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.32">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
</style>
<title>omniORBpy</title>
</head>
<body >
<!--HEVEA command line is: hevea omniORBpy.tex -->
<!--CUT STYLE book--><!--CUT DEF chapter 1 --><div class="center"><p> <span style="font-size:xx-large"><span style="font-size:150%">The omniORBpy version 4.2<br>
User&#X2019;s Guide
</span></span></p><p> <span style="font-size:x-large">Duncan Grisby<br>
</span><span style="font-size:medium">(</span><a href="mailto:dgrisby@apasphere.com"><span style="font-size:medium"><span style="font-style:italic"><span style="font-family:sans-serif">dgrisby@apasphere.com</span></span></span></a><span style="font-size:medium">)</span><span style="font-size:x-large"><br>
</span></p></div><p><span style="font-size:x-large"><span style="font-weight:bold">Contents</span></span></p>
<!--TOC chapter id="sec1" Introduction-->
<h1 id="sec1" class="chapter">Chapter&#XA0;1&#XA0;&#XA0;Introduction</h1><!--SEC END --><p>omniORBpy is an Object Request Broker (ORB) that implements the CORBA
2.6 Python mapping&#XA0;[<a href="#pythonmapping">OMG01b</a>]. It works in conjunction with
omniORB for C++, version 4.2.</p><p>This user guide tells you how to use omniORBpy to develop CORBA
applications using Python. It assumes a basic understanding of CORBA,
and of the Python mapping. Unlike most CORBA standards, the Python
mapping document is small, and quite easy to follow.</p><p>This manual contains all you need to know about omniORB in order to
use omniORBpy. Some sections are repeated from the omniORB manual.</p><p>In this chapter, we give an overview of the main features of omniORBpy
and what you need to do to setup your environment to run it.</p>
<!--TOC section id="sec2" Features-->
<h2 id="sec2" class="section">1.1&#XA0;&#XA0;Features</h2><!--SEC END -->
<!--TOC subsection id="sec3" Multithreading-->
<h3 id="sec3" class="subsection">1.1.1&#XA0;&#XA0;Multithreading</h3><!--SEC END --><p>omniORB is fully multithreaded. To achieve low call overhead,
unnecessary call-multiplexing is eliminated. With the default
policies, there is at most one call in-flight in each communication
channel between two address spaces at any one time. To do this without
limiting the level of concurrency, new channels connecting the two
address spaces are created on demand and cached when there are
concurrent calls in progress. Each channel is served by a dedicated
thread. This arrangement provides maximal concurrency and eliminates
any thread switching in either of the address spaces to process a
call. Furthermore, to maximise the throughput in processing large call
arguments, large data elements are sent as soon as they are processed
while the other arguments are being marshalled. With GIOP 1.2, large
messages are fragmented, so the marshaller can start transmission
before it knows how large the entire message will be.</p><p>omniORB also supports a flexible thread pooling policy, and supports
sending multiple interleaved calls on a single connection. This policy
leads to a small amount of additional call overhead, compared to the
default thread per connection model, but allows omniORB to scale to
extremely large numbers of concurrent clients.</p>
<!--TOC subsection id="sec4" Portability-->
<h3 id="sec4" class="subsection">1.1.2&#XA0;&#XA0;Portability</h3><!--SEC END --><p>omniORB has always been designed to be portable. It runs on many
flavours of Unix, Windows, several embedded operating systems, and
relatively obscure systems such as OpenVMS and Fujitsu-Siemens BS2000.
It is designed to be easy to port to new platforms.</p>
<!--TOC subsection id="sec5" Missing features-->
<h3 id="sec5" class="subsection">1.1.3&#XA0;&#XA0;Missing features</h3><!--SEC END --><p>
<a id="sec:missing"></a></p><p>omniORB is not a complete implementation of the CORBA 2.6 core.
The following is a list of the most significant missing features.</p><ul class="itemize"><li class="li-itemize">For some very dynamic uses of CORBA, you may need an Interface
Repository. omniORB does not have its own one, but it can act as a
client to an IfR. The omniifr project
(<a href="https://github.com/omniorb/omniifr"><span style="font-family:monospace">https://github.com/omniorb/omniifr</span></a>) aims to create an IfR
for omniORB.</li><li class="li-itemize">omniORB supports interceptors, but not the standard Portable
Interceptor API. Interceptor facilities available from Python code
are quite limited.</li><li class="li-itemize">DII, DSI and DynAny are not available in Python, but Python&#X2019;s
normal dynamic features can be used to write code with the same
sorts of dynamic characteristics.</li></ul>
<!--TOC section id="sec6" Setting up your environment-->
<h2 id="sec6" class="section">1.2&#XA0;&#XA0;Setting up your environment</h2><!--SEC END --><p>
<a id="sec:setup"></a></p><p>omniORBpy relies on the omniORB C++ libraries. If you are building
from source, you must first build omniORB itself, as detailed in the
omniORB documentation. After that, you can build the omniORBpy
distribution, according to the instructions in the release notes.</p>
<!--TOC subsection id="sec7" Paths-->
<h3 id="sec7" class="subsection">1.2.1&#XA0;&#XA0;Paths</h3><!--SEC END --><p>With an Autoconf build (the norm on Unix platforms), omniORBpy is
usually installed into a location that Python will find it.</p><p>Otherwise, you must tell Python where to find it. You must add two
directories to the <span style="font-family:monospace">PYTHONPATH</span> environment variable. The
<span style="font-family:monospace">lib/python</span> directory contains platform-independent Python code;
the <span style="font-family:monospace">lib/</span><span style="font-family:monospace">$</span><span style="font-family:monospace">FARCH</span> directory contains
platform-specific binaries, where <span style="font-family:monospace">FARCH</span> is the name of
your platform, such as <span style="font-family:monospace">x86_win32</span>.</p><p>On Unix platforms, set <span style="font-family:monospace">PYTHONPATH</span> with a command like:</p><pre class="verbatim">   export PYTHONPATH=$TOP/lib/python:$TOP/lib/$FARCH
</pre><p>On Windows, use</p><pre class="verbatim">   set PYTHONPATH=%TOP%\lib\python;%TOP%\lib\x86_win32
</pre><p>(Where the <span style="font-family:monospace">TOP</span> environment variable is the root of your
omniORB tree.)</p><p>You should also add the <span style="font-family:monospace">bin/</span><span style="font-family:monospace">$</span><span style="font-family:monospace">FARCH</span> directory
to your <span style="font-family:monospace">PATH</span>, so you can run the IDL compiler, omniidl.
Finally, add the <span style="font-family:monospace">lib/</span><span style="font-family:monospace">$</span><span style="font-family:monospace">FARCH</span> directory to
<span style="font-family:monospace">LD_LIBRARY_PATH</span>, so the omniORB core library can be found.</p>
<!--TOC subsection id="sec8" Configuration-->
<h3 id="sec8" class="subsection">1.2.2&#XA0;&#XA0;Configuration</h3><!--SEC END --><p>Once omniORBpy is installed in a suitable location, you must configure
it according to your required setup. The configuration can be set with
a configuration file, environment variables, command-line arguments
or, on Windows, the Windows registry.</p><ul class="itemize"><li class="li-itemize">On Unix platforms, the omniORB runtime looks for the environment
variable <span style="font-family:monospace">OMNIORB_CONFIG</span>. If this variable is defined, it
contains the pathname of the omniORB configuration file. If the
variable is not set, omniORB will use the compiled-in pathname to
locate the file (by default <span style="font-family:monospace">/etc/omniORB.cfg</span>).</li><li class="li-itemize">On Win32 / Win64 platforms omniORB first checks the environment
variable <span style="font-family:monospace">OMNIORB_CONFIG</span> to obtain the pathname of the
configuration file. If this is not set, it then attempts to obtain
configuration data in the system registry. It searches for the data
under the key <span style="font-family:monospace">HKEY_LOCAL_MACHINE\SOFTWARE\omniORB</span>.</li></ul><p>omniORB has a large number of parameters than can be configured. See
chapter&#XA0;<a href="#chap%3Aconfig">4</a> for full details. The files
<span style="font-family:monospace">sample.cfg</span> and <span style="font-family:monospace">sample.reg</span> contain an example
configuration file and set of registry entries respectively.</p><p>To get all the omniORB examples running, the main thing you need to
configure is the Naming service, omniNames. To do that, the
configuration file or registry should contain an entry of the form</p><pre class="verbatim">  InitRef = NameService=corbaname::my.host.name
</pre><p>See section&#XA0;<a href="#sec%3Acorbaname">7.1.2</a> for full details of corbaname URIs.</p>
<!--TOC chapter id="sec9" The Basics-->
<h1 id="sec9" class="chapter">Chapter&#XA0;2&#XA0;&#XA0;The Basics</h1><!--SEC END --><p>
<a id="chap:basics"></a></p><p>In this chapter, we go through three examples to illustrate the
practical steps to use omniORBpy. By going through the source code of
each example, the essential concepts and APIs are introduced. If you
have no previous experience with using CORBA, you should study this
chapter in detail. There are pointers to other essential documents you
should be familiar with.</p><p>If you have experience with using other ORBs, you should still go
through this chapter because it provides important information about
the features and APIs that are necessarily omniORB specific.</p>
<!--TOC section id="sec10" The Echo example-->
<h2 id="sec10" class="section">2.1&#XA0;&#XA0;The Echo example</h2><!--SEC END --><p>We use an example which is similar to the one used in the omniORB
manual. We define an interface, called <span style="font-family:monospace">Example::Echo</span>, as
follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// echo_example.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The important difference from the omniORB Echo example is that our
<span style="font-family:monospace">Echo</span> interface is declared within an IDL module named
<span style="font-family:monospace">Example</span>. The reason for this will become clear in a moment.</p><p>If you are new to IDL, you can learn about its syntax in Chapter 3 of
the CORBA specification 2.6&#XA0;[<a href="#corba26-spec">OMG01a</a>]. For the moment, you
only need to know that the interface consists of a single operation,
<span style="font-family:monospace">echoString()</span>, which takes a string as an argument and returns a
copy of the same string.</p><p>The interface is written in a file, called <span style="font-family:monospace">example_echo.idl</span>. It
is part of the CORBA standard that all IDL files should have the
extension &#X2018;<span style="font-family:monospace">.idl</span>&#X2019;, although omniORB does not enforce this.</p>
<!--TOC section id="sec11" Generating the Python stubs-->
<h2 id="sec11" class="section">2.2&#XA0;&#XA0;Generating the Python stubs</h2><!--SEC END --><p>
<a id="sec:generatingStubs"></a></p><p>From the IDL file, we use the IDL compiler, omniidl, to produce the
Python stubs for that IDL. The stubs contain Python declarations for
all the interfaces and types declared in the IDL, as required by the
Python mapping. It is possible to generate stubs dynamically at
run-time, as described in section&#XA0;<a href="#sec%3AimportIDL">4.9</a>, but it is more
efficient to generate them statically.</p><p>To generate the stubs, we use a command line like</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython example_echo.idl</span>
</blockquote><p>As required by the standard, that produces two Python
packages derived from the module name <span style="font-family:monospace">Example</span>. Directory
<span style="font-family:monospace">Example</span> contains the client-side definitions (and also the type
declarations if there were any); directory <span style="font-family:monospace">Example__POA</span>
contains the server-side skeletons. This explains the difficulty with
declarations at IDL global scope; section&#XA0;<a href="#sec%3AglobalIDL">2.7</a> explains
how to access global declarations.</p><p>If you look at the Python code in the two packages, you will see that
they are almost empty. They simply import the
<span style="font-family:monospace">example_echo_idl.py</span> file, which is where both the client and
server side declarations actually live. This arrangement is so that
omniidl can easily extend the packages if other IDL files add
declarations to the same IDL modules.</p>
<!--TOC section id="sec12" Object References and Servants-->
<h2 id="sec12" class="section">2.3&#XA0;&#XA0;Object References and Servants</h2><!--SEC END --><p>We contact a CORBA object through an <span style="font-style:italic">object reference</span>. The
actual implementation of a CORBA object is termed a <span style="font-style:italic">servant</span>.</p><p>Object references and servants are quite separate entities, and it is
important not to confuse the two. Client code deals purely with object
references, so there can be no confusion; object implementation code
must deal with both object references and servants. You will get a
run-time error if you use a servant where an object reference is
expected, or vice-versa.</p>
<!--TOC section id="sec13" Example 1 &#X2014; Colocated client and servant-->
<h2 id="sec13" class="section">2.4&#XA0;&#XA0;Example 1 &#X2014; Colocated client and servant</h2><!--SEC END --><p>
<a id="sec:eg1"></a></p><p>In the first example, both the client and servant are in the same
address space. The next sections show how the client and servant can
be split between different address spaces.</p><p>First, the code:</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">, </span><span style="font-size:small">PortableServer</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small">, </span><span style="font-size:small">Example__POA</span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> (</span><span style="font-size:small">Example__POA</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">self</span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"echoString() called with message:"</span></span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">ei</span><span style="font-size:small"> = </span><span style="font-size:small">Echo_i</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">eo</span><span style="font-size:small"> = </span><span style="font-size:small">ei</span><span style="font-size:small">.</span><span style="font-size:small">_this</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">poaManager</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">.</span><span style="font-size:small">_get_the_POAManager</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">poaManager</span><span style="font-size:small">.</span><span style="font-size:small">activate</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">message</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello"</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">  22</span><span style="font-size:small"> </span><span style="font-size:small">result</span><span style="font-size:small">  = </span><span style="font-size:small">eo</span><span style="font-size:small">.</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">message</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  23</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  24</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"I said '%s'. The object said '%s'."</span></span><span style="font-size:small"> % (</span><span style="font-size:small">message</span><span style="font-size:small">,</span><span style="font-size:small">result</span><span style="font-size:small">)</span></div><p>The example illustrates several important interactions among the ORB,
the POA, the servant, and the client. Here are the details:</p>
<!--TOC subsection id="sec14" Imports-->
<h3 id="sec14" class="subsection">2.4.1&#XA0;&#XA0;Imports</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 3</span></dt><dd class="dd-description"><br>
Import the <span style="font-family:monospace">sys</span> module to access <span style="font-family:monospace">sys.argv</span>.</dd><dt class="dt-description"><span style="font-weight:bold">Line 4</span></dt><dd class="dd-description"><br>
Import omniORB&#X2019;s implementations of the <span style="font-family:monospace">CORBA</span> and
<span style="font-family:monospace">PortableServer</span> modules. The standard requires that these
modules are available outside of any package, so you can also do<div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">, </span><span style="font-size:small">PortableServer</span></div><p>Explicitly specifying omniORB is useful if you have more
than one Python ORB installed.</p></dd><dt class="dt-description"><span style="font-weight:bold">Line 5</span></dt><dd class="dd-description"><br>
Import the client-side stubs and server-side skeletons generated for
IDL module <span style="font-family:monospace">Example</span>.</dd></dl>
<!--TOC subsection id="sec15" Servant class definition-->
<h3 id="sec15" class="subsection">2.4.2&#XA0;&#XA0;Servant class definition</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 7&#X2013;10</span></dt><dd class="dd-description"><br>
For interface <span style="font-family:monospace">Example::Echo</span>, omniidl produces a skeleton class
named <span style="font-family:monospace">Example__POA.Echo</span>. Here we define an implementation
class, <span style="font-family:monospace">Echo_i</span>, which derives from the skeleton class.<p>There is little constraint on how you design your implementation
class, except that it has to inherit from the skeleton class and must
implement all of the operations declared in the IDL. Note that since
Python is a dynamic language, errors due to missing operations and
operations with incorrect type signatures are only reported when
someone tries to call those operations.</p></dd></dl>
<!--TOC subsection id="sec16" ORB initialisation-->
<h3 id="sec16" class="subsection">2.4.3&#XA0;&#XA0;ORB initialisation</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 12</span></dt><dd class="dd-description"><br>
The ORB is initialised by calling <span style="font-family:monospace">CORBA.ORB_init()</span>.
<span style="font-family:monospace">ORB_init()</span> is passed a list of command-line arguments, and
an ORB identifier. The ORB identifier should be &#X2018;omniORB4&#X2019;, but it is
usually best to use <span style="font-family:monospace">CORBA.ORB_ID</span>, which is initialised to a
suitable string, or leave it out altogether, and rely on the default.<p><span style="font-family:monospace">ORB_init()</span> processes any command-line arguments which begin with
the string &#X2018;<span style="font-family:monospace">-ORB</span>&#X2019;, and removes them from the argument
list. See section&#XA0;<a href="#sec%3AORBargs">4.1.1</a> for details. If any arguments are
invalid, or other initialisation errors occur (such as errors in the
configuration file), the <span style="font-family:monospace">CORBA.INITIALIZE</span> exception is raised.</p></dd></dl>
<!--TOC subsection id="sec17" Obtaining the Root POA-->
<h3 id="sec17" class="subsection">2.4.4&#XA0;&#XA0;Obtaining the Root POA</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 13</span></dt><dd class="dd-description"><br>
To activate our servant object and make it available to clients, we
must register it with a POA. In this example, we use the <span style="font-style:italic">Root
POA</span>, rather than creating any child POAs. The Root POA is found with
<span style="font-family:monospace">orb.resolve_initial_references()</span>.<p>A POA&#X2019;s behaviour is governed by its <span style="font-style:italic">policies</span>. The Root POA has
suitable policies for many simple servers. Chapter 11 of the CORBA 2.6
specification [<a href="#corba26-spec">OMG01a</a>] has details of all the POA policies
which are available.</p></dd></dl>
<!--TOC subsection id="sec18" Object initialisation-->
<h3 id="sec18" class="subsection">2.4.5&#XA0;&#XA0;Object initialisation</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 15</span></dt><dd class="dd-description"><br>
An instance of the Echo servant object is created.</dd><dt class="dt-description"><span style="font-weight:bold">Line 16</span></dt><dd class="dd-description"><br>
The object is implicitly activated in the Root POA, and an object
reference is returned, using the <span style="font-family:monospace">_this()</span> method.<p>One of the important characteristics of an object reference is that it
is completely location transparent. A client can invoke on the object
using its object reference without any need to know whether the
servant object is colocated in the same address space or is in a
different address space.</p><p>In the case of colocated client and servant, omniORB is able to
short-circuit the client calls so they do not involve IIOP. The calls
still go through the POA, however, so the various POA policies affect
local calls in the same way as remote ones. This optimisation is
applicable not only to object references returned by <span style="font-family:monospace">_this()</span>, but
to any object references that are passed around within the same
address space or received from other address spaces via IIOP calls.</p></dd></dl>
<!--TOC subsection id="sec19" Activating the POA-->
<h3 id="sec19" class="subsection">2.4.6&#XA0;&#XA0;Activating the POA</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 18&#X2013;19</span></dt><dd class="dd-description"><br>
POAs are initially in the <span style="font-style:italic">holding</span> state, meaning that incoming
requests are blocked. Lines 18 and 19 acquire a reference to the POA&#X2019;s
POA manager, and use it to put the POA into the <span style="font-style:italic">active</span> state.
Incoming requests are now served. <span style="font-weight:bold">Failing to activate the POA
is one of the most common programming mistakes. If your program
appears deadlocked, make sure you activated the POA!</span></dd></dl>
<!--TOC subsection id="sec20" Performing a call-->
<h3 id="sec20" class="subsection">2.4.7&#XA0;&#XA0;Performing a call</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 22</span></dt><dd class="dd-description"><br>
At long last, we can call the object&#X2019;s <span style="font-family:monospace">echoString()</span> operation.
Even though the object is local, the operation goes through the ORB
and POA, so the types of the arguments can be checked, and any mutable
arguments can be copied. This ensures that the semantics of local and
remote calls are identical. If any of the arguments (or return values)
are of the wrong type, a <span style="font-family:monospace">CORBA.BAD_PARAM</span> exception is raised.</dd></dl>
<!--TOC subsection id="sec21" Parameter type checking-->
<h3 id="sec21" class="subsection">2.4.8&#XA0;&#XA0;Parameter type checking</h3><!--SEC END --><p>CORBA IDL is statically typed, and so in statically typed programming
languages like C++, the compiler reports errors for code where the
types of operation parameters and return values do not match what is
defined in the IDL. Since Python is dynamically typed, it is not until
run time that parameter and return types can be checked against the
IDL definitions.</p><p>When operations are called, omniORBpy checks the types of parameters
and return values against the IDL. If the types do not match, it
raises a <span style="font-family:monospace">CORBA.BAD_PARAM</span> exception, with the minor code
<span style="font-family:monospace">omniORB.BAD_PARAM_WrongPythonType</span>. With complex parameter
types, it can be hard to work out exactly what part of a type was
incorrect so, new in omniORBpy 4.2, the exception contains a list of
information about where exactly a type check failed. The information
is stored as a list of strings in the <span style="font-family:monospace">_info</span> attribute of the
exception object, and output as part of the string form of the
exception:</p><div class="lstlisting"><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small">eo</span><span style="font-size:small">.</span><span style="font-size:small">echoString</span><span style="font-size:small">(123)</span><span style="font-size:small">
</span><span style="font-size:small">Traceback</span><span style="font-size:small"> (</span><span style="font-size:small">most</span><span style="font-size:small"> </span><span style="font-size:small">recent</span><span style="font-size:small"> </span><span style="font-size:small">call</span><span style="font-size:small"> </span><span style="font-size:small">last</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">File</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"&lt;stdin&gt;"</span></span><span style="font-size:small">, </span><span style="font-size:small">line</span><span style="font-size:small"> 1, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">module</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">File</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"example_echo_idl.py"</span></span><span style="font-size:small">, </span><span style="font-size:small">line</span><span style="font-size:small"> 54, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">self</span><span style="font-size:small">.</span><span style="font-size:small">_obj</span><span style="font-size:small">.</span><span style="font-size:small">invoke</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"echoString"</span></span><span style="font-size:small">, </span><span style="font-size:small">_0_Example</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">.</span><span style="font-size:small">_d_echoString</span><span style="font-size:small">, </span><span style="font-size:small">args</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">BAD_PARAM</span><span style="font-size:small">: </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">BAD_PARAM</span><span style="font-size:small">(</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">BAD_PARAM_WrongPythonType</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">COMPLETED_NO</span><span style="font-size:small">, [</span><span style="font-size:small"><span style="font-size:small">"Expecting string, got &lt;type 'int'&gt;"</span></span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                       </span><span style="font-size:small"><span style="font-size:small">"Operation 'echoString' parameter 0"</span></span><span style="font-size:small">])</span></div>
<!--TOC section id="sec22" Example 2 &#X2014; Different Address Spaces-->
<h2 id="sec22" class="section">2.5&#XA0;&#XA0;Example 2 &#X2014; Different Address Spaces</h2><!--SEC END --><p>In this example, the client and the object implementation reside in
two different address spaces. The code of this example is almost the
same as the previous example. The only difference is the extra work
which needs to be done to pass the object reference from the object
implementation to the client.</p><p>The simplest (and quite primitive) way to pass an object reference
between two address spaces is to produce a <span style="font-style:italic">stringified</span> version
of the object reference and to pass this string to the client as a
command-line argument. The string is then converted by the client
into a proper object reference. This method is used in this
example. In the next example, we shall introduce a better way of
passing the object reference using the CORBA Naming Service.</p>
<!--TOC subsection id="sec23" Server: Making a Stringified Object Reference-->
<h3 id="sec23" class="subsection">2.5.1&#XA0;&#XA0;Server: Making a Stringified Object Reference</h3><!--SEC END --><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">, </span><span style="font-size:small">PortableServer</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small">, </span><span style="font-size:small">Example__POA</span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> (</span><span style="font-size:small">Example__POA</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">self</span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"echoString() called with message:"</span></span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">ei</span><span style="font-size:small"> = </span><span style="font-size:small">Echo_i</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">eo</span><span style="font-size:small"> = </span><span style="font-size:small">ei</span><span style="font-size:small">.</span><span style="font-size:small">_this</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">eo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">poaManager</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">.</span><span style="font-size:small">_get_the_POAManager</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">poaManager</span><span style="font-size:small">.</span><span style="font-size:small">activate</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small">  22</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  23</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">run</span><span style="font-size:small">()</span></div><p>Up until line 18, this example is identical to the colocated case. On
line 18, the ORB&#X2019;s <span style="font-family:monospace">object_to_string()</span> operation is called. This
results in a string starting with the signature &#X2018;IOR:&#X2019; and followed by
some hexadecimal digits. All CORBA 2 compliant ORBs are able to
convert the string into its internal representation of a so-called
Interoperable Object Reference (IOR). The IOR contains the location
information and a key to uniquely identify the object implementation
in its own address space<sup><a id="text1" href="#note1">1</a></sup>. From the IOR, an object
reference can be constructed.</p><p>After the POA has been activated, <span style="font-family:monospace">orb.run()</span> is called. Since
omniORB is fully multi-threaded, it is not actually necessary to call
<span style="font-family:monospace">orb.run()</span> for operation dispatch to happen&#X2014;if the main program
had some other work to do, it could do so, and remote invocations
would be dispatched in separate threads. However, in the absence of
anything else to do, <span style="font-family:monospace">orb.run()</span> is called so the thread blocks
rather than exiting immediately when the end-of-file is reached.
<span style="font-family:monospace">orb.run()</span> stays blocked until the ORB is shut down.</p>
<!--TOC subsection id="sec24" Client: Using a Stringified Object Reference-->
<h3 id="sec24" class="subsection">2.5.2&#XA0;&#XA0;Client: Using a Stringified Object Reference</h3><!--SEC END --><p>
<a id="clnt2"></a></p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">ior</span><span style="font-size:small"> = </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">[1]</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">ior</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">eo</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">Example</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">eo</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Object reference is not an Example::Echo"</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">message</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello from Python"</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">result</span><span style="font-size:small">  = </span><span style="font-size:small">eo</span><span style="font-size:small">.</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">message</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"I said '%s'. The object said '%s'."</span></span><span style="font-size:small"> % (</span><span style="font-size:small">message</span><span style="font-size:small">,</span><span style="font-size:small">result</span><span style="font-size:small">)</span></div><p>The stringified object reference is passed to the client as a
command-line argument<sup><a id="text2" href="#note2">2</a></sup>. The client uses the ORB&#X2019;s
<span style="font-family:monospace">string_to_object()</span> function to convert the string into a generic
object reference (<span style="font-family:monospace">CORBA.Object</span>).</p><p>On line 12, the object&#X2019;s <span style="font-family:monospace">_narrow()</span> function is called to convert
the <span style="font-family:monospace">CORBA.Object</span> reference into an <span style="font-family:monospace">Example.Echo</span>
reference. If the IOR was not actually of type <span style="font-family:monospace">Example.Echo</span>, or
something derived from it, <span style="font-family:monospace">_narrow()</span> returns <span style="font-family:monospace">None</span>.</p><p>In fact, since Python is a dynamically-typed language,
<span style="font-family:monospace">string_to_object()</span> is often able to return an object reference of
a more derived type than <span style="font-family:monospace">CORBA.Object</span>. See
section&#XA0;<a href="#sec%3Anarrowing">3.1</a> for details.</p>
<!--TOC subsection id="sec25" System exceptions-->
<h3 id="sec25" class="subsection">2.5.3&#XA0;&#XA0;System exceptions</h3><!--SEC END --><p>The keep it short, the client code shown above performs no exception
handling. A robust client (and server) should do, since there are a
number of system exceptions which can arise.</p><p>As already mentioned, <span style="font-family:monospace">ORB_init()</span> can raise the
<span style="font-family:monospace">CORBA.INITIALIZE</span> exception if the command line arguments or
configuration file are invalid. <span style="font-family:monospace">string_to_object()</span> can
raise two exceptions: if the string is not an IOR (or a valid URI), it
raises <span style="font-family:monospace">CORBA.BAD_PARAM</span>; if the string looks like an IOR, but
contains invalid data, is raises <span style="font-family:monospace">CORBA.MARSHAL</span>.</p><p>The call to <span style="font-family:monospace">echoString()</span> can result in any of the CORBA system
exceptions, since any exceptions not caught on the server side are
propagated back to the client. Even if the implementation of
<span style="font-family:monospace">echoString()</span> does not raise any system exceptions itself, failures
in invoking the operation can cause a number of exceptions. First, if
the server process cannot be contacted, a <span style="font-family:monospace">CORBA.TRANSIENT</span>
exception is raised. Second, if the server process <em>can</em> be
contacted, but the object in question does not exist there, a
<span style="font-family:monospace">CORBA.OBJECT_NOT_EXIST</span> exception is raised.</p><p>As explained later in section&#XA0;<a href="#sec%3Anarrowing">3.1</a>, the call to
<span style="font-family:monospace">_narrow()</span> may also involve a call to the object to confirm its
type. This means that <span style="font-family:monospace">_narrow()</span> can also raise
<span style="font-family:monospace">CORBA.TRANSIENT</span>, <span style="font-family:monospace">CORBA.OBJECT_NOT_EXIST</span>, and
<span style="font-family:monospace">CORBA.COMM_FAILURE</span>.</p><p>Section&#XA0;<a href="#sec%3AexHandlers">4.7</a> describes how exception handlers can be
installed for all the various system exceptions, to avoid surrounding
all code with <span style="font-family:monospace">try</span>&#X2026;<span style="font-family:monospace">except</span> blocks.</p>
<!--TOC subsection id="sec26" Lifetime of a CORBA object-->
<h3 id="sec26" class="subsection">2.5.4&#XA0;&#XA0;Lifetime of a CORBA object</h3><!--SEC END --><p>CORBA objects are either <span style="font-style:italic">transient</span> or <span style="font-style:italic">persistent</span>. The
majority are transient, meaning that the lifetime of the CORBA object
(as contacted through an object reference) is the same as the lifetime
of its servant object. Persistent objects can live beyond the
destruction of their servant object, the POA they were created in, and
even their process. Persistent objects are, of course, only
contactable when their associated servants are active, or can be
activated by their POA with a servant manager<sup><a id="text3" href="#note3">3</a></sup>. A reference to
a persistent object can be published, and will remain valid even if
the server process is restarted.</p><p>A POA&#X2019;s Lifespan Policy determines whether objects created within it
are transient or persistent. The Root POA has the <span style="font-family:monospace">TRANSIENT</span>
policy.</p><p>An alternative to creating persistent objects is to register object
references in a <span style="font-style:italic">naming service</span> and bind them to fixed
pathnames. Clients can bind to the object implementations at runtime
by asking the naming service to resolve the pathnames to the object
references. CORBA defines a standard naming service, which is a
component of the Common Object Services (COS)&#XA0;[<a href="#corbaservices">OMG98</a>],
that can be used for this purpose. The next section describes an
example of how to use the COS Naming Service.</p>
<!--TOC section id="sec27" Example 3 &#X2014; Using the Naming Service-->
<h2 id="sec27" class="section">2.6&#XA0;&#XA0;Example 3 &#X2014; Using the Naming Service</h2><!--SEC END --><p>
<a id="sec:usingNS"></a></p><p>In this example, the object implementation uses the Naming
Service&#XA0;[<a href="#corbaservices">OMG98</a>] to pass on the object reference to the
client. This method is far more practical than using stringified
object references. The full listings of the server and client are
below.</p><p>The names used by the Naming service consist of a sequence of
<span style="font-style:italic">name components</span>. Each name component has an <span style="font-style:italic">id</span> and a
<span style="font-style:italic">kind</span> field, both of which are strings. All name components
except the last one are bound to <span style="font-style:italic">naming contexts</span>. A naming
context is analogous to a directory in a filing system: it can contain
names of object references or other naming contexts. The last name
component is bound to an object reference.</p><p>Sequences of name components can be represented as a flat string,
using &#X2018;.&#X2019; to separate the id and kind fields, and &#X2018;/&#X2019; to separate name
components from each other<sup><a id="text4" href="#note4">4</a></sup>. In our example, the Echo object
reference is bound to the stringified name
&#X2018;<span style="font-family:monospace">test.my_context/ExampleEcho.Object</span>&#X2019;.</p><p>The kind field is intended to describe the name in a
syntax-independent way. The naming service does not interpret, assign,
or manage these values. However, both the name and the kind attribute
must match for a name lookup to succeed. In this example, the kind
values for <span style="font-family:monospace">test</span> and <span style="font-family:monospace">ExampleEcho</span> are chosen to be
&#X2018;<span style="font-family:monospace">my_context</span>&#X2019; and &#X2018;<span style="font-family:monospace">Object</span>&#X2019; respectively. This is an
arbitrary choice as there is no standardised set of kind values.</p>
<!--TOC subsection id="sec28" Obtaining the Root Context object reference-->
<h3 id="sec28" class="subsection">2.6.1&#XA0;&#XA0;Obtaining the Root Context object reference</h3><!--SEC END --><p>
<a id="resolveinit"></a></p><p>The initial contact with the Naming Service can be established via the
<span style="font-style:italic">root</span> context. The object reference to the root context is
provided by the ORB and can be obtained by calling
<span style="font-family:monospace">resolve_initial_references()</span>. The following code fragment shows
how it is used:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">cxt</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">)</span></div><p>Remember, omniORB constructs its internal list of initial references
at initialisation time using the information provided in the
configuration file <span style="font-family:monospace">omniORB.cfg</span>, or given on the command
line. If this file is not present, the internal list will be empty and
<span style="font-family:monospace">resolve_initial_references()</span> will raise a
<span style="font-family:monospace">CORBA.ORB.InvalidName</span> exception.</p><p>Note that, like <span style="font-family:monospace">string_to_object()</span>,
<span style="font-family:monospace">resolve_initial_references()</span> returns base <span style="font-family:monospace">CORBA.Object</span>, so
we should narrow it to the interface we want. In this case, we want
<span style="font-family:monospace">CosNaming.NamingContext</span><sup><a id="text5" href="#note5">5</a></sup>.</p>
<!--TOC subsection id="sec29" The Naming Service interface-->
<h3 id="sec29" class="subsection">2.6.2&#XA0;&#XA0;The Naming Service interface</h3><!--SEC END --><p>It is beyond the scope of this chapter to describe in detail the
Naming Service interface. You should consult the CORBA services
specification&#XA0;[<a href="#corbaservices">OMG98</a>] (chapter 3).</p>
<!--TOC subsection id="sec30" Server code-->
<h3 id="sec30" class="subsection">2.6.3&#XA0;&#XA0;Server code</h3><!--SEC END --><p>Hopefully, the server code is self-explanatory:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">, </span><span style="font-size:small">PortableServer</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">, </span><span style="font-size:small">Example</span><span style="font-size:small">, </span><span style="font-size:small">Example__POA</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Define an implementation of the Echo interface</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> (</span><span style="font-size:small">Example__POA</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">self</span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"echoString() called with message:"</span></span><span style="font-size:small">, </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Initialise the ORB and find the root POA</span></span></span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Create an instance of Echo_i and an Echo object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">ei</span><span style="font-size:small"> = </span><span style="font-size:small">Echo_i</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">eo</span><span style="font-size:small"> = </span><span style="font-size:small">ei</span><span style="font-size:small">.</span><span style="font-size:small">_this</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Obtain a reference to the root naming context</span></span></span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small">         = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context"</span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Bind a context named "test.my_context" to the root context</span></span></span><span style="font-size:small">
</span><span style="font-size:small">name</span><span style="font-size:small"> = [</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NameComponent</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">)]</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">.</span><span style="font-size:small">bind_new_context</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"New test context bound"</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">except</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">.</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">, </span><span style="font-size:small">ex</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Test context already exists"</span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">.</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">testContext</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"test.mycontext exists but is not a NamingContext"</span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Bind the Echo object to the test context</span></span></span><span style="font-size:small">
</span><span style="font-size:small">name</span><span style="font-size:small"> = [</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NameComponent</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"ExampleEcho"</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">)]</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">testContext</span><span style="font-size:small">.</span><span style="font-size:small">bind</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">, </span><span style="font-size:small">eo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"New ExampleEcho object bound"</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">except</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">.</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">testContext</span><span style="font-size:small">.</span><span style="font-size:small">rebind</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">, </span><span style="font-size:small">eo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"ExampleEcho binding already existed -- rebound"</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Activate the POA</span></span></span><span style="font-size:small">
</span><span style="font-size:small">poaManager</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">.</span><span style="font-size:small">_get_the_POAManager</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">poaManager</span><span style="font-size:small">.</span><span style="font-size:small">activate</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Block for ever (or until the ORB is shut down)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">run</span><span style="font-size:small">()</span></div>
<!--TOC subsection id="sec31" Client code-->
<h3 id="sec31" class="subsection">2.6.4&#XA0;&#XA0;Client code</h3><!--SEC END --><p>Hopefully the client code is self-explanatory too:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">, </span><span style="font-size:small">Example</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Initialise the ORB</span></span></span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Obtain a reference to the root naming context</span></span></span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small">         = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context"</span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Resolve the name "test.my_context/ExampleEcho.Object"</span></span></span><span style="font-size:small">
</span><span style="font-size:small">name</span><span style="font-size:small"> = [</span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NameComponent</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">),</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NameComponent</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"ExampleEcho"</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">)]</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">.</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">except</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small">.</span><span style="font-size:small">NamingContext</span><span style="font-size:small">.</span><span style="font-size:small">NotFound</span><span style="font-size:small">, </span><span style="font-size:small">ex</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Name not found"</span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Narrow the object to an Example::Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small">eo</span><span style="font-size:small"> = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">Example</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">eo</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"Object reference is not an Example::Echo"</span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">exit</span><span style="font-size:small">(1)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Invoke the echoString operation</span></span></span><span style="font-size:small">
</span><span style="font-size:small">message</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello from Python"</span></span><span style="font-size:small">
</span><span style="font-size:small">result</span><span style="font-size:small">  = </span><span style="font-size:small">eo</span><span style="font-size:small">.</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">message</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"I said '%s'. The object said '%s'."</span></span><span style="font-size:small"> % (</span><span style="font-size:small">message</span><span style="font-size:small">,</span><span style="font-size:small">result</span><span style="font-size:small">)</span></div>
<!--TOC section id="sec32" Global IDL definitions-->
<h2 id="sec32" class="section">2.7&#XA0;&#XA0;Global IDL definitions</h2><!--SEC END --><p>
<a id="sec:globalIDL"></a></p><p>As we have seen, the Python mapping maps IDL modules to Python
packages with the same name. This poses a problem for IDL declarations
at global scope. Global declarations are generally a bad idea since
they make name clashes more likely, but they must be supported.</p><p>Since Python does not have a concept of a global scope (only a
per-module global scope, which is dangerous to modify), global
declarations are mapped to a specially named Python package. By
default, this package is named <span style="font-family:monospace">_GlobalIDL</span>, with skeletons in
<span style="font-family:monospace">_GlobalIDL__POA</span>. The package name may be changed with
omniidl&#X2019;s <span style="font-family:monospace">-Wbglobal</span> option, described in
section&#XA0;<a href="#sec%3AWbglobal">5.2</a>. The omniORB C++ Echo example, with IDL:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>can therefore be supported with code like</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">#!/usr/bin/env python</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">from</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">_GlobalIDL</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">ORB_ID</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">ior</span><span style="font-size:small"> = </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">argv</span><span style="font-size:small">[1]</span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">.</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">ior</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">eo</span><span style="font-size:small">  = </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">_GlobalIDL</span><span style="font-size:small">.</span><span style="font-size:small">Echo</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">message</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello from Python"</span></span><span style="font-size:small">
</span><span style="font-size:small">result</span><span style="font-size:small">  = </span><span style="font-size:small">eo</span><span style="font-size:small">.</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">message</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"I said '%s'. The object said '%s'"</span></span><span style="font-size:small"> % (</span><span style="font-size:small">message</span><span style="font-size:small">,</span><span style="font-size:small">result</span><span style="font-size:small">)</span></div>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note1" href="#text1">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Notice that the object key is not
globally unique across address spaces.</div></dd><dt class="dt-thefootnotes"><a id="note2" href="#text2">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The code does not check that there is
actually an IOR on the command line!</div></dd><dt class="dt-thefootnotes"><a id="note3" href="#text3">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The POA itself
can be activated on demand with an adapter activator.</div></dd><dt class="dt-thefootnotes"><a id="note4" href="#text4">4</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">There are escaping rules to cope
with id and kind fields which contain &#X2018;.&#X2019; and &#X2018;/&#X2019; characters. See
chapter&#XA0;<a href="#chap%3Ains">7</a> of this manual, and chapter 3 of the CORBA
services specification, as updated for the Interoperable Naming
Service&#XA0;[<a href="#inschapters">OMG00</a>].</div></dd><dt class="dt-thefootnotes"><a id="note5" href="#text5">5</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">If you are on-the-ball, you
will have noticed that we didn&#X2019;t call <span style="font-family:monospace">_narrow()</span> when resolving the
Root POA. The reason it is safe to miss it out is given in
section&#XA0;<a href="#sec%3Anarrowing">3.1</a>.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec33" Python language mapping issues-->
<h1 id="sec33" class="chapter">Chapter&#XA0;3&#XA0;&#XA0;Python language mapping issues</h1><!--SEC END --><p>omniORBpy adheres to the standard Python mapping&#XA0;[<a href="#pythonmapping">OMG01b</a>],
so there is no need to describe the mapping here. This chapter
outlines a number of issues which are not addressed by the standard
(or are optional), and how they are resolved in omniORBpy.</p>
<!--TOC section id="sec34" Narrowing object references-->
<h2 id="sec34" class="section">3.1&#XA0;&#XA0;Narrowing object references</h2><!--SEC END --><p>
<a id="sec:narrowing"></a></p><p>As explained in chapter&#XA0;<a href="#chap%3Abasics">2</a>, whenever you receive an
object reference declared to be base <span style="font-family:monospace">CORBA::Object</span>, such as
from <span style="font-family:monospace">NamingContext::resolve()</span> or
<span style="font-family:monospace">ORB::string_to_object()</span>, you should narrow the reference to
the type you require. You might think that since Python is a
dynamically typed language, narrowing should never be necessary.
Unfortunately, although omniORBpy often generates object references
with the right types, it cannot do so in all circumstances.</p><p>The rules which govern when narrowing is required are quite complex.
To be totally safe, you can <em>always</em> narrow object references to
the type you are expecting. The advantages of this approach are that
it is simple and that it is guaranteed to work with all Python ORBs.</p><p>The disadvantage with calling narrow for all received object
references is that much of the time it is guaranteed not to be
necessary. If you understand the situations in which narrowing
<em>is</em> necessary, you can avoid spurious narrowing.</p>
<!--TOC subsection id="sec35" The gory details-->
<h3 id="sec35" class="subsection">3.1.1&#XA0;&#XA0;The gory details</h3><!--SEC END --><p>When object references are transmitted (or stored in stringified
IORs), they contain a single type identifier string, termed the
<span style="font-style:italic">repository id</span>. Normally, the repository id represents the most
derived interface of the object. However, it is also permitted to be
the empty string, or to refer to an interface higher up the
inheritance hierarchy. To give a concrete example, suppose there are
two IDL files:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// a.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">A</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">opA</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// b.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"a.idl"</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M2</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">B</span><span style="font-size:small"> : </span><span style="font-size:small">M1</span><span style="font-size:small">::</span><span style="font-size:small">A</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">opB</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>A reference to an object with interface <span style="font-family:monospace">B</span> will
normally contain the repository id &#X2018;<span style="font-family:monospace">IDL:M2/B:1.0</span>&#X2019;<sup><a id="text6" href="#note6">1</a></sup>. It is also permitted to have an empty
repository id, or the id &#X2018;<span style="font-family:monospace">IDL:M1/A:1.0</span>&#X2019;.
&#X2018;<span style="font-family:monospace">IDL:M1/A:1.0</span>&#X2019; is unlikely unless the server is being
deliberately obtuse.</p><p>Whenever omniORBpy receives an object reference from
somewhere&#X2014;either as a return value or as an operation argument&#X2014;it
has a particular <span style="font-style:italic">target</span> interface in mind, which it compares
with the repository id it has received. A target of base
<span style="font-family:monospace">CORBA::Object</span> is just one (common) case. For example, in the
following IDL:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// c.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"a.idl"</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M3</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">C</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">Object</span></span><span style="font-size:small"> </span><span style="font-size:small">getObj</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">M1</span><span style="font-size:small">::</span><span style="font-size:small">A</span><span style="font-size:small">  </span><span style="font-size:small">getA</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>the target interface for <span style="font-family:monospace">getObj</span>&#X2019;s return value is
<span style="font-family:monospace">CORBA::Object</span>; the target interface for <span style="font-family:monospace">getA</span>&#X2019;s return
value is <span style="font-family:monospace">M1::A</span>.</p><p>omniORBpy uses the result of comparing the received and target
repository ids to determine the type of the object reference it
creates. The object reference has either the type of the received
reference, or the target type, according to this table:</p><div class="center">
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap"  colspan=2><span style="font-weight:bold">Case</span></td><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" > <span style="font-weight:bold">Objref Type</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >
1.</td><td style="vertical-align:top;text-align:left;border:solid 1px;" >The received id is the same as the target id</td><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >received</td></tr>
<tr><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >
2.</td><td style="vertical-align:top;text-align:left;border:solid 1px;" >The received id is not the same as the target id, but the
ORB knows that the received interface is derived from
the target interface</td><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >received</td></tr>
<tr><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >
3.</td><td style="vertical-align:top;text-align:left;border:solid 1px;" >The received id is unknown to the ORB</td><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >target</td></tr>
<tr><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >
4.</td><td style="vertical-align:top;text-align:left;border:solid 1px;" >The received id is not the same as the target id, and the
ORB knows that the received interface is <em>not</em>
derived from the target interface</td><td style="vertical-align:top;text-align:left;border:solid 1px;white-space:nowrap" >target </td></tr>
</table>
</div><p>Cases 1 and 2 are the most common. Case 2 explains why it is not
necessary to narrow the result of calling
<span style="font-family:monospace">resolve_initial_references("RootPOA")</span>: the return is always
of the known type <span style="font-family:monospace">PortableServer.POA</span>, which is derived from the
target type of <span style="font-family:monospace">CORBA.Object</span>.</p><p>Case 3 is also quite common. Suppose a client knows about IDL modules
<span style="font-family:monospace">M1</span> and <span style="font-family:monospace">M3</span> from above, but not module <span style="font-family:monospace">M2</span>.
When it calls <span style="font-family:monospace">getA()</span> on an instance of <span style="font-family:monospace">M3::C</span>, the return
value may validly be of type <span style="font-family:monospace">M2::B</span>, which it does not know. By
creating an object reference of type <span style="font-family:monospace">M1::A</span> in this case, the
client is still able to call the object&#X2019;s <span style="font-family:monospace">opA()</span> operation. On the
other hand, if <span style="font-family:monospace">getObj()</span> returns an object of type <span style="font-family:monospace">M2::B</span>, the
ORB will create a reference to base <span style="font-family:monospace">CORBA::Object</span>, since that
is the target type.</p><p>Note that the ORB <em>never</em> rejects an object reference due to it
having the wrong type. Even if it knows that the received id is not
derived from the target interface (case 4), it might be the case that
the object actually has a more derived interface, which is derived
from both the type it is claiming to be <em>and</em> the target type.
That is, of course, extremely unlikely.</p><p>In cases 3 and 4, the ORB confirms the type of the object by calling
<span style="font-family:monospace">_is_a()</span> just before the first invocation on the object. If it
turns out that the object is not of the right type after all, the
<span style="font-family:monospace">CORBA.INV_OBJREF</span> exception is raised. The alternative to this
approach would be to check the types of object references when they
were received, rather than waiting until the first invocation. That
would be inefficient, however, since it is quite possible that a
received object reference will never be used. It may also cause
objects to be activated earlier than expected.</p><p>In summary, whenever your code receives an object reference, you
should bear in mind what omniORBpy&#X2019;s idea of the target type is. You
must not assume that the ORB will always correctly figure out a more
derived type than the target. One consequence of this is that you must
always narrow a plain <span style="font-family:monospace">CORBA::Object</span> to a more specific type
before invoking on it<sup><a id="text7" href="#note7">2</a></sup>. You
<em>can</em> assume that the object reference you receive is of the
target type, or something derived from it, although the object it
refers to may turn out to be invalid. The fact that omniORBpy often
<em>is</em> able figure out a more derived type than the target is only
useful when using the Python interactive command line.</p>
<!--TOC section id="sec36" Support for Any values-->
<h2 id="sec36" class="section">3.2&#XA0;&#XA0;Support for Any values</h2><!--SEC END --><p>In statically typed languages, such as C++, Anys can only be used with
built-in types and IDL-declared types for which stubs have been
generated. If, for example, a C++ program receives an Any containing a
struct for which it does not have static knowledge, it cannot easily
extract the struct contents. The only solution is to use the
inconvenient DynAny interface.</p><p>Since Python is a dynamically typed language, it does not have this
difficulty. When omniORBpy receives an Any containing types it does
not know, it is able to create new Python types which behave exactly
as if there were statically generated stubs available. Note that this
behaviour is not required by the Python mapping specification, so
other Python ORBs may not be so accommodating.</p><p>The equivalent of DynAny creation can be achieved by dynamically
writing and importing new IDL, as described in
section&#XA0;<a href="#sec%3AimportIDL">4.9</a>.</p><p>There is, however, a minor fly in the ointment when it comes to
receiving Anys. When an Any is transmitted, it is sent as a TypeCode
followed by the actual value. Normally, the TypeCodes for entities
with names&#X2014;members of structs, for example&#X2014;contain those names as
strings. That permits omniORBpy to create types with the corresponding
names. Unfortunately, the GIOP specification permits TypeCodes to be
sent with empty strings where the names would normally be. In this
situation, the types which omniORBpy creates cannot be given the
correct names. The contents of all types except structs and exceptions
can be accessed without having to know their names, through the
standard interfaces. Unknown structs, exceptions and valuetypes
received by omniORBpy have an attribute named &#X2018;<span style="font-family:monospace">_values</span>&#X2019; which
contains a sequence of the member values. This attribute is omniORBpy
specific.</p><p>Similarly, TypeCodes for constructed types such as structs and unions
normally contain the repository ids of those types. This means that
omniORBpy can use types statically declared in the stubs when they are
available. Once again, the specification permits the repository id
strings to be empty<sup><a id="text8" href="#note8">3</a></sup>. This means that even if stubs for a type
received in an Any are available, it may not be able to create a
Python value with the right type. For example, with a struct
definition such as:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">S</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">str</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">   </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The transmitted TypeCode for <span style="font-family:monospace">M::S</span> may contain only
the information that it is a structure containing a string followed by
a long, not that it is type <span style="font-family:monospace">M::S</span>, or what the member names are.</p><p>To cope with this situation, omniORBpy has an extension to the
standard interface which allows you to <span style="font-style:italic">coerce</span> an Any value to a
known type. Calling an Any&#X2019;s <span style="font-family:monospace">value()</span> method with a TypeCode
argument returns either a value of the requested type, or <span style="font-family:monospace">None</span>
if the requested TypeCode is not <span style="font-style:italic">equivalent</span> to the Any&#X2019;s
TypeCode. The following code is guaranteed to be safe, but is not
standard:</p><div class="lstlisting"><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># Acquire an Any from somewhere</span></span></span><span style="font-size:small">
</span><span style="font-size:small">v</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">.</span><span style="font-size:small">value</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">TypeCode</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">id</span><span style="font-size:small">(</span><span style="font-size:small">M</span><span style="font-size:small">.</span><span style="font-size:small">S</span><span style="font-size:small">)))</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> </span><span style="font-size:small">v</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">not</span></span><span style="font-size:small"> </span><span style="font-size:small">None</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small">v</span><span style="font-size:small">.</span><span style="font-size:small">str</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-size:small">"The Any does not contain a value compatible with M::S."</span></span></div>
<!--TOC subsection id="sec37" Any helper module-->
<h3 id="sec37" class="subsection">3.2.1&#XA0;&#XA0;Any helper module</h3><!--SEC END --><p>omniORBpy provides an alternative, non-standard way of constructing
and deconstructing Anys that is often more convenient to use in Python
programs. It uses Python&#X2019;s own dynamic typing to infer the TypeCodes
to use. The <span style="font-family:monospace">omniORB.any</span> module contains two functions,
<span style="font-family:monospace">to_any()</span> and <span style="font-family:monospace">from_any()</span>.</p><p><span style="font-family:monospace">to_any()</span> takes a Python object and tries to return it inside an
Any. It uses the following rules:</p><ul class="itemize"><li class="li-itemize">
Python strings are represented as CORBA strings.
</li><li class="li-itemize">Python unicode objects are represented as CORBA wstrings.
</li><li class="li-itemize">Python integers are represented as CORBA longs.</li><li class="li-itemize">Python long integers are represented as a CORBA integer type
taken from long, unsigned long, long long, unsigned long, depending on
what size type the Python long integer will fit in. If the value is
too large for any of these, <span style="font-family:monospace">CORBA.BAD_PARAM</span> is raised.</li><li class="li-itemize">Python lists and tuples of the types above are represented as
sequences of the corresponding CORBA types.</li><li class="li-itemize">Python lists and tuples of mixed types are represented as
sequences of Anys.</li><li class="li-itemize">Python dictionaries with string keys are represented as CORBA
structs, using the dictionary keys as the member names, and the
types of the dictionary values as the member types.</li><li class="li-itemize">Instances of CORBA types (structs, unions, enums, etc.)
generated by the IDL compiler are represented as themselves.
</li></ul><p>All other Python types result in a <span style="font-family:monospace">CORBA.BAD_PARAM</span> exception.</p><p>The <span style="font-family:monospace">from_any()</span> function works in reverse. It takes an Any as its
argument and extracts its contents using the same rules as
<span style="font-family:monospace">to_any()</span>. By default, CORBA structs are extracted to dictionaries;
if the optional <span style="font-family:monospace">keep_structs</span> argument is set true, they are
instead left as instances of the CORBA struct classes.</p>
<!--TOC section id="sec38" Interface Repository stubs-->
<h2 id="sec38" class="section">3.3&#XA0;&#XA0;Interface Repository stubs</h2><!--SEC END --><p>
<a id="sec:ifrstubs"></a></p><p>The Interface Repository interfaces are declared in IDL module
<span style="font-family:monospace">CORBA</span> so, according to the Python mapping, the stubs for them
should appear in the Python <span style="font-family:monospace">CORBA</span> module, along with all the
other CORBA definitions. However, since the stubs are extremely large,
omniORBpy does not include them by default. To do so would
unnecessarily increase the memory footprint and start-up time.</p><p>The Interface Repository stubs are automatically included if you
define the <span style="font-family:monospace">OMNIORBPY_IMPORT_IR_STUBS</span> environment variable.
Alternatively, you can import the stubs at run-time by calling the
<span style="font-family:monospace">omniORB.importIRStubs()</span> function. In both cases, the stubs become
available in the Python <span style="font-family:monospace">CORBA</span> module.</p>
<!--TOC section id="sec39" IDL attributes-->
<h2 id="sec39" class="section">3.4&#XA0;&#XA0;IDL attributes</h2><!--SEC END --><p>
<a id="sec:attributes"></a></p><p>The Python language mapping says that IDL attributes map to methods
with names prefixed <span style="font-family:monospace">_get_</span> and <span style="font-family:monospace">_set_</span>. omniORBpy
adheres to this standard mapping, but additionally supports access
using properties:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">attr1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">readonly</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">attr2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><div class="lstlisting"><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small"># an M::Example object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">attr1</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello"</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">attr2</span></div><p>Servant classes can similarly provide attribute values using simple
Python object attributes or properties. When invoking an attribute
getter or setter, omniORBpy first looks for a method with the standard
<span style="font-family:monospace">_get_</span> or <span style="font-family:monospace">_set_</span> name. If that is not found, a simple
attribute lookup is performed. This is therefore a complete
implementation of the <span style="font-family:monospace">M::Example</span> interface:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Example_i</span><span style="font-size:small"> (</span><span style="font-size:small">M__POA</span><span style="font-size:small">.</span><span style="font-size:small">Example</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">__init__</span><span style="font-size:small">(</span><span style="font-size:small">self</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">self</span><span style="font-size:small">.</span><span style="font-size:small">attr1</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Test"</span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">self</span><span style="font-size:small">.</span><span style="font-size:small">attr2</span><span style="font-size:small"> = 1234</span></div>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note6" href="#text6">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">It
is possible to change the repository id strings associated with
particular interfaces using the <span style="font-family:monospace">ID</span>, <span style="font-family:monospace">version</span> and
<span style="font-family:monospace">prefix</span> pragmas.</div></dd><dt class="dt-thefootnotes"><a id="note7" href="#text7">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Unless you are invoking pseudo
operations like <span style="font-family:monospace">_is_a()</span> and <span style="font-family:monospace">_non_existent()</span>.</div></dd><dt class="dt-thefootnotes"><a id="note8" href="#text8">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The use of empty repository id strings is
deprecated as of GIOP 1.2.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec40" omniORB configuration and API-->
<h1 id="sec40" class="chapter">Chapter&#XA0;4&#XA0;&#XA0;omniORB configuration and API</h1><!--SEC END --><p>
<a id="chap:config"></a></p><p>omniORB, and thus omniORBpy, has a wide range of parameters that can
be configured. They can be set in the configuration file / Windows
registry, as environment variables, or on the command line. A few
parameters can be configured at run time. This chapter lists all the
configuration parameters, and how they are used.</p>
<!--TOC section id="sec41" Setting parameters-->
<h2 id="sec41" class="section">4.1&#XA0;&#XA0;Setting parameters</h2><!--SEC END --><p>When <span style="font-family:monospace">CORBA::ORB_init()</span> is called, the value for each configuration
parameter is searched for in the following order:</p><ol class="enumerate" type=1><li class="li-enumerate">Command line arguments
</li><li class="li-enumerate">Environment variables
</li><li class="li-enumerate">Configuration file / Windows registry
</li><li class="li-enumerate">Built-in defaults</li></ol>
<!--TOC subsection id="sec42" Command line arguments-->
<h3 id="sec42" class="subsection">4.1.1&#XA0;&#XA0;Command line arguments</h3><!--SEC END --><p>
<a id="sec:ORBargs"></a></p><p>Command line arguments take the form
&#X2018;<span style="font-family:monospace">-ORB</span><span style="font-style:italic">parameter</span>&#X2019;, and usually expect another
argument. An example is &#X2018;<span style="font-family:monospace">-ORBtraceLevel 10</span>&#X2019;.</p>
<!--TOC subsection id="sec43" Environment variables-->
<h3 id="sec43" class="subsection">4.1.2&#XA0;&#XA0;Environment variables</h3><!--SEC END --><p>Environment variables consist of the parameter name prefixed with
&#X2018;<span style="font-family:monospace">ORB</span>&#X2019;. Using bash, for example</p><div class="lstlisting"><span style="font-size:small">export</span><span style="font-size:small"> </span><span style="font-size:small">ORBtraceLevel</span><span style="font-size:small">=10</span></div>
<!--TOC subsection id="sec44" Configuration file-->
<h3 id="sec44" class="subsection">4.1.3&#XA0;&#XA0;Configuration file</h3><!--SEC END --><p>The best way to understand the format of the configuration file is to
look at the <span style="font-family:monospace">sample.cfg</span> file in the omniORB distribution. Each
parameter is set on a single line like</p><pre class="verbatim">traceLevel = 10
</pre><p>Some parameters can have more than one value, in which case the
parameter name may be specified more than once, or you can leave it
out:</p><pre class="verbatim">InitRef = NameService=corbaname::host1.example.com
        = InterfaceRepository=corbaloc::host2.example.com:1234/IfR
</pre><div class="minipage"><hr style="height:2"><dl class="list"><dt class="dt-list">

</dt><dd class="dd-list">
Note how command line arguments and environment variables prefix
parameter names with &#X2018;-ORB&#X2019; and &#X2018;ORB&#X2019; respectively, but the
configuration file does not use a prefix.
</dd></dl><hr style="height:2"></div>
<!--TOC subsection id="sec45" Windows registry-->
<h3 id="sec45" class="subsection">4.1.4&#XA0;&#XA0;Windows registry</h3><!--SEC END --><p>On Windows, configuration parameters can be stored in the registry,
under the key <span style="font-family:monospace">HKEY_LOCAL_MACHINE\SOFTWARE\omniORB</span>.</p><p>The file <span style="font-family:monospace">sample.reg</span> shows the settings that can be made. It can
be edited and then imported into regedit.</p>
<!--TOC section id="sec46" Tracing options-->
<h2 id="sec46" class="section">4.2&#XA0;&#XA0;Tracing options</h2><!--SEC END --><p>The following options control debugging trace output.</p><p><span style="font-family:monospace">traceLevel</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>omniORB can output tracing and diagnostic messages to the standard
error stream. The following levels are defined:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 0</td><td style="vertical-align:top;text-align:left;" >critical errors only</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 1</td><td style="vertical-align:top;text-align:left;" >informational messages only</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 2</td><td style="vertical-align:top;text-align:left;" >configuration information and warnings</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 5</td><td style="vertical-align:top;text-align:left;" >notifications when server threads are
created and communication endpoints are shutdown</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 10</td><td style="vertical-align:top;text-align:left;" >execution and exception traces</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 25</td><td style="vertical-align:top;text-align:left;" >trace each send or receive of a GIOP message</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 30</td><td style="vertical-align:top;text-align:left;" >dump up to 128 bytes of each GIOP message</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 40</td><td style="vertical-align:top;text-align:left;" >dump complete contents of each GIOP message</td></tr>
</table><p>The trace level is cumulative, so at level 40, all trace
messages are output.</p><p><span style="font-family:monospace">traceExceptions</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceExceptions</span> parameter is set <span style="font-family:monospace">true</span>, all system
exceptions are logged as they are thrown, along with details about
where the exception is thrown from. This parameter is enabled by
default if the traceLevel is set to 10 or more.</p><p><span style="font-family:monospace">traceInvocations</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceInvocations</span> parameter is set <span style="font-family:monospace">true</span>, all local
and remote invocations are logged, in addition to any logging that may
have been selected with <span style="font-family:monospace">traceLevel</span>.</p><p><span style="font-family:monospace">traceInvocationReturns</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceInvocationReturns</span> parameter is set <span style="font-family:monospace">true</span>, a
log message is output as an operation invocation returns. In
conjunction with <span style="font-family:monospace">traceInvocations</span> and <span style="font-family:monospace">traceTime</span>
(described below), this provides a simple way of timing CORBA calls
within your application.</p><p><span style="font-family:monospace">traceThreadId</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">traceThreadId</span> is set <span style="font-family:monospace">true</span>, all trace messages are
prefixed with the id of the thread outputting the message. This can be
handy for making sense of multi-threaded code, but it adds overhead to
the logging so it can be disabled.</p><p><span style="font-family:monospace">traceTime</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">traceTime</span> is set <span style="font-family:monospace">true</span>, all trace messages are
prefixed with the time. This is useful, but on some platforms it adds
a very large overhead, so it can be turned off.</p><p><span style="font-family:monospace">traceFile</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
</p><p>omniORB&#X2019;s tracing is normally sent to stderr. If <span style="font-family:monospace">traceFile</span> it
set, the specified file name is used for trace messages.</p>
<!--TOC subsection id="sec47" Tracing API-->
<h3 id="sec47" class="subsection">4.2.1&#XA0;&#XA0;Tracing API</h3><!--SEC END --><p>The tracing parameters can be inspected or modified at runtime with
the following functions in the <span style="font-family:monospace">omniORB</span> module:</p><div class="lstlisting"><span style="font-size:small">  </span><span style="font-size:small">traceLevel</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">traceExceptions</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">traceInvocations</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">traceInvocationReturns</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">traceThreadId</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">traceTime</span><span style="font-size:small">()</span></div><p>Calling one of the functions with no arguments returns the current
value; calling it with a single integer argument sets the value.</p>
<!--TOC section id="sec48" Miscellaneous global options-->
<h2 id="sec48" class="section">4.3&#XA0;&#XA0;Miscellaneous global options</h2><!--SEC END --><p>These options control miscellaneous features that affect the whole ORB
runtime.</p><p><span style="font-family:monospace">dumpConfiguration</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, the ORB dumps the values of all configuration
parameters at start-up.</p><p><span style="font-family:monospace">scanGranularity</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>As explained in chapter&#XA0;<a href="#chap%3Aconnections">6</a>, omniORB regularly
scans incoming and outgoing connections, so it can close unused
ones. This value is the granularity in seconds at which the ORB
performs its scans. A value of zero turns off the scanning altogether.</p><p><span style="font-family:monospace">nativeCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">ISO-8859-1</span></p><p>The native code set the application is using for <span style="font-family:monospace">char</span> and
<span style="font-family:monospace">string</span>. See chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">nativeWCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">UTF-16</span></p><p>The native code set the application is using for <span style="font-family:monospace">wchar</span> and
<span style="font-family:monospace">wstring</span>. See chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">defaultCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>The default code set used for <span style="font-family:monospace">char</span> and <span style="font-family:monospace">string</span> if the
server does not specify it in its IORs. See
chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">defaultWCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>The default code set used for <span style="font-family:monospace">wchar</span> and <span style="font-family:monospace">wstring</span> if the
server does not specify it in its IORs. See
chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">copyValuesInLocalCalls</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>Determines whether valuetype parameters in local calls are copied or
not. See chapter&#XA0;<a href="#chap%3Avaluetype">10</a>.</p><p><span style="font-family:monospace">abortOnInternalError</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If this is set <span style="font-family:monospace">true</span>, internal fatal errors will abort
immediately, rather than throwing the <span style="font-family:monospace">omniORB::fatalException</span>
exception. This can be helpful for tracking down bugs, since it
leaves the call stack intact.</p><p><span style="font-family:monospace">abortOnNativeException</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>On Windows, &#X2018;native&#X2019; exceptions such as segmentation faults and divide
by zero appear as C++ exceptions that can be caught with <span style="font-family:monospace">catch
(...)</span>. Setting this parameter to <span style="font-family:monospace">true</span> causes such exceptions
to abort the process instead.</p><p><span style="font-family:monospace">maxSocketSend</span><br>
<span style="font-family:monospace">maxSocketRecv</span><br>

On some platforms, calls to send() and recv() have a limit on the
buffer size that can be used. These parameters set the limits in bytes
that omniORB uses when sending / receiving bulk data.</p><p>The default values are platform specific. It is unlikely that you will
need to change the values from the defaults.</p><p>The minimum valid limit is 1KB, 1024 bytes.</p><p><span style="font-family:monospace">socketSendBuffer</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">-1 </span><span style="font-family:monospace"><span style="font-style:italic">or</span></span><span style="font-family:monospace"> 16384</span></p><p>On Windows, there is a kernel buffer used during send operations. A
bug in Windows means that if a send uses the entire kernel buffer, a
select() on the socket blocks until all the data has been acknowledged
by the receiver, resulting in dreadful performance. This parameter
modifies the socket send buffer from its default (8192 bytes on
Windows) to the value specified. If this parameter is set to -1, the
socket send buffer is left at the system default.</p><p>On Windows, the default value of this parameter is 16384 bytes; on all
other platforms the default is -1.</p><p><span style="font-family:monospace">validateUTF8</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>When transmitting a string that is supposed to be UTF-8, omniORB
usually passes it directly, assuming that it is valid. With this
parameter set <span style="font-family:monospace">true</span>, omniORB checks that all UTF-8 strings are
valid, and throws DATA_CONVERSION if not.</p>
<!--TOC section id="sec49" Client side options-->
<h2 id="sec49" class="section">4.4&#XA0;&#XA0;Client side options</h2><!--SEC END --><p>
<a id="sec:clientconf"></a></p><p>These options control aspects of client-side behaviour.</p><p><span style="font-family:monospace">InitRef</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>Specify objects available from
<span style="font-family:monospace">orb.resolve_initial_references()</span>. The arguments take the form
&lt;<span style="font-style:italic">key</span>&gt;=&lt;<span style="font-style:italic">uri</span>&gt;, where the <span style="font-style:italic">key</span> is the name
given to <span style="font-family:monospace">resolve_initial_references()</span> and
<span style="font-style:italic">uri</span> is a valid CORBA object reference URI, as detailed in
chapter&#XA0;<a href="#chap%3Ains">7</a>.</p><p><span style="font-family:monospace">DefaultInitRef</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>Specify the default URI prefix for
<span style="font-family:monospace">resolve_initial_references()</span>, as explained in
chapter&#XA0;<a href="#chap%3Ains">7</a>.</p><p><span style="font-family:monospace">clientTransportRule</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">* unix,tcp,ssl</span></p><p>Used to specify the way the client contacts a server, depending on the
server&#X2019;s address. See section&#XA0;<a href="#sec%3AclientRule">6.7.1</a> for details.</p><p><span style="font-family:monospace">clientCallTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Call timeout in milliseconds for the client side. If a call takes
longer than the specified number of milliseconds, the ORB closes the
connection to the server and raises a <span style="font-family:monospace">TRANSIENT</span> exception. A
value of zero means no timeout; calls can block for ever. See
section&#XA0;<a href="#sec%3AtimeoutAPI">6.3.1</a> for more information about timeouts.</p><p><span style="font-weight:bold">Note</span>: omniORB 3 had timeouts specified in seconds;
omniORB 4.0 and later use milliseconds for timeouts.</p><p><span style="font-family:monospace">clientConnectTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>The timeout that is used in the case that a new network connection is
established to the server. A value of zero means that the normal call
timeout is used. See section&#XA0;<a href="#sec%3AtimeoutAPI">6.3.1</a> for more information
about timeouts.</p><p><span style="font-family:monospace">supportPerThreadTimeOut</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If this parameter is set <span style="font-family:monospace">true</span>, timeouts can be set on a per
thread basis, as well as globally and per object. Checking per-thread
storage has a noticeable performance impact, so it is turned off by
default.</p><p><span style="font-family:monospace">resetTimeoutOnRetries</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, the call timeout is reset when an exception handler
causes a call to be retried. If <span style="font-family:monospace">false</span>, the timeout is not
reset, and therefore applies to the call as a whole, rather than to
each individual call attempt.</p><p><span style="font-family:monospace">throwTransientOnTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>omniORB 4.2 supports the <span style="font-family:monospace">CORBA::TIMEOUT</span> exception that is part
of the CORBA Messaging specification. By default, that is the
exception thrown when timeouts occur. Previous omniORB releases did
not have the <span style="font-family:monospace">CORBA::TIMEOUT</span> exception, and instead used
<span style="font-family:monospace">CORBA::TRANSIENT</span>. If this parameter is set <span style="font-family:monospace">true</span>, omniORB
follows the old behaviour of throwing <span style="font-family:monospace">CORBA::TRANSIENT</span> when a
timeout occurs.</p><p><span style="font-family:monospace">outConScanPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">120</span></p><p>Idle timeout in seconds for outgoing (i.e. client initiated)
connections. If a connection has been idle for this amount of time,
the ORB closes it. See section&#XA0;<a href="#sec%3AconnShutdown">6.5</a>.</p><p><span style="font-family:monospace">maxGIOPConnectionPerServer</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>The maximum number of concurrent connections the ORB will open to a
<em>single</em> server. If multiple threads on the client call the same
server, the ORB opens additional connections to the server, up to the
maximum specified by this parameter. If the maximum is reached,
threads are blocked until a connection becomes free for them to use.</p><p><span style="font-family:monospace">oneCallPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>When this parameter is set to <span style="font-family:monospace">true</span> (the default), the ORB will
only send a single call on a connection at a time. If multiple client
threads invoke on the same server, multiple connections are opened, up
to the limit specified by
<span style="font-family:monospace">maxGIOPConnectionPerServer</span>. With this parameter set to
<span style="font-family:monospace">false</span>, the ORB will allow concurrent calls on a single
connection. This saves connection resources, but requires slightly
more management work for both client and server. Some server-side ORBs
(including omniORB versions before 4.0) serialise all incoming calls
on a single connection.</p><p><span style="font-family:monospace">maxInterleavedCallsPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>The maximum number of calls that can be interleaved on a connection.
If more concurrent calls are made, they are queued.</p><p><span style="font-family:monospace">offerBiDirectionalGIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, the client will indicate to servers that it is
willing to accept callbacks on client-initiated connections using
bidirectional GIOP, provided the relevant POA policies are set. See
section&#XA0;<a href="#sec%3Abidir">6.8</a>.</p><p><span style="font-family:monospace">verifyObjectExistsAndType</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>By default, omniORB uses the GIOP <span style="font-family:monospace">LOCATE_REQUEST</span> message to
verify the existence of an object prior to the first invocation. In
the case that the full type of the object is not known, it instead
calls the <span style="font-family:monospace">_is_a()</span> operation to check the object&#X2019;s type. Some ORBs
have bugs that mean one or other of these operations fail. Setting
this parameter <span style="font-family:monospace">false</span> prevents omniORB from making these calls.</p><p><span style="font-family:monospace">giopTargetAddressMode</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>GIOP 1.2 supports three addressing modes for contacting objects. This
parameter selects the mode that omniORB uses. A value of 0 means
<span style="font-family:monospace">GIOP::KeyAddr</span>; 1 means <span style="font-family:monospace">GIOP::ProfileAddr</span>; 2 means
<span style="font-family:monospace">GIOP::ReferenceAddr</span>.</p><p><span style="font-family:monospace">immediateAddressSwitch</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, the client will immediately switch to use a new
address to contact an object after a failure. If <span style="font-family:monospace">false</span> (the
default), the current address will be retried in certain
circumstances.</p><p><span style="font-family:monospace">resolveNamesForTransportRules</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span>, names in IORs will be resolved when evaluating client
transport rules, and remembered from then on; if <span style="font-family:monospace">false</span>, names
will not be resolved until connect time. Client transport rules based
on IP address will therefore not match, but some platforms can use
external knowledge to pick the best address to use if given a name to
connect to.</p><p><span style="font-family:monospace">retainAddressOrder</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>For IORs with multiple addresses, determines how the address to
connect to is chosen. When first establishing a connection, the
addresses are ordered according to the client transport rules (after
resolving names if <span style="font-family:monospace">resolveNamesForTransportRules</span> is
<span style="font-family:monospace">true</span>), and the addresses are tried in priority order until one
connects successfully. For as long as there is at least one connection
open to the address, new connections continue to use the same address.</p><p>After a failure, or after all open connections have been scavenged and
closed, this parameter determines the address used to reconnect on the
next call. If this parameter is <span style="font-family:monospace">true</span> (the default), the address
order and chosen address within the order is remembered; if
<span style="font-family:monospace">false</span>, a new connection attempt causes re-evaluation of the
order (in case name resolutions change), and the highest priority
address is tried first.</p><p><span style="font-family:monospace">bootstrapAgentHostname</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>If set, this parameter indicates the hostname to use for look-ups
using the obsolete Sun bootstrap agent. This mechanism is superseded
by the interoperable naming service.</p><p><span style="font-family:monospace">bootstrapAgentPort</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">900</span></p><p>The port number for the obsolete Sun bootstrap agent.</p><p><span style="font-family:monospace">principal</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>GIOP 1.0 and 1.1 have a request header field named &#X2018;principal&#X2019;, which
contains a sequence of octets. It was never defined what it should
mean, and its use is now deprecated; GIOP 1.2 has no such field. Some
systems (e.g. Gnome) use the principal field as a primitive
authentication scheme. This parameter sets the data omniORB uses in
the principal field. The default is an empty sequence.</p>
<!--TOC section id="sec50" Server side options-->
<h2 id="sec50" class="section">4.5&#XA0;&#XA0;Server side options</h2><!--SEC END --><p>These parameters affect server-side operations.</p><p><span style="font-family:monospace">endPoint&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> = <span style="font-family:monospace">giop:tcp::</span><br>
<span style="font-family:monospace">endPointNoListen</span><br>
<span style="font-family:monospace">endPointPublish</span><br>
<span style="font-family:monospace">endPointNoPublish</span><br>
<span style="font-family:monospace">endPointPublishAllIFs</span><br>

These options determine the end-points the ORB should listen on, and
the details that should be published in IORs. See
chapter&#XA0;<a href="#chap%3Aconnections">6</a> for details.</p><p><span style="font-family:monospace">serverTransportRule</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">* unix,tcp,ssl</span></p><p>Configure the rules about whether a server should accept an incoming
connection from a client. See section&#XA0;<a href="#sec%3AserverRule">6.7.2</a> for
details.</p><p><span style="font-family:monospace">serverCallTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>This timeout is used to catch the situation that the server starts
receiving a request, but the end of the request never comes. If a
calls takes longer than the specified number of milliseconds to
arrive, the ORB shuts the connection. A value of zero means never
timeout.</p><p><span style="font-family:monospace">inConScanPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">180</span></p><p>Idle timeout in seconds for incoming connections. If a connection has
been idle for this amount of time, the ORB closes it. See
section&#XA0;<a href="#sec%3AconnShutdown">6.5</a>.</p><p><span style="font-family:monospace">threadPerConnectionPolicy</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span> (the default), the ORB dedicates one server thread to
each incoming connection. Setting it <span style="font-family:monospace">false</span> means the server
should use a thread pool.</p><p><span style="font-family:monospace">maxServerThreadPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">100</span></p><p>If the client multiplexes several concurrent requests on a single
connection, omniORB uses extra threads to service them. This parameter
specifies the maximum number of threads that are allowed to service a
single connection at any one time.</p><p><span style="font-family:monospace">maxServerThreadPoolSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">100</span></p><p>The maximum number of threads the server will allocate to do various
tasks, including dispatching calls in the thread pool mode. This
number does not include threads dispatched under the thread per
connection server mode.</p><p><span style="font-family:monospace">threadPerConnectionUpperLimit</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">10000</span></p><p>If the <span style="font-family:monospace">threadPerConnectionPolicy</span> parameter is <span style="font-family:monospace">true</span>, the
ORB can automatically transition to thread pool mode if too many
connections arrive. This parameter sets the number of connections at
which thread pooling is started. The default of 10000 is designed to
mean that it never happens.</p><p><span style="font-family:monospace">threadPerConnectionLowerLimit</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">9000</span></p><p>If thread pooling was started because the number of connections hit
the upper limit, this parameter determines when thread per connection
should start again.</p><p><span style="font-family:monospace">threadPoolWatchConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>After dispatching an upcall in thread pool mode, the thread that has
just performed the call can watch the connection for a short time
before returning to the pool. This leads to less thread switching for
a series of calls from a single client, but is less fair if there are
concurrent clients. The connection is watched if the number of threads
concurrently handling the connection is less than or equal to the
value of this parameter. i.e. if the parameter is zero, the
connection is never watched; if it is 1, the last thread managing a
connection watches it; if 2, the connection is still watched if there
is one other thread still in an upcall for the connection, and so
on. See section&#XA0;<a href="#sec%3AwatchConn">6.4.2</a>.</p><p><span style="font-family:monospace">connectionWatchPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">50000</span></p><p>For each endpoint, the ORB allocates a thread to watch for new
connections and to monitor existing connections for calls that should
be handed by the thread pool. The thread blocks in select() or similar
for a period, after which it re-scans the lists of connections it
should watch. This parameter is specified in microseconds.</p><p><span style="font-family:monospace">connectionWatchImmediate</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>When a thread handles an incoming call, it unmarshals the arguments
then marks the connection as watchable by the connection watching
thread, in case the client sends a concurrent call on the same
connection. If this parameter is set to the default <span style="font-family:monospace">false</span>, the
connection is not actually watched until the next connection watch
period (determined by the <span style="font-family:monospace">connectionWatchPeriod</span> parameter). If
this parameter is set <span style="font-family:monospace">true</span>, the connection watching thread is
immediately signalled to watch the connection. That leads to faster
interactive response to clients that multiplex calls, but adds
significant overhead along the call chain.</p><p>Note that this setting has no effect on Windows, since it has no
mechanism for signalling the connection watching thread.</p><p><span style="font-family:monospace">acceptBiDirectionalGIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Determines whether a server will ever accept clients&#X2019; offers of
bidirectional GIOP connections. See section&#XA0;<a href="#sec%3Abidir">6.8</a>.</p><p><span style="font-family:monospace">unixTransportDirectory</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">/tmp/omni-%u</span></p><p>(Unix platforms only). Selects the location used to store Unix domain
sockets. The &#X2018;<span style="font-family:monospace">%u</span>&#X2019; is expanded to the user name.</p><p><span style="font-family:monospace">unixTransportPermission</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0777</span></p><p>(Unix platforms only). Determines the octal permission bits for Unix
domain sockets. By default, all users can connect to a server, just as
with TCP.</p><p><span style="font-family:monospace">supportCurrent</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>omniORB supports the <span style="font-family:monospace">PortableServer::Current</span> interface to
provide thread context information to servants. Supporting current has
a small but noticeable run-time overhead due to accessing thread
specific storage, so this option allows it to be turned off.</p><p><span style="font-family:monospace">objectTableSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Hash table size of the Active Object Map. If this is zero, the ORB
uses a dynamically resized open hash table. This is normally the best
option, but it leads to less predictable performance since any
operation which adds or removes a table entry may trigger a resize. If
set to a non-zero value, the hash table has the specified number of
entries, and is never resized. Note that the hash table is open, so
this does not limit the number of active objects, just how efficiently
they can be located.</p><p><span style="font-family:monospace">poaHoldRequestTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If a POA is put in the <span style="font-family:monospace">HOLDING</span> state, calls to it will be timed
out after the specified number of milliseconds, by raising a
<span style="font-family:monospace">CORBA.TIMEOUT</span> exception. Zero means no timeout.</p><p><span style="font-family:monospace">poaUniquePersistentSystemIds</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>The POA specification requires that object ids in POAs with the
PERSISTENT and SYSTEM_ID policies are unique between instantiations
of the POA. Older versions of omniORB did not comply with that, and
reused object ids. With this value <span style="font-family:monospace">true</span>, the POA has the
correct behaviour; with <span style="font-family:monospace">false</span>, the POA uses the old scheme for
compatibility.</p><p><span style="font-family:monospace">idleThreadTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">10</span></p><p>When a thread created by omniORB becomes idle, it is kept alive for a
while, in case a new thread is required. Once a thread has been idle
for the number of seconds specified in this parameter, it exits.</p><p><span style="font-family:monospace">supportBootstrapAgent</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, servers support the Sun bootstrap agent protocol.</p>
<!--TOC section id="sec51" GIOP and interoperability options-->
<h2 id="sec51" class="section">4.6&#XA0;&#XA0;GIOP and interoperability options</h2><!--SEC END --><p>These options control omniORB&#X2019;s use of GIOP, and cover some areas
where omniORB can work around buggy behaviour by other ORBs.</p><p><span style="font-family:monospace">maxGIOPVersion</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1.2</span></p><p>Choose the maximum GIOP version the ORB should support. Valid values
are 1.0, 1.1 and 1.2.</p><p><span style="font-family:monospace">giopMaxMsgSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">2097152</span></p><p>The largest message, in bytes, that the ORB will send or receive, to
avoid resource starvation. If the limit is exceeded, a <span style="font-family:monospace">MARSHAL</span>
exception is thrown. The size must be &gt;= 8192.</p><p><span style="font-family:monospace">strictIIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span>, be strict about interpretation of the IIOP
specification; if <span style="font-family:monospace">false</span>, permit some buggy behaviour to pass.</p><p><span style="font-family:monospace">lcdMode</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, select &#X2018;Lowest Common Denominator&#X2019; mode. This disables
various IIOP and GIOP features that are known to cause problems with
some ORBs.</p><p><span style="font-family:monospace">tcAliasExpand</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>This flag is used to indicate whether TypeCodes associated with Anys
should have aliases removed. This functionality is included because
some ORBs will not recognise an Any containing a TypeCode with aliases
to be the same as the actual type contained in the Any. There is a
performance penalty when inserting into an Any if <span style="font-family:monospace">tcAliasExpand</span>
is set to 1.</p><p><span style="font-family:monospace">useTypeCodeIndirections</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>TypeCode Indirections reduce the size of marshalled TypeCodes, and are
essential for recursive types, but some old ORBs do not support them.
Setting this flag to <span style="font-family:monospace">false</span> prevents the use of indirections
(and, therefore, prevents the use of recursive TypeCodes).</p><p><span style="font-family:monospace">acceptMisalignedTcIndirections</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, try to fix a mis-aligned indirection in a
typecode. This is used to work around a bug in some old versions of
Visibroker&#X2019;s Java ORB.</p>
<!--TOC section id="sec52" System Exception Handlers-->
<h2 id="sec52" class="section">4.7&#XA0;&#XA0;System Exception Handlers</h2><!--SEC END --><p>
<a id="sec:exHandlers"></a></p><p>By default, all system exceptions that are raised during an operation
invocation, with the exception of some cases of
<span style="font-family:monospace">CORBA.TRANSIENT</span>, are propagated to the application code. Some
applications may prefer to trap these exceptions within the proxy
objects so that the application logic does not have to deal with the
error condition. For example, when a <span style="font-family:monospace">CORBA.COMM_FAILURE</span> is
received, an application may just want to retry the invocation until
it finally succeeds. This approach is useful for objects that are
persistent and have idempotent operations.</p><p>omniORBpy provides a set of functions to install exception handlers.
Once they are installed, proxy objects will call these handlers when
the associated system exceptions are raised by the ORB runtime.
Handlers can be installed for <span style="font-family:monospace">CORBA.TRANSIENT</span>,
<span style="font-family:monospace">CORBA.COMM_FAILURE</span> and <span style="font-family:monospace">CORBA.SystemException</span>. This
last handler covers all system exceptions other than the two covered
by the first two handlers. An exception handler can be installed for
individual proxy objects, or it can be installed for all proxy objects
in the address space.</p>
<!--TOC subsection id="sec53" Minor codes-->
<h3 id="sec53" class="subsection">4.7.1&#XA0;&#XA0;Minor codes</h3><!--SEC END --><p>omniORB makes extensive use of exception minor codes to indicate the
specific circumstances surrounding a system exception. The C++ file
<span style="font-family:monospace">include/omniORB4/minorCode.h</span> contains definitions of all the
minor codes used in omniORB, covering codes allocated in the CORBA
specification, and ones specific to omniORB.</p><p>Applications can use minor codes to adjust their behaviour according
to the condition. You can receive a string format of a minor code by
calling the <span style="font-family:monospace">omniORB.minorCodeToString()</span> function, passing an
exception object as its argument.</p>
<!--TOC subsection id="sec54" CORBA.TRANSIENT handlers-->
<h3 id="sec54" class="subsection">4.7.2&#XA0;&#XA0;CORBA.TRANSIENT handlers</h3><!--SEC END --><p><span style="font-family:monospace">TRANSIENT</span> exceptions can occur in many circumstances. One
circumstance is as follows:</p><ol class="enumerate" type=1><li class="li-enumerate">The client invokes on an object reference.
</li><li class="li-enumerate">The object replies with a <span style="font-family:monospace">LOCATION_FORWARD</span> message.
</li><li class="li-enumerate">The client caches the new location and retries to the new location.
</li><li class="li-enumerate">Time passes...
</li><li class="li-enumerate">The client tries to invoke on the object again, using the
cached, forwarded location. 
</li><li class="li-enumerate">The attempt to contact the object fails.
</li><li class="li-enumerate">The ORB runtime resets the location cache and throws a
<span style="font-family:monospace">TRANSIENT</span> exception with minor code
<span style="font-family:monospace">TRANSIENT_FailedOnForwarded</span>.</li></ol><p>In this situation, the default <span style="font-family:monospace">TRANSIENT</span> exception handler
retries the call, using the object&#X2019;s original location. If the retry
results in another <span style="font-family:monospace">LOCATION_FORWARD</span>, to the same or a
different location, and <em>that</em> forwarded location fails
immediately, the <span style="font-family:monospace">TRANSIENT</span> exception will occur again, and the
pattern will repeat. With repeated exceptions, the handler starts
adding delays before retries, with exponential back-off.</p><p>In all other circumstances, the default <span style="font-family:monospace">TRANSIENT</span> handler just
passes the exception on to the caller.</p><p>You can override the default behaviour by installing your own
exception handler. The function to call has signature:</p><div class="lstlisting"><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">installTransientExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">cookie</span><span style="font-size:small">, </span><span style="font-size:small">function</span><span style="font-size:small"> [, </span><span style="font-size:small">object</span><span style="font-size:small">])</span></div><p>The arguments are a cookie, which is any Python object, a call-back
function, and optionally an object reference. If the object reference
is present, the exception handler is installed for just that object;
otherwise the handler is installed for all objects with no handler of
their own.</p><p>The call-back function must have the signature</p><div class="lstlisting"><span style="font-size:small">function</span><span style="font-size:small">(</span><span style="font-size:small">cookie</span><span style="font-size:small">, </span><span style="font-size:small">retries</span><span style="font-size:small">, </span><span style="font-size:small">exc</span><span style="font-size:small">) -&gt; </span><span style="font-size:small">boolean</span></div><p>When a <span style="font-family:monospace">TRANSIENT</span> exception occurs, the callback function is
called, passing the cookie object, a count of how many times the
operation has been retried, and the TRANSIENT exception object
itself. If the function returns true, the operation is retried; if it
returns false, the original exception is raised in the application. In
the case of a <span style="font-family:monospace">TRANSIENT</span> exception due to a failed location
forward, the exception propagated to the application is the
<em>original</em> exception that caused the <span style="font-family:monospace">TRANSIENT</span> (e.g. a
<span style="font-family:monospace">COMM_FAILURE</span> or <span style="font-family:monospace">OBJECT_NOT_EXIST</span>), rather than the
<span style="font-family:monospace">TRANSIENT</span> exception<sup><a id="text9" href="#note9">1</a></sup>.</p>
<!--TOC subsection id="sec55" CORBA.TIMEOUT-->
<h3 id="sec55" class="subsection">4.7.3&#XA0;&#XA0;CORBA.TIMEOUT</h3><!--SEC END --><p>When a call timeout occurs, by default the ORB raises
<span style="font-family:monospace">CORBA.TIMEOUT</span>. The default behaviour of the proxy objects is
to propagate this exception to the application. Applications can
override the default behaviour by installing their own exception
handlers in the same manner as for <span style="font-family:monospace">TRANSIENT</span> exceptions:</p><div class="lstlisting"><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">installTimeoutExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">cookie</span><span style="font-size:small">, </span><span style="font-size:small">function</span><span style="font-size:small"> [, </span><span style="font-size:small">object</span><span style="font-size:small">])</span></div><p>The call-back function has the same signature as for <span style="font-family:monospace">TRANSIENT</span>
handlers. There is no default handler, do <span style="font-family:monospace">TIMEOUT</span> exceptions
are propagated to application code by default.</p><p>omniORB version 4.1 and earlier did not have the <span style="font-family:monospace">CORBA.TIMEOUT</span>
exception, and threw <span style="font-family:monospace">CORBA.TRANSIENT</span> instead. If the
<span style="font-family:monospace">throwTransientOnTimeout</span> configuration parameter is set to
<span style="font-family:monospace">1</span>, omniORB 4.2 reverts to this behaviour, and calls the
transient exception handler instead of the timeout exception handler.</p><p>The timeout exception handler is used when a CORBA call times out. It
is <em>not</em> called when an AMI poller operation throws
<span style="font-family:monospace">CORBA.TIMEOUT</span>. In that situation, the exception is always
propagated to the caller.</p>
<!--TOC subsection id="sec56" CORBA.COMM_FAILURE and CORBA.SystemException-->
<h3 id="sec56" class="subsection">4.7.4&#XA0;&#XA0;CORBA.COMM_FAILURE and CORBA.SystemException</h3><!--SEC END --><p>There are two other functions for registering exception handlers: one
for <span style="font-family:monospace">CORBA.COMM_FAILURE</span>, and one for all other
exceptions. For both these cases, the default is for there to be no
handler, so exceptions are propagated to the application.</p><p>If the ORB has successfully contacted a server at some point, and
access to it subsequently fails (and the condition for
<span style="font-family:monospace">TRANSIENT</span> described above does not occur), the ORB raises a
<span style="font-family:monospace">CORBA.COMM_FAILURE</span> exception.</p><div class="lstlisting"><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">installCommFailureExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">cookie</span><span style="font-size:small">, </span><span style="font-size:small">function</span><span style="font-size:small"> [, </span><span style="font-size:small">object</span><span style="font-size:small">])</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">installSystemExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">cookie</span><span style="font-size:small">, </span><span style="font-size:small">function</span><span style="font-size:small"> [, </span><span style="font-size:small">object</span><span style="font-size:small">])</span></div><p>In both cases, the call-back function has the same signature
as for <span style="font-family:monospace">TRANSIENT</span> handlers.</p>
<!--TOC section id="sec57" Location forwarding-->
<h2 id="sec57" class="section">4.8&#XA0;&#XA0;Location forwarding</h2><!--SEC END --><p>
<a id="sec:locationForward"></a></p><p>Any CORBA operation invocation can return a <span style="font-family:monospace">LOCATION_FORWARD</span>
message to the caller, indicating that it should retry the invocation
on a new object reference. The standard allows ServantManagers to
trigger <span style="font-family:monospace">LOCATION_FORWARD</span>s by raising the
<span style="font-family:monospace">PortableServer.ForwardRequest</span> exception, but it does not
provide a similar mechanism for normal servants. omniORB provides the
<span style="font-family:monospace">omniORB.LOCATION_FORWARD</span> exception for this purpose. It
can be thrown by any operation implementation.</p>
<!--TOC section id="sec58" Dynamic importing of IDL-->
<h2 id="sec58" class="section">4.9&#XA0;&#XA0;Dynamic importing of IDL</h2><!--SEC END --><p>
<a id="sec:importIDL"></a></p><p>omniORBpy is usually used with pre-generated stubs. Since Python is a
dynamic language, however, it is possible to compile and import new
stubs at run-time.</p><p>Dynamic importing is achieved with <span style="font-family:monospace">omniORB.importIDL()</span> and
<span style="font-family:monospace">omniORB.importIDLString()</span>. Their signatures are:</p><div class="lstlisting"><span style="font-size:small">importIDL</span><span style="font-size:small">(</span><span style="font-size:small">filename</span><span style="font-size:small"> [, </span><span style="font-size:small">args</span><span style="font-size:small"> ]) -&gt; </span><span style="font-size:small">tuple</span><span style="font-size:small">
</span><span style="font-size:small">importIDLString</span><span style="font-size:small">(</span><span style="font-size:small">string</span><span style="font-size:small"> [, </span><span style="font-size:small">args</span><span style="font-size:small"> ]) -&gt; </span><span style="font-size:small">tuple</span></div><p>The first function compiles and imports the specified file; the second
takes a string containing the IDL definitions. The functions work by
forking omniidl and importing its output<sup><a id="text10" href="#note10">2</a></sup>; they both take an optional
argument containing a list of strings which are used as arguments for
omniidl. For example, the following command runs omniidl with an
include path set:</p><div class="lstlisting"><span style="font-size:small">m</span><span style="font-size:small"> = </span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">importIDL</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"test.idl"</span></span><span style="font-size:small">, [</span><span style="font-size:small"><span style="font-size:small">"-I/my/include/path"</span></span><span style="font-size:small">])</span></div><p>Instead of specifying omniidl arguments on each import, you can set
the arguments to be used for all calls using the
<span style="font-family:monospace">omniORB.omniidlArguments()</span> function.</p><p>Both import functions return a tuple containing the names of the
Python modules that have been imported. The modules themselves can be
accessed through <span style="font-family:monospace">sys.modules</span>. For example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// test.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-size:small">"Hello"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M2</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">l</span><span style="font-size:small"> = 42;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M3</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">short</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small"> = 5;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>From Python:</p><div class="lstlisting"><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small"><span style="font-weight:bold">import</span></span><span style="font-size:small"> </span><span style="font-size:small">sys</span><span style="font-size:small">, </span><span style="font-size:small">omniORB</span><span style="font-size:small">
</span><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">importIDL</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"test.idl"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">'M1'</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">'M1.M2'</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">'M3'</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">'_GlobalIDL'</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">modules</span><span style="font-size:small">[</span><span style="font-size:small"><span style="font-size:small">"M1.M2"</span></span><span style="font-size:small">].</span><span style="font-size:small">l</span><span style="font-size:small">
</span><span style="font-size:small">42</span><span style="font-size:small">
</span><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">modules</span><span style="font-size:small">[</span><span style="font-size:small"><span style="font-size:small">"M3"</span></span><span style="font-size:small">].</span><span style="font-size:small">s</span><span style="font-size:small">
</span><span style="font-size:small">5</span><span style="font-size:small">
</span><span style="font-size:small">&gt;&gt;&gt; </span><span style="font-size:small">sys</span><span style="font-size:small">.</span><span style="font-size:small">modules</span><span style="font-size:small">[</span><span style="font-size:small"><span style="font-size:small">"_GlobalIDL"</span></span><span style="font-size:small">].</span><span style="font-size:small">s</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-size:small">'Hello'</span></span></div><p>Note that each time <span style="font-family:monospace">importIDL()</span> or <span style="font-family:monospace">importIDLString()</span> is called,
the IDL definitions are compiled and imported into the associated
Python declarations. The new declarations overwrite any old ones with
the same names. This can cause confusing situations where different
modules see different definitions of the same objects. Although the
objects appear identical, they are not, and comparisons within
applications and within omniORBpy unexpectedly fail. You should not
use these functions in more than one module to import the same IDL
files.</p>
<!--TOC section id="sec59" C++ API-->
<h2 id="sec59" class="section">4.10&#XA0;&#XA0;C++ API</h2><!--SEC END --><p>omniORBpy has a C++ API that can be used by programs that embed Python
in C++, or by C++ extension modules to Python. The API has functions
to convert object references between their Python representation and
their C++ representation. For extensions to omniORBpy itself, it has a
mechanism for adding pseudo object types to omniORBpy.</p><p>The definitions used by the C++ API are in the <span style="font-family:monospace">omniORBpy.h</span>
header. An example of its use is in <span style="font-family:monospace">examples/embed/</span>.</p><p>The API is accessed through a singleton structure containing function
pointers. In Python 3.x, a pointer to the API struct is stored in a
<span style="font-family:monospace">PyCapsule</span> named <span style="font-family:monospace">_omnipy.API</span>. Access it with code like:</p><div class="lstlisting"><span style="font-size:small">omniORBpyAPI</span><span style="font-size:small">* </span><span style="font-size:small">api</span><span style="font-size:small"> = (</span><span style="font-size:small">omniORBpyAPI</span><span style="font-size:small">*)</span><span style="font-size:small">PyCapsule_Import</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"_omnipy.API"</span></span><span style="font-size:small">, 0);</span></div><p>In Python 2.x, a pointer to the API struct is stored as a
<span style="font-family:monospace">PyCObject</span> in the <span style="font-family:monospace">_omnipy</span> module with the name
<span style="font-family:monospace">API</span>. It can be accessed with code like:</p><div class="lstlisting"><span style="font-size:small">PyObject</span><span style="font-size:small">*     </span><span style="font-size:small">omnipy</span><span style="font-size:small"> = </span><span style="font-size:small">PyImport_ImportModule</span><span style="font-size:small">((</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small"><span style="font-size:small">"_omnipy"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">PyObject</span><span style="font-size:small">*     </span><span style="font-size:small">pyapi</span><span style="font-size:small">  = </span><span style="font-size:small">PyObject_GetAttrString</span><span style="font-size:small">(</span><span style="font-size:small">omnipy</span><span style="font-size:small">, (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small"><span style="font-size:small">"API"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">omniORBpyAPI</span><span style="font-size:small">* </span><span style="font-size:small">api</span><span style="font-size:small">    = (</span><span style="font-size:small">omniORBpyAPI</span><span style="font-size:small">*)</span><span style="font-size:small">PyCObject_AsVoidPtr</span><span style="font-size:small">(</span><span style="font-size:small">pyapi</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">Py_DECREF</span><span style="font-size:small">(</span><span style="font-size:small">pyapi</span><span style="font-size:small">);</span></div><p>See the structure definition in <span style="font-family:monospace">omniORBpy.h</span> for
details of the available functions.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note9" href="#text9">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">This is a change from omniORB 4.0
/ omniORBpy 2 and earlier, where it was the <span style="font-family:monospace">TRANSIENT</span>
exception that was propagated to the application.</div></dd><dt class="dt-thefootnotes"><a id="note10" href="#text10">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">omniidl must
therefore be available on your path.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec60" The IDL compiler-->
<h1 id="sec60" class="chapter">Chapter&#XA0;5&#XA0;&#XA0;The IDL compiler</h1><!--SEC END --><p>
<a id="chap:omniidl"></a></p><p>omniORBpy&#X2019;s IDL compiler is called omniidl. It consists of a generic
front-end parser written in C++, and a number of back-ends written in
Python. omniidl is very strict about IDL validity, so you may find
that it reports errors in IDL which compiles fine with other IDL
compilers.</p><p>The general form of an omniidl command line is:</p><blockquote class="quote"> <span style="font-family:monospace">omniidl </span>[<span style="font-style:italic">options</span>]<span style="font-family:monospace"> -b</span>&lt;<span style="font-style:italic">back-end</span>&gt;<span style="font-family:monospace"> </span>[<span style="font-style:italic">back-end options</span>]<span style="font-family:monospace"> </span>&lt;<span style="font-style:italic">file 1</span>&gt;<span style="font-family:monospace"> </span>&#X2026;</blockquote>
<!--TOC section id="sec61" Common options-->
<h2 id="sec61" class="section">5.1&#XA0;&#XA0;Common options</h2><!--SEC END --><p>The following options are common to all back-ends:</p><table style="border:0;border-spacing:0" class="cellpadding0"><tr><td style="text-align:left;white-space:nowrap" ></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-b</span><span style="font-style:italic">back-end</span>
</td><td style="text-align:left;white-space:nowrap" >Run the specified back-end. For omniORBpy, use <span style="font-family:monospace">-bpython</span>.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-D</span><span style="font-style:italic">name</span>[<span style="font-family:monospace">=</span><span style="font-style:italic">value</span>]
</td><td style="text-align:left;white-space:nowrap" >Define <span style="font-style:italic">name</span> for the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-U</span><span style="font-style:italic">name</span>
</td><td style="text-align:left;white-space:nowrap" >Undefine <span style="font-style:italic">name</span> for the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-I</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Include <span style="font-style:italic">dir</span> in the preprocessor search path.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-E</span>
</td><td style="text-align:left;white-space:nowrap" >Only run the preprocessor, sending its output to stdout.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Y</span><span style="font-style:italic">cmd</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">cmd</span> as the preprocessor, rather than the normal C
preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-N</span>
</td><td style="text-align:left;white-space:nowrap" >Do not run the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-T</span>
</td><td style="text-align:left;white-space:nowrap" >Use a temporary file, not a pipe, for preprocessor output.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wp</span><span style="font-style:italic">arg</span>[,<span style="font-style:italic">arg</span>&#X2026;]
</td><td style="text-align:left;white-space:nowrap" >Send arguments to the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wb</span><span style="font-style:italic">arg</span>[,<span style="font-style:italic">arg</span>&#X2026;]
</td><td style="text-align:left;white-space:nowrap" >Send arguments to the back-end.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-nf</span>
</td><td style="text-align:left;white-space:nowrap" >Do not warn about unresolved forward declarations.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-k</span>
</td><td style="text-align:left;white-space:nowrap" >Keep comments after declarations, to be used by some back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-K</span>
</td><td style="text-align:left;white-space:nowrap" >Keep comments before declarations, to be used by some back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-C</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Change directory to <span style="font-style:italic">dir</span> before writing output files.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-d</span>
</td><td style="text-align:left;white-space:nowrap" >Dump the parsed IDL then exit, without running a back-end.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-p</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">dir</span> as a path to find omniidl back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-V</span>
</td><td style="text-align:left;white-space:nowrap" >Print version information then exit.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-u</span>
</td><td style="text-align:left;white-space:nowrap" >Print usage information.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-v</span>
</td><td style="text-align:left;white-space:nowrap" >Verbose: trace compilation stages.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
</td></tr>
</table><p>Most of these options are self explanatory, but some are not
so obvious.</p>
<!--TOC subsection id="sec62" Preprocessor interactions-->
<h3 id="sec62" class="subsection">5.1.1&#XA0;&#XA0;Preprocessor interactions</h3><!--SEC END --><p>IDL is processed by the C preprocessor before omniidl parses it.
omniidl always uses the GNU C preprocessor (which it builds with the
name omnicpp). The <span style="font-family:monospace">-D</span>, <span style="font-family:monospace">-U</span>, and <span style="font-family:monospace">-I</span>
options are just sent to the preprocessor. Note that the current
directory is not on the include search path by default&#X2014;use
&#X2018;<span style="font-family:monospace">-I.</span>&#X2019; for that. The <span style="font-family:monospace">-Y</span> option can be used to
specify a different preprocessor to omnicpp. Beware that line
directives inserted by other preprocessors are likely to confuse
omniidl.</p>
<!--TOC subsubsection id="sec63" Windows 9x-->
<h4 id="sec63" class="subsubsection">5.1.1.1&#XA0;&#XA0;Windows 9x</h4><!--SEC END --><p>The output from the C preprocessor is normally fed to the omniidl
parser through a pipe. On some Windows 98 machines (but not all!) the
pipe does not work, and the preprocessor output is echoed to the
screen. When this happens, the omniidl parser sees an empty file, and
produces useless stub files with strange long names. To avoid the
problem, use the &#X2018;<span style="font-family:monospace">-T</span>&#X2019; option to create a temporary file
between the two stages.</p>
<!--TOC subsection id="sec64" Forward-declared interfaces-->
<h3 id="sec64" class="subsection">5.1.2&#XA0;&#XA0;Forward-declared interfaces</h3><!--SEC END --><p>If you have an IDL file like:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">J</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> </span><span style="font-size:small">the_I</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>then omniidl will normally issue a warning:</p><pre class="verbatim"><span style="font-size:small">  test.idl:1: Warning: Forward declared interface `I' was never
  fully defined
</span></pre><p>It is illegal to declare such IDL in isolation, but it
<em>is</em> valid to define interface <span style="font-family:monospace">I</span> in a separate file. If
you have a lot of IDL with this sort of construct, you will drown
under the warning messages. Use the <span style="font-family:monospace">-nf</span> option to suppress
them.</p>
<!--TOC subsection id="sec65" Comments-->
<h3 id="sec65" class="subsection">5.1.3&#XA0;&#XA0;Comments</h3><!--SEC END --><p>By default, omniidl discards comments in the input IDL. However, with
the <span style="font-family:monospace">-k</span> and <span style="font-family:monospace">-K</span> options, it preserves the comments
for use by the back-ends. The Python back-end ignores this
information, but it is relatively easy to write new back-ends which
<em>do</em> make use of comments.</p><p>The two different options relate to how comments are attached to
declarations within the IDL. Given IDL like:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// A comment</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op2</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>the <span style="font-family:monospace">-k</span> flag will attach the comment to <span style="font-family:monospace">op1()</span>;
the <span style="font-family:monospace">-K</span> flag will attach it to <span style="font-family:monospace">op2()</span>.</p>
<!--TOC section id="sec66" Python back-end options-->
<h2 id="sec66" class="section">5.2&#XA0;&#XA0;Python back-end options</h2><!--SEC END --><p>
<a id="sec:Wbglobal"></a></p><p>When you specify the Python back-end (with <span style="font-family:monospace">-bpython</span>), the
following <span style="font-family:monospace">-Wb</span> options become available. Note that the
<span style="font-family:monospace">-Wb</span> options must be specified <em>after</em> the
<span style="font-family:monospace">-bpython</span> option, so omniidl knows which back-end to give the
arguments to.</p><table style="border:0;border-spacing:0" class="cellpadding0"><tr><td style="text-align:left;white-space:nowrap" ></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbinline</span>
</td><td style="text-align:left;white-space:nowrap" >Output stubs for #included files in line with the main
file.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbstdout</span>
</td><td style="text-align:left;white-space:nowrap" >Send the generated stubs to standard output, rather than to a
file.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbglobal=</span><span style="font-style:italic">g</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">g</span> as the name for the global IDL scope (default
<span style="font-family:monospace">_GlobalIDL</span>).</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbpackage=</span><span style="font-style:italic">p</span>
</td><td style="text-align:left;white-space:nowrap" >Put both Python modules and stub files in package
<span style="font-style:italic">p</span>.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbmodules=</span><span style="font-style:italic">p</span>
</td><td style="text-align:left;white-space:nowrap" >Put Python modules in package <span style="font-style:italic">p</span>.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbstubs=</span><span style="font-style:italic">p</span>
</td><td style="text-align:left;white-space:nowrap" >Put stub files in package <span style="font-style:italic">p</span>.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbami</span>
</td><td style="text-align:left;white-space:nowrap" >Generate AMI types and operations.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
</td></tr>
</table>
<!--TOC subsection id="sec67" Inclusion options-->
<h3 id="sec67" class="subsection">5.2.1&#XA0;&#XA0;Inclusion options</h3><!--SEC END --><p>When you compile an IDL file which #includes other IDL files, omniidl
normally only generates code for the main file, assuming that code for
the included files will be generated separately. Instead, you can use
the <span style="font-family:monospace">-Wbinline</span> option to generate code for the main IDL file
<em>and</em> all included files in a single stub file.</p>
<!--TOC subsection id="sec68" Output options-->
<h3 id="sec68" class="subsection">5.2.2&#XA0;&#XA0;Output options</h3><!--SEC END --><p>The <span style="font-family:monospace">-Wbstdout</span> option is not really useful if you are
invoking omniidl yourself. It is used by <span style="font-family:monospace">omniORB.importIDL()</span>,
described in section&#XA0;<a href="#sec%3AimportIDL">4.9</a>.</p><p>Definitions declared at IDL global scope are normally placed in a
Python module named &#X2018;<span style="font-family:monospace">_GlobalIDL</span>&#X2019;. The <span style="font-family:monospace">-Wbglobal</span>
allows you to change that.</p><p>As explained in section&#XA0;<a href="#sec%3AgeneratingStubs">2.2</a>, when you compile an
IDL file like:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// example_echo.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>omniidl generates directories named <span style="font-family:monospace">Example</span> and
<span style="font-family:monospace">Example__POA</span>, which provide the standard Python mapping
modules, and also the file <span style="font-family:monospace">example_echo_idl.py</span> which contains
the actual definitions. The latter file contains code which inserts
the definitions in the standard modules. This arrangement means that
it is not possible to move all of the generated code into a Python
package by simply placing the files in a suitably named directory.
You may wish to do this to avoid clashes with names in use elsewhere
in your software.</p><p>You can place all generated code in a package using the
<span style="font-family:monospace">-Wbpackage</span> command line option. For example,</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython -Wbpackage=generated echo_example.idl</span>
</blockquote><p>creates a directory named &#X2018;<span style="font-family:monospace">generated</span>&#X2019;, containing the
generated code. The stub module is now called
&#X2018;<span style="font-family:monospace">generated.Example</span>&#X2019;, and the actual stub definitions are in
&#X2018;<span style="font-family:monospace">generated.example_echo_idl</span>&#X2019;. If you wish to split the
modules and the stub definitions into different Python packages, you
can use the <span style="font-family:monospace">-Wbmodules</span> and <span style="font-family:monospace">-Wbstubs</span> options.</p><p>Note that if you use these options to change the module package, the
interface to the generated code is not strictly-speaking CORBA
compliant. You may have to change your code if you ever use a Python
ORB other than omniORBpy.</p>
<!--TOC subsection id="sec69" Asynchronous Method Invocation-->
<h3 id="sec69" class="subsection">5.2.3&#XA0;&#XA0;Asynchronous Method Invocation</h3><!--SEC END --><p>Generate asynchronous invocation operations and the various types
required by AMI by specifying <span style="font-family:monospace">-Wbami</span>. See
chapter&#XA0;<a href="#chap%3Aami">11</a> for details.</p>
<!--TOC section id="sec70" Examples-->
<h2 id="sec70" class="section">5.3&#XA0;&#XA0;Examples</h2><!--SEC END --><p>Generate the Python stubs for a file <span style="font-family:monospace">a.idl</span>:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython a.idl</span>
</blockquote><p>As above, but put the stubs in a package called
&#X2018;<span style="font-family:monospace">stubs</span>&#X2019;:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython -Wbstubs=stubs a.idl</span>
</blockquote><p>Generate both Python and C++ stubs for two IDL files:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython -bcxx a.idl b.idl</span>
</blockquote><p>Just check the IDL files for validity, generating no output:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl a.idl b.idl</span>
</blockquote>
<!--TOC chapter id="sec71" Connection and Thread Management-->
<h1 id="sec71" class="chapter">Chapter&#XA0;6&#XA0;&#XA0;Connection and Thread Management</h1><!--SEC END --><p>
<a id="chap:connections"></a></p><p>This chapter describes how omniORB manages threads and network
connections.</p>
<!--TOC section id="sec72" Background-->
<h2 id="sec72" class="section">6.1&#XA0;&#XA0;Background</h2><!--SEC END --><p>In CORBA, the ORB is the &#X2018;middleware&#X2019; that allows a client to invoke
an operation on an object without regard to its implementation or
location. In order to invoke an operation on an object, a client needs
to &#X2018;bind&#X2019; to the object by acquiring its object reference. Such a
reference may be obtained as the result of an operation on another
object (such as a naming service or factory object) or by conversion
from a stringified representation. If the object is in a different
address space, the binding process involves the ORB building a proxy
object in the client&#X2019;s address space. The ORB arranges for invocations
on the proxy object to be transparently mapped to equivalent
invocations on the implementation object.</p><p>For the sake of interoperability, CORBA mandates that all ORBs should
support IIOP as the means to communicate remote invocations over a
TCP/IP connection. IIOP is usually<sup><a id="text11" href="#note11">1</a></sup>
asymmetric with respect to the roles of the parties at the two ends of
a connection. At one end is the client which can only initiate remote
invocations. At the other end is the server which can only receive
remote invocations.</p><p>Notice that in CORBA, as in most distributed systems, remote bindings
are established implicitly without application intervention. This
provides the illusion that all objects are local, a property known as
&#X2018;location transparency&#X2019;. CORBA does not specify when such bindings
should be established or how they should be multiplexed over the
underlying network connections. Instead, ORBs are free to implement
implicit binding by a variety of means.</p><p>The rest of this chapter describes how omniORB manages network
connections and the programming interface to fine tune the management
policy.</p>
<!--TOC section id="sec73" The model-->
<h2 id="sec73" class="section">6.2&#XA0;&#XA0;The model</h2><!--SEC END --><p>omniORB is designed from the ground up to be fully multi-threaded. The
objective is to maximise the degree of concurrency and at the same
time eliminate any unnecessary thread overhead. Another objective is
to minimise the interference by the activities of other threads on the
progress of a remote invocation. In other words, thread &#X2018;cross-talk&#X2019;
should be minimised within the ORB. To achieve these objectives, the
degree of multiplexing at every level is kept to a minimum by default.</p><p>Minimising multiplexing works well when the system is relatively
lightly loaded. However, when the ORB is under heavy load, it can
sometimes be beneficial to conserve operating system resources such as
threads and network connections by multiplexing at the ORB
level. omniORB has various options that control its multiplexing
behaviour.</p>
<!--TOC section id="sec74" Client side behaviour-->
<h2 id="sec74" class="section">6.3&#XA0;&#XA0;Client side behaviour</h2><!--SEC END --><p>On the client side of a connection, the thread that invokes on a proxy
object drives the GIOP protocol directly and blocks on the connection
to receive the reply. The first time the client makes a call to a
particular address space, the ORB opens a suitable connection to the
remote address space (based on the client transport rule as described
in section&#XA0;<a href="#sec%3AclientRule">6.7.1</a>). After the reply has been received,
the ORB caches the open network connection, ready for use by another
call.</p><p>If two (or more) threads in a multi-threaded client attempt to contact
the same address space simultaneously, there are two different ways to
proceed. The default way is to open another network connection to the
server. This means that neither the client or server ORB has to
perform any multiplexing on the network connections&#X2014;multiplexing is
performed by the operating system, which has to deal with multiplexing
anyway. The second possibility is for the client to multiplex the
concurrent requests on a single network connection. This conserves
operating system resources (network connections), but means that both
the client and server have to deal with multiplexing issues
themselves.</p><p>In the default one call per connection mode, there is a limit to the
number of concurrent connections that are opened, set with the
<span style="font-family:monospace">maxGIOPConnectionPerServer</span> parameter. To tell the ORB
that it may multiplex calls on a single connection, set the
<span style="font-family:monospace">oneCallPerConnection</span> parameter to zero. If the
<span style="font-family:monospace">oneCallPerConnection</span> parameter is set to the default
value of one, and there are more concurrent calls than specified by
<span style="font-family:monospace">maxGIOPConnectionPerServer</span>, calls block waiting for connections
to become free.</p><p>Note that some server-side ORBs, including omniORB versions before
version 4.0, are unable to deal with concurrent calls multiplexed on a
single connection, so they serialise the calls. It is usually best to
keep to the default mode of opening multiple connections.</p>
<!--TOC subsection id="sec75" Client side timeouts-->
<h3 id="sec75" class="subsection">6.3.1&#XA0;&#XA0;Client side timeouts</h3><!--SEC END --><p>
<a id="sec:timeoutAPI"></a></p><p>omniORB can associate a timeout with a call, meaning that if the call
takes too long a <span style="font-family:monospace">CORBA::TIMEOUT</span> exception<sup><a id="text12" href="#note12">2</a></sup> is
thrown. Timeouts can be set for the whole process, for a specific
thread, or for a specific object reference.</p><p>Timeouts are set using functions in the <span style="font-family:monospace">omniORB</span> module:</p><div class="lstlisting"><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">setClientCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">millisecs</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">setClientCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">objref</span><span style="font-size:small">, </span><span style="font-size:small">millisecs</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">setClientThreadCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">millisecs</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">setClientConnectTimeout</span><span style="font-size:small">(</span><span style="font-size:small">millisecs</span><span style="font-size:small">)</span></div><p><span style="font-family:monospace">setClientCallTimeout()</span> sets either the global timeout or the
timeout for a specific object reference.
<span style="font-family:monospace">setClientThreadCallTimeout()</span> sets the timeout for the calling
thread. Setting any timeout value to zero disables it.</p><p>Accessing per-thread state is a relatively expensive operation, so per
thread timeouts are disabled by default. The
<span style="font-family:monospace">supportPerThreadTimeOut</span> parameter must be set <span style="font-family:monospace">true</span> to
enable them.</p><p>To choose the timeout value to use for a call, the ORB first looks to
see if there is a timeout for the object reference, then to the
calling thread, and finally to the global timeout.</p><p>When a client has no existing connection to communicate with a server,
it must open a new connection before performing the
call. <span style="font-family:monospace">setClientConnectTimeout()</span> sets an overriding timeout for
cases where a new connection must be established. The effect of the
connect timeout depends upon whether the connect timeout is greater
or less than the timeout that would otherwise be used.</p><p>As an example, imagine that the usual call timeout is 10 seconds:</p><!--TOC subsubsection id="sec76" Connect timeout &gt; usual timeout-->
<h4 id="sec76" class="subsubsection">Connect timeout &gt; usual timeout</h4><!--SEC END --><p>If the connect timeout is set to 20 seconds, then a call that
establishes a new connection will be permitted 20 seconds before it
times out. Subsequent calls using the same connection have the normal
10 second timeout. If establishing the connection takes 8 seconds,
then the call itself takes 5 seconds, the call succeeds despite having
taken 13 seconds in total, longer than the usual timeout.</p><p>This kind of configuration is good when connections are slow to be
established.</p><p>If an object reference has multiple possible endpoints available, and
connecting to the first endpoint times out, only that one endpoint
will have been tried before an exception is raised. However, once the
timeout has occurred, the object reference will switch to use the next
endpoint. If the application attempts to make another call, it will
use the next endpoint.</p><!--TOC subsubsection id="sec77" Connect timeout &lt; usual timeout-->
<h4 id="sec77" class="subsubsection">Connect timeout &lt; usual timeout</h4><!--SEC END --><p>If the connect timeout is set to 2 seconds, the actual network-level
connect is only permitted to take 2 seconds. As long as the connection
is established in less than 2 seconds, the call can proceed. The 10
second call timeout still applies to the time taken for the whole call
(including the connection establishment). So, if establishing the
connection takes 1.5 seconds, and the call itself takes 9.5 seconds,
the call will time out because although it met the connection timeout,
it exceeded the 10 second total call timeout. On the other hand, if
establishing the connection takes 3 seconds, the call will fail after
only 2 seconds, since only 2 seconds are permitted for the connect.</p><p>If an object reference has multiple possible endpoints available, the
client will attempt to connect to them in turn, until one succeeds.
The connect timeout applies to each connection attempt. So with a
connect timeout of 2 seconds, the client will spend up to 2 seconds
attempting to connect to the first address and then, if that fails, up
to 2 seconds trying the second address, and so on. The 10 second
timeout still applies to the call as a whole, so if the total time
taken on timed-out connection attempts exceeds 10 seconds, the call
will time out.</p><p>This kind of configuration is useful where calls may take a long time
to complete (so call timeouts are long), but a fast indication of
connection failure is required.</p>
<!--TOC section id="sec78" Server side behaviour-->
<h2 id="sec78" class="section">6.4&#XA0;&#XA0;Server side behaviour</h2><!--SEC END --><p>The server side has two primary modes of operation: thread per
connection and thread pooling. It is able to dynamically transition
between the two modes, and it supports a hybrid scheme that behaves
mostly like thread pooling, but has the same fast turn-around for
sequences of calls as thread per connection.</p>
<!--TOC subsection id="sec79" Thread per connection mode-->
<h3 id="sec79" class="subsection">6.4.1&#XA0;&#XA0;Thread per connection mode</h3><!--SEC END --><p>In thread per connection mode (the default, and the only option in
omniORB versions before 4.0), each connection has a single thread
dedicated to it. The thread blocks waiting for a request. When it
receives one, it unmarshals the arguments, makes the up-call to the
application code, marshals the reply, and goes back to watching the
connection. There is thus no thread switching along the call chain,
meaning the call is very efficient.</p><p>As explained above, a client can choose to multiplex multiple
concurrent calls on a single connection, so once the server has
received the request, and just before it makes the call into
application code, it marks the connection as &#X2018;selectable&#X2019;, meaning
that another thread should watch it to see if any other requests
arrive. If they do, extra threads are dispatched to handle the
concurrent calls. GIOP 1.2 actually allows the argument data for
multiple calls to be interleaved on a connection, so the unmarshalling
code has to handle that too. As soon as any multiplexing occurs on the
connection, the aim of removing thread switching cannot be met, and
there is inevitable inefficiency due to thread switching.</p><p>The <span style="font-family:monospace">maxServerThreadPerConnection</span> parameter can be set to limit
the number of threads that can be allocated to a single connection
containing concurrent calls. Setting the parameter to 1 mimics the
behaviour of omniORB versions before 4.0, that did not support
calls multiplexed on one connection.</p>
<!--TOC subsection id="sec80" Thread pool mode-->
<h3 id="sec80" class="subsection">6.4.2&#XA0;&#XA0;Thread pool mode</h3><!--SEC END --><p>
<a id="sec:watchConn"></a></p><p>In thread pool mode, selected by setting the
<span style="font-family:monospace">threadPerConnectionPolicy</span> parameter to zero, a single thread
watches all incoming connections. When a call arrives on one of them,
a thread is chosen from a pool of threads, and set to work
unmarshalling the arguments and performing the up-call. There is
therefore at least one thread switch for each call.</p><p>The thread pool is not pre-initialised. Instead, threads are started
on demand, and idle threads are stopped after a period of inactivity.
The maximum number of threads that can be started in the pool is set
with the <span style="font-family:monospace">maxServerThreadPoolSize</span> parameter. The default
is 100.</p><p>A common pattern in CORBA applications is for a client to make several
calls to a single object in quick succession. To handle this situation
most efficiently, the default behaviour is to not return a thread to
the pool immediately after a call is finished. Instead, it is set to
watch the connection it has just served for a short while, mimicking
the behaviour in thread per connection mode. If a new call comes in
during the watching period, the call is dispatched without any thread
switching, just as in thread per connection mode. Of course, if the
server is supporting a very large number of connections (more than the
size of the thread pool), this policy can delay a call coming from
another connection. If the <span style="font-family:monospace">threadPoolWatchConnection</span>
parameter is set to zero, connection watching is disabled and threads
return to the pool immediately after finishing a single request.</p><p>In the face of multiplexed calls on a single connection, multiple
threads from the pool can be dispatched for one connection, just as in
thread per connection mode. With <span style="font-family:monospace">threadPoolWatchConnection</span> set
to the default value of 1, only the last thread servicing a connection
will watch it when it finishes a request. Setting the parameter to a
larger number allows the last <em>n</em> connections to watch the
connection.</p>
<!--TOC subsection id="sec81" Policy transition-->
<h3 id="sec81" class="subsection">6.4.3&#XA0;&#XA0;Policy transition</h3><!--SEC END --><p>If the server is dealing with a relatively small number of
connections, it is most efficient to use thread per connection mode.
If the number of connections becomes too large, however, operating
system limits on the number of threads may cause a significant
slowdown, or even prevent the acceptance of new connections
altogether.</p><p>To give the most efficient response in all circumstances, omniORB
allows a server to start in thread per connection mode, and transition
to thread pooling if many connections arrive. This is controlled with
the <span style="font-family:monospace">threadPerConnectionUpperLimit</span> and
<span style="font-family:monospace">threadPerConnectionLowerLimit</span> parameters. The upper limit must
always be larger than the lower limit. The upper limit chooses the
number of connections at which time the ORB transitions to thread pool
mode; the lower limit selects the point at which the transition back
to thread per connection is made.</p><p>For example, setting the upper limit to 50 and the lower limit to 30
would mean that the first 49 connections would receive dedicated
threads. The 50th to arrive would trigger thread pooling. All future
connections to arrive would make use of threads from the pool. Note
that the existing dedicated threads continue to service their
connections until the connections are closed. If the number of
connections falls below 30, thread per connection is reactivated and
new connections receive their own dedicated threads (up to the limit
of 50 again). Once again, existing connections in thread pool mode
stay in that mode until they are closed.</p>
<!--TOC section id="sec82" Idle connection shutdown-->
<h2 id="sec82" class="section">6.5&#XA0;&#XA0;Idle connection shutdown</h2><!--SEC END --><p>
<a id="sec:connShutdown"></a></p><p>It is wasteful to leave a connection open when it has been left unused
for a considerable time. Too many idle connections could block out new
connections when the system runs out of spare communication channels.
For example, most platforms have a limit on the number of file handles
a process can open. Many platforms have a very small default limit
like 64. The value can often be increased to a maximum of a thousand
or more by changing the &#X2018;ulimit&#X2019; in the shell.</p><p>Every so often, a thread scans all open connections to see which are
idle. The scanning period (in seconds) is set with the
<span style="font-family:monospace">scanGranularity</span> parameter. The default is 5 seconds.</p><p>Outgoing connections (initiated by clients) and incoming connections
(initiated by servers) have separate idle timeouts. The timeouts are
set with the <span style="font-family:monospace">outConScanPeriod</span> and <span style="font-family:monospace">inConScanPeriod</span>
parameters respectively. The values are in seconds, and must be a
multiple of the scan granularity.</p><p>Beware that setting <span style="font-family:monospace">outConScanPeriod</span> or <span style="font-family:monospace">inConScanPeriod</span>
to be equal to (or less than) <span style="font-family:monospace">scanGranularity</span> means that
connections are considered candidates for closure immediately after
they are opened. That can mean that the connections are closed before
any calls have been sent through them. If oneway calls are used, such
connection closure can result in silent loss of calls.</p>
<!--TOC subsection id="sec83" Interoperability Considerations-->
<h3 id="sec83" class="subsection">6.5.1&#XA0;&#XA0;Interoperability Considerations</h3><!--SEC END --><p>The IIOP specification allows both the client and the server to
shutdown a connection unilaterally. When one end is about to shutdown
a connection, it should send a <span style="font-family:monospace">CloseConnection</span> message to the
other end. It should also make sure that the message will reach the
other end before it proceeds to shutdown the connection.</p><p>The client should distinguish between an orderly and an abnormal
connection shutdown. When a client receives a <span style="font-family:monospace">CloseConnection</span>
message before the connection is closed, the condition is an orderly
shutdown. If the message is not received, the condition is an
abnormal shutdown. In an abnormal shutdown, the ORB should raise a
<span style="font-family:monospace">COMM_FAILURE</span> exception whereas in an orderly shutdown, the ORB
should <em>not</em> raise an exception and should try to re-establish a
new connection transparently.</p><p>omniORB implements these semantics completely. However, it is known
that some ORBs are not (yet) able to distinguish between an orderly
and an abnormal shutdown. Usually this is manifested as the client in
these ORBs seeing a <span style="font-family:monospace">COMM_FAILURE</span> occasionally when connected
to an omniORB server. The work-around is either to catch the exception
in the application code and retry, or to turn off the idle connection
shutdown inside the omniORB server.</p>
<!--TOC section id="sec84" Transports and endpoints-->
<h2 id="sec84" class="section">6.6&#XA0;&#XA0;Transports and endpoints</h2><!--SEC END --><p>
<a id="sec:endpoints"></a></p><p>omniORB can support multiple network transports. All platforms
(usually) have a TCP transport available. Unix platforms support a
Unix domain socket transport. Platforms with the OpenSSL library
available can support an SSL transport.</p><p>Servers must be configured in two ways with regard to transports: the
transports and interfaces on which they listen, and the details that
are published in IORs for clients to see. Usually the published
details will be the same as the listening details, but there are times
when it is useful to publish different information.</p><p>Details are selected with the <span style="font-family:monospace">endPoint</span> family of parameters.
The simplest is plain <span style="font-family:monospace">endPoint</span>, which chooses a transport and
interface details, and publishes the information in IORs. Endpoint
parameters are in the form of URIs, with a scheme name of
&#X2018;<span style="font-family:monospace">giop:</span>&#X2019;, followed by the transport name. Different transports
have different parameters following the transport.</p><p>TCP endpoints have the format:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:</span><span style="font-style:italic">&lt;host&gt;</span><span style="font-family:monospace">:</span><span style="font-style:italic">&lt;port&gt;</span>
</blockquote><p>The host must be a valid host name or IP address for the
server machine. It determines the network interface on which the
server listens. The port selects the TCP port to listen on, which must
be unoccupied. Either the host or port, or both can be left empty. If
the host is empty, the ORB publishes the IP address of the first
non-loopback network interface it can find (or the loopback if that is
the only interface), but listens on <em>all</em> network interfaces. If
the port is empty, the operating system chooses an <span style="font-style:italic">ephemeral</span>
port.</p><p>Multiple TCP endpoints can be selected, either to specify multiple
network interfaces on which to listen, or (less usefully) to select
multiple TCP ports on which to listen.</p><p>If no <span style="font-family:monospace">endPoint</span> parameters are set, the ORB assumes a single
parameter of <span style="font-family:monospace">giop:tcp::</span>, meaning IORs contain the address of
the first non-loopback network interface, the ORB listens on all
interfaces, and the OS chooses a port number.</p><p>SSL endpoints have the same format as TCP ones, except &#X2018;<span style="font-family:monospace">tcp</span>&#X2019;
is replaced with &#X2018;<span style="font-family:monospace">ssl</span>&#X2019;. Unix domain socket endpoints have the
format:</p><blockquote class="quote">
<span style="font-family:monospace">giop:unix:</span><span style="font-style:italic">&lt;filename&gt;</span>
</blockquote><p>where the filename is the name of the socket within the
filesystem. If the filename is left blank, the ORB chooses a name
based on the process id and a timestamp.</p><p>To listen on an endpoint without publishing it in IORs, specify it
with the <span style="font-family:monospace">endPointNoPublish</span> configuration parameter. See below
for more details about endpoint publishing.</p>
<!--TOC subsection id="sec85" Port ranges-->
<h3 id="sec85" class="subsection">6.6.1&#XA0;&#XA0;Port ranges</h3><!--SEC END --><p>Sometimes it is useful to restrict a server to listen on one of a
range of ports, rather than pinning it to one particular port or
allowing the OS to choose an ephemeral port. omniORB 4.2 introduces
the ability to specify a range of ports using a hyphen. e.g. to
listen on a port between 5000 and 5010 inclusive:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp::5000-5010</span>
</blockquote><p>omniORB randomly chooses a port in the range. If it finds that the
chosen port is already occupied, it keeps trying different ports until
it finds a free one. If all the ports in the range are occupied, it
throws <span style="font-family:monospace">CORBA.INITIALIZE</span>.</p>
<!--TOC subsection id="sec86" IPv6-->
<h3 id="sec86" class="subsection">6.6.2&#XA0;&#XA0;IPv6</h3><!--SEC END --><p>On platforms where it is available, omniORB supports IPv6. On most
Unix platforms, IPv6 sockets accept both IPv6 and IPv4 connections, so
omniORB&#X2019;s default <span style="font-family:monospace">giop:tcp::</span> endpoint accepts both IPv4 and
IPv6 connections. On Windows versions before Windows Vista, each
socket type only accepts incoming connections of the same type, so an
IPv6 socket cannot be used with IPv4 clients. For this reason, the
default <span style="font-family:monospace">giop:tcp::</span> endpoint only listens for IPv4 connections.
Since endpoints with a specific host name or address only listen on a
single network interface, they are inherently limited to just one
protocol family.</p><p>To explicitly ask for just IPv4 or just IPv6, an endpoint with the
wildcard address for the protocol family should be used. For IPv4, the
wildcard address is &#X2018;<span style="font-family:monospace">0.0.0.0</span>&#X2019;, and for IPv6 it is &#X2018;<span style="font-family:monospace">::</span>&#X2019;.
So, to listen for IPv4 connections on all IPv4 network interfaces, use
an endpoint of:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:0.0.0.0:</span>
</blockquote><p>All IPv6 addresses contain colons, so the address portion in
URIs must be contained within <span style="font-family:monospace">[]</span> characters. Therefore, to
listen just for IPv6 connections on all IPv6 interfaces, use the
somewhat cryptic:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:[::]:</span>
</blockquote><p>To listen for both IPv4 and IPv6 connections on Windows
versions prior to Vista, both endpoints must be explicitly provided.</p>
<!--TOC subsubsection id="sec87" Link local addresses-->
<h4 id="sec87" class="subsubsection">6.6.2.1&#XA0;&#XA0;Link local addresses</h4><!--SEC END --><p>In IPv6, all network interfaces are assigned a <span style="font-style:italic">link local</span>
address, starting with the digits <span style="font-family:monospace">fe80</span>. The link local address
is only valid on the same &#X2018;link&#X2019; as the interface, meaning directly
connected to the interface, or possibly on the same subnet, depending
on how the network is switched. To connect to a server&#X2019;s link local
address, a client has to know which of its network interfaces is on
the same link as the server. Since there is no way for omniORB to know
which local interface a remote link local address may be connected to,
and in extreme circumstances may even end up contacting the wrong
server if it picks the wrong interface, link local addresses are not
considered valid. Servers do not publish link local addresses in their
IORs.</p>
<!--TOC subsection id="sec88" Endpoint publishing-->
<h3 id="sec88" class="subsection">6.6.3&#XA0;&#XA0;Endpoint publishing</h3><!--SEC END --><p>For clients to be able to connect to a server, the server publishes
endpoint information in its IORs (Interoperable Object References).
Normally, omniORB publishes the first available address for each of
the endpoints it is listening on.</p><p>The endpoint information to publish is determined by the
<span style="font-family:monospace">endPointPublish</span> configuration parameter. It contains a
comma-separated list of publish rules. The rules are applied in turn
to each of the configured endpoints; if a rule matches an endpoint, it
causes one or more endpoints to be published.</p><p>The following core rules are supported:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">addr</span></td><td style="vertical-align:top;text-align:left;" >the first natural address of the endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">ipv4</span></td><td style="vertical-align:top;text-align:left;" >the first IPv4 address of a TCP or SSL endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">ipv6</span></td><td style="vertical-align:top;text-align:left;" >the first IPv6 address of a TCP or SSL endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name</span></td><td style="vertical-align:top;text-align:left;" >the first address that can be resolved to a name</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">hostname</span></td><td style="vertical-align:top;text-align:left;" >the result of the gethostname() system call</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">fqdn</span></td><td style="vertical-align:top;text-align:left;" >the fully-qualified domain name</td></tr>
</table><p>The core rules can be combined using the vertical bar operator to
try several rules in turn until one succeeds. e.g:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name|ipv6|ipv4</span></td><td style="vertical-align:top;text-align:left;" >the name of the endpoint if it has one;
	failing that, its first IPv6 address;
	failing that, its first IPv4 address.
</td></tr>
</table><p>Multiple rules can be combined using the comma operator to
publish more than one endpoint. e.g.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name,addr</span></td><td style="vertical-align:top;text-align:left;" >the name of the endpoint (if it has one),
followed by its first address.
</td></tr>
</table><p>For endpoints with multiple addresses (e.g. TCP endpoints on
multi-homed machines), the <span style="font-family:monospace">all()</span> manipulator causes all
addresses to be published. e.g.:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name)</span></td><td style="vertical-align:top;text-align:left;" >all addresses that resolve to names are published</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name|addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published by name if they have
one, address otherwise.</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name,addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published by name (if they
have one), and by address.</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name), all(addr)</span></td><td style="vertical-align:top;text-align:left;" >first the names of all addresses are published,
followed by all the addresses.</td></tr>
</table><p>A specific endpoint can be published by giving its endpoint URI,
even if the server is not listening on that endpoint. e.g.:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">giop:tcp:not.my.host:12345</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">giop:unix:/not/my/socket-file</span></td></tr>
</table><p>If the host or port number for a TCP or SSL URI are missed out,
they are filled in with the details from each listening TCP/SSL
endpoint. This can be used to publish a different name for a
TCP/SSL endpoint that is using an ephemeral port, for example.</p><p>omniORB 4.0 supported two options related to endpoint publishing that
are superseded by the <span style="font-family:monospace">endPointPublish</span> parameter, and so are now
deprecated. Setting <span style="font-family:monospace">endPointPublishAllIFs</span> to 1 is equivalent to
setting <span style="font-family:monospace">endPointPublish</span> to &#X2018;<span style="font-family:monospace">all(addr)</span>&#X2019;. The
<span style="font-family:monospace">endPointNoListen</span> parameter is equivalent to adding endpoint
URIs to the <span style="font-family:monospace">endPointPublish</span> parameter.</p>
<!--TOC section id="sec89" Connection selection and acceptance-->
<h2 id="sec89" class="section">6.7&#XA0;&#XA0;Connection selection and acceptance</h2><!--SEC END --><p>In the face of IORs containing details about multiple different
endpoints, clients have to know how to choose the one to use to
connect a server. Similarly, servers may wish to restrict which
clients can connect to particular transports. This is achieved with
<span style="font-style:italic">transport rules</span>.</p>
<!--TOC subsection id="sec90" Client transport rules-->
<h3 id="sec90" class="subsection">6.7.1&#XA0;&#XA0;Client transport rules</h3><!--SEC END --><p>
<a id="sec:clientRule"></a></p><p>The <span style="font-family:monospace">clientTransportRule</span> parameter is used to filter and
prioritise the order in which transports specified in an IOR are
tried. Each rule has the form:</p><blockquote class="quote">
<span style="font-style:italic">&lt;address mask&gt; [action]+</span>
</blockquote><p>The address mask can be one of</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >1.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">localhost</span></td><td style="vertical-align:top;text-align:left;" >The address of this machine</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
2.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">w.x.y.z</span><span style="font-family:monospace">/</span><span style="font-style:italic">m1.m2.m3.m4</span></td><td style="vertical-align:top;text-align:left;" >An IPv4 address
with bits selected by the mask, e.g.
 <span style="font-family:monospace">172.16.0.0/255.240.0.0</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
3.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">w.x.y.z</span><span style="font-family:monospace">/</span><span style="font-style:italic">prefixlen</span></td><td style="vertical-align:top;text-align:left;" >An IPv4 address with
<span style="font-style:italic">prefixlen</span> significant bits, e.g.
 <span style="font-family:monospace">172.16.2.0/24</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
4.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">a:b:c:d:e:f:g:h</span><span style="font-family:monospace">/</span><span style="font-style:italic">prefixlen</span></td><td style="vertical-align:top;text-align:left;" >An IPv6
address with <span style="font-style:italic">prefixlen</span> significant bits, e.g.
 <span style="font-family:monospace">3ffe:505:2:1::/64</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
5.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">*</span></td><td style="vertical-align:top;text-align:left;" >Wildcard that matches any address</td></tr>
</table><p>The action is one or more of the following:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >1.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">none</span></td><td style="vertical-align:top;text-align:left;" >Do not use this address</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >2.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">tcp</span></td><td style="vertical-align:top;text-align:left;" >Use a TCP transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >3.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">ssl</span></td><td style="vertical-align:top;text-align:left;" >Use an SSL transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >4.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">unix</span></td><td style="vertical-align:top;text-align:left;" >Use a Unix socket transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >5.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">bidir</span></td><td style="vertical-align:top;text-align:left;" >Connections to this address can be used
bidirectionally (see section&#XA0;<a href="#sec%3Abidir">6.8</a>)</td></tr>
</table><p>The transport-selecting actions form a prioritised list, so
an action of &#X2018;<span style="font-family:monospace">unix,ssl,tcp</span>&#X2019; means to use a Unix transport if
there is one, failing that a SSL transport, failing <em>that</em> a TCP
transport. In the absence of any explicit rules, the client uses the
implicit rule of &#X2018;<span style="font-family:monospace">* unix,ssl,tcp</span>&#X2019;.</p><p>If more than one rule is specified, they are prioritised in the order
they are specified. For example, the configuration file might contain:</p><pre class="verbatim">  clientTransportRule = 192.168.1.0/255.255.255.0  unix,tcp
  clientTransportRule = 172.16.0.0/255.240.0.0     unix,tcp
                      =       *                    none
</pre><p>This would be useful if there is a fast network
(192.168.1.0) which should be used in preference to another network
(172.16.0.0), and connections to other networks are not permitted at
all.</p><p>In general, the result of filtering the endpoint specifications in an
IOR with the client transport rule will be a prioritised list of
transports and networks. (If the transport rules do not prioritise one
endpoint over another, the order the endpoints are listed in the IOR
is used.) When trying to contact an object, the ORB tries its
possible endpoints in turn, until it finds one with which it can
contact the object. Only after it has unsuccessfully tried all
permissible endpoints will it raise a <span style="font-family:monospace">TRANSIENT</span> exception to
indicate that the connect failed.</p>
<!--TOC subsection id="sec91" Server transport rules-->
<h3 id="sec91" class="subsection">6.7.2&#XA0;&#XA0;Server transport rules</h3><!--SEC END --><p>
<a id="sec:serverRule"></a></p><p>Server transport rules have the same format as client transport
rules. Rather than being used to select which of a set of ways to
contact a machine, they are used to determine whether or not to accept
connections from particular clients. In this example, we only allow
connections from our intranet:</p><pre class="verbatim">  serverTransportRule = localhost                  unix,tcp,ssl
                      = 172.16.0.0/255.240.0.0     tcp,ssl
                      = *                          none
</pre><p>And in this one, we accept only SSL connections if the
client is not on the intranet:</p><pre class="verbatim">  serverTransportRule = localhost                  unix,tcp,ssl
                      = 172.16.0.0/255.240.0.0     tcp,ssl
                      = *                          ssl,bidir
</pre><p>In the absence of any explicit rules, the server uses the
implicit rule of &#X2018;<span style="font-family:monospace">* unix,ssl,tcp</span>&#X2019;, meaning any kind of
connection is accepted from any client.</p>
<!--TOC section id="sec92" Bidirectional GIOP-->
<h2 id="sec92" class="section">6.8&#XA0;&#XA0;Bidirectional GIOP</h2><!--SEC END --><p>
<a id="sec:bidir"></a></p><p>omniORB supports bidirectional GIOP, which allows callbacks to be made
using a connection opened by the original client, rather than the
normal model where the server opens a new connection for the callback.
This is important for negotiating firewalls, since they tend not to
allow connections back on arbitrary ports.</p><p>There are several steps required for bidirectional GIOP to be enabled
for a callback. Both the client and server must be configured
correctly. On the client side, these conditions must be met:</p><ul class="itemize"><li class="li-itemize">The <span style="font-family:monospace">offerBiDirectionalGIOP</span> parameter must be set to <span style="font-family:monospace">true</span>. 
</li><li class="li-itemize">The client transport rule for the target server must contain the
<span style="font-family:monospace">bidir</span> action.
</li><li class="li-itemize">The POA containing the callback object (or objects) must have
been created with a <span style="font-family:monospace">BidirectionalPolicy</span> value of
<span style="font-family:monospace">BOTH</span>.</li></ul><p>On the server side, these conditions must be met:</p><ul class="itemize"><li class="li-itemize">The <span style="font-family:monospace">acceptBiDirectionalGIOP</span> parameter must be set to <span style="font-family:monospace">true</span>. 
</li><li class="li-itemize">The server transport rule for the requesting client must contain
the <span style="font-family:monospace">bidir</span> action.
</li><li class="li-itemize">The POA hosting the object contacted by the client must have
been created with a <span style="font-family:monospace">BidirectionalPolicy</span> value of
<span style="font-family:monospace">BOTH</span>.</li></ul>
<!--TOC section id="sec93" TLS / SSL transport-->
<h2 id="sec93" class="section">6.9&#XA0;&#XA0;TLS / SSL transport</h2><!--SEC END --><p>omniORB supports a TLS / SSL transport, using OpenSSL. It is only
built if OpenSSL is available. On platforms using Autoconf, it is
autodetected in many locations, or its location can be given with the
<span style="font-family:monospace">--with-openssl=</span> argument to <span style="font-family:monospace">configure</span>. On other
platforms, the <span style="font-family:monospace">OPEN_SSL_ROOT</span> make variable must be set in the
platform file.</p><p>To use the SSL transport from Python you must import and set
parameters in the <span style="font-family:monospace">omniORB.sslTP</span> module before calling
<span style="font-family:monospace">CORBA.ORB_init()</span>. To initialise the module, you must call the
<span style="font-family:monospace">certificate_authority_file()</span>, <span style="font-family:monospace">key_file()</span> and
<span style="font-family:monospace">key_file_password()</span> functions, providing the file names of the
certificate authority and encryption keys, and the key file password.</p>
<!--TOC subsection id="sec94" Self-signed certificate authority-->
<h3 id="sec94" class="subsection">6.9.1&#XA0;&#XA0;Self-signed certificate authority</h3><!--SEC END --><p>By default, omniORB configures OpenSSL to require both clients and
servers to have certificates that are signed by a Certificate
Authority (CA). It is possible to use a public CA to obtain keys that
can be independently verified, but for many purposes, it is sufficient
to use a private CA to sign all the keys in use in an application. The
following is a brief description of how to become your own certificate
authority and issue and sign certificates, using the OpenSSL command
line tools.</p><p>Before starting, find the default <span style="font-family:monospace">openssl.cnf</span> file that was
installed with OpenSSL, copy it to a suitable location, and edit it as
you feel appropriate. Now, build a certificate directory structure,
authority key and certificate:</p><pre class="verbatim">  mkdir demoCA demoCA/private demoCA/newcerts

  openssl req -config openssl.cnf -x509 -newkey rsa:2048 \
     -keyout demoCA/private/cakey.pem -out demoCA/cacert.pem -days 3650

  echo 01 &gt;demoCA/serial
  touch demoCA/index.txt
</pre><p>Next, issue a key request and sign it:</p><pre class="verbatim">  openssl req -config openssl.cnf -new -keyout server_key.pem \
     -out server_req.pem -days 3650

  openssl ca -config openssl.cnf -policy policy_anything \
     -out server_cert.pem -in server_req.pem 
</pre><p>Amongst other things, you now have a server key file in
<span style="font-family:monospace">server_key.pem</span> and a certificate in <span style="font-family:monospace">server_cert.pem</span>. To
make a single file containing both the key and the certificate,
suitable for use in omniORB, concatenate the key and certificate files
together. You can skip the human-readable(ish) text in the
certificate file before the <code>-----BEGIN CERTIFICATE-----</code> marker.</p><p>If need be, create more certificates for servers and clients in the
same way.</p>
<!--TOC section id="sec95" ZIOP-->
<h2 id="sec95" class="section">6.10&#XA0;&#XA0;ZIOP</h2><!--SEC END --><p>omniORB has support for ZIOP, which compresses transmitted
messages. To use it, import <span style="font-family:monospace">omniORB.omniZIOP</span>.</p><p>On Unix platforms, ZIOP support is automatically enabled if the
configure script detects zlib. To enable it on Windows, set the
<span style="font-family:monospace">EnableZIOP</span> make variable in the platform configuration file.</p><p>omniORB has an almost complete implementation of the ZIOP
specification, with the following extensions and differences:</p><ol class="enumerate" type=1><li class="li-enumerate">
Client-side policies are global, set with
<span style="font-family:monospace">omniZIOP.setGlobalPolicies()</span>.
<span style="font-family:monospace">CORBA.Object._set_policy_overrides()</span> is not supported.</li><li class="li-enumerate">POAs can be created with ZIOP policies as shown in
<span style="font-family:monospace">examples/ziop/ziop_srv.py</span>, but in the absence of specific
policies, they also use the global policies set with
<span style="font-family:monospace">omniZIOP.setGlobalPolicies()</span>. This is useful to apply ZIOP
policies to the RootPOA or omniINSPOA.
</li></ol><p>In addition to the standard policies, whether or not to
enable ZIOP is determined by client and server transport rules. For a
client to use ZIOP, the matching client transport rule must include
&#X2018;<span style="font-family:monospace">ziop</span>&#X2019;; similarly, for a server to use ZIOP, the matching
server transport rule must include &#X2018;<span style="font-family:monospace">ziop</span>&#X2019;. e.g. to use the
examples:</p><pre class="verbatim">  ziop_srv.py -ORBserverTransportRule "* unix,ssl,tcp,ziop"

  ziop_clt.py -ORBclientTransportRule "* unix,ssl,tcp,ziop" IOR:...
</pre><p>This allows you to enable ZIOP for WAN links, but disable it
for LAN communication, for example.</p>
<!--TOC subsection id="sec96" Forcing ZIOP Policies-->
<h3 id="sec96" class="subsection">6.10.1&#XA0;&#XA0;Forcing ZIOP Policies</h3><!--SEC END --><p>The fact that a server supports ZIOP is encoded in its IORs. This
means that if a client uses a <span style="font-family:monospace">corbaloc</span> URI to reference an
object, the object reference does not contain ZIOP details, and thus
the communication cannot use ZIOP. If a client is absolutely certain
that a server supports ZIOP, it can extend an object reference with
ZIOP details using <span style="font-family:monospace">omniZIOP.setServerPolicies()</span>. Using the new
object reference, the client will be able to make ZIOP calls.</p><div class="lstlisting"><span style="font-size:small">ziop_obj</span><span style="font-size:small"> = </span><span style="font-size:small">omniZIOP</span><span style="font-size:small">.</span><span style="font-size:small">serServerPolicies</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">, </span><span style="font-size:small">policies</span><span style="font-size:small">)</span></div><p>Creating a ZIOP-enabling object reference in this way is dangerous!
If the server does not actually support ZIOP, it will receive
compressed messages that it cannot handle. A well-behaved server will
throw a <span style="font-family:monospace">CORBA.MARSHAL</span> exception in response, or perhaps just
drop the invalid connection.</p>
<!--TOC section id="sec97" Connection Management Extension-->
<h2 id="sec97" class="section">6.11&#XA0;&#XA0;Connection Management Extension</h2><!--SEC END --><p>The <span style="font-family:monospace">omniConnectionMgmt</span> module provides an omniORB-specific
extension for application-level connection management. Its purpose is
to allow clients and servers to negotiate private GIOP connections,
and to control how the connections are used in multi-threaded
situations.</p><p>The <span style="font-family:monospace">omniConnectionMgmt</span> library has two functions:</p><div class="lstlisting"><span style="font-size:small">  </span><span style="font-size:small">init</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">makeRestrictedReference</span><span style="font-size:small">(</span><span style="font-size:small">object_ref</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">connection_id</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">max_connections</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">max_threads</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">data_batch</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">permit_interleaved</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">server_hold_open</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The <span style="font-family:monospace">init()</span> function must be called before <span style="font-family:monospace">CORBA.ORB_init()</span> in
every process that is to take part in the connection management.</p><p>The <span style="font-family:monospace">makeRestrictedReference()</span> function is the single entry-point to
the connection management functionality. It builds an annotated object
reference that contains information for the connection management
system. It returns a new reference, leaving the original object
reference unchanged.</p>
<!--TOC subsection id="sec98" Client-side parameters-->
<h3 id="sec98" class="subsection">6.11.1&#XA0;&#XA0;Client-side parameters</h3><!--SEC END --><p>These parameters affect the client side of a connection:</p><p><span style="font-family:monospace">connection_id</span></p><p>This number identifies the private connection set. All object
references with the same <span style="font-family:monospace">connection_id</span> will share the same set
of GIOP connections. Object references with different connection ids
are guaranteed to use different connections from each other, and from
object references that have not been annotated with
<span style="font-family:monospace">makeRestrictedReference()</span>.</p><p><span style="font-family:monospace">max_connections</span></p><p>This parameter overrides the omniORB <span style="font-family:monospace">maxGIOPConnectionPerServer</span>
configuration parameter for the given <span style="font-family:monospace">connection_id</span>. It
determines the maximum number of separate GIOP connections that will
be opened to the object&#X2019;s server to service concurrent calls. It is
common to set this value to 1, indicating that only one connection
will be used for the given <span style="font-family:monospace">connection_id</span>. Note that this
parameter can only be used to reduce the default
<span style="font-family:monospace">maxGIOPConnectionPerServer</span> value, not increase it.</p><p><span style="font-family:monospace">data_batch</span></p><p>omniORB usually configures its TCP connections to disable Nagle&#X2019;s
algorithm, which batches small messages together into single IP
packages, since that is best for the usual CORBA usage pattern of
two-way requests. Setting this parameter to true overrides that, and
enables Nagle&#X2019;s algorithm on TCP connections or equivalent
functionality on other transports. This can increase throughput if a
client is sending a large number of small oneway calls.</p><p><span style="font-family:monospace">permit_interleaved</span></p><p>This parameter overrides the <span style="font-family:monospace">oneCallPerConnection</span> configuration
parameter that determines whether multi-threaded clients can
interleave calls on a single connection, issuing a new request message
while a previous request is still waiting for a reply. If
<span style="font-family:monospace">permit_interleaved</span> is true, clients can interleave messages;
if it is false, they cannot.</p>
<!--TOC subsection id="sec99" Server-side parameters-->
<h3 id="sec99" class="subsection">6.11.2&#XA0;&#XA0;Server-side parameters</h3><!--SEC END --><p>These parameters affect the client side of a connection:</p><p><span style="font-family:monospace">max_threads</span></p><p>This parameter overrides the global
<span style="font-family:monospace">maxServerThreadPerConnection</span> configuration parameter that
determines the maximum number of concurrent threads the server will
use to service requests coming from a connection. Note that this
parameter is only relevant if either the client permits interleaved
calls, or if oneway operations are used, since those are the only
circumstances under which the server can receive a new request on a
connection while already handling a request. As with the
<span style="font-family:monospace">max_connections</span> client-side parameter, this parameter can only
reduce the default number of threads, not increase it.</p><p><span style="font-family:monospace">server_hold_open</span></p><p>Normally, both clients and servers can decide to close a GIOP
connection at any time. When using normal two-way calls, this is no
problem since if a server closes a connection, the client is
guaranteed to notice it when it waits for a reply, and can retry the
call if necessary. With oneway calls, however, if a server closes a
connection just as the client is sending a request, the client will
not know whether the oneway call was received or not, and the call
will potentially be lost. By setting the <span style="font-family:monospace">server_hold_open</span>
parameter to true, the server will not close the connection, relying
on the client to do so. In that case, oneway calls will not be lost
unless there is a network problem that breaks the GIOP connection.</p>
<!--TOC subsection id="sec100" Usage-->
<h3 id="sec100" class="subsection">6.11.3&#XA0;&#XA0;Usage</h3><!--SEC END --><p>The omniConnectionMgmt extension is very easy to use&#X2014;simply call the
<span style="font-family:monospace">init()</span> method in all processes involved, then restrict references
as required. The <span style="font-family:monospace">makeRestrictedReference()</span> function adds profile
information to the object reference&#X2019;s IOR, meaning that the parameters
become part of the object reference and are transmitted along with
it. In other words, a server can create a restricted reference and
send it to a client, and the client will automatically make use of the
restricted parameters when it invokes operations on the object
reference. Alternatively, a client can restrict a normal reference it
receives, in order to change its own behaviour.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note11" href="#text11">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">GIOP 1.2 supports
&#X2018;bidirectional GIOP&#X2019;, which permits the r&#XF4;les to be reversed.</div></dd><dt class="dt-thefootnotes"><a id="note12" href="#text12">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Or
<span style="font-family:monospace">CORBA::TRANSIENT</span> if the backwards-compatibility
<span style="font-family:monospace">throwTransientOnTimeout</span> parameter is set to <span style="font-family:monospace">1</span>.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec101" Interoperable Naming Service-->
<h1 id="sec101" class="chapter">Chapter&#XA0;7&#XA0;&#XA0;Interoperable Naming Service</h1><!--SEC END --><p>
<a id="chap:ins"></a></p><p>omniORB supports the Interoperable Naming Service (INS). The following
is a summary of its facilities.</p>
<!--TOC section id="sec102" Object URIs-->
<h2 id="sec102" class="section">7.1&#XA0;&#XA0;Object URIs</h2><!--SEC END --><p>As well as accepting IOR-format strings, <span style="font-family:monospace">orb.string_to_object()</span>
now also supports two new Uniform Resource Identifier
(URI)&#XA0;[<a href="#rfc2396">BLFIM98</a>] formats, which can be used to specify objects in
a convenient human-readable form. The existing IOR-format strings are
now also considered URIs.</p>
<!--TOC subsection id="sec103" corbaloc-->
<h3 id="sec103" class="subsection">7.1.1&#XA0;&#XA0;corbaloc</h3><!--SEC END --><p><span style="font-family:monospace">corbaloc</span> URIs allow you to specify object references which
can be contacted by IIOP, or found through
<span style="font-family:monospace">ORB::resolve_initial_references()</span>. To specify an IIOP object
reference, you use a URI of the form:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:</span>&lt;<span style="font-style:italic">host</span>&gt;<span style="font-family:monospace">:</span>&lt;<span style="font-style:italic">port</span>&gt;<span style="font-family:monospace">/</span>&lt;<span style="font-style:italic">object key</span>&gt;
</blockquote><p>for example:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:myhost.example.com:1234/MyObjectKey</span>
</blockquote><p>which specifies an object with key &#X2018;MyObjectKey&#X2019; within a
process running on myhost.example.com listening on port 1234. Object
keys containing non-ASCII characters can use the standard URI %
escapes:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:myhost.example.com:1234/My</span><span style="font-family:monospace">%</span><span style="font-family:monospace">efObjectKey</span>
</blockquote><p>denotes an object key with the value 239 (hex ef) in the
third octet.</p><p>The protocol name &#X2018;<span style="font-family:monospace">iiop</span>&#X2019; can be abbreviated to the empty
string, so the original URI can be written:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com:1234/MyObjectKey</span>
</blockquote><p>The IANA has assigned port number 2809<sup><a id="text13" href="#note13">1</a></sup> for use by <span style="font-family:monospace">corbaloc</span>, so if
the server is listening on that port, you can leave the port number
out. The following two URIs refer to the same object:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com:2809/MyObjectKey</span><br>
<span style="font-family:monospace">corbaloc::myhost.example.com/MyObjectKey</span>
</blockquote><p>You can specify an object which is available at more than
one location by separating the locations with commas:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com,:localhost:1234/MyObjectKey</span>
</blockquote><p>Note that you must restate the protocol for each address,
hence the &#X2018;<span style="font-family:monospace">:</span>&#X2019; before &#X2018;<span style="font-family:monospace">localhost</span>&#X2019;. It could
equally have been written &#X2018;<span style="font-family:monospace">iiop:localhost</span>&#X2019;.</p><p>You can also specify an IIOP version number:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::1.2@myhost.example.com/MyObjectKey</span>
</blockquote><p>Specifying IIOP versions above 1.0 is slightly risky since higher
versions make use of various information stored in IORs that is not
present in a corbaloc URI. It is generally best to contact initial
corbaloc objects with IIOP 1.0, and rely on higher versions for all
other object references.</p><p>Alternatively, to use <span style="font-family:monospace">resolve_initial_references()</span>, you
use a URI of the form:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:rir:/NameService</span>
</blockquote>
<!--TOC subsection id="sec104" corbaname-->
<h3 id="sec104" class="subsection">7.1.2&#XA0;&#XA0;corbaname</h3><!--SEC END --><p>
<a id="sec:corbaname"></a></p><p><span style="font-family:monospace">corbaname</span> URIs cause <span style="font-family:monospace">string_to_object()</span> to look-up a
name in a CORBA Naming service. They are an extension of the
<span style="font-family:monospace">corbaloc</span> syntax:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname:</span>&lt;<span style="font-style:italic">corbaloc location</span>&gt;<span style="font-family:monospace">/</span>&lt;<span style="font-style:italic">object key</span>&gt;<span style="font-family:monospace">#</span>&lt;<span style="font-style:italic">stringified name</span>&gt;
</blockquote><p>for example:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost/NameService#project/example/echo.obj</span><br>
<span style="font-family:monospace">corbaname:rir:/NameService#project/example/echo.obj</span>
</blockquote><p>The object found with the <span style="font-family:monospace">corbaloc</span>-style portion
must be of type <span style="font-family:monospace">CosNaming::NamingContext</span>, or something
derived from it. If the object key (or <span style="font-family:monospace">rir</span> name) is
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019;, it can be left out:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost#project/example/echo.obj</span><br>
<span style="font-family:monospace">corbaname:rir:#project/example/echo.obj</span>
</blockquote><p>The stringified name portion can also be left out, in which
case the URI denotes the <span style="font-family:monospace">CosNaming::NamingContext</span> which would
have been used for a look-up:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost.example.com</span><br>
<span style="font-family:monospace">corbaname:rir:</span>
</blockquote><p>The first of these examples is the easiest way of specifying
the location of a naming service.</p>
<!--TOC section id="sec105" Configuring resolve_initial_references-->
<h2 id="sec105" class="section">7.2&#XA0;&#XA0;Configuring resolve_initial_references</h2><!--SEC END --><p>
<a id="sec:insargs"></a></p><p>The INS specifies two standard command line arguments which provide a
portable way of configuring <span style="font-family:monospace">ORB::resolve_initial_references()</span>:</p>
<!--TOC subsection id="sec106" ORBInitRef-->
<h3 id="sec106" class="subsection">7.2.1&#XA0;&#XA0;ORBInitRef</h3><!--SEC END --><p><span style="font-family:monospace">-ORBInitRef</span> takes an argument of the form
&lt;<span style="font-style:italic">ObjectId</span>&gt;<span style="font-family:monospace">=</span>&lt;<span style="font-style:italic">ObjectURI</span>&gt;. So, for example,
with command line arguments of:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBInitRef NameService=corbaname::myhost.example.com</span>
</blockquote><p><span style="font-family:monospace">resolve_initial_references("NameService")</span> will
return a reference to the object with key &#X2018;NameService&#X2019; available on
myhost.example.com, port 2809. Since IOR-format strings are considered
URIs, you can also say things like:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBInitRef NameService=IOR:00ff...</span>
</blockquote>
<!--TOC subsection id="sec107" ORBDefaultInitRef-->
<h3 id="sec107" class="subsection">7.2.2&#XA0;&#XA0;ORBDefaultInitRef</h3><!--SEC END --><p><span style="font-family:monospace">-ORBDefaultInitRef</span> provides a prefix string which is used to
resolve otherwise unknown names. When
<span style="font-family:monospace">resolve_initial_references()</span> is unable to resolve a name which
has been specifically configured (with <span style="font-family:monospace">-ORBInitRef</span>), it
constructs a string consisting of the default prefix, a &#X2018;<span style="font-family:monospace">/</span>&#X2019;
character, and the name requested. The string is then fed to
<span style="font-family:monospace">string_to_object()</span>. So, for example, with a command line of:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBDefaultInitRef corbaloc::myhost.example.com</span>
</blockquote><p>a call to <span style="font-family:monospace">resolve_initial_references("MyService")</span>
will return the object reference denoted by
&#X2018;<span style="font-family:monospace">corbaloc::myhost.example.com/MyService</span>&#X2019;.</p><p>Similarly, a <span style="font-family:monospace">corbaname</span> prefix can be used to cause
look-ups in the naming service. Note, however, that since a
&#X2018;<span style="font-family:monospace">/</span>&#X2019; character is always added to the prefix, it is
impossible to specify a look-up in the root context of the naming
service&#X2014;you have to use a sub-context, like:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBDefaultInitRef corbaname::myhost.example.com#services</span>
</blockquote>
<!--TOC section id="sec108" omniNames-->
<h2 id="sec108" class="section">7.3&#XA0;&#XA0;omniNames</h2><!--SEC END -->
<!--TOC subsection id="sec109" NamingContextExt-->
<h3 id="sec109" class="subsection">7.3.1&#XA0;&#XA0;NamingContextExt</h3><!--SEC END --><p>omniNames supports the <span style="font-family:monospace">CosNaming::NamingContextExt</span> interface:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">NamingContextExt</span><span style="font-size:small"> : </span><span style="font-size:small">NamingContext</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">Address</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">URLString</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">StringName</span><span style="font-size:small">  </span><span style="font-size:small">to_string</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">n</span><span style="font-size:small">)        </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Name</span><span style="font-size:small">        </span><span style="font-size:small">to_name</span><span style="font-size:small">  (</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">sn</span><span style="font-size:small">) </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">exception</span></span><span style="font-size:small"> </span><span style="font-size:small">InvalidAddress</span><span style="font-size:small"> {};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">URLString</span><span style="font-size:small">   </span><span style="font-size:small">to_url</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Address</span><span style="font-size:small"> </span><span style="font-size:small">addr</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">sn</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidAddress</span><span style="font-size:small">, </span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">Object</span></span><span style="font-size:small">      </span><span style="font-size:small">resolve_str</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">n</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">NotFound</span><span style="font-size:small">, </span><span style="font-size:small">CannotProceed</span><span style="font-size:small">, </span><span style="font-size:small">InvalidName</span><span style="font-size:small">, </span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p><span style="font-family:monospace">to_string()</span> and <span style="font-family:monospace">to_name()</span> convert from <span style="font-family:monospace">CosNaming::Name</span>
sequences to flattened strings and vice-versa. Calling these
operations involves remote calls to the naming service, so they are
not particularly efficient. The <span style="font-family:monospace">omniORB.URI</span> module contains
equivalent <span style="font-family:monospace">nameToString()</span> and <span style="font-family:monospace">stringToName()</span> functions, which do
not involve remote calls.</p><p>A <span style="font-family:monospace">CosNaming::Name</span> is stringified by separating name components
with &#X2018;<span style="font-family:monospace">/</span>&#X2019; characters. The <span style="font-family:monospace">kind</span> and <span style="font-family:monospace">id</span> fields of
each component are separated by &#X2018;<span style="font-family:monospace">.</span>&#X2019; characters. If the
<span style="font-family:monospace">kind</span> field is empty, the representation has no trailing
&#X2018;<span style="font-family:monospace">.</span>&#X2019;; if the <span style="font-family:monospace">id</span> is empty, the representation starts
with a &#X2018;<span style="font-family:monospace">.</span>&#X2019; character; if both <span style="font-family:monospace">id</span> and <span style="font-family:monospace">kind</span>
are empty, the representation is just a &#X2018;<span style="font-family:monospace">.</span>&#X2019;. The backslash
&#X2018;<span style="font-family:monospace">\</span>&#X2019; is used to escape the meaning of
&#X2018;<span style="font-family:monospace">/</span>&#X2019;, &#X2018;<span style="font-family:monospace">.</span>&#X2019; and &#X2018;<span style="font-family:monospace">\</span>&#X2019; itself.</p><p><span style="font-family:monospace">to_url()</span> takes a <span style="font-family:monospace">corbaloc</span> style address and key string
(but without the <span style="font-family:monospace">corbaloc:</span> part), and a stringified name,
and returns a <span style="font-family:monospace">corbaname</span> URI (incorrectly called a URL)
string, having properly escaped any invalid characters. The
specification does not make it clear whether or not the address string
should also be escaped by the operation; omniORB does not escape
it. For this reason, it is best to avoid calling <span style="font-family:monospace">to_url()</span> if the
address part contains escapable characters. The local function
<span style="font-family:monospace">omniORB.URI.addrAndNameToURI()</span> is equivalent.</p><p><span style="font-family:monospace">resolve_str()</span> is equivalent to calling <span style="font-family:monospace">to_name()</span> followed by
the inherited <span style="font-family:monospace">resolve()</span> operation. There are no string-based
equivalents of the various bind operations.</p>
<!--TOC subsection id="sec110" Use with corbaname-->
<h3 id="sec110" class="subsection">7.3.2&#XA0;&#XA0;Use with corbaname</h3><!--SEC END --><p>To make it easy to use omniNames with <span style="font-family:monospace">corbaname</span> URIs, it
starts with the default port of 2809, and an object key of
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019; for the root naming context.</p>
<!--TOC section id="sec111" omniMapper-->
<h2 id="sec111" class="section">7.4&#XA0;&#XA0;omniMapper</h2><!--SEC END --><p>omniMapper is a simple daemon which listens on port 2809 (or any other
port), and redirects IIOP requests for configured object keys to
associated persistent IORs. It can be used to make a naming service
(even an old non-INS aware version of omniNames or other ORB&#X2019;s naming
service) appear on port 2809 with the object key
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019;. The same goes for any other service you may
wish to specify, such as an interface repository. omniMapper is
started with a command line of:</p><blockquote class="quote">
<span style="font-family:monospace">omniMapper [-port </span>&lt;<span style="font-style:italic">port</span>&gt;<span style="font-family:monospace">] [-config </span>&lt;<span style="font-style:italic">config file</span>&gt;<span style="font-family:monospace">] [-v]</span>
</blockquote><p>The <span style="font-family:monospace">-port</span> option allows you to choose a port other
than 2809 to listen on. The <span style="font-family:monospace">-config</span> option specifies a
location for the configuration file. The default name is
<span style="font-family:monospace">/etc/omniMapper.cfg</span>, or <span style="font-family:monospace">C:\omniMapper.cfg</span> on
Windows. omniMapper does not normally print anything; the <span style="font-family:monospace">-v</span>
option makes it verbose so it prints configuration information and a
record of the redirections it makes, to standard output.</p><p>The configuration file is very simple. Each line contains a string to
be used as an object key, some white space, and an IOR (or any valid
URI) that it will redirect that object key to. Comments should be
prefixed with a &#X2018;<span style="font-family:monospace">#</span>&#X2019; character. For example:</p><blockquote class="quote">
<pre class="verbatim"># Example omniMapper.cfg
NameService         IOR:000f...
InterfaceRepository IOR:0100...
</pre>
</blockquote><p>omniMapper can either be run on a single machine, in much the same way
as omniNames, or it can be run on <em>every</em> machine, with a common
configuration file. That way, each machine&#X2019;s omniORB configuration
file could contain the line:</p><blockquote class="quote">
<pre class="verbatim">ORBDefaultInitRef corbaloc::localhost
</pre>
</blockquote>
<!--TOC section id="sec112" Creating objects with simple object keys-->
<h2 id="sec112" class="section">7.5&#XA0;&#XA0;Creating objects with simple object keys</h2><!--SEC END --><p>In normal use, omniORB creates object keys containing various
information including POA names and various non-ASCII characters.
Since object keys are supposed to be opaque, this is not usually a
problem. The INS breaks this opacity and requires servers to create
objects with human-friendly keys.</p><p>If you wish to make your objects available with human-friendly URIs,
there are two options. The first is to use omniMapper as described
above, in conjunction with a <span style="font-family:monospace">PERSISTENT</span> POA. The second is to
create objects with the required keys yourself. You do this with a
special POA with the name &#X2018;<span style="font-family:monospace">omniINSPOA</span>&#X2019;, acquired from
<span style="font-family:monospace">resolve_initial_references()</span>. This POA has the <span style="font-family:monospace">USER_ID</span>
and <span style="font-family:monospace">PERSISTENT</span> policies, and the special property that the
object keys it creates contain only the object ids given to the POA,
and no other data. It is a normal POA in all other respects, so you
can activate/deactivate it, create children, and so on, in the usual
way.</p><p>Children of the omniINSPOA do not inherit its special properties of
creating simple object keys. If the omniINSPOA&#X2019;s policies are not
suitable for your application, you cannot create a POA with different
policies (such as single threading, for example), and still generate
simple object keys. Instead, you can activate a servant in the
omniINSPOA that uses location forwarding to redirect requests to
objects in a different POA.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note13" href="#text13">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Not 2089 as
printed in [<a href="#inschapters">OMG00</a>]!</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec113" Code set conversion-->
<h1 id="sec113" class="chapter">Chapter&#XA0;8&#XA0;&#XA0;Code set conversion</h1><!--SEC END --><p>
<a id="chap:codesets"></a></p><p>omniORB supports full code set negotiation, used to select and
translate between different character sets, for the transmission of
chars, strings, wchars and wstrings. The support is mostly transparent
to application code, but there are a number of options that can be
selected. This chapter covers the options, and also gives some
pointers about how to implement your own code sets, in case the ones
that come with omniORB are not sufficient.</p>
<!--TOC section id="sec114" Native code set-->
<h2 id="sec114" class="section">8.1&#XA0;&#XA0;Native code set</h2><!--SEC END --><p>For the ORB to know how to handle strings given to it by the
application, it must know what code set they are represented with, so
it can properly translate them if need be.</p><p>For Python 2.x, the default is ISO 8859-1 (Latin 1). A different code
set can be chosen at initialisation time with the
<span style="font-family:monospace">nativeCharCodeSet</span> parameter. The supported code sets are
printed out at initialisation time if the ORB traceLevel is 15 or
greater. Some applications may need to set the native char code set to
UTF-8, allowing the full Unicode range to be supported in strings.</p><p>In Python 3.x, all Python strings are Unicode, so it always behaves as
if the native char code set is UTF-8.</p><p>wchar and wstring are always represented by the Python Unicode type,
so there is no need to select a native code set for wchar.</p>
<!--TOC section id="sec115" Default code sets-->
<h2 id="sec115" class="section">8.2&#XA0;&#XA0;Default code sets</h2><!--SEC END --><p>The way code set conversion is meant to work in CORBA communication is
that each client and server has a <span style="font-style:italic">native</span> code set that it uses
for character data in application code, and supports a number of
<span style="font-style:italic">transmission</span> code sets that is uses for communication. When a
client connects to a server, the client picks one of the server&#X2019;s
transmission code sets to use for the interaction. For that to work,
the client plainly has to know the server&#X2019;s supported transmission
code sets.</p><p>Code set information from servers is embedded in IORs. A client with
an IOR from a server should therefore know what transmission code sets
the server supports. This approach can fail for two reasons:</p><ol class="enumerate" type=1><li class="li-enumerate">
A <span style="font-family:monospace">corbaloc</span> URI (see chapter&#XA0;<a href="#chap%3Ains">7</a>) does
not contain any code set information.</li><li class="li-enumerate">Some badly-behaved servers that do support code set conversion
fail to put codeset information in their IORs.
</li></ol><p>The CORBA standard says that if a server has not specified
transmission code set information, clients must assume that they only
support ISO-8859-1 for char and string, and do not support wchar and
wstring at all. The effect is that client code receives
<span style="font-family:monospace">DATA_CONVERSION</span> or <span style="font-family:monospace">BAD_PARAM</span> exceptions.</p><p>To avoid this issue, omniORB allows you to configure <span style="font-style:italic">default</span>
code sets that are used as a server&#X2019;s transmission code sets if they
are not otherwise known. Set <span style="font-family:monospace">defaultCharCodeSet</span> for char and
string data, and <span style="font-family:monospace">defaultWCharCodeSet</span> for wchar and wstring data.</p>
<!--TOC section id="sec116" Code set library-->
<h2 id="sec116" class="section">8.3&#XA0;&#XA0;Code set library</h2><!--SEC END --><p>To save space in the main ORB core library, most of the code set
implementations are in a separate library. To load it from Python, you
must import the <span style="font-family:monospace">omniORB.codesets</span> module before calling
<span style="font-family:monospace">CORBA.ORB_init()</span>.</p>
<!--TOC section id="sec117" Implementing new code sets-->
<h2 id="sec117" class="section">8.4&#XA0;&#XA0;Implementing new code sets</h2><!--SEC END --><p>Code sets must currently be implemented in C++. See the omniORB for
C++ documentation for details.</p>
<!--TOC chapter id="sec118" Interceptors-->
<h1 id="sec118" class="chapter">Chapter&#XA0;9&#XA0;&#XA0;Interceptors</h1><!--SEC END --><p>
<a id="chap:interceptors"></a></p><p>omniORBpy has limited interceptor support. Interceptors permit the
application to insert processing at various points along the call
chain, as requests are processed. The Portable Interceptors API is not
supported.</p>
<!--TOC section id="sec119" Request interceptors-->
<h2 id="sec119" class="section">9.1&#XA0;&#XA0;Request interceptors</h2><!--SEC END --><p>Interceptors for incoming and outgoing requests are registered using
functions in the <span style="font-family:monospace">omniORB.interceptors</span> module:</p><div class="lstlisting"><span style="font-size:small">  </span><span style="font-size:small">addClientSendRequest</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">addClientReceiveReply</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">addServerReceiveRequest</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">addServerSendReply</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">addServerSendException</span><span style="font-size:small">()</span></div><p>To register an interceptor function, call the relevant registration
function with a callable argument. The callable will be called with
two or three arguments. The first argument is a string containing the
name of the operation being invoked; the second is the collection of
service contexts to be retrieved or filled in.
<span style="font-family:monospace">ServerSendException</span> has a third argument, the repository id of
the exception being thrown.</p><p>When receiving service contexts (in the <span style="font-family:monospace">ClientReceiveReply</span> and
<span style="font-family:monospace">ServerReceiveRequest</span> interceptors), the second argument
is a tuple of 2-tuples. In each 2-tuple, the first item is the service
context id and the second item is the CDR encapsulation of the service
context. The encapsulation can be decoded with
<span style="font-family:monospace">omniORB.cdrUnmarshal()</span> (but only if you know the type to decode it
to).</p><p>When sending service contexts (<span style="font-family:monospace">ClientSendRequest</span>,
<span style="font-family:monospace">ServerSendReply</span>, and <span style="font-family:monospace">ServerSendException</span>), the second
argument is an empty list. The interceptor function can choose to add
one or more service context tuples, with the same form described
above, by appending to the list. Encapsulations are created with
<span style="font-family:monospace">omniORB.cdrMarshal()</span>.</p><p>Interceptor registration functions may only be called before the ORB
is initialised. Attempting to call them later results in a
<span style="font-family:monospace">BAD_INV_ORDER</span> exception.</p>
<!--TOC section id="sec120" Thread interceptors-->
<h2 id="sec120" class="section">9.2&#XA0;&#XA0;Thread interceptors</h2><!--SEC END --><p>Thread interceptors are registered using functions in the
<span style="font-family:monospace">omniORB.interceptors</span> module:</p><div class="lstlisting"><span style="font-size:small">  </span><span style="font-size:small">addAssignUpcallThread</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">addAssignAMIThread</span></div><p>To register thread interceptors, call the relevant registration
function with a callable argument. The callable can be a simple
function that returns None, or a generator that yields once. When a
thread is assigned to perform server upcalls or AMI calls, the
corresponding function is called. If it is a simple function, the
function is called when the thread is assigned. If it is a generator,
it is called when the thread is assigned, yields to permit the thread
to execute, and then resumes when the thread is unassigned. For
example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">upcallInterceptor</span><span style="font-size:small">():</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"This thread is about to be used to call into server code"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">yield</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">print</span></span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"The thread has finished"</span></span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">omniORB</span><span style="font-size:small">.</span><span style="font-size:small">interceptors</span><span style="font-size:small">.</span><span style="font-size:small">addAssignUpcallThread</span><span style="font-size:small">(</span><span style="font-size:small">upcallInterceptor</span><span style="font-size:small">)</span></div>
<!--TOC chapter id="sec121" Objects by value-->
<h1 id="sec121" class="chapter">Chapter&#XA0;10&#XA0;&#XA0;Objects by value</h1><!--SEC END --><p>
<a id="chap:valuetype"></a></p><p>omniORBpy supports objects by value, declared with the
<span style="font-family:monospace">valuetype</span> keyword in IDL. This chapter outlines some issues to
do with using valuetypes in omniORB. You are assumed to have read the
relevant parts of the CORBA specification, specifically chapters 4 and
5 of the CORBA 2.6 specification, and section 1.3.10 of the Python
language mapping, version 1.2.</p>
<!--TOC section id="sec122" Features-->
<h2 id="sec122" class="section">10.1&#XA0;&#XA0;Features</h2><!--SEC END --><p>omniORB supports the complete objects by value specification, with the
exception of custom valuetypes. All other features including value
boxes, value sharing semantics, abstract valuetypes, and abstract
interfaces are supported.</p>
<!--TOC section id="sec123" Value sharing and local calls-->
<h2 id="sec123" class="section">10.2&#XA0;&#XA0;Value sharing and local calls</h2><!--SEC END --><p>When valuetypes are passed as parameters in CORBA calls (i.e. calls
on CORBA objects declared with <span style="font-family:monospace">interface</span> in IDL), the structure
of related values is maintained. Consider, for example, the following
IDL definitions (which are from the example code in
<span style="font-family:monospace">src/examples/valuetype/simple</span>:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">   </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Test</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>If the client to the <span style="font-family:monospace">Test</span> object passes the same value in both
parameters, just one value is transmitted, and the object
implementation receives a copy of the single value, with references to
it in both parameters.</p><p>In the case that the object is remote from the client, there is
obviously a copying step involved. In the case that the object is in
the same address space as the client, the same copying semantics must
be maintained so that the object implementation can modify the values
it receives without the client seeing the modifications. To support
that, omniORB must copy the entire parameter list in one operation, in
case there is sharing between different parameters. Such copying is a
rather more time-consuming process than the parameter-by-parameter
copy that takes place in calls not involving valuetypes.</p><p>To avoid the overhead of copying parameters in this way, applications
can choose to relax the semantics of value copying in local calls, so
values are not copied at all, but are passed by reference. In that
case, the client to a call <em>will</em> see any modifications to the
values it passes as parameters (and similarly, the object
implementation will see any changes the client makes to returned
values). To choose this option, set the <span style="font-family:monospace">copyValuesInLocalCalls</span>
configuration parameter to zero.</p>
<!--TOC section id="sec124" Value factories-->
<h2 id="sec124" class="section">10.3&#XA0;&#XA0;Value factories</h2><!--SEC END --><p>As specified in section 1.3.10 of the Python language mapping (version
1.2), factories are automatically registered for values with no
operations. This means that in common usage where values are just used
to hold state, the application code does not need to implement and
register factories. The application may still register different
factories if it requires.</p><p>If the IDL definitions specify operations on values, the application
is supposed to provide implementations of the operations, meaning that
it must register suitable factories. If the application chooses to
ignore the operations and just manipulate the data inside the values,
omniidl can be asked to register factories for <em>all</em> values, not
just ones with no operations, using the <span style="font-family:monospace">-Wbfactories</span> option.</p><p>The Python language mapping says a value factory should be &#X201C;a class
instance with a <span style="font-family:monospace">__call__</span> method taking no arguments&#X201D;.
omniORBpy is less restrictive than that, and permits the use of
<em>any</em> callable object, in particular the value implementation
class itself.</p>
<!--TOC section id="sec125" Standard value boxes-->
<h2 id="sec125" class="section">10.4&#XA0;&#XA0;Standard value boxes</h2><!--SEC END --><p>The standard <span style="font-family:monospace">CORBA.StringValue</span> and <span style="font-family:monospace">CORBA.WStringValue</span>
value boxes are available to application code. To make the definitions
available in IDL, #include the standard <span style="font-family:monospace">orb.idl</span>.</p>
<!--TOC section id="sec126" Values inside Anys-->
<h2 id="sec126" class="section">10.5&#XA0;&#XA0;Values inside Anys</h2><!--SEC END --><p>Valuetypes inserted into Anys cause a number of interesting issues.
Even when inside Anys, values are required to support complete sharing
semantics. Take this IDL for example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">   </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">AnyTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Any</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Now, suppose the client behaves as follows:</p><div class="lstlisting"><span style="font-size:small">v</span><span style="font-size:small"> = </span><span style="font-size:small">One_impl</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"hello"</span></span><span style="font-size:small">, 123)</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">.</span><span style="font-size:small">Any</span><span style="font-size:small">(</span><span style="font-size:small">ValueTest</span><span style="font-size:small">.</span><span style="font-size:small">_tc_One</span><span style="font-size:small">, </span><span style="font-size:small">v</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small">.</span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small">a</span><span style="font-size:small">)</span></div><p>then on the server side:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">AnyTest_impl</span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    ...</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">def</span></span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small">self</span><span style="font-size:small">, </span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small">a</span><span style="font-size:small">):</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">v2</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">.</span><span style="font-size:small">value</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">assert</span><span style="font-size:small"> </span><span style="font-size:small">v2</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">is</span></span><span style="font-size:small"> </span><span style="font-size:small">v</span></div><p>This is all very well in this kind of simple situation, but problems
can arise if truncatable valuetypes are used. Imagine this derived
value:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">Two</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">truncatable</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small"> </span><span style="font-size:small">d</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Now, suppose that the client shown above sends an instance of
valuetype <span style="font-family:monospace">Two</span> in both parameters, and suppose that the server
has not seen the definition of valuetype <span style="font-family:monospace">Two</span>. In this
situation, as the first parameter is unmarshalled, it will be
truncated to valuetype <span style="font-family:monospace">One</span>, as required. Now, when the Any is
unmarshalled, it refers to the same value, which has been truncated.
So, even though the TypeCode in the Any indicates that the value has
type <span style="font-family:monospace">Two</span>, the stored value actually has type <span style="font-family:monospace">One</span>. If the
receiver of the Any tries to pass it on, transmission will fail
because the Any&#X2019;s value does not match its TypeCode.</p><p>In the opposite situation, where an Any parameter comes before a
valuetype parameter, a different problem occurs. In that case, as the
Any is unmarshalled, there is no type information available for
valuetype <span style="font-family:monospace">Two</span>, so omniORBpy constructs a suitable type based on
the transmitted TypeCode. Because omniORBpy is unable to know how (and
indeed if) the application has implemented valuetype <span style="font-family:monospace">One</span>, the
generated class for valuetype <span style="font-family:monospace">Two</span> is not derived from the
application&#X2019;s <span style="font-family:monospace">One</span> class. When the second parameter is
unmarshalled, it is given as an indirection to the
previously-marshalled value inside the Any. The parameter is therefore
set to the constructed <span style="font-family:monospace">Two</span> type, rather than being truncated to
an instance of the application&#X2019;s registered <span style="font-family:monospace">One</span> type.</p><p>Because of these issues, it is best to avoid defining interfaces that
mix valuetypes and Anys in a single operation, and certainly to avoid
trying to share plain values with values inside Anys.</p>
<!--TOC chapter id="sec127" Asynchronous Method Invocation-->
<h1 id="sec127" class="chapter">Chapter&#XA0;11&#XA0;&#XA0;Asynchronous Method Invocation</h1><!--SEC END --><p>
<a id="chap:ami"></a></p><p>omniORB 4.2 supports Asynchronous Method Invocation, AMI, as defined
in the CORBA Messaging specification. It supports both the polling and
callback models of asynchronous calls. Note that omniORB does not
support the other parts of the Messaging specification such as Quality
of Service, Routing and Persistent requests.</p><p>While omniORB mainly targets the 2.6 version of the CORBA
specification, the AMI support follows the CORBA Messaging
specification as described in the CORBA 3.1 specification, chapter
17&#XA0;[<a href="#corba31-spec">OMG08</a>]. That version of the specification is largely
the same as the one in CORBA 2.6. The only significant difference is
that exception replies in the callback model use a simpler
interface-independent mapping.</p>
<!--TOC section id="sec128" Implied IDL-->
<h2 id="sec128" class="section">11.1&#XA0;&#XA0;Implied IDL</h2><!--SEC END --><p>AMI works by defining some additional <span style="font-style:italic">implied IDL</span> for each
interface in the real IDL. The implied IDL contains type and
operation definitions that enable asynchronous calls.</p><p>As a guide to the implied IDL, there is a special <span style="font-family:monospace">ami</span>
back-end to omniidl that outputs the implied IDL for the given input
IDL. For example, given the Echo example IDL:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// echo.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>You can output the implied IDL using</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bami echo.idl</span>
</blockquote><p>That outputs the following to standard out:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ReplyHandler for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">AMI_EchoHandler</span><span style="font-size:small"> : </span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">ReplyHandler</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_return_val</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString_excep</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> ::</span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">ExceptionHolder</span><span style="font-size:small"> </span><span style="font-size:small">excep_holder</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Poller valuetype for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">abstract</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">AMI_EchoPoller</span><span style="font-size:small"> : </span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">Poller</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_timeout</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">out</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_return_val</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// AMI implied operations for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">sendc_echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> ::</span><span style="font-size:small">AMI_EchoHandler</span><span style="font-size:small"> </span><span style="font-size:small">ami_handler</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  ::</span><span style="font-size:small">AMI_EchoPoller</span><span style="font-size:small"> </span><span style="font-size:small">sendp_echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Alternatively, you can use the <span style="font-family:monospace">-Wbdump</span> option to
output an interleaved version that shows the original IDL and the
implied IDL together.</p><p>Note that the implied IDL output is for information only. You should
not compile it, but rather instruct the omniidl Python back-end to
generate the corresponding Python definitions.</p>
<!--TOC section id="sec129" Generating AMI stubs-->
<h2 id="sec129" class="section">11.2&#XA0;&#XA0;Generating AMI stubs</h2><!--SEC END --><p>To generate stub code including AMI types and operations, give the
<span style="font-family:monospace">-Wbami</span> command line option to omniidl&#X2019;s <span style="font-family:monospace">python</span>
back-end:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bpython -Wbami echo.idl</span>
</blockquote><p>That generates the normal Python stubs and skeletons, plus
all the definitions in the implied IDL.</p>
<!--TOC section id="sec130" AMI examples-->
<h2 id="sec130" class="section">11.3&#XA0;&#XA0;AMI examples</h2><!--SEC END --><p>Example AMI clients for the <span style="font-family:monospace">Example::Echo</span> server can be found in
<span style="font-family:monospace">examples/ami</span>.</p>
<!--TOC chapter id="sec131" Resources-->
<h1 id="sec131" class="chapter">Chapter&#XA0;12&#XA0;&#XA0;Resources</h1><!--SEC END --><p>There are a number of useful online resources related to omniORB:</p><ul class="itemize"><li class="li-itemize"><a href="https://www.omniorb.net/"><span style="font-family:monospace">https://www.omniorb.net/</span></a> is the main omniORB web
site.</li><li class="li-itemize">The omniORB mailing list is the first port of call for questions
that are not answered in this document or in the FAQ. Subscription
information and archives are at
<a href="https://www.omniorb.net/list.html"><span style="font-family:monospace">https://www.omniorb.net/list.html</span></a></li><li class="li-itemize">Commercial support is available from
<a href="https://www.omniorb-support.com/"><span style="font-family:monospace">https://www.omniorb-support.com/</span></a></li></ul><!--TOC chapter id="sec132" References-->
<h1 id="sec132" class="chapter">References</h1><!--SEC END --><dl class="thebibliography"><dt class="dt-thebibliography">
<a id="rfc2396">[BLFIM98]</a></dt><dd class="dd-thebibliography">
T. Berners-Lee, R. Fielding, U.C. Irvine, and L. Masinter.
<em>U</em><em>niform </em><em>R</em><em>esource </em><em>I</em><em>dentifiers (</em><em>URI</em><em>): Generic Syntax</em>.
RFC 2396, August 1998.</dd><dt class="dt-thebibliography"><a id="corbaservices">[OMG98]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>CORBAServices</em><em>: Common Object Services Specification</em>, December
1998.</dd><dt class="dt-thebibliography"><a id="inschapters">[OMG00]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>Interoperable Naming Service revised chapters</em>, August 2000.
From <a href="http://www.omg.org/cgi-bin/doc?ptc/00-08-07"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?ptc/00-08-07</span></a>.</dd><dt class="dt-thebibliography"><a id="corba26-spec">[OMG01a]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>The </em><em>C</em><em>ommon </em><em>O</em><em>bject </em><em>R</em><em>equest </em><em>B</em><em>roker: </em><em>A</em><em>rchitecture and
Specification</em>, 2.6 edition, December 2001.
From <a href="http://www.omg.org/cgi-bin/doc?formal/01-12-01"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?formal/01-12-01</span></a>.</dd><dt class="dt-thebibliography"><a id="pythonmapping">[OMG01b]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>Python Language Mapping Specification</em>, February 2001.
<a href="http://www.omg.org/technology/documents/formal/python.htm"><span style="font-family:monospace">http://www.omg.org/technology/documents/formal/python.htm</span></a>.</dd><dt class="dt-thebibliography"><a id="corba31-spec">[OMG08]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>The </em><em>C</em><em>ommon </em><em>O</em><em>bject </em><em>R</em><em>equest </em><em>B</em><em>roker: </em><em>A</em><em>rchitecture and
Specification</em>, 3.1 edition, January 2008.
From <a href="http://www.omg.org/cgi-bin/doc?formal/08-01-04"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?formal/08-01-04</span></a>.</dd></dl><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
