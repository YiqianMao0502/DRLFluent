<!DOCTYPE html>
<html >
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.32">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
</style>
<title>omniORB</title>
</head>
<body >
<!--HEVEA command line is: hevea omniORB.tex -->
<!--CUT STYLE book--><!--CUT DEF chapter 1 --><div class="center"><p> <span style="font-size:xx-large"><span style="font-size:150%">The omniORB version 4.2<br>
Users&#X2019; Guide
</span></span></p><p> <span style="font-size:x-large">Duncan Grisby<br>
</span><span style="font-size:medium">(</span><a href="mailto:dgrisby@apasphere.com"><span style="font-size:medium"><span style="font-style:italic"><span style="font-family:sans-serif">dgrisby@apasphere.com</span></span></span></a><span style="font-size:medium">)</span><span style="font-size:x-large"><br>
</span></p></div><p><span style="font-size:x-large"><span style="font-weight:bold">Contents</span></span></p>
<!--TOC chapter id="sec1" Introduction-->
<h1 id="sec1" class="chapter">Chapter&#XA0;1&#XA0;&#XA0;Introduction</h1><!--SEC END --><p>omniORB is an Object Request Broker (ORB) that implements version 2.6
of the Common Object Request Broker Architecture
(CORBA)&#XA0;[<a href="#corba26-spec">OMG01</a>] specification. Where possible, backward
compatibility has been maintained back to specification 2.0. It passed
the Open Group CORBA compliant testsuite (for CORBA 2.1) and was one
of the three ORBs to be granted the CORBA brand in June 1999.</p><p>This user guide tells you how to use omniORB to develop CORBA
applications. It assumes a basic understanding of CORBA.</p><p>In this chapter, we give an overview of the main features of omniORB
and what you need to do to set up your environment to run omniORB.</p>
<!--TOC section id="sec2" Features-->
<h2 id="sec2" class="section">1.1&#XA0;&#XA0;Features</h2><!--SEC END --><p>omniORB is quite feature-rich, but it does not slavishly implement
every last part of the CORBA specification. The goal is to provide the
most generally useful parts of the specification in a clean and
efficient manner. Highlights are:</p><ul class="itemize"><li class="li-itemize">C++ and Python language bindings.</li><li class="li-itemize">Support for the complete Portable Object Adapter (POA) specification.</li><li class="li-itemize">Support for the Interoperable Naming Service (INS).</li><li class="li-itemize">Internet Inter-ORB Protocol (IIOP 1.2) is used as the native
protocol.</li><li class="li-itemize">The omniORB runtime is fully multithreaded. It uses platform
thread support encapsulated with a small class library, omnithread,
to abstract away from differences in native thread APIs.</li><li class="li-itemize">TypeCode and type Any are supported.</li><li class="li-itemize">DynAny is supported.</li><li class="li-itemize">The Dynamic Invocation and Dynamic Skeleton interfaces are supported.</li><li class="li-itemize">Valuetype and abstract interfaces are supported.</li><li class="li-itemize">Asynchronous Method Invocation (AMI) supported, including both
polling and callback models.</li><li class="li-itemize">Extensive control over connection management.</li><li class="li-itemize">Soft real-time features including call deadlines and timeouts.</li><li class="li-itemize">A COS Naming Service, omniNames.</li><li class="li-itemize">Many platforms are supported, including most Unix platforms and
Windows.</li><li class="li-itemize">It has been successfully tested for interoperability via IIOP with
other ORBs.</li></ul>
<!--TOC subsection id="sec3" Multithreading-->
<h3 id="sec3" class="subsection">1.1.1&#XA0;&#XA0;Multithreading</h3><!--SEC END --><p>omniORB is fully multithreaded. To achieve low call overhead,
unnecessary call multiplexing is eliminated. With the default
policies, there is at most one call in-flight in each communication
channel between two address spaces at any one time. To do this without
limiting the level of concurrency, new channels connecting the two
address spaces are created on demand and cached when there are
concurrent calls in progress. Each channel is served by a dedicated
thread. This arrangement provides maximal concurrency and eliminates
any thread switching in either of the address spaces to process a
call. Furthermore, to maximise the throughput in processing large call
arguments, large data elements are sent as soon as they are processed
while the other arguments are being marshalled. With GIOP 1.2, large
messages are fragmented, so the marshaller can start transmission
before it knows how large the entire message will be.</p><p>omniORB also supports a flexible thread pool policy, and supports
sending multiple interleaved calls on a single connection. This policy
leads to a small amount of additional call overhead, compared to the
default thread per connection model, but allows omniORB to scale to
extremely large numbers of concurrent clients.</p>
<!--TOC subsection id="sec4" Portability-->
<h3 id="sec4" class="subsection">1.1.2&#XA0;&#XA0;Portability</h3><!--SEC END --><p>omniORB runs on many flavours of Unix, Windows, several embedded
operating systems, and relatively obscure systems such as OpenVMS and
Fujitsu-Siemens BS2000. It is designed to be easy to port to new
platforms. The IDL to C++ mapping for all target platforms is the
same.</p><p>omniORB uses real C++ exceptions and nested classes. It keeps to the
CORBA specification&#X2019;s standard mapping as much as possible and does
not use the alternative mappings for C++ dialects. The only small
exception is the mapping of IDL modules, which can use either
namespaces according to the standard, or nested classes for truly
ancient C++ compilers without namespace support.</p><p>omniORB relies on native thread libraries to provide multithreading
capability. A small class library (omnithread&#XA0;[<a href="#tjr96a">Ric96</a>]) is used
to encapsulate the APIs of the native thread libraries. In application
code, it is recommended but not mandatory to use this class library
for thread management. It should be easy to port omnithread to any
platform that either supports the POSIX thread standard or has a
thread package that supports similar capabilities.</p><p>Partly for historical reasons, and partly to support users with
archaic compilers, omniORB does not use the C++ standard library.</p><p>The omniORB IDL compiler, omniidl, requires Python 2.5, 2.6 or 2.7.</p>
<!--TOC subsection id="sec5" Missing features-->
<h3 id="sec5" class="subsection">1.1.3&#XA0;&#XA0;Missing features</h3><!--SEC END --><p>
<a id="sec:missing"></a></p><p>omniORB is not a complete implementation of the CORBA 2.6 core. The
following is a list of the most significant missing features.</p><ul class="itemize"><li class="li-itemize">For some very dynamic uses of CORBA, you may need an Interface
Repository. omniORB does not have its own one, but it can act as a
client to an IfR. The omniifr project
(<a href="https://github.com/omniorb/omniifr"><span style="font-family:monospace">https://github.com/omniorb/omniifr</span></a>) aims to create an IfR
for omniORB.</li><li class="li-itemize">omniORB supports interceptors, but not the standard Portable
Interceptor API.</li></ul>
<!--TOC section id="sec6" Setting up your environment-->
<h2 id="sec6" class="section">1.2&#XA0;&#XA0;Setting up your environment</h2><!--SEC END --><p>
<a id="sec:setup"></a></p><p>To get omniORB running, you first need to install omniORB according to
the instructions in the installation notes for your platform. See
<span style="font-family:monospace">README.FIRST.txt</span> at the top of the omniORB tree for
instructions. Most Unix platforms can use the Autoconf
<span style="font-family:monospace">configure</span> script to automate the configuration process.</p><p>Once omniORB is installed in a suitable location, you must configure
it according to your required setup. The configuration can be set with
a configuration file, environment variables, command-line arguments
or, on Windows, the Windows registry.</p><ul class="itemize"><li class="li-itemize">On Unix platforms, the omniORB runtime looks for the environment
variable <span style="font-family:monospace">OMNIORB_CONFIG</span>. If this variable is defined, it
contains the pathname of the omniORB configuration file. If the
variable is not set, omniORB will use the compiled-in pathname to
locate the file (by default <span style="font-family:monospace">/etc/omniORB.cfg</span>).</li><li class="li-itemize">On Win32 / Win64 platforms, omniORB first checks the environment
variable <span style="font-family:monospace">OMNIORB_CONFIG</span> to obtain the pathname of the
configuration file. If this is not set, it then attempts to obtain
configuration data in the system registry. It searches for the data
under the key <span style="font-family:monospace">HKEY_LOCAL_MACHINE\SOFTWARE\omniORB</span>.</li></ul><p>omniORB has a large number of parameters than can be configured. See
chapter&#XA0;<a href="#chap%3Aconfig">4</a> for full details. The files
<span style="font-family:monospace">sample.cfg</span> and <span style="font-family:monospace">sample.reg</span> contain an example
configuration file and set of registry entries respectively.</p><p>To get all the omniORB examples running, the main thing you need to
configure is the Naming service, omniNames. To do that, the
configuration file or registry should contain an entry of the form</p><pre class="verbatim">  InitRef = NameService=corbaname::my.host.name
</pre><p>See section&#XA0;<a href="#sec%3Acorbaname">7.1.4</a> for full details of
corbaname URIs.</p>
<!--TOC section id="sec7" Platform specific variables-->
<h2 id="sec7" class="section">1.3&#XA0;&#XA0;Platform specific variables</h2><!--SEC END --><p>To compile omniORB programs correctly, several C++ preprocessor
defines <em>must</em> be specified to identify the target platform. On
Unix platforms where omniORB was configured with Autoconf, the
<span style="font-family:monospace">omniconfig.h</span> file sets these for you. On other platforms, and
Unix platforms when Autoconf is not used, you must specify the
following defines:</p><div class="flushleft">
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Platform</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >CPP defines </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Windows</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__x86__     __NT__       __OSVERSION__=4  __WIN32__</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Windows NT 3.5</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__x86__     __NT__       __OSVERSION__=3  __WIN32__</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Sun Solaris 2.5</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__sparc__   __sunos__    __OSVERSION__=5</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
HPUX 10.x</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__hppa__    __hpux__     __OSVERSION__=10</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
HPUX 11.x</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__hppa__    __hpux__     __OSVERSION__=11</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
IBM AIX 4.x</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__aix__     __powerpc__  __OSVERSION__=4</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Digital Unix 3.2</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__alpha__   __osf1__     __OSVERSION__=3</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Linux 2.x (x86)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__x86__     __linux__    __OSVERSION__=2</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Linux 2.x (powerpc)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__powerpc__ __linux__    __OSVERSION__=2</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
OpenVMS 6.x (alpha)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__alpha__   __vms        __OSVERSION__=6 </code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
OpenVMS 6.x (vax)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__vax__     __vms        __OSVERSION__=6 </code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
SGI Irix 6.x</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__mips__    __irix__     __OSVERSION__=6 </code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Reliant Unix 5.43</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__mips__    __SINIX__    __OSVERSION__=5 </code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
ATMos 4.0</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__arm__     __atmos__    __OSVERSION__=4</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
NextStep 3.x</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__m68k__    __nextstep__ __OSVERSION__=3</code> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >
Unixware 7</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><code>__x86__     __uw7__      __OSVERSION__=5</code> </td></tr>
</table>
</div><p>The preprocessor defines for new platform ports not listed above can
be found in the corresponding platform configuration files. For
instance, the platform configuration file for Sun Solaris 2.6 is in
<span style="font-family:monospace">mk/platforms/sun4_sosV_5.6.mk</span>. The preprocessor defines to
identify a platform are in the make variable
<span style="font-family:monospace">IMPORT_CPPFLAGS</span>.</p><p>In a single source multi-target environment, you can put the
preprocessor defines as the command-line arguments for the compiler.
If you are building for a single platform, you can edit
include/omniconfig.h to add the definitions.</p>
<!--TOC chapter id="sec8" The Basics-->
<h1 id="sec8" class="chapter">Chapter&#XA0;2&#XA0;&#XA0;The Basics</h1><!--SEC END --><p>
<a id="chap:basic"></a></p><p>In this chapter, we go through three examples to illustrate the
practical steps to use omniORB. By going through the source code of
each example, the essential concepts and APIs are introduced. If you
have no previous experience with using CORBA, you should study this
chapter in detail. There are pointers to other essential documents you
should be familiar with.</p><p>If you have experience with using other ORBs, you should still go
through this chapter because it provides important information about
the features and APIs that are necessarily omniORB specific. With the
Portable Object Adapter, there are very few omniORB specific details.</p>
<!--TOC section id="sec9" The Echo Object Example-->
<h2 id="sec9" class="section">2.1&#XA0;&#XA0;The Echo Object Example</h2><!--SEC END --><p>Our example is an object which has only one method. The method simply
echos the argument string. We have to:</p><ol class="enumerate" type=1><li class="li-enumerate">define the object interface in IDL
</li><li class="li-enumerate">use the IDL compiler to generate the stub code, which provides
the object mapping as defined in the CORBA specification
</li><li class="li-enumerate">provide the <span style="font-style:italic">servant</span> object implementation
</li><li class="li-enumerate">write the client code.</li></ol><p>These examples are in the <span style="font-family:monospace">src/examples/echo</span> directory of the
omniORB distribution; there are several other examples in
<span style="font-family:monospace">src/examples</span>.</p>
<!--TOC section id="sec10" Specifying the Echo interface in IDL-->
<h2 id="sec10" class="section">2.2&#XA0;&#XA0;Specifying the Echo interface in IDL</h2><!--SEC END --><p>We define an object interface, called <span style="font-family:monospace">Echo</span>, as follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>If you are new to IDL, you can learn about its syntax in Chapter 3 of
the CORBA 2.6 specification&#XA0;[<a href="#corba26-spec">OMG01</a>]. For the moment, you
only need to know that the interface consists of a single operation,
<span style="font-family:monospace">echoString()</span>, which takes a string as an input argument and returns
a copy of the same string.</p><p>The interface is written in a file, called <span style="font-family:monospace">echo.idl</span>. It is part
of the CORBA standard that all IDL files must have the extension
&#X2018;<span style="font-family:monospace">.idl</span>&#X2019;, although omniORB does not enforce this. In the omniORB
distribution, this file is in <span style="font-family:monospace">idl/echo.idl</span>.</p><p>For simplicity, the interface is defined in the global IDL namespace.
You should normally avoid this practice for the sake of object
reusability. If every CORBA developer defines their interfaces in the
global IDL namespace, there is a danger of name clashes between two
independently defined interfaces. Therefore, it is better to qualify
your interfaces by defining them inside <span style="font-family:monospace">module</span> names. Of
course, this does not eliminate the chance of a name clash unless some
form of naming convention is agreed globally. Nevertheless, a
well-chosen module name can help a lot.</p>
<!--TOC section id="sec11" Generating the C++ stubs-->
<h2 id="sec11" class="section">2.3&#XA0;&#XA0;Generating the C++ stubs</h2><!--SEC END --><p>From the IDL file, we use the IDL compiler to produce the C++ mapping
of the interface. The IDL compiler for omniORB is called omniidl.
Given the IDL file, omniidl produces two stub files: a C++ header file
and a C++ source file. For example, from the file <span style="font-family:monospace">echo.idl</span>, the
following files are produced:</p><ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">echo.hh</span>
</li><li class="li-itemize"><span style="font-family:monospace">echoSK.cc</span>
</li></ul><p>omniidl must be invoked with the <span style="font-family:monospace">-bcxx</span> argument to
tell it to generate C++ stubs. The following command line generates
the stubs for <span style="font-family:monospace">echo.idl</span>:</p><div class="lstlisting"><span style="font-size:small">omniidl</span><span style="font-size:small"> -</span><span style="font-size:small">bcxx</span><span style="font-size:small"> </span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">idl</span></div><p>Note that the names <span style="font-family:monospace">echo.hh</span> and <span style="font-family:monospace">echoSK.cc</span> are not
defined in the C++ mapping standard. Other CORBA implementations may
use different file names. To aid migration omniidl from other
implementations, omniidl has options to override the default output
file names. See section&#XA0;<a href="#sec%3Acxx_backend">5.2</a> for details.</p><p>If you are using our make environment, you don&#X2019;t need to invoke
omniidl explicitly. In the example file <span style="font-family:monospace">dir.mk</span>, we have the
following line:</p><div class="lstlisting"><span style="font-size:small">CORBA_INTERFACES</span><span style="font-size:small"> = </span><span style="font-size:small">echo</span></div><p>That is all we need to instruct the build system to generate
the stubs. You won&#X2019;t find the stubs in your working directory because
all stubs are written into the <span style="font-family:monospace">stub</span> directory at the top level
of your build tree.</p><p>The full arguments to omniidl are detailed in
chapter&#XA0;<a href="#chap%3Aomniidl">5</a>.</p>
<!--TOC section id="sec12" Object References and Servants-->
<h2 id="sec12" class="section">2.4&#XA0;&#XA0;Object References and Servants</h2><!--SEC END --><p>We contact a CORBA object through an <span style="font-style:italic">object reference</span>. The
actual implementation of a CORBA object is termed a <span style="font-style:italic">servant</span>.</p><p>Object references and servants are quite separate entities, and it is
important not to confuse the two. Client code deals purely with object
references, so there can be no confusion; object implementation code
must deal with both object references and servants. omniORB uses
distinct C++ types for object references and servants, so the C++
compiler will complain if you use a servant when an object reference
is expected, or vice-versa.</p>
<!--TOC section id="sec13" A quick look at the C++ mapping-->
<h2 id="sec13" class="section">2.5&#XA0;&#XA0;A quick look at the C++ mapping</h2><!--SEC END --><p>The C++ stubs conform to the standard mapping defined in the CORBA
specification&#XA0;[<a href="#cxxmapping">OMG03</a>]. Sadly, since it pre-dates the C++
standard library, the C++ language mapping is quite hard to use,
especially because it has complex memory management rules.</p><p>The best way to understand the mapping is to read either the
specification or, better, a book about using CORBA from C++. Reading
the code generated by omniidl is hard-going, and it is difficult to
distinguish the parts you need to know from the implementation
details.</p>
<!--TOC subsection id="sec14" Mapping overview-->
<h3 id="sec14" class="subsection">2.5.1&#XA0;&#XA0;Mapping overview</h3><!--SEC END --><p>For interface <span style="font-family:monospace">Echo</span>, omniidl generates four things of note:</p><ul class="itemize"><li class="li-itemize">
class <span style="font-family:monospace">Echo</span>, containing static functions and type
definitions</li><li class="li-itemize"><span style="font-family:monospace">Echo_ptr</span>, an <em>object reference</em> type with pointer
semantics</li><li class="li-itemize"><span style="font-family:monospace">Echo_var</span>, a memory management helper for
<span style="font-family:monospace">Echo_ptr</span></li><li class="li-itemize">class <span style="font-family:monospace">POA_Echo</span>, the server-side <em>skeleton</em> class</li></ul>
<!--TOC subsection id="sec15" Interface scope type-->
<h3 id="sec15" class="subsection">2.5.2&#XA0;&#XA0;Interface scope type</h3><!--SEC END --><p>A C++ class <span style="font-family:monospace">Echo</span> is defined to hold a number of static
functions and type definitions. It looks like this:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">_var_type</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_duplicate</span><span style="font-size:small">(</span><span style="font-size:small">_ptr_type</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The <span style="font-family:monospace">_ptr_type</span> and <span style="font-family:monospace">_var_type</span> typedefs are there to
facilitate template programming. The static functions are described
below.</p>
<!--TOC subsection id="sec16" Object reference pointer type-->
<h3 id="sec16" class="subsection">2.5.3&#XA0;&#XA0;Object reference pointer type</h3><!--SEC END --><p>For interface <span style="font-family:monospace">Echo</span>, the mapping defines the object reference
type <span style="font-family:monospace">Echo_ptr</span> which has pointer semantics. The <span style="font-family:monospace">_ptr</span>
type provides access to the interface&#X2019;s operations. The concrete type
of an object reference is opaque, i.e. you must not make any
assumptions about how an object reference is implemented. You can
imagine it looks something like this:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">private_class</span></span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">some_base_class</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">something</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small">;</span></div><p>To use an object reference, you use the arrow operator &#X2018;<span style="font-family:monospace">-&gt;</span>&#X2019; to
invoke its operations, but you must not use it as a C++ pointer in any
other respect. It is non-compliant to convert it to <span style="font-family:monospace">void*</span>,
perform arithmetic or relational operations including testing for
equality using <span style="font-family:monospace">operator==</span>.</p><p>In some CORBA implementations, <span style="font-family:monospace">Echo_ptr</span> is a typedef to
<span style="font-family:monospace">Echo*</span>. In omniORB, it is not&#X2014;the object reference type is
distinct from class <span style="font-family:monospace">Echo</span>.</p>
<!--TOC subsubsection id="sec17" Nil object reference-->
<h4 id="sec17" class="subsubsection">2.5.3.1&#XA0;&#XA0;Nil object reference</h4><!--SEC END --><p>Object references can be <em>nil</em>. To obtain a nil object reference
for interface <span style="font-family:monospace">Echo</span>, call <span style="font-family:monospace">Echo::_nil()</span>. To test if an
object reference is nil, use <span style="font-family:monospace">CORBA::_is_nil()</span>:</p><div class="lstlisting"><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">true_result</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">());</span></div><p><span style="font-family:monospace">Echo::_nil()</span> is the only compliant way to obtain a nil Echo
reference, and <span style="font-family:monospace">CORBA::is_nil()</span> is the only compliant way to check
if an object reference is nil. You should not use the equality
<span style="font-family:monospace">operator==</span>. Many C++ ORBs use the null pointer to represent a
nil object reference, but <em>omniORB does not</em>.</p>
<!--TOC subsubsection id="sec18" Object reference lifecycle-->
<h4 id="sec18" class="subsubsection">2.5.3.2&#XA0;&#XA0;Object reference lifecycle</h4><!--SEC END --><p>Object references are reference counted. That is, the opaque C++
objects on the client side that implement <span style="font-family:monospace">Echo_ptr</span> are
reference counted, so they are deleted when the count goes to zero.
The lifetime of an object reference has no bearing at all on the
lifetime of the CORBA object to which it is a reference&#X2014;when an
object reference is deleted, it has <em>no effect</em> on the object in
the server.</p><p>Reference counting for <span style="font-family:monospace">Echo</span> object references is performed with
<span style="font-family:monospace">Echo::_duplicate()</span> and <span style="font-family:monospace">CORBA::release()</span>.</p><p>The <span style="font-family:monospace">_duplicate()</span> function returns a new object reference of the
Echo interface. The new object reference can be used interchangeably
with the old object reference to perform an operation on the same
object.</p><p>To indicate that an object reference will no longer be accessed, you
must call the <span style="font-family:monospace">CORBA::release()</span> operation. Its signature is as
follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">release</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// other methods</span></span></span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Once you have called <span style="font-family:monospace">CORBA::release()</span> on an object reference, you
may no longer use that reference. This is because the associated
resources may have been deallocated. Remember that we are referring to
the resources associated with the object reference and <em>not the
servant object</em>. Servant objects are not affected by the lifetimes
of object references. In particular, servants are not deleted when all
references to them have been released&#X2014;CORBA does not perform
distributed garbage collection.</p><p>Nil object references are <em>not</em> reference counted, so there is no
need to call <span style="font-family:monospace">_duplicate()</span> and <span style="font-family:monospace">release()</span> with them, although it
does no harm.</p><p>Since object references must be released explicitly, their usage is
prone to error and can lead to memory leaks or invalid memory
accesses. The mapping defines the <span style="font-style:italic">object reference variable</span>
type <span style="font-family:monospace">Echo_var</span> to make life somewhat easier.</p><p>The <span style="font-family:monospace">Echo_var</span> is more convenient to use because it
automatically releases its object reference when it goes out of scope
or when assigned a new object reference. For many operations, mixing
data of type <span style="font-family:monospace">Echo_var</span> and <span style="font-family:monospace">Echo_ptr</span> is possible without
any explicit operations or casting. For instance, the <span style="font-family:monospace">echoString()</span>
operation can be called using the arrow (&#X2018;<span style="font-family:monospace">-&gt;</span>&#X2019;) on a
<span style="font-family:monospace">Echo_var</span>, as one can do with a <span style="font-family:monospace">Echo_ptr</span>.</p><p>The usage of <span style="font-family:monospace">Echo_var</span> is illustrated below:</p><div class="lstlisting"><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">p</span><span style="font-size:small"> = ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// somehow obtain an object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small">p</span><span style="font-size:small">;           </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// a assumes ownership of p, must not use p any more</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">;  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// implicit _duplicate</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">p</span><span style="font-size:small"> = ...          </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// somehow obtain another object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_duplicate</span><span style="font-size:small">(</span><span style="font-size:small">p</span><span style="font-size:small">);     </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// release old object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">                             </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// a now holds a copy of p.</span></span></span></div><p>The mappings of many other IDL data types include <span style="font-family:monospace">_var</span> types
with similar semantics.</p>
<!--TOC subsubsection id="sec19" Object reference inheritance-->
<h4 id="sec19" class="subsubsection">2.5.3.3&#XA0;&#XA0;Object reference inheritance</h4><!--SEC END --><p>All CORBA objects inherit from the generic object
<span style="font-family:monospace">CORBA::Object</span>. <span style="font-family:monospace">CORBA::Object_ptr</span> is the object
reference type for base <span style="font-family:monospace">CORBA::Object</span>. Object references can be
implicitly <em>widened</em> to base interface types, so this is valid:</p><div class="lstlisting"><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">echo_ref</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// get reference from somewhere</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">base_ref</span><span style="font-size:small"> = </span><span style="font-size:small">echo_ref</span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// widen</span></span></span></div><p>An object reference such as <span style="font-family:monospace">Echo_ptr</span> can be used in places
where a <span style="font-family:monospace">CORBA::Object_ptr</span> is expected. Conversely, the
<span style="font-family:monospace">Echo::_narrow()</span> function takes an argument of type
<span style="font-family:monospace">CORBA::Object_ptr</span> and returns a new object reference of the
<span style="font-family:monospace">Echo</span> interface. If the actual (runtime) type of the argument
object reference can be narrowed to <span style="font-family:monospace">Echo_ptr</span>, <span style="font-family:monospace">_narrow()</span>
will return a valid object reference. Otherwise it will return a nil
object reference. Note that <span style="font-family:monospace">_narrow()</span> performs an implicit
duplication of the object reference, so the result must be released.
Note also that <span style="font-family:monospace">_narrow()</span> may involve a remote call to check the
type of the object, so it may throw CORBA system exceptions such as
<span style="font-family:monospace">TRANSIENT</span> or <span style="font-family:monospace">OBJECT_NOT_EXIST</span>.</p>
<!--TOC subsubsection id="sec20" Object reference equivalence-->
<h4 id="sec20" class="subsubsection">2.5.3.4&#XA0;&#XA0;Object reference equivalence</h4><!--SEC END --><p>As described above, the equality <span style="font-family:monospace">operator==</span> should not be used
on object references. To test if two object references are equivalent,
the member function <span style="font-family:monospace">_is_equivalent()</span> of the generic object
<span style="font-family:monospace">CORBA::Object</span> can be used. Here is an example of its usage:</p><div class="lstlisting"><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">...            </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// initialise a to a valid object reference </span></span></span><span style="font-size:small">
</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">true_result</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_is_equivalent</span><span style="font-size:small">(</span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: the above call is guaranteed to be true</span></span></span></div><p><span style="font-family:monospace">_is_equivalent()</span> does <em>not</em> contact the object to check for
equivalence&#X2014;it uses purely local knowledge, meaning that it is
possible to construct situations in which two object references refer
to the same object, but <span style="font-family:monospace">_is_equivalent()</span> does not consider them
equivalent. If you need a strong sense of object identity, you must
implement it with explicit IDL operations.</p>
<!--TOC subsection id="sec21" Servant Object Implementation-->
<h3 id="sec21" class="subsection">2.5.4&#XA0;&#XA0;Servant Object Implementation</h3><!--SEC END --><p>
<a id="stubobjimpl"></a></p><p>For each object interface, a <span style="font-style:italic">skeleton</span> class is generated. In
our example, the POA specification says that the skeleton class for
interface <span style="font-family:monospace">Echo</span> is named <span style="font-family:monospace">POA_Echo</span>. A servant
implementation can be written by creating an implementation class that
derives from the skeleton class.</p><p>The skeleton class <span style="font-family:monospace">POA_Echo</span> is defined in <span style="font-family:monospace">echo.hh</span>. The
relevant section of the code is reproduced below.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small"> :</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ServantBase</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> * </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">) = 0;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The code fragment shows the only member functions that can be used in
the object implementation code. Other member functions are generated
for internal use only. As with the code generated for object
references, other POA-based ORBs will generate code which looks
different, but is functionally equivalent to this.</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">echoString()</span></span></dt><dd class="dd-description"><br>
It is through this abstract function that an implementation class
provides the implementation of the <span style="font-family:monospace">echoString()</span> operation. Notice
that its signature is the same as the <span style="font-family:monospace">echoString()</span> function that
can be invoked via the <span style="font-family:monospace">Echo_ptr</span> object reference. This will be
the case most of the time, but object reference operations for certain
parameter types use special helper classes to facilitate correct
memory management.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">_this()</span></span></dt><dd class="dd-description"><br>
The <span style="font-family:monospace">_this()</span> function returns an object reference for the target
object, provided the POA policies permit it. The returned value must
be deallocated via <span style="font-family:monospace">CORBA::release()</span>. See
section&#XA0;<a href="#objeg1">2.8</a> for an example of how this function is used.</dd></dl>
<!--TOC section id="sec22" Writing the servant implementation-->
<h2 id="sec22" class="section">2.6&#XA0;&#XA0;Writing the servant implementation</h2><!--SEC END --><p>
<a id="objimpl"></a></p><p>You define a class to provide the servant implementation. There is
little constraint on how you design your implementation class except
that it has to inherit from the skeleton class<sup><a id="text1" href="#note1">1</a></sup> and to
implement all the abstract functions defined in the skeleton
class. Each of these abstract functions corresponds to an operation of
the interface. They are the hooks for the ORB to perform upcalls to
your implementation. Here is a simple implementation of the Echo
object.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>There are four points to note here:</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Storage Responsibilities</span></dt><dd class="dd-description"><br>
String, which is used both as an in argument and the return value of
<span style="font-family:monospace">echoString()</span>, is a variable sized data type. Other examples of
variable sized data types include sequences, type &#X2018;any&#X2019;, etc. For
these data types, you must be clear about whose responsibility it is
to allocate and release the associated storage. As a rule of thumb,
the client (or the caller to the implementation functions) owns the
storage of all <em>in</em> arguments, the object implementation (or the
callee) must copy the data if it wants to retain a copy. For
<em>out</em> arguments and return values, the object implementation
allocates the storage and passes the ownership to the client. The
client must release the storage when the variables will no longer be
used. For details, see the C++ mapping specification.</dd><dt class="dt-description"><span style="font-weight:bold">Multi-threading</span></dt><dd class="dd-description"><br>
As omniORB is fully multithreaded, multiple threads may perform the
same upcall to your implementation concurrently. It is up to your
implementation to synchronise the threads&#X2019; accesses to shared data.
In our simple example, we have no shared data to protect so no thread
synchronisation is necessary.<p>Alternatively, you can create a POA which has the
<span style="font-family:monospace">SINGLE_THREAD_MODEL</span> Thread Policy. This guarantees that all
calls to that POA are processed sequentially.</p></dd><dt class="dt-description"><span style="font-weight:bold">Reference Counting</span></dt><dd class="dd-description"><br>
All servant objects are reference counted. The base
<span style="font-family:monospace">PortableServer::ServantBase</span> class from which all servant
skeleton classes derive defines member functions named <span style="font-family:monospace">_add_ref()</span>
and <span style="font-family:monospace">_remove_ref()</span><sup><a id="text2" href="#note2">2</a></sup>. The reference
counting means that an <span style="font-family:monospace">Echo_i</span> instance will be deleted when no
more references to it are held by application code or the POA
itself. Note that this is totally separate from the reference counting
which is associated with object references&#X2014;a servant object is
<em>never</em> deleted due to a CORBA object reference being released.</dd><dt class="dt-description"><span style="font-weight:bold">Instantiation</span></dt><dd class="dd-description"><br>
Servants are usually instantiated on the heap, i.e. using the
<span style="font-family:monospace">new</span> operator. However, they can also be created on the stack as
automatic variables. If you do that, it is vital to make sure that the
servant has been deactivated, and thus released by the POA, before the
variable goes out of scope and is destroyed.</dd></dl>
<!--TOC section id="sec23" Writing the client-->
<h2 id="sec23" class="section">2.7&#XA0;&#XA0;Writing the client</h2><!--SEC END --><p>Here is an example of how an <span style="font-family:monospace">Echo_ptr</span> object reference is
used.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"cannot invoke on a nil object reference."</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said,\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" The Object said,\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The <span style="font-family:monospace">hello()</span> function accepts a generic object reference. The
object reference (<span style="font-family:monospace">obj</span>) is narrowed to <span style="font-family:monospace">Echo_ptr</span>. If the
object reference returned by <span style="font-family:monospace">Echo::_narrow()</span> is not nil, the
operation <span style="font-family:monospace">echoString()</span> is invoked. Finally, both the argument to
and the return value of <span style="font-family:monospace">echoString()</span> are printed to <span style="font-family:monospace">cout</span>.</p><p>The example also illustrates how <span style="font-family:monospace">T_var</span> types are used. As was
explained in the previous section, <span style="font-family:monospace">T_var</span> types take care of
storage allocation and release automatically when variables are
reassigned or when the variables go out of scope.</p><p>In line 4, the variable <span style="font-family:monospace">e</span> takes over the storage responsibility
of the object reference returned by <span style="font-family:monospace">Echo::_narrow()</span>. The object
reference is released by the destructor of <span style="font-family:monospace">e</span>. It is called
automatically when the function returns. Lines 6 and 15 show how a
<span style="font-family:monospace">Echo_var</span> variable is used. As explained earlier, the
<span style="font-family:monospace">Echo_var</span> type can be used interchangeably with the
<span style="font-family:monospace">Echo_ptr</span> type.</p><p>The argument and the return value of <span style="font-family:monospace">echoString()</span> are stored in
<span style="font-family:monospace">CORBA::String_var</span> variables <span style="font-family:monospace">src</span> and <span style="font-family:monospace">dest</span>
respectively. The strings managed by the variables are deallocated by
the destructor of <span style="font-family:monospace">CORBA::String_var</span>. It is called
automatically when the variable goes out of scope (as the function
returns). Line 15 shows how <span style="font-family:monospace">CORBA::String_var</span> variables are
used. They can be used in place of a string (for which the mapping is
<span style="font-family:monospace">char*</span>)<sup><a id="text3" href="#note3">3</a></sup>. As used in line 12, assigning a constant string
(<span style="font-family:monospace">const char*</span>) to a <span style="font-family:monospace">CORBA::String_var</span> causes the string
to be copied. On the other hand, assigning a <span style="font-family:monospace">char*</span> to a
<span style="font-family:monospace">CORBA::String_var</span>, as used in line 15, causes the latter to
assume the ownership of the string<sup><a id="text4" href="#note4">4</a></sup>.</p><p>Under the C++ mapping, <span style="font-family:monospace">T_var</span> types are provided for all the
non-basic data types. One should use automatic variables whenever
possible both to avoid memory leaks and to maximise performance.
However, when one has to allocate data items on the heap, it is a good
practice to use the <span style="font-family:monospace">T_var</span> types to manage the heap storage.</p>
<!--TOC section id="sec24" Example 1 &#X2014; Colocated Client and Servant-->
<h2 id="sec24" class="section">2.8&#XA0;&#XA0;Example 1 &#X2014; Colocated Client and Servant</h2><!--SEC END --><p>
<a id="objeg1"></a></p><p>Having introduced the client and the object implementation, we can now
describe how to link up the two via the ORB and POA. In this section,
we describe an example in which both the client and the object
implementation are in the same address space. In the next two
sections, we shall describe the case where the two are in different
address spaces.</p><p>The code for this example is reproduced below:</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"omniORB4"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoref</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">myechoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The example illustrates several important interactions among the ORB,
the POA, the servant, and the client. Here are the details:</p>
<!--TOC subsection id="sec25" ORB initialisation-->
<h3 id="sec25" class="subsection">2.8.1&#XA0;&#XA0;ORB initialisation</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 4</span></dt><dd class="dd-description"><br>
The ORB is initialised by calling the <span style="font-family:monospace">CORBA::ORB_init()</span>
function. The function uses the optional 3rd argument to determine
which ORB should be returned. Unless you are using omniORB specific
features, it is usually best to leave it out, and get the default
ORB. To explicitly ask for omniORB 4.x, this argument must be
&#X2018;omniORB4&#X2019;<sup><a id="text5" href="#note5">5</a></sup>.<p><span style="font-family:monospace">CORBA::ORB_init()</span> takes the list of command line arguments and
processes any that start &#X2018;<span style="font-family:monospace">-ORB</span>&#X2019;. It removes these arguments
from the list, so application code does not have to deal with them.</p><p>If any error occurs during ORB initialisation, such as invalid ORB
arguments, or an invalid configuration file, the
<span style="font-family:monospace">CORBA::INITIALIZE</span> system exception is raised.</p></dd></dl>
<!--TOC subsection id="sec26" Obtaining the Root POA-->
<h3 id="sec26" class="subsection">2.8.2&#XA0;&#XA0;Obtaining the Root POA</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 6&#X2013;7</span></dt><dd class="dd-description"><br>
To activate our servant object and make it available to clients, we
must register it with a POA. In this example, we use the <span style="font-style:italic">Root
POA</span>, rather than creating any child POAs. The Root POA is found with
<span style="font-family:monospace">orb-&gt;resolve_initial_references()</span>, which returns a plain
<span style="font-family:monospace">CORBA::Object</span>. In line 7, we narrow the reference to the right
type for a POA.<p>A POA&#X2019;s behaviour is governed by its <span style="font-style:italic">policies</span>. The Root POA has
suitable policies for many simple servers, and closely matches the
&#X2018;policies&#X2019; used by omniORB 2&#X2019;s BOA. See Chapter 11 of the CORBA 2.6
specification[<a href="#corba26-spec">OMG01</a>] for details of all the POA policies
which are available.</p></dd></dl>
<!--TOC subsection id="sec27" Object initialisation-->
<h3 id="sec27" class="subsection">2.8.3&#XA0;&#XA0;Object initialisation</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 9</span></dt><dd class="dd-description"><br>
An instance of the Echo servant is initialised using the <span style="font-family:monospace">new</span>
operator. The <span style="font-family:monospace">PortableServer::Servant_var&lt;&gt;</span> template
automatically is analogous to the <span style="font-family:monospace">T_var</span> types generated by the
IDL compiler. It releases our reference to the servant when it goes
out of scope.</dd><dt class="dt-description"><span style="font-weight:bold">Line 10</span></dt><dd class="dd-description"><br>
The servant object is activated in the Root POA using
<span style="font-family:monospace">poa-&gt;activate_object()</span>, which returns an object identifier
(of type <span style="font-family:monospace">PortableServer::ObjectId*</span>). The object id must
be passed back to various POA operations. The caller is responsible
for freeing the object id, so it is assigned to a <span style="font-family:monospace">_var</span> type.</dd><dt class="dt-description"><span style="font-weight:bold">Line 12</span></dt><dd class="dd-description"><br>
The object reference is obtained from the servant object by calling
its <span style="font-family:monospace">_this()</span> method. Like all object references, the return value
of <span style="font-family:monospace">_this()</span> must be released by <span style="font-family:monospace">CORBA::release()</span> when it is no
longer needed. In this case, we assign it to a <span style="font-family:monospace">_var</span> type, so
the release is implicit at the end of the function.<p>One of the important characteristics of an object reference is that it
is completely location transparent. A client can invoke on the object
using its object reference without any need to know whether the
servant object is colocated in the same address space or is in a
different address space.</p><p>In the case of colocated client and servant, omniORB is able to
short-circuit the client calls so they do not involve IIOP. The calls
still go through the POA, however, so the various POA policies affect
local calls in the same way as remote ones. This optimisation is
applicable not only to object references returned by <span style="font-family:monospace">_this()</span>, but
to any object references that are passed around within the same
address space or received from other address spaces via remote calls.</p></dd></dl>
<!--TOC subsection id="sec28" Activating the POA-->
<h3 id="sec28" class="subsection">2.8.4&#XA0;&#XA0;Activating the POA</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 15&#X2013;16</span></dt><dd class="dd-description"><br>
POAs are initially in the <span style="font-style:italic">holding</span> state, meaning that incoming
requests are blocked. Lines 15 and 16 acquire a reference to the POA&#X2019;s
POA manager, and use it to put the POA into the <span style="font-style:italic">active</span> state.
Incoming requests are now served. <span style="font-weight:bold">Failing to activate the POA
is one of the most common programming mistakes. If your program
appears deadlocked, make sure you activated the POA!</span></dd></dl>
<!--TOC subsection id="sec29" Performing a call-->
<h3 id="sec29" class="subsection">2.8.5&#XA0;&#XA0;Performing a call</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 18</span></dt><dd class="dd-description"><br>
At long last, we can call <span style="font-family:monospace">hello()</span> with this object reference. The
argument is widened implicitly to the generic object reference
<span style="font-family:monospace">CORBA::Object_ptr</span>.</dd></dl>
<!--TOC subsection id="sec30" ORB destruction-->
<h3 id="sec30" class="subsection">2.8.6&#XA0;&#XA0;ORB destruction</h3><!--SEC END --><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 20</span></dt><dd class="dd-description"><br>
Shutdown the ORB permanently. This call causes the ORB to release all
its resources, e.g. internal threads, and also to deactivate any
servant objects which are currently active. When it deactivates the
<span style="font-family:monospace">Echo_i</span> instance, the servant&#X2019;s reference count drops to zero,
so the servant is deleted.<p>This call is particularly important when writing a CORBA DLL on
Windows NT that is to be used from ActiveX. If this call is absent,
the application will hang when the CORBA DLL is unloaded.</p></dd></dl>
<!--TOC section id="sec31" Example 2 &#X2014; Different Address Spaces-->
<h2 id="sec31" class="section">2.9&#XA0;&#XA0;Example 2 &#X2014; Different Address Spaces</h2><!--SEC END --><p>In this example, the client and the object implementation reside in
two different address spaces. The code of this example is almost the
same as the previous example. The only difference is the extra work
which needs to be done to pass the object reference from the object
implementation to the client.</p><p>The simplest (and quite primitive) way to pass an object reference
between two address spaces is to produce a <span style="font-style:italic">stringified</span> version
of the object reference and to pass this string to the client as a
command-line argument. The string is then converted by the client
into a proper object reference. This method is used in this
example. In the next example, we shall introduce a better way of
passing the object reference using the CORBA Naming Service.</p>
<!--TOC subsection id="sec32" Making a Stringified Object Reference-->
<h3 id="sec32" class="subsection">2.9.1&#XA0;&#XA0;Making a Stringified Object Reference</h3><!--SEC END --><p>The <span style="font-family:monospace">main()</span> function of the server side is reproduced below. The
full listing (<span style="font-family:monospace">eg2_impl.cc</span>) can be found at the end of this
chapter.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  22</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The stringified object reference is obtained by calling the ORB&#X2019;s
<span style="font-family:monospace">object_to_string()</span> function (line 13). This results in a
string starting with the signature &#X2018;<span style="font-family:monospace">IOR:</span>&#X2019; and followed by quite
a lot of hexadecimal digits. All CORBA compliant ORBs are able to
convert the string into its internal representation of a so-called
Interoperable Object Reference (IOR). The IOR contains the location
information and a key to uniquely identify the object implementation
in its own address space. From the IOR, an object reference can be
constructed.</p>
<!--TOC subsection id="sec33" Client: Using a Stringified Object Reference-->
<h3 id="sec33" class="subsection">2.9.2&#XA0;&#XA0;Client: Using a Stringified Object Reference</h3><!--SEC END --><p>
<a id="clnt2"></a></p><p>The stringified object reference is passed to the client as a
command-line argument. The client uses the ORB&#X2019;s
<span style="font-family:monospace">string_to_object()</span> function to convert the string into a generic
object reference (<span style="font-family:monospace">CORBA::Object_ptr</span>). The relevant section of
the code is reproduced below. The full listing (<span style="font-family:monospace">eg2_clt.cc</span>) can
be found at the end of this chapter.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">argv</span><span style="font-size:small">[1]);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">  ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// code to handle transient exception...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec34" Catching System Exceptions-->
<h3 id="sec34" class="subsection">2.9.3&#XA0;&#XA0;Catching System Exceptions</h3><!--SEC END --><p>When omniORB detects an error condition, it may raise a system
exception. The CORBA specification defines a series of exceptions
covering most of the error conditions that an ORB may encounter. The
client may choose to catch these exceptions and recover from the error
condition<sup><a id="text6" href="#note6">6</a></sup>. For instance, the code fragment, shown in
section&#XA0;<a href="#clnt2">2.9.2</a>, catches the <span style="font-family:monospace">TRANSIENT</span> system exception
which indicates that the object could not be contacted at the time of
the call, usually meaning the server is not running.</p><p>All system exceptions inherit from <span style="font-family:monospace">CORBA::SystemException</span>.
Unless you have a truly ancient C++ compiler, a single catch of
<span style="font-family:monospace">CORBA::SystemException</span> will catch all the different system
exceptions.</p>
<!--TOC subsection id="sec35" Lifetime of a CORBA object-->
<h3 id="sec35" class="subsection">2.9.4&#XA0;&#XA0;Lifetime of a CORBA object</h3><!--SEC END --><p>CORBA objects are either <span style="font-style:italic">transient</span> or <span style="font-style:italic">persistent</span>. The
majority are transient, meaning that the lifetime of the CORBA object
(as contacted through an object reference) is the same as the lifetime
of its servant object. Persistent objects can live beyond the
destruction of their servant object, the POA they were created in, and
even their process. Persistent objects are, of course, only
contactable when their associated server processes are running, and
their servants are active or can be activated by their POA with a
servant manager<sup><a id="text7" href="#note7">7</a></sup>. A reference to a persistent object can
be published, and will remain valid even if the server process is
restarted.</p><p>To support persistent objects, the servants must be activated in their
POA with the same object identifier each time. Also, the server must
be configured with the same <span style="font-style:italic">endpoint</span> details so it is
contactable in the same way as previous invocations. See
section&#XA0;<a href="#sec%3Aendpoints">6.6</a> for details.</p><p>A POA&#X2019;s Lifespan Policy determines whether objects created within it
are transient or persistent. The Root POA has the <span style="font-family:monospace">TRANSIENT</span>
policy.</p><p>An alternative to creating persistent objects is to register object
references in a <span style="font-style:italic">naming service</span> and bind them to fixed path
names. Clients can bind to the object implementations at run time by
asking the naming service to resolve the path names to the object
references. CORBA defines a standard naming service, which is a
component of the Common Object Services (COS)&#XA0;[<a href="#corbaservices">OMG98</a>],
that can be used for this purpose. The next section describes an
example of how to use the COS Naming Service.</p>
<!--TOC section id="sec36" Example 3 &#X2014; Using the Naming Service-->
<h2 id="sec36" class="section">2.10&#XA0;&#XA0;Example 3 &#X2014; Using the Naming Service</h2><!--SEC END --><p>In this example, the object implementation uses the Naming
Service&#XA0;[<a href="#corbaservices">OMG98</a>] to pass on the object reference to the
client. This method is often more practical than using stringified
object references. The full listing of the object implementation
(<span style="font-family:monospace">eg3_impl.cc</span>) and the client (<span style="font-family:monospace">eg3_clt.cc</span>) can be found
at the end of this chapter.</p><p>The names used by the Naming service consist of a sequence of
<span style="font-style:italic">name components</span>. Each name component has an <span style="font-style:italic">id</span> and a
<span style="font-style:italic">kind</span> field, both of which are strings. All name components
except the last one are bound to a naming context. A naming context is
analogous to a directory in a filing system: it can contain names of
object references or other naming contexts. The last name component is
bound to an object reference.</p><p>Sequences of name components can be represented as a flat string,
using &#X2018;.&#X2019; to separate the id and kind fields, and &#X2018;/&#X2019; to separate name
components from each other<sup><a id="text8" href="#note8">8</a></sup>. In our example, the Echo object
reference is bound to the stringified name
&#X2018;<span style="font-family:monospace">test.my_context/Echo.Object</span>&#X2019;.</p><p>The kind field is intended to describe the name in a
syntax-independent way. The naming service does not interpret, assign,
or manage these values. However, both the name and the kind attribute
must match for a name lookup to succeed. In this example, the kind
values for <span style="font-family:monospace">test</span> and <span style="font-family:monospace">Echo</span> are chosen to be
&#X2018;<span style="font-family:monospace">my_context</span>&#X2019; and &#X2018;<span style="font-family:monospace">Object</span>&#X2019; respectively. This is an
arbitrary choice as there is no standardised set of kind values.</p>
<!--TOC subsection id="sec37" Obtaining the Root Context Object Reference-->
<h3 id="sec37" class="subsection">2.10.1&#XA0;&#XA0;Obtaining the Root Context Object Reference</h3><!--SEC END --><p>
<a id="resolveinit"></a></p><p>The initial contact with the Naming Service can be established via the
<span style="font-style:italic">root</span> context. The object reference to the root context is
provided by the ORB and can be obtained by calling
<span style="font-family:monospace">resolve_initial_references()</span>. The following code fragment shows
how it is used:</p><div class="lstlisting"><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">,</span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span></div><p>Remember from section&#XA0;<a href="#sec%3Asetup">1.2</a>, omniORB constructs its internal
list of initial references at initialisation time using the
information provided in the configuration file <span style="font-family:monospace">omniORB.cfg</span>, or
given on the command line. If this file is not present, the internal
list will be empty and <span style="font-family:monospace">resolve_initial_references()</span> will raise a
<span style="font-family:monospace">CORBA::ORB::InvalidName</span> exception.</p>
<!--TOC subsection id="sec38" The Naming Service Interface-->
<h3 id="sec38" class="subsection">2.10.2&#XA0;&#XA0;The Naming Service Interface</h3><!--SEC END --><p>It is beyond the scope of this chapter to describe in detail the
Naming Service interface. You should consult the CORBA services
specification&#XA0;[<a href="#corbaservices">OMG98</a>] (chapter 3). The code listed in
<span style="font-family:monospace">eg3_impl.cc</span> and <span style="font-family:monospace">eg3_clt.cc</span> are good examples of how the
service can be used.</p>
<!--TOC section id="sec39" Example 4 &#X2014; Using tie implementation templates-->
<h2 id="sec39" class="section">2.11&#XA0;&#XA0;Example 4 &#X2014; Using tie implementation templates</h2><!--SEC END --><p>
<a id="sec:tie"></a></p><p>omniORB supports <span style="font-style:italic">tie</span> implementation templates as an alternative
way of providing servant classes. If you use the <span style="font-family:monospace">-Wbtp</span> option
to omniidl, it generates an extra template class for each interface.
This template class can be used to tie a C++ class to the skeleton
class of the interface.</p><p>The source code in <span style="font-family:monospace">eg3_tieimpl.cc</span> at the end of this chapter
illustrates how the template class can be used. The code is almost
identical to <span style="font-family:monospace">eg3_impl.cc</span> with only a few changes.</p><p>Firstly, the servant class <span style="font-family:monospace">Echo_i</span> does not inherit from any
skeleton classes. This is the main benefit of using the template class
because there are applications in which it is difficult to require
every servant class to derive from CORBA classes.</p><p>Secondly, the instantiation of a CORBA object now involves creating an
instance of the implementation class <em>and</em> an instance of the
template. Here is the relevant code fragment:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> { ... };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Echo_i</span><span style="font-size:small"> *</span><span style="font-size:small">myimpl</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">POA_Echo_tie</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small">(</span><span style="font-size:small">myimpl</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(&amp;</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span></div><p>For interface <span style="font-family:monospace">Echo</span>, the name of its tie implementation template
is <span style="font-family:monospace">POA_Echo_tie</span>. The template parameter is the servant
class that contains an implementation of each of the operations
defined in the interface. As used above, the tie template takes
ownership of the <span style="font-family:monospace">Echo_i</span> instance, and deletes it when the tie
object goes out of scope. The tie constructor has an optional boolean
argument (defaulted to <span style="font-family:monospace">true</span>) which indicates whether or not it
should delete the servant object. For full details of using tie
templates, see the CORBA C++ mapping specification.</p>
<!--TOC section id="sec40" Source Listings-->
<h2 id="sec40" class="section">2.12&#XA0;&#XA0;Source Listings</h2><!--SEC END -->
<!--TOC subsection id="sec41" eg1.cc-->
<h3 id="sec41" class="subsection">2.12.1&#XA0;&#XA0;eg1.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg1.cc - This is the source code of example 1 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          In this example, both the object implementation and the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          client are in the same process.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg1</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Memory management rules say we must return a newly allocated</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This function acts as a client to the object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small">( </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">) ) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"hello: The object reference is nil!"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// String literals are (char*) rather than (const char*) on some</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// old compilers.  Thus it is essential to cast to (const char*)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// here to ensure that the string is copied, so that the</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// CORBA::String_var does not attempt to 'delete' the string</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// literal.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Initialise the ORB.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root POA.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// We allocate the servant (implementation object) on the heap.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// The servant is reference counted. We start out holding a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// reference, and when the object is activated, the POA holds</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// another reference. The PortableServer::Servant_var&lt;&gt; template</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// automatically releases our reference when it goes out of scope.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Activate the object. This tells the POA that this object is</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ready to accept requests.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoref</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a POAManager, and tell the POA to start accepting</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// requests on its objects.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Do the client-side call.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">myechoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Clean up all the resources.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec42" eg2_impl.cc-->
<h3 id="sec42" class="subsection">2.12.2&#XA0;&#XA0;eg2_impl.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg2_impl.cc - This is the source code of example 2 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg2_impl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is printed to cout as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        stringified IOR. This string should be used as the argument to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        eg2_clt.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Upcall: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">mesg</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and print it out as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// stringified IOR.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Block until the ORB is shut down.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec43" eg2_clt.cc-->
<h3 id="sec43" class="subsection">2.12.3&#XA0;&#XA0;eg2_clt.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg2_clt.cc - This is the source code of example 2 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              This is the client. The object reference is given as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              stringified IOR on the command line.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg2_clt &lt;object reference&gt;</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">argc</span><span style="font-size:small"> != 2) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"usage:  eg2_clt &lt;object reference&gt;"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">argv</span><span style="font-size:small">[1]);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">echoref</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Can't narrow reference to type Echo (or it was nil)."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">for</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">count</span><span style="font-size:small">=0; </span><span style="font-size:small">count</span><span style="font-size:small">&lt;10; </span><span style="font-size:small">count</span><span style="font-size:small">++)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"server."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec44" eg3_impl.cc-->
<h3 id="sec44" class="subsection">2.12.4&#XA0;&#XA0;eg3_impl.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_impl.cc - This is the source code of example 3 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_impl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is registered with the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service. The client uses the naming service to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        locate this object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              test  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and register it in</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// the naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (!</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">obj</span><span style="font-size:small">))</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objref</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind a context called "test" to the root context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">contextName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">testContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind the context to root.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind_new_context</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// If the context already exists, this exception will be raised.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// In this case, just resolve the name and assign testContext</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// to the object returned:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">testContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">      }</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind objref with name Echo to the testContext:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">objectName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">rebind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: Using rebind() will overwrite any Object previously bound</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       to /test/Echo with obj.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       Alternatively, bind() can be used, which will raise a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       CosNaming::NamingContext::AlreadyBound exception if the name</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       supplied is already bound to an object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec45" eg3_clt.cc-->
<h3 id="sec45" class="subsection">2.12.5&#XA0;&#XA0;eg3_clt.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_clt.cc - This is the source code of example 3 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              This is the client. It uses the COSS naming service</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              to obtain the object reference.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_clt</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the client lookup the object reference from the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              text  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"hello: The object reference is nil!\n"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:small">main</span><span style="font-size:small"> (</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">echoref</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">for</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">count</span><span style="font-size:small">=0; </span><span style="font-size:small">count</span><span style="font-size:small"> &lt; 10; </span><span style="font-size:small">count</span><span style="font-size:small">++)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"server."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">
</span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Create a name object, containing the name test/context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">name</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(2);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[1].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[1].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Resolve the name to an object reference.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">NotFound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This exception is thrown if any of the components of the</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// path [contexts or the object] aren't found:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Context not found."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec46" eg3_tieimpl.cc-->
<h3 id="sec46" class="subsection">2.12.6&#XA0;&#XA0;eg3_tieimpl.cc</h3><!--SEC END --><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_tieimpl.cc - This example is similar to eg3_impl.cc except that</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//                  the tie implementation skeleton is used.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_tieimpl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is registered with the </span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service. The client uses the naming service to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        locate this object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              test  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This is the object implementation.  Notice that it does not inherit</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// from any skeleton class, and notice that the echoString() member</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// function does not have to be virtual.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note that the &lt;myecho&gt; tie object is constructed on the stack</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// here. It will delete its implementation (myimpl) when it it</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// itself destroyed (when it goes out of scope).  It is essential</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// however to ensure that such servants are not deleted whilst</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// still activated.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Tie objects can of course be allocated on the heap using new,</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// in which case they are deleted when their reference count</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// becomes zero, as with any other servant object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_i</span><span style="font-size:small">* </span><span style="font-size:small">myimpl</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">POA_Echo_tie</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small">(</span><span style="font-size:small">myimpl</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(&amp;</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and register it in</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// the naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">.</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (!</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">obj</span><span style="font-size:small">))</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objref</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind a context called "test" to the root context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">contextName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">testContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind the context to root.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind_new_context</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// If the context already exists, this exception will be raised.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// In this case, just resolve the name and assign testContext</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// to the object returned:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">testContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">      }</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind objref with name Echo to the testContext:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">objectName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">rebind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: Using rebind() will overwrite any Object previously bound</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       to /test/Echo with obj.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       Alternatively, bind() can be used, which will raise a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       CosNaming::NamingContext::AlreadyBound exception if the name</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       supplied is already bound to an object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note1" href="#text1">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Rather than
deriving from the skeleton class, an alternative is to use a
<span style="font-style:italic">tie</span> template, described in section&#XA0;<a href="#sec%3Atie">2.11</a>.</div></dd><dt class="dt-thefootnotes"><a id="note2" href="#text2">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">In the previous 1.0 version of the C++
mapping, servant reference counting was optional, chosen by inheriting
from a mixin class named <span style="font-family:monospace">RefCountServantBase</span>. That has been
deprecated in the 1.1 version of the C++ mapping, but the class is
still available as an empty struct, so existing code that inherits
from <span style="font-family:monospace">RefCountServantBase</span> will continue to work.</div></dd><dt class="dt-thefootnotes"><a id="note3" href="#text3">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">A conversion operator of
<span style="font-family:monospace">CORBA::String_var</span> converts a <span style="font-family:monospace">CORBA::String_var</span>
to a <span style="font-family:monospace">char*</span>.</div></dd><dt class="dt-thefootnotes"><a id="note4" href="#text4">4</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Please refer to the C++
mapping specification for details of the String_var mapping.</div></dd><dt class="dt-thefootnotes"><a id="note5" href="#text5">5</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">For backwards compatibility, the ORB identifiers
&#X2018;omniORB2&#X2019; and &#X2018;omniORB3&#X2019; are also accepted.</div></dd><dt class="dt-thefootnotes"><a id="note6" href="#text6">6</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">If a system exception is not caught, the C++
runtime will call the <span style="font-family:monospace">terminate()</span> function. This function is
defaulted to abort the whole process and on some systems will cause a
core file to be produced.</div></dd><dt class="dt-thefootnotes"><a id="note7" href="#text7">7</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The POA itself can be activated on demand
with an adapter activator.</div></dd><dt class="dt-thefootnotes"><a id="note8" href="#text8">8</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">There are escaping rules to cope
with id and kind fields which contain &#X2018;.&#X2019; and &#X2018;/&#X2019; characters. See
chapter&#XA0;<a href="#chap%3Ains">7</a> of this manual, and chapter 3 of the CORBA
services specification, as updated for the Interoperable Naming
Service&#XA0;[<a href="#inschapters">OMG00</a>].</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec47" C++ language mapping-->
<h1 id="sec47" class="chapter">Chapter&#XA0;3&#XA0;&#XA0;C++ language mapping</h1><!--SEC END --><p>Now that you are familiar with the basics, it is important to
familiarise yourself with the standard IDL to C++ language mapping.
The mapping is described in detail in&#XA0;[<a href="#cxxmapping">OMG03</a>]. If you have
not done so, you should obtain a copy of the document and use that as
the programming guide to omniORB.</p><p>The specification is not an easy read. The alternative is to use one
of the books on CORBA programming. For instance, Henning and Vinoski&#X2019;s
&#X2018;Advanced CORBA Programming with C++&#X2019;&#XA0;[<a href="#henning1999">HV99</a>] includes many
example code fragments to illustrate how to use the C++ mapping.</p>
<!--TOC section id="sec48" omniORB 2 BOA compatibility-->
<h2 id="sec48" class="section">3.1&#XA0;&#XA0;omniORB 2 BOA compatibility</h2><!--SEC END --><p>
<a id="sec:BOAcompat"></a></p><p>Before the Portable Object Adapter (POA) specification, many of the
details of how servant objects should be implemented and registered
with the system were unspecified, so server-side code was not portable
between ORBs. The POA specification rectifies that. For compatibility,
omniORB 4 still supports the old omniORB 2.x BOA mapping, but you
should always use the POA mapping for new code. BOA code and POA code
can coexist within a single program. </p><p>If you use the <span style="font-family:monospace">-WbBOA</span> option to omniidl, it will generate
skeleton code with (nearly) the same interface as the old omniORB 2
BOA mapping, as well as code to be used with the POA. Note that since
the major problem with the BOA specification was that server code was
not portable between ORBs, it is unlikely that omniORB&#X2019;s BOA
compatibility will help you much if you are moving from a different
BOA-based ORB.</p><p>The BOA compatibility permits the majority of BOA code to compile
without difficulty. However, there are a number of constructs which
relied on omniORB 2 implementation details which no longer work.</p><ul class="itemize"><li class="li-itemize">omniORB 2 did not use distinct types for object references and
servants, and often accepted a pointer to a servant when the CORBA
specification says it should only accept an object reference. Such
code will not compile under omniORB 4.</li><li class="li-itemize">The reverse is true for <span style="font-family:monospace">BOA::obj_is_ready()</span>. It now only
works when passed a pointer to a servant object, not an object
reference. The more commonly used mechanism of calling
<span style="font-family:monospace">_obj_is_ready(boa)</span> on the servant object still works as
expected.</li><li class="li-itemize">It used to be the case that the skeleton class for interface
<span style="font-family:monospace">I</span> (<span style="font-family:monospace">_sk_I</span>) was derived from class <span style="font-family:monospace">I</span>. This meant
that the names of any types declared in the interface were available
in the scope of the skeleton class. This is no longer true. If you
have an interface:<div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">S</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">,</span><span style="font-size:small">b</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">op</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>then where before the implementation code might have been:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">I_impl</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">_sk_I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">op</span><span style="font-size:small">();  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// _sk_I is derived from I</span></span></span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">I</span><span style="font-size:small">::</span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">I_impl</span><span style="font-size:small">::</span><span style="font-size:small">op</span><span style="font-size:small">() {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">ret</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>it is now necessary to fully qualify all uses of <span style="font-family:monospace">S</span>:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">I_impl</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">_sk_I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">I</span><span style="font-size:small">::</span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">op</span><span style="font-size:small">(); </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// _sk_I is not derived from I</span></span></span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">I</span><span style="font-size:small">::</span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">I_impl</span><span style="font-size:small">::</span><span style="font-size:small">op</span><span style="font-size:small">() {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">I</span><span style="font-size:small">::</span><span style="font-size:small">S</span><span style="font-size:small"> </span><span style="font-size:small">ret</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span></div></li><li class="li-itemize">The proprietary omniORB 2 LifeCycle extensions are no longer
supported. All of the facilities it offered can be implemented with
the POA interfaces, and the <span style="font-family:monospace">omniORB::LOCATION_FORWARD</span>
exception (see section&#XA0;<a href="#sec%3AlocationForward">4.8</a>). Code which used the
old interfaces will have to be rewritten.</li></ul>
<!--TOC section id="sec49" omniORB 3.0 compatibility-->
<h2 id="sec49" class="section">3.2&#XA0;&#XA0;omniORB 3.0 compatibility</h2><!--SEC END --><p>omniORB 4 is almost completely source-code compatible with omniORB
3.0. There are two main cases where code may have to change. The first
is code that uses the omniORB API, some aspects of which have
changed. The omniORB configuration file also has a new format. See the
next chapter for details of the new API and configuration file.</p><p>The second case of code that may have to change is code using the
Dynamic Any interfaces. The standard changed quite significantly
between CORBA 2.2 and CORBA 2.3; omniORB 3.0 supported the old CORBA
2.2 interfaces; omniORB 4 uses the new mapping. The changes are
largely syntax changes, rather than semantic differences.</p>
<!--TOC section id="sec50" omniORB 4.0 compatibility-->
<h2 id="sec50" class="section">3.3&#XA0;&#XA0;omniORB 4.0 compatibility</h2><!--SEC END --><p>omniORB 4.2 is source-code compatible with omniORB 4.0, with four
exceptions:</p><ol class="enumerate" type=1><li class="li-enumerate">As required by the 1.1 version of the CORBA C++ mapping
specification, the <span style="font-family:monospace">RefCountServantBase</span> class has been
deprecated, and the reference counting functionality moved into
<span style="font-family:monospace">ServantBase</span>. For backwards compatibility,
<span style="font-family:monospace">RefCountServantBase</span> still exists, but is now defined as an
empty struct. Most code will continue to work unchanged, but code
that explicitly calls <span style="font-family:monospace">RefCountServantBase::_add_ref()</span> or
<span style="font-family:monospace">_remove_ref()</span> will no longer compile.</li><li class="li-enumerate">omniORB 4.0 had an option for Any extraction semantics that was
compatible with omniORB 2.7, where ownership of extracted values was
not maintained by the Any. That option is no longer available.</li><li class="li-enumerate">The members of the <span style="font-family:monospace">clientSendRequest</span> interceptor have
been changed, replacing all the separate variables with a single
member of type <span style="font-family:monospace">GIOP_C</span>. All the values previously available
can be accessed through the <span style="font-family:monospace">GIOP_C</span> instance.</li><li class="li-enumerate">The C++ mapping contains Any insertion operators for sequence
types that are passed by pointer, which cause the Any to take
ownership of the inserted sequence. In omniORB 4.0 and earlier, the
sequence was immediately marshalled into the Any&#X2019;s internal buffer,
and the sequence was deleted. In omniORB 4.1, the sequence pointer
is stored by the Any, and the sequence is deleted later when the Any
is destroyed.<p>For most uses, this change is not visible to application code.
However, if a sequence is constructed using an application-supplied
buffer with the release flag set to <span style="font-family:monospace">false</span> (meaning that the
application continues to own the buffer), it is now important that
the buffer is not deleted or modified while the Any exists, since
the Any continues to refer to the buffer contents. This change
means that code that worked with omniORB 4.0 may now fail with 4.1,
with the Any seeing modified data or the process crashing due to
accessing deleted data. To avoid this situation, use the alternative
Any insertion operator using a const reference, which copies the
sequence.</p></li></ol>
<!--TOC section id="sec51" omniORB 4.1 compatibility-->
<h2 id="sec51" class="section">3.4&#XA0;&#XA0;omniORB 4.1 compatibility</h2><!--SEC END --><p>omniORB 4.2 is source-code compatible with omniORB 4.1 with one
exception:</p><ol class="enumerate" type=1><li class="li-enumerate">When omniORB 4.1 and earlier detected a timeout condition, they
would throw the <span style="font-family:monospace">CORBA::TRANSIENT</span> system exception. omniORB
4.2 supports the <span style="font-family:monospace">CORBA::TIMEOUT</span> system exception that was
introduced with the CORBA Messaging specification. Application code
that caught <span style="font-family:monospace">CORBA::TRANSIENT</span> to handle timeout situations
should be updated to catch <span style="font-family:monospace">CORBA::TIMEOUT</span>
instead. Alternatively, to avoid code changes, omniORB can be
configured to throw <span style="font-family:monospace">CORBA::TRANSIENT</span> for timeouts, by setting
the <span style="font-family:monospace">throwTransientOnTimeout</span> parameter to <span style="font-family:monospace">1</span>. See
section&#XA0;<a href="#sec%3Aclientconf">4.4</a>.</li></ol>
<!--TOC chapter id="sec52" omniORB configuration and API-->
<h1 id="sec52" class="chapter">Chapter&#XA0;4&#XA0;&#XA0;omniORB configuration and API</h1><!--SEC END --><p>
<a id="chap:config"></a></p><p>omniORB has a wide range of parameters that can be configured. They
can be set in the configuration file / Windows registry, as
environment variables, on the command line, or within a proprietary
extra argument to <span style="font-family:monospace">CORBA::ORB_init()</span>. A few parameters can be
configured at run time. This chapter lists all the configuration
parameters, and how they are used.</p>
<!--TOC section id="sec53" Setting parameters-->
<h2 id="sec53" class="section">4.1&#XA0;&#XA0;Setting parameters</h2><!--SEC END --><p>When <span style="font-family:monospace">CORBA::ORB_init()</span> is called, the value for each configuration
parameter is searched for in the following order:</p><ol class="enumerate" type=1><li class="li-enumerate">Command line arguments
</li><li class="li-enumerate"><span style="font-family:monospace">ORB_init()</span> options
</li><li class="li-enumerate">Environment variables
</li><li class="li-enumerate">Configuration file / Windows registry
</li><li class="li-enumerate">Built-in defaults</li></ol>
<!--TOC subsection id="sec54" Command line arguments-->
<h3 id="sec54" class="subsection">4.1.1&#XA0;&#XA0;Command line arguments</h3><!--SEC END --><p>Command line arguments take the form
&#X2018;<span style="font-family:monospace">-ORB</span><span style="font-style:italic">parameter</span>&#X2019;, and usually expect another
argument. An example is &#X2018;<span style="font-family:monospace">-ORBtraceLevel 10</span>&#X2019;.</p>
<!--TOC subsection id="sec55" ORB_init() parameter-->
<h3 id="sec55" class="subsection">4.1.2&#XA0;&#XA0;ORB_init() parameter</h3><!--SEC END --><p><span style="font-family:monospace">ORB_init()</span>&#X2019;s extra argument accepts an array of two-dimensional
string arrays, like this:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">options</span><span style="font-size:small">[][2] = { { </span><span style="font-size:small"><span style="font-size:small">"traceLevel"</span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"1"</span></span><span style="font-size:small"> }, { 0, 0 } };</span><span style="font-size:small">
</span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">,</span><span style="font-size:small">argv</span><span style="font-size:small">,</span><span style="font-size:small"><span style="font-size:small">"omniORB4"</span></span><span style="font-size:small">,</span><span style="font-size:small">options</span><span style="font-size:small">);</span></div>
<!--TOC subsection id="sec56" Environment variables-->
<h3 id="sec56" class="subsection">4.1.3&#XA0;&#XA0;Environment variables</h3><!--SEC END --><p>Environment variables consist of the parameter name prefixed with
&#X2018;<span style="font-family:monospace">ORB</span>&#X2019;. Using bash, for example</p><div class="lstlisting"><span style="font-size:small">export</span><span style="font-size:small"> </span><span style="font-size:small">ORBtraceLevel</span><span style="font-size:small">=10</span></div>
<!--TOC subsection id="sec57" Configuration file-->
<h3 id="sec57" class="subsection">4.1.4&#XA0;&#XA0;Configuration file</h3><!--SEC END --><p>The best way to understand the format of the configuration file is to
look at the <span style="font-family:monospace">sample.cfg</span> file in the omniORB distribution. Each
parameter is set on a single line like</p><pre class="verbatim">traceLevel = 10
</pre><p>Some parameters can have more than one value, in which case the
parameter name may be specified more than once, or you can leave it
out:</p><pre class="verbatim">InitRef = NameService=corbaname::host1.example.com
        = InterfaceRepository=corbaloc::host2.example.com:1234/IfR
</pre><div class="minipage"><hr style="height:2"><dl class="list"><dt class="dt-list">

</dt><dd class="dd-list">
Command line arguments and environment variables prefix parameter
names with &#X2018;-ORB&#X2019; and &#X2018;ORB&#X2019; respectively, but the configuration file
and the extra argument to <span style="font-family:monospace">ORB_init()</span> do not use a prefix.
</dd></dl><hr style="height:2"></div>
<!--TOC subsection id="sec58" Windows registry-->
<h3 id="sec58" class="subsection">4.1.5&#XA0;&#XA0;Windows registry</h3><!--SEC END --><p>On Windows, configuration parameters can be stored in the registry,
under the key <span style="font-family:monospace">HKEY_LOCAL_MACHINE\SOFTWARE\omniORB</span>.</p><p>The file <span style="font-family:monospace">sample.reg</span> shows the settings that can be made. It can
be edited and then imported into regedit.</p>
<!--TOC section id="sec59" Tracing options-->
<h2 id="sec59" class="section">4.2&#XA0;&#XA0;Tracing options</h2><!--SEC END --><p>The following options control debugging trace output.</p><p><span style="font-family:monospace">traceLevel</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>omniORB can output tracing and diagnostic messages to the standard
error stream. The following levels are defined:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 0</td><td style="vertical-align:top;text-align:left;" >critical errors only</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 1</td><td style="vertical-align:top;text-align:left;" >informational messages only</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 2</td><td style="vertical-align:top;text-align:left;" >configuration information and warnings</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 5</td><td style="vertical-align:top;text-align:left;" >notifications when server threads are
created and communication endpoints are shutdown</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
level 10</td><td style="vertical-align:top;text-align:left;" >execution and exception traces</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 25</td><td style="vertical-align:top;text-align:left;" >trace each send or receive of a GIOP message</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 30</td><td style="vertical-align:top;text-align:left;" >dump up to 128 bytes of each GIOP message</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >level 40</td><td style="vertical-align:top;text-align:left;" >dump complete contents of each GIOP message</td></tr>
</table><p>The trace level is cumulative, so at level 40, all trace
messages are output.</p><p><span style="font-family:monospace">traceExceptions</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceExceptions</span> parameter is set <span style="font-family:monospace">true</span>, all system
exceptions are logged as they are thrown, along with details about
where the exception is thrown from. This parameter is enabled by
default if the traceLevel is set to 10 or more.</p><p><span style="font-family:monospace">traceInvocations</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceInvocations</span> parameter is set <span style="font-family:monospace">true</span>, all local
and remote invocations are logged, in addition to any logging that may
have been selected with <span style="font-family:monospace">traceLevel</span>.</p><p><span style="font-family:monospace">traceInvocationReturns</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If the <span style="font-family:monospace">traceInvocationReturns</span> parameter is set <span style="font-family:monospace">true</span>, a
log message is output as an operation invocation returns. In
conjunction with <span style="font-family:monospace">traceInvocations</span> and <span style="font-family:monospace">traceTime</span>
(described below), this provides a simple way of timing CORBA calls
within your application.</p><p><span style="font-family:monospace">traceThreadId</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">traceThreadId</span> is set <span style="font-family:monospace">true</span>, all trace messages are
prefixed with the id of the thread outputting the message. This can be
handy for making sense of multi-threaded code, but it adds overhead to
the logging so it can be disabled.</p><p><span style="font-family:monospace">traceTime</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">traceTime</span> is set <span style="font-family:monospace">true</span>, all trace messages are
prefixed with the time. This is useful, but on some platforms it adds
a very large overhead, so it can be turned off.</p><p><span style="font-family:monospace">traceFile</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
</p><p>omniORB&#X2019;s tracing is normally sent to stderr. If <span style="font-family:monospace">traceFile</span> it
set, the specified file name is used for trace messages.</p>
<!--TOC subsection id="sec60" Tracing API-->
<h3 id="sec60" class="subsection">4.2.1&#XA0;&#XA0;Tracing API</h3><!--SEC END --><p>The tracing parameters can be modified at runtime by assigning to the
following variables</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small">   </span><span style="font-size:small">traceLevel</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">traceExceptions</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">traceInvocations</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">traceInvocationReturns</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">traceThreadId</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">traceTime</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Log messages can be sent somewhere other than stderr by registering a
logging function which is called with the text of each log message:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> (*</span><span style="font-size:small">logFunction</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setLogFunction</span><span style="font-size:small">(</span><span style="font-size:small">logFunction</span><span style="font-size:small"> </span><span style="font-size:small">f</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The log function must not make any CORBA calls, since that could lead
to infinite recursion as outputting a log message caused other log
messages to be generated, and so on.</p>
<!--TOC section id="sec61" Miscellaneous global options-->
<h2 id="sec61" class="section">4.3&#XA0;&#XA0;Miscellaneous global options</h2><!--SEC END --><p>These options control miscellaneous features that affect the whole ORB
runtime.</p><p><span style="font-family:monospace">dumpConfiguration</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, the ORB dumps the values of all configuration
parameters at start-up.</p><p><span style="font-family:monospace">scanGranularity</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>As explained in chapter&#XA0;<a href="#chap%3Aconnections">6</a>, omniORB regularly
scans incoming and outgoing connections, so it can close unused
ones. This value is the granularity in seconds at which the ORB
performs its scans. A value of zero turns off the scanning altogether.</p><p><span style="font-family:monospace">nativeCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">ISO-8859-1</span></p><p>The native code set the application is using for <span style="font-family:monospace">char</span> and
<span style="font-family:monospace">string</span>. See chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">nativeWCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">UTF-16</span></p><p>The native code set the application is using for <span style="font-family:monospace">wchar</span> and
<span style="font-family:monospace">wstring</span>. See chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">defaultCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>The default code set used for <span style="font-family:monospace">char</span> and <span style="font-family:monospace">string</span> if the
server does not specify it in its IORs. See
chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">defaultWCharCodeSet</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>The default code set used for <span style="font-family:monospace">wchar</span> and <span style="font-family:monospace">wstring</span> if the
server does not specify it in its IORs. See
chapter&#XA0;<a href="#chap%3Acodesets">8</a>.</p><p><span style="font-family:monospace">copyValuesInLocalCalls</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>Determines whether valuetype parameters in local calls are copied or
not. See chapter&#XA0;<a href="#chap%3Avaluetype">11</a>.</p><p><span style="font-family:monospace">abortOnInternalError</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If this is set <span style="font-family:monospace">true</span>, internal fatal errors will abort
immediately, rather than throwing the <span style="font-family:monospace">omniORB::fatalException</span>
exception. This can be helpful for tracking down bugs, since it
leaves the call stack intact.</p><p><span style="font-family:monospace">abortOnNativeException</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>On Windows, &#X2018;native&#X2019; exceptions such as segmentation faults and divide
by zero appear as C++ exceptions that can be caught with <span style="font-family:monospace">catch
(...)</span>. Setting this parameter to <span style="font-family:monospace">true</span> causes such exceptions
to abort the process instead.</p><p><span style="font-family:monospace">maxSocketSend</span><br>
<span style="font-family:monospace">maxSocketRecv</span><br>

On some platforms, calls to send() and recv() have a limit on the
buffer size that can be used. These parameters set the limits in bytes
that omniORB uses when sending / receiving bulk data.</p><p>The default values are platform specific. It is unlikely that you will
need to change the values from the defaults.</p><p>The minimum valid limit is 1KB, 1024 bytes.</p><p><span style="font-family:monospace">socketSendBuffer</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">-1 </span><span style="font-family:monospace"><span style="font-style:italic">or</span></span><span style="font-family:monospace"> 16384</span></p><p>On Windows, there is a kernel buffer used during send operations. A
bug in Windows means that if a send uses the entire kernel buffer, a
select() on the socket blocks until all the data has been acknowledged
by the receiver, resulting in dreadful performance. This parameter
modifies the socket send buffer from its default (8192 bytes on
Windows) to the value specified. If this parameter is set to -1, the
socket send buffer is left at the system default.</p><p>On Windows, the default value of this parameter is 16384 bytes; on all
other platforms the default is -1.</p><p><span style="font-family:monospace">validateUTF8</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>When transmitting a string that is supposed to be UTF-8, omniORB
usually passes it directly, assuming that it is valid. With this
parameter set <span style="font-family:monospace">true</span>, omniORB checks that all UTF-8 strings are
valid, and throws DATA_CONVERSION if not.</p>
<!--TOC section id="sec62" Client side options-->
<h2 id="sec62" class="section">4.4&#XA0;&#XA0;Client side options</h2><!--SEC END --><p>
<a id="sec:clientconf"></a></p><p>These options control aspects of client-side behaviour.</p><p><span style="font-family:monospace">InitRef</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>Specify objects available from
<span style="font-family:monospace">ORB::resolve_initial_references()</span>. The arguments take the form
&lt;<span style="font-style:italic">key</span>&gt;=&lt;<span style="font-style:italic">uri</span>&gt;, where <span style="font-style:italic">key</span> is the name given to
<span style="font-family:monospace">resolve_initial_references()</span> and <span style="font-style:italic">uri</span> is a
valid CORBA object reference URI, as detailed in
chapter&#XA0;<a href="#chap%3Ains">7</a>.</p><p><span style="font-family:monospace">DefaultInitRef</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>Specify the default URI prefix for
<span style="font-family:monospace">resolve_initial_references()</span>, as explained in
chapter&#XA0;<a href="#chap%3Ains">7</a>.</p><p><span style="font-family:monospace">clientTransportRule</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">* unix,tcp,ssl</span></p><p>Used to specify the way the client contacts a server, depending on the
server&#X2019;s address. See section&#XA0;<a href="#sec%3AclientRule">6.7.1</a> for details.</p><p><span style="font-family:monospace">clientCallTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Call timeout in milliseconds for the client side. If a call takes
longer than the specified number of milliseconds, the ORB closes the
connection to the server and raises a <span style="font-family:monospace">TRANSIENT</span> exception. A
value of zero means no timeout; calls can block for ever. See
section&#XA0;<a href="#sec%3AtimeoutAPI">6.3.1</a> for more information about timeouts.</p><p><span style="font-weight:bold">Note</span>: omniORB 3 had timeouts specified in seconds;
omniORB 4.0 and later use milliseconds for timeouts.</p><p><span style="font-family:monospace">clientConnectTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>The timeout that is used in the case that a new network connection is
established to the server. A value of zero means that the normal call
timeout is used. See section&#XA0;<a href="#sec%3AtimeoutAPI">6.3.1</a> for more information
about timeouts.</p><p><span style="font-family:monospace">supportPerThreadTimeOut</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If this parameter is set <span style="font-family:monospace">true</span>, timeouts can be set on a per
thread basis, as well as globally and per object. Checking per-thread
storage has a noticeable performance impact, so it is turned off by
default.</p><p><span style="font-family:monospace">resetTimeoutOnRetries</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, the call timeout is reset when an exception handler
causes a call to be retried. If <span style="font-family:monospace">false</span>, the timeout is not
reset, and therefore applies to the call as a whole, rather than to
each individual call attempt.</p><p><span style="font-family:monospace">throwTransientOnTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>omniORB 4.2 supports the <span style="font-family:monospace">CORBA::TIMEOUT</span> exception that is part
of the CORBA Messaging specification. By default, that is the
exception thrown when timeouts occur. Previous omniORB releases did
not have the <span style="font-family:monospace">CORBA::TIMEOUT</span> exception, and instead used
<span style="font-family:monospace">CORBA::TRANSIENT</span>. If this parameter is set <span style="font-family:monospace">true</span>, omniORB
follows the old behaviour of throwing <span style="font-family:monospace">CORBA::TRANSIENT</span> when a
timeout occurs.</p><p><span style="font-family:monospace">outConScanPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">120</span></p><p>Idle timeout in seconds for outgoing (i.e. client initiated)
connections. If a connection has been idle for this amount of time,
the ORB closes it. See section&#XA0;<a href="#sec%3AconnShutdown">6.5</a>.</p><p><span style="font-family:monospace">maxGIOPConnectionPerServer</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>The maximum number of concurrent connections the ORB will open to a
<em>single</em> server. If multiple threads on the client call the same
server, the ORB opens additional connections to the server, up to the
maximum specified by this parameter. If the maximum is reached,
threads are blocked until a connection becomes free for them to use.</p><p><span style="font-family:monospace">oneCallPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>When this parameter is set to <span style="font-family:monospace">true</span> (the default), the ORB will
only send a single call on a connection at a time. If multiple client
threads invoke on the same server, multiple connections are opened, up
to the limit specified by
<span style="font-family:monospace">maxGIOPConnectionPerServer</span>. With this parameter set to
<span style="font-family:monospace">false</span>, the ORB will allow concurrent calls on a single
connection. This saves connection resources, but requires slightly
more management work for both client and server. Some server-side ORBs
(including omniORB versions before 4.0) serialise all incoming calls
on a single connection.</p><p><span style="font-family:monospace">maxInterleavedCallsPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">5</span></p><p>The maximum number of calls that can be interleaved on a connection.
If more concurrent calls are made, they are queued.</p><p><span style="font-family:monospace">offerBiDirectionalGIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, the client will indicate to servers that it is
willing to accept callbacks on client-initiated connections using
bidirectional GIOP, provided the relevant POA policies are set. See
section&#XA0;<a href="#sec%3Abidir">6.8</a>.</p><p><span style="font-family:monospace">diiThrowsSysExceptions</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If this is <span style="font-family:monospace">true</span>, DII functions throw system exceptions; if it
is <span style="font-family:monospace">false</span>, system exceptions that occur are passed through the
<span style="font-family:monospace">Environment</span> object.</p><p><span style="font-family:monospace">verifyObjectExistsAndType</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>By default, omniORB uses the GIOP <span style="font-family:monospace">LOCATE_REQUEST</span> message to
verify the existence of an object prior to the first invocation. In
the case that the full type of the object is not known, it instead
calls the <span style="font-family:monospace">_is_a()</span> operation to check the object&#X2019;s type. Some ORBs
have bugs that mean one or other of these operations fail. Setting
this parameter <span style="font-family:monospace">false</span> prevents omniORB from making these calls.</p><p><span style="font-family:monospace">giopTargetAddressMode</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>GIOP 1.2 supports three addressing modes for contacting objects. This
parameter selects the mode that omniORB uses. A value of 0 means
<span style="font-family:monospace">GIOP::KeyAddr</span>; 1 means <span style="font-family:monospace">GIOP::ProfileAddr</span>; 2 means
<span style="font-family:monospace">GIOP::ReferenceAddr</span>.</p><p><span style="font-family:monospace">immediateAddressSwitch</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, the client will immediately switch to use a new
address to contact an object after a failure. If <span style="font-family:monospace">false</span> (the
default), the current address will be retried in certain
circumstances.</p><p><span style="font-family:monospace">resolveNamesForTransportRules</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span>, names in IORs will be resolved when evaluating client
transport rules, and remembered from then on; if <span style="font-family:monospace">false</span>, names
will not be resolved until connect time. Client transport rules based
on IP address will therefore not match, but some platforms can use
external knowledge to pick the best address to use if given a name to
connect to.</p><p><span style="font-family:monospace">retainAddressOrder</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>For IORs with multiple addresses, determines how the address to
connect to is chosen. When first establishing a connection, the
addresses are ordered according to the client transport rules (after
resolving names if <span style="font-family:monospace">resolveNamesForTransportRules</span> is
<span style="font-family:monospace">true</span>), and the addresses are tried in priority order until one
connects successfully. For as long as there is at least one connection
open to the address, new connections continue to use the same address.</p><p>After a failure, or after all open connections have been scavenged and
closed, this parameter determines the address used to reconnect on the
next call. If this parameter is <span style="font-family:monospace">true</span> (the default), the address
order and chosen address within the order is remembered; if
<span style="font-family:monospace">false</span>, a new connection attempt causes re-evaluation of the
order (in case name resolutions change), and the highest priority
address is tried first.</p><p><span style="font-family:monospace">bootstrapAgentHostname</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>If set, this parameter indicates the hostname to use for look-ups
using the obsolete Sun bootstrap agent. This mechanism is superseded
by the interoperable naming service.</p><p><span style="font-family:monospace">bootstrapAgentPort</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">900</span></p><p>The port number for the obsolete Sun bootstrap agent.</p><p><span style="font-family:monospace">principal</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace"><span style="font-style:italic">none</span></span></p><p>GIOP 1.0 and 1.1 have a request header field named &#X2018;principal&#X2019;, which
contains a sequence of octets. It was never defined what it should
mean, and its use is now deprecated; GIOP 1.2 has no such field. Some
systems (e.g. Gnome) use the principal field as a primitive
authentication scheme. This parameter sets the data omniORB uses in
the principal field. The default is an empty sequence.</p>
<!--TOC section id="sec63" Server side options-->
<h2 id="sec63" class="section">4.5&#XA0;&#XA0;Server side options</h2><!--SEC END --><p>These parameters affect server-side operations.</p><p><span style="font-family:monospace">endPoint&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;&#XA0;</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> = <span style="font-family:monospace">giop:tcp::</span><br>
<span style="font-family:monospace">endPointNoListen</span><br>
<span style="font-family:monospace">endPointPublish</span><br>
<span style="font-family:monospace">endPointNoPublish</span><br>
<span style="font-family:monospace">endPointPublishAllIFs</span><br>

These options determine the end-points the ORB should listen on, and
the details that should be published in IORs. See
chapter&#XA0;<a href="#chap%3Aconnections">6</a> for details.</p><p><span style="font-family:monospace">serverTransportRule</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">* unix,tcp,ssl</span></p><p>Configure the rules about whether a server should accept an incoming
connection from a client. See section&#XA0;<a href="#sec%3AserverRule">6.7.2</a> for
details.</p><p><span style="font-family:monospace">serverCallTimeOutPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>This timeout is used to catch the situation that the server starts
receiving a request, but the end of the request never comes. If a
calls takes longer than the specified number of milliseconds to
arrive, the ORB shuts the connection. A value of zero means never
timeout.</p><p><span style="font-family:monospace">inConScanPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">180</span></p><p>Idle timeout in seconds for incoming connections. If a connection has
been idle for this amount of time, the ORB closes it. See
section&#XA0;<a href="#sec%3AconnShutdown">6.5</a>.</p><p><span style="font-family:monospace">threadPerConnectionPolicy</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span> (the default), the ORB dedicates one server thread to
each incoming connection. Setting it <span style="font-family:monospace">false</span> means the server
should use a thread pool.</p><p><span style="font-family:monospace">maxServerThreadPerConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">100</span></p><p>If the client multiplexes several concurrent requests on a single
connection, omniORB uses extra threads to service them. This parameter
specifies the maximum number of threads that are allowed to service a
single connection at any one time.</p><p><span style="font-family:monospace">maxServerThreadPoolSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">100</span></p><p>The maximum number of threads the server will allocate to do various
tasks, including dispatching calls in the thread pool mode. This
number does not include threads dispatched under the thread per
connection server mode.</p><p><span style="font-family:monospace">threadPerConnectionUpperLimit</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">10000</span></p><p>If the <span style="font-family:monospace">threadPerConnectionPolicy</span> parameter is <span style="font-family:monospace">true</span>, the
ORB can automatically transition to thread pool mode if too many
connections arrive. This parameter sets the number of connections at
which thread pooling is started. The default of 10000 is designed to
mean that it never happens.</p><p><span style="font-family:monospace">threadPerConnectionLowerLimit</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">9000</span></p><p>If thread pooling was started because the number of connections hit
the upper limit, this parameter determines when thread per connection
should start again.</p><p><span style="font-family:monospace">threadPoolWatchConnection</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>After dispatching an upcall in thread pool mode, the thread that has
just performed the call can watch the connection for a short time
before returning to the pool. This leads to less thread switching for
a series of calls from a single client, but is less fair if there are
concurrent clients. The connection is watched if the number of threads
concurrently handling the connection is less than or equal to the
value of this parameter. i.e. if the parameter is zero, the
connection is never watched; if it is 1, the last thread managing a
connection watches it; if 2, the connection is still watched if there
is one other thread still in an upcall for the connection, and so
on. See section&#XA0;<a href="#sec%3AwatchConn">6.4.2</a>.</p><p><span style="font-family:monospace">connectionWatchPeriod</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">50000</span></p><p>For each endpoint, the ORB allocates a thread to watch for new
connections and to monitor existing connections for calls that should
be handed by the thread pool. The thread blocks in select() or similar
for a period, after which it re-scans the lists of connections it
should watch. This parameter is specified in microseconds.</p><p><span style="font-family:monospace">connectionWatchImmediate</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>When a thread handles an incoming call, it unmarshals the arguments
then marks the connection as watchable by the connection watching
thread, in case the client sends a concurrent call on the same
connection. If this parameter is set to the default <span style="font-family:monospace">false</span>, the
connection is not actually watched until the next connection watch
period (determined by the <span style="font-family:monospace">connectionWatchPeriod</span> parameter). If
this parameter is set <span style="font-family:monospace">true</span>, the connection watching thread is
immediately signalled to watch the connection. That leads to faster
interactive response to clients that multiplex calls, but adds
significant overhead along the call chain.</p><p>Note that this setting has no effect on Windows, since it has no
mechanism for signalling the connection watching thread.</p><p><span style="font-family:monospace">acceptBiDirectionalGIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Determines whether a server will ever accept clients&#X2019; offers of
bidirectional GIOP connections. See section&#XA0;<a href="#sec%3Abidir">6.8</a>.</p><p><span style="font-family:monospace">unixTransportDirectory</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">/tmp/omni-%u</span></p><p>(Unix platforms only). Selects the location used to store Unix domain
sockets. The &#X2018;<span style="font-family:monospace">%u</span>&#X2019; is expanded to the user name.</p><p><span style="font-family:monospace">unixTransportPermission</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0777</span></p><p>(Unix platforms only). Determines the octal permission bits for Unix
domain sockets. By default, all users can connect to a server, just as
with TCP.</p><p><span style="font-family:monospace">supportCurrent</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>omniORB supports the <span style="font-family:monospace">PortableServer::Current</span> interface to
provide thread context information to servants. Supporting current has
a small but noticeable run-time overhead due to accessing thread
specific storage, so this option allows it to be turned off.</p><p><span style="font-family:monospace">objectTableSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>Hash table size of the Active Object Map. If this is zero, the ORB
uses a dynamically resized open hash table. This is normally the best
option, but it leads to less predictable performance since any
operation which adds or removes a table entry may trigger a resize. If
set to a non-zero value, the hash table has the specified number of
entries, and is never resized. Note that the hash table is open, so
this does not limit the number of active objects, just how efficiently
they can be located.</p><p><span style="font-family:monospace">poaHoldRequestTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If a POA is put in the <span style="font-family:monospace">HOLDING</span> state, calls to it will be timed
out after the specified number of milliseconds, by raising a
<span style="font-family:monospace">CORBA::TIMEOUT</span> exception. Zero means no timeout.</p><p><span style="font-family:monospace">poaUniquePersistentSystemIds</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>The POA specification requires that object ids in POAs with the
PERSISTENT and SYSTEM_ID policies are unique between instantiations
of the POA. Older versions of omniORB did not comply with that, and
reused object ids. With this value <span style="font-family:monospace">true</span>, the POA has the
correct behaviour; with <span style="font-family:monospace">false</span>, the POA uses the old scheme for
compatibility.</p><p><span style="font-family:monospace">idleThreadTimeout</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">10</span></p><p>When a thread created by omniORB becomes idle, it is kept alive for a
while, in case a new thread is required. Once a thread has been idle
for the number of seconds specified in this parameter, it exits.</p><p><span style="font-family:monospace">supportBootstrapAgent</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If set <span style="font-family:monospace">true</span>, servers support the Sun bootstrap agent protocol.</p>
<!--TOC subsection id="sec64" Main thread selection-->
<h3 id="sec64" class="subsection">4.5.1&#XA0;&#XA0;Main thread selection</h3><!--SEC END --><p>There is one server-side parameter that must be set with an API
function, rather than a normal configuration parameter:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setMainThread</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>POAs with the <span style="font-family:monospace">MAIN_THREAD</span> policy dispatch calls on the &#X2018;main&#X2019;
thread. By default, omniORB assumes that the thread that initialised
the omnithread library is the &#X2018;main&#X2019; thread. To choose a different
thread, call this function from the desired &#X2018;main&#X2019; thread. The calling
thread must have an <span style="font-family:monospace">omni_thread</span> associated with it (i.e. it
must have been created by omnithread, or
<span style="font-family:monospace">omni_thread::create_dummy()</span> must have been called). If it
does not, the function throws <span style="font-family:monospace">CORBA::INITIALIZE</span>.</p><p>Note that calls are only actually dispatched to the &#X2018;main&#X2019; thread if
<span style="font-family:monospace">ORB::run()</span> or <span style="font-family:monospace">ORB::perform_work()</span> is called from that thread.</p>
<!--TOC section id="sec65" GIOP and interoperability options-->
<h2 id="sec65" class="section">4.6&#XA0;&#XA0;GIOP and interoperability options</h2><!--SEC END --><p>These options control omniORB&#X2019;s use of GIOP, and cover some areas
where omniORB can work around buggy behaviour by other ORBs.</p><p><span style="font-family:monospace">maxGIOPVersion</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1.2</span></p><p>Choose the maximum GIOP version the ORB should support. Valid values
are 1.0, 1.1 and 1.2.</p><p><span style="font-family:monospace">giopMaxMsgSize</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">2097152</span></p><p>The largest message, in bytes, that the ORB will send or receive, to
avoid resource starvation. If the limit is exceeded, a <span style="font-family:monospace">MARSHAL</span>
exception is thrown. The size must be &gt;= 8192.</p><p><span style="font-family:monospace">strictIIOP</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>If <span style="font-family:monospace">true</span>, be strict about interpretation of the IIOP
specification; if <span style="font-family:monospace">false</span>, permit some buggy behaviour to pass.</p><p><span style="font-family:monospace">lcdMode</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, select &#X2018;Lowest Common Denominator&#X2019; mode. This disables
various IIOP and GIOP features that are known to cause problems with
some ORBs.</p><p><span style="font-family:monospace">tcAliasExpand</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>This flag is used to indicate whether TypeCodes associated with Anys
should have aliases removed. This functionality is included because
some ORBs will not recognise an Any containing a TypeCode with aliases
to be the same as the actual type contained in the Any. There is a
performance penalty when inserting into an Any if <span style="font-family:monospace">tcAliasExpand</span>
is set to 1.</p><p><span style="font-family:monospace">useTypeCodeIndirections</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">1</span></p><p>TypeCode Indirections reduce the size of marshalled TypeCodes, and are
essential for recursive types, but some old ORBs do not support them.
Setting this flag to <span style="font-family:monospace">false</span> prevents the use of indirections
(and, therefore, prevents the use of recursive TypeCodes).</p><p><span style="font-family:monospace">acceptMisalignedTcIndirections</span> &#XA0;&#XA0; <span style="font-style:italic">default</span> =
<span style="font-family:monospace">0</span></p><p>If <span style="font-family:monospace">true</span>, try to fix a mis-aligned indirection in a
typecode. This is used to work around a bug in some old versions of
Visibroker&#X2019;s Java ORB.</p>
<!--TOC section id="sec66" System Exception Handlers-->
<h2 id="sec66" class="section">4.7&#XA0;&#XA0;System Exception Handlers</h2><!--SEC END --><p>By default, all system exceptions that are raised during an operation
invocation, with the exception of some cases of
<span style="font-family:monospace">CORBA::TRANSIENT</span>, are propagated to the application code. Some
applications may prefer to trap these exceptions within the proxy
objects so that the application logic does not have to deal with the
error condition. For example, when a <span style="font-family:monospace">CORBA::COMM_FAILURE</span> is
received, an application may just want to retry the invocation until
it finally succeeds. This approach is useful for objects that are
persistent and have idempotent operations.</p><p>omniORB provides a set of functions to install exception handlers.
Once they are installed, proxy objects will call these handlers when
the associated system exceptions are raised by the ORB runtime.
Handlers can be installed for <span style="font-family:monospace">CORBA::TRANSIENT</span>,
<span style="font-family:monospace">CORBA::TIMEOUT</span>, <span style="font-family:monospace">CORBA::COMM_FAILURE</span> and
<span style="font-family:monospace">CORBA::SystemException</span>. This last handler covers all
system exceptions other than the three specific ones covered by the
first three handlers. An exception handler can be installed for
individual proxy objects, or it can be installed for all proxy objects
in the address space.</p>
<!--TOC subsection id="sec67" Minor codes-->
<h3 id="sec67" class="subsection">4.7.1&#XA0;&#XA0;Minor codes</h3><!--SEC END --><p>omniORB makes extensive use of exception minor codes to indicate the
specific circumstances surrounding a system exception. The file
<span style="font-family:monospace">include/omniORB4/minorCode.h</span> contains definitions of all the
minor codes used in omniORB, covering codes allocated in the CORBA
specification, and ones specific to omniORB. In compilers with
namespace support, the minor code constants appear in namespace
<span style="font-family:monospace">omni</span>; otherwise they are in the global scope.</p><p>Applications can use minor codes to adjust their behaviour according
to the condition, e.g.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  ...</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">minor</span><span style="font-size:small">() == </span><span style="font-size:small">omni</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT_ConnectFailed</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// retry with a different object reference...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// print an error message...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec68" CORBA::TRANSIENT handlers-->
<h3 id="sec68" class="subsection">4.7.2&#XA0;&#XA0;CORBA::TRANSIENT handlers</h3><!--SEC END --><p><span style="font-family:monospace">TRANSIENT</span> exceptions can occur in many circumstances. One
circumstance is as follows:</p><ol class="enumerate" type=1><li class="li-enumerate">The client invokes on an object reference.
</li><li class="li-enumerate">The object replies with a <span style="font-family:monospace">LOCATION_FORWARD</span> message.
</li><li class="li-enumerate">The client caches the new location and retries to the new location.
</li><li class="li-enumerate">Time passes...
</li><li class="li-enumerate">The client tries to invoke on the object again, using the
cached, forwarded location. 
</li><li class="li-enumerate">The attempt to contact the object fails.
</li><li class="li-enumerate">The ORB runtime resets the location cache and throws a
<span style="font-family:monospace">TRANSIENT</span> exception with minor code
<span style="font-family:monospace">TRANSIENT_FailedOnForwarded</span>.</li></ol><p>In this situation, the default <span style="font-family:monospace">TRANSIENT</span> exception handler
retries the call, using the object&#X2019;s original location. If the retry
results in another <span style="font-family:monospace">LOCATION_FORWARD</span>, to the same or a
different location, and <em>that</em> forwarded location fails
immediately, the <span style="font-family:monospace">TRANSIENT</span> exception will occur again, and the
pattern will repeat. With repeated exceptions, the handler starts
adding delays before retries, with exponential back-off.</p><p>In all other circumstances, the default <span style="font-family:monospace">TRANSIENT</span> handler just
passes the exception on to the caller.</p><p>Applications can override the default behaviour by installing their
own exception handler. The API to do so is summarised below:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">  (*</span><span style="font-size:small">transientExceptionHandler_t</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                 </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">n_retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                 </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">installTransientExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small">transientExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">installTransientExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small">transientExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>The overloaded <span style="font-family:monospace">installTransientExceptionHandler()</span> function is used
to install the exception handlers for <span style="font-family:monospace">CORBA::TRANSIENT</span>. Two
forms are available: the first form installs an exception handler for
all object references except for those which have an exception handler
installed by the second form, which takes an additional argument to
identify the target object reference. The argument <span style="font-family:monospace">cookie</span> is an
opaque pointer which will be passed on by the ORB when it calls the
exception handler.</p><p>An exception handler will be called by proxy objects with three
arguments. The <span style="font-family:monospace">cookie</span> is the opaque pointer registered by
<span style="font-family:monospace">installTransientExceptionHandler()</span>. The argument
<span style="font-family:monospace">n_retries</span> is the number of times the proxy has called this
handler for the same invocation. The argument <span style="font-family:monospace">ex</span> is the value
of the exception caught. The exception handler is expected to do
whatever is appropriate and return a boolean value. If the return
value is <span style="font-family:monospace">true</span>, the proxy object retries the operation. If the
return value is <span style="font-family:monospace">false</span>, the original exception is propagated
into the application code. In the case of a <span style="font-family:monospace">TRANSIENT</span> exception
due to a failed location forward, the exception propagated to the
application is the <em>original</em> exception that caused the
<span style="font-family:monospace">TRANSIENT</span> (e.g. a <span style="font-family:monospace">COMM_FAILURE</span> or
<span style="font-family:monospace">OBJECT_NOT_EXIST</span>), rather than the <span style="font-family:monospace">TRANSIENT</span>
exception<sup><a id="text9" href="#note9">1</a></sup>.</p><p>The following sample code installs a simple exception handler for all
objects and for a specific object:</p><div class="lstlisting"><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">my_transient_handler1</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                     </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                     </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"transient handler 1 called."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">true</span></span><span style="font-size:small">;           </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// retry immediately.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">my_transient_handler2</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                     </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                     </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"transient handler 2 called."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">false</span></span><span style="font-size:small">;          </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// do not retry.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">myobj</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">installhandlers</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">omniORB</span><span style="font-size:small">::</span><span style="font-size:small">installTransientExceptionHandler</span><span style="font-size:small">(0, </span><span style="font-size:small">my_transient_handler1</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// All proxy objects will call my_transient_handler1 from now on.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">omniORB</span><span style="font-size:small">::</span><span style="font-size:small">installTransientExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">myobj</span><span style="font-size:small">, 0, </span><span style="font-size:small">my_transient_handler2</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// The proxy object of myobj will call my_transient_handler2 from now on.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec69" CORBA::TIMEOUT-->
<h3 id="sec69" class="subsection">4.7.3&#XA0;&#XA0;CORBA::TIMEOUT</h3><!--SEC END --><p>When a call timeout occurs, by default the ORB throws
<span style="font-family:monospace">CORBA::TIMEOUT</span>. The default behaviour of the proxy objects is
to propagate this exception to the application. Applications can
override the default behaviour by installing their own exception
handlers. The API to do so is summarised below:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">(*</span><span style="font-size:small">timeoutExceptionHandler_t</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                             </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">n_retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                             </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TIMEOUT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installTimeoutExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                               </span><span style="font-size:small">timeoutExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installTimeoutExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                               </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                               </span><span style="font-size:small">timeoutExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span></div><p>The functions are equivalent to their counterparts for
<span style="font-family:monospace">CORBA::TRANSIENT</span>.</p><p>omniORB version 4.1 and earlier did not have the <span style="font-family:monospace">CORBA::TIMEOUT</span>
exception, and threw <span style="font-family:monospace">CORBA::TRANSIENT</span> instead. If the
<span style="font-family:monospace">throwTransientOnTimeout</span> configuration parameter is set to
<span style="font-family:monospace">1</span>, omniORB 4.2 reverts to this behaviour, and calls the
transient exception handler instead of the timeout exception handler.</p><p>The timeout exception handler is used when a CORBA call times out. It
is <em>not</em> called when an AMI poller operation throws
<span style="font-family:monospace">CORBA::TIMEOUT</span>. In that situation, the exception is always
propagated to the caller.</p>
<!--TOC subsection id="sec70" CORBA::COMM_FAILURE-->
<h3 id="sec70" class="subsection">4.7.4&#XA0;&#XA0;CORBA::COMM_FAILURE</h3><!--SEC END --><p>If the ORB has successfully contacted a server at some point, and
access to it subsequently fails (and the condition for
<span style="font-family:monospace">TRANSIENT</span> described above does not occur), the ORB raises a
<span style="font-family:monospace">CORBA::COMM_FAILURE</span> exception.</p><p>The default behaviour of the proxy objects is to propagate this
exception to the application. Applications can override the default
behaviour by installing their own exception handlers. The API to do so
is summarised below:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">(*</span><span style="font-size:small">commFailureExceptionHandler_t</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                 </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">n_retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                 </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">COMM_FAILURE</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installCommFailureExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small">commFailureExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installCommFailureExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                   </span><span style="font-size:small">commFailureExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span></div><p>The functions are equivalent to their counterparts for
<span style="font-family:monospace">CORBA::TRANSIENT</span>.</p>
<!--TOC subsection id="sec71" CORBA::SystemException-->
<h3 id="sec71" class="subsection">4.7.5&#XA0;&#XA0;CORBA::SystemException</h3><!--SEC END --><p>If a system exceptions other than <span style="font-family:monospace">TRANSIENT</span>, <span style="font-family:monospace">TIMEOUT</span> or
<span style="font-family:monospace">COMM_FAILURE</span> occurs, the default behaviour of the proxy
objects is to propagate this exception to the application.
Applications can override the default behaviour by installing their
own exception handlers. The API to do so is summarised below:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">(*</span><span style="font-size:small">systemExceptionHandler_t</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                            </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">n_retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                            </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installSystemExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                              </span><span style="font-size:small">systemExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">installSystemExceptionHandler</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                              </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                              </span><span style="font-size:small">systemExceptionHandler_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span></div><p>The functions are equivalent to their counterparts for
<span style="font-family:monospace">CORBA::TRANSIENT</span>.</p>
<!--TOC subsection id="sec72" Extended exception handlers-->
<h3 id="sec72" class="subsection">4.7.6&#XA0;&#XA0;Extended exception handlers</h3><!--SEC END --><p>New in omniORB 4.2, each of the exception handlers described above
also has an &#X2018;extended&#X2019; form in which the exception handler takes two
additional parameters, the object reference being invoked upon, and a
string containing the name of the operation invoked. e.g.:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">  (*</span><span style="font-size:small">transientExceptionHandlerExt_t</span><span style="font-size:small">)(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">*                   </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small">            </span><span style="font-size:small">n_retries</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                    </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                    </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*             </span><span style="font-size:small">op</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">installTransientExceptionHandlerExt</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                     </span><span style="font-size:small">transientExceptionHandlerExt_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">installTransientExceptionHandlerExt</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                      </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">* </span><span style="font-size:small">cookie</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                                      </span><span style="font-size:small">transientExceptionHandlerExt_t</span><span style="font-size:small"> </span><span style="font-size:small">fn</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>Note that the operation parameter can sometimes be null. By default,
omniORB sends a <span style="font-family:monospace">LocateRequest</span> message prior to the first
operation invocation on an object reference. That <span style="font-family:monospace">LocateRequest</span>
is subject to the same exception handling mechanism as a normal
operation invocation, but it is represented with a null operation
name. Exception handler code that uses the operation name must
correctly handle a null operation name pointer.</p>
<!--TOC section id="sec73" Location forwarding-->
<h2 id="sec73" class="section">4.8&#XA0;&#XA0;Location forwarding</h2><!--SEC END --><p>
<a id="sec:locationForward"></a></p><p>Any CORBA operation invocation can return a <span style="font-family:monospace">LOCATION_FORWARD</span>
message to the caller, indicating that it should retry the invocation
on a new object reference. The standard allows ServantManagers to
trigger <span style="font-family:monospace">LOCATION_FORWARD</span>s by raising the
<span style="font-family:monospace">PortableServer::ForwardRequest</span> exception, but it does not
provide a similar mechanism for normal servants. omniORB provides the
<span style="font-family:monospace">omniORB::LOCATION_FORWARD</span> exception for this purpose. It
can be thrown by any operation implementation.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">LOCATION_FORWARD</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">LOCATION_FORWARD</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The exception object consumes the object reference it is
passed.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note9" href="#text9">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">This is different from omniORB 4.0 and earlier,
where it was the <span style="font-family:monospace">TRANSIENT</span> exception that was propagated to
the application.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec74" The IDL compiler-->
<h1 id="sec74" class="chapter">Chapter&#XA0;5&#XA0;&#XA0;The IDL compiler</h1><!--SEC END --><p>
<a id="chap:omniidl"></a></p><p>omniORB&#X2019;s IDL compiler is called omniidl. It consists of a generic
front-end parser written in C++, and a number of back-ends written in
Python. omniidl is very strict about IDL validity, so you may find
that it reports errors in IDL which compiles fine with other IDL
compilers.</p><p>The general form of an omniidl command line is:</p><blockquote class="quote"> <span style="font-family:monospace">omniidl </span>[<span style="font-style:italic">options</span>]<span style="font-family:monospace"> -b</span>&lt;<span style="font-style:italic">back-end</span>&gt;<span style="font-family:monospace"> </span>[<span style="font-style:italic">back-end options</span>]<span style="font-family:monospace"> </span>&lt;<span style="font-style:italic">file</span>&gt;
</blockquote>
<!--TOC section id="sec75" Common options-->
<h2 id="sec75" class="section">5.1&#XA0;&#XA0;Common options</h2><!--SEC END --><p>The following options are common to all back-ends:</p><table style="border:0;border-spacing:0" class="cellpadding0"><tr><td style="text-align:left;white-space:nowrap" ></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-b</span><span style="font-style:italic">back-end</span>
</td><td style="text-align:left;white-space:nowrap" >Run the specified back-end. For the C++ ORB, use <span style="font-family:monospace">-bcxx</span>.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-D</span><span style="font-style:italic">name</span>[<span style="font-family:monospace">=</span><span style="font-style:italic">value</span>]
</td><td style="text-align:left;white-space:nowrap" >Define <span style="font-style:italic">name</span> for the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-U</span><span style="font-style:italic">name</span>
</td><td style="text-align:left;white-space:nowrap" >Undefine <span style="font-style:italic">name</span> for the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-I</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Include <span style="font-style:italic">dir</span> in the preprocessor search path.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-E</span>
</td><td style="text-align:left;white-space:nowrap" >Only run the preprocessor, sending its output to stdout.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Y</span><span style="font-style:italic">cmd</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">cmd</span> as the preprocessor, rather than the normal C
preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-N</span>
</td><td style="text-align:left;white-space:nowrap" >Do not run the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-T</span>
</td><td style="text-align:left;white-space:nowrap" >Use a temporary file, not a pipe, for preprocessor output.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wp</span><span style="font-style:italic">arg</span>[,<span style="font-style:italic">arg</span>&#X2026;]
</td><td style="text-align:left;white-space:nowrap" >Send arguments to the preprocessor.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wb</span><span style="font-style:italic">arg</span>[,<span style="font-style:italic">arg</span>&#X2026;]
</td><td style="text-align:left;white-space:nowrap" >Send arguments to the back-end.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-nf</span>
</td><td style="text-align:left;white-space:nowrap" >Do not warn about unresolved forward declarations.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-k</span>
</td><td style="text-align:left;white-space:nowrap" >Keep comments after declarations, to be used by some back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-K</span>
</td><td style="text-align:left;white-space:nowrap" >Keep comments before declarations, to be used by some back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-C</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Change directory to <span style="font-style:italic">dir</span> before writing output files.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-d</span>
</td><td style="text-align:left;white-space:nowrap" >Dump the parsed IDL then exit, without running a back-end.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-p</span><span style="font-style:italic">dir</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">dir</span> as a path to find omniidl back-ends.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-V</span>
</td><td style="text-align:left;white-space:nowrap" >Print version information then exit.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-u</span>
</td><td style="text-align:left;white-space:nowrap" >Print usage information.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-v</span>
</td><td style="text-align:left;white-space:nowrap" >Verbose: trace compilation stages.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
</td></tr>
</table><p>Most of these options are self explanatory, but some are not
so obvious.</p>
<!--TOC subsection id="sec76" Preprocessor interactions-->
<h3 id="sec76" class="subsection">5.1.1&#XA0;&#XA0;Preprocessor interactions</h3><!--SEC END --><p>IDL is processed by the C preprocessor before omniidl parses it.
omniidl always uses the GNU C preprocessor (which it builds with the
name omnicpp). The <span style="font-family:monospace">-D</span>, <span style="font-family:monospace">-U</span>, and <span style="font-family:monospace">-I</span>
options are just sent to the preprocessor. Note that the current
directory is not on the include search path by default&#X2014;use
&#X2018;<span style="font-family:monospace">-I.</span>&#X2019; for that. The <span style="font-family:monospace">-Y</span> option can be used to
specify a different preprocessor to omnicpp. Beware that line
directives inserted by other preprocessors are likely to confuse
omniidl.</p>
<!--TOC subsubsection id="sec77" Ancient history: Windows 9x-->
<h4 id="sec77" class="subsubsection">5.1.1.1&#XA0;&#XA0;Ancient history: Windows 9x</h4><!--SEC END --><p>The output from the C preprocessor is normally fed to the omniidl
parser through a pipe. On some Windows 98 machines (but not all!) the
pipe does not work, and the preprocessor output is echoed to the
screen. When this happens, the omniidl parser sees an empty file, and
produces useless stub files with strange long names. To avoid the
problem, use the &#X2018;<span style="font-family:monospace">-T</span>&#X2019; option to create a temporary file
between the two stages.</p>
<!--TOC subsection id="sec78" Forward-declared interfaces-->
<h3 id="sec78" class="subsection">5.1.2&#XA0;&#XA0;Forward-declared interfaces</h3><!--SEC END --><p>If you have an IDL file like:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">J</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> </span><span style="font-size:small">the_I</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>then omniidl will normally issue a warning:</p><pre class="verbatim"><span style="font-size:small">  test.idl:1: Warning: Forward declared interface `I' was never
  fully defined
</span></pre><p>It is illegal to declare such IDL in isolation, but it
<em>is</em> valid to define interface <span style="font-family:monospace">I</span> in a separate file. If
you have a lot of IDL with this sort of construct, you will drown
under the warning messages. Use the <span style="font-family:monospace">-nf</span> option to suppress
them.</p>
<!--TOC subsection id="sec79" Comments-->
<h3 id="sec79" class="subsection">5.1.3&#XA0;&#XA0;Comments</h3><!--SEC END --><p>By default, omniidl discards comments in the input IDL. However, with
the <span style="font-family:monospace">-k</span> and <span style="font-family:monospace">-K</span> options, it preserves the comments
for use by the back-ends. The C++ back-end ignores this information,
but it is relatively easy to write new back-ends which <em>do</em> make
use of comments.</p><p>The two different options relate to how comments are attached to
declarations within the IDL. Given IDL like:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// A comment</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op2</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>the <span style="font-family:monospace">-k</span> flag will attach the comment to <span style="font-family:monospace">op1()</span>;
the <span style="font-family:monospace">-K</span> flag will attach it to <span style="font-family:monospace">op2()</span>.</p>
<!--TOC section id="sec80" C++ back-end options-->
<h2 id="sec80" class="section">5.2&#XA0;&#XA0;C++ back-end options</h2><!--SEC END --><p>
<a id="sec:cxx_backend"></a></p><p>When you specify the C++ back-end (with <span style="font-family:monospace">-bcxx</span>), the
following <span style="font-family:monospace">-Wb</span> options are available. Note that the
<span style="font-family:monospace">-Wb</span> options must be specified <em>after</em> the
<span style="font-family:monospace">-bcxx</span> option, so omniidl knows which back-end to give the
arguments to.</p><table style="border:0;border-spacing:0" class="cellpadding0"><tr><td style="text-align:left;white-space:nowrap" ></td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbh=</span><span style="font-style:italic">suffix</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">suffix</span> for generated header files. Default
&#X2018;<span style="font-family:monospace">.hh</span>&#X2019;.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbs=</span><span style="font-style:italic">suffix</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">suffix</span> for generated stub files. Default
&#X2018;<span style="font-family:monospace">SK.cc</span>.&#X2019;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbd=</span><span style="font-style:italic">suffix</span>
</td><td style="text-align:left;white-space:nowrap" >Use <span style="font-style:italic">suffix</span> for generated dynamic files. Default
&#X2018;<span style="font-family:monospace">DynSK.cc</span>.&#X2019;</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wba</span>
</td><td style="text-align:left;white-space:nowrap" >Generate stubs for TypeCode and Any.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbtp</span>
</td><td style="text-align:left;white-space:nowrap" >Generate &#X2018;tie&#X2019; implementation skeletons.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbtf</span>
</td><td style="text-align:left;white-space:nowrap" >Generate flattened &#X2018;tie&#X2019; implementation skeletons.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbami</span>
</td><td style="text-align:left;white-space:nowrap" >Generate AMI types and operations.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbexample</span>
</td><td style="text-align:left;white-space:nowrap" >Generate example implementation code.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbinline</span>
</td><td style="text-align:left;white-space:nowrap" >Output stubs for <span style="font-family:monospace">#include</span>d IDL files in line with the
main file.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbuse-quotes</span>
</td><td style="text-align:left;white-space:nowrap" >Use quotes in &#X2018;<span style="font-family:monospace">#include</span>&#X2019; directives 
(e.g. <span style="font-family:monospace">"foo"</span> rather than <span style="font-family:monospace">&lt;foo&gt;</span>.)</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbkeep-inc-path</span>
</td><td style="text-align:left;white-space:nowrap" >Preserve IDL &#X2018;<span style="font-family:monospace">#include</span>&#X2019; paths in generated
	&#X2018;<span style="font-family:monospace">#include</span>&#X2019; directives.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbvirtual-objref</span>
</td><td style="text-align:left;white-space:nowrap" >Use virtual functions for object reference operations.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbimpl-mapping</span>
</td><td style="text-align:left;white-space:nowrap" >Use the &#X2018;implementation&#X2019; mapping for object reference methods.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbsplice-modules</span>
</td><td style="text-align:left;white-space:nowrap" >Splice together multiply-opened modules into one.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-WbBOA</span>
</td><td style="text-align:left;white-space:nowrap" >Generate BOA compatible skeletons.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbold</span>
</td><td style="text-align:left;white-space:nowrap" >Generate old CORBA 2.1 signatures for skeletons.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-Wbold-prefix</span>
</td><td style="text-align:left;white-space:nowrap" >Map C++ reserved words with prefix &#X2018;<span style="font-family:monospace">_</span>&#X2019; rather than
&#X2018;<span style="font-family:monospace">_cxx_</span>&#X2019;.</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
<span style="font-family:monospace">-WbF</span>
</td><td style="text-align:left;white-space:nowrap" >Generate code fragments (only for use during omniORB build).</td></tr>
<tr><td style="text-align:left;white-space:nowrap" >
</td></tr>
</table>
<!--TOC subsection id="sec81" Optional code generation options-->
<h3 id="sec81" class="subsection">5.2.1&#XA0;&#XA0;Optional code generation options</h3><!--SEC END --><p>By default, omniidl generates the minimum code required to provide all
the IDL-defined types and interfaces, which is sufficient for the
majority of applications. Additional code can also be generated, for
various purposes:</p>
<!--TOC subsubsection id="sec82" Any and TypeCode-->
<h4 id="sec82" class="subsubsection">5.2.1.1&#XA0;&#XA0;Any and TypeCode</h4><!--SEC END --><p>To generate TypeCodes and Any insertion operators, give the
<span style="font-family:monospace">-Wba</span> option. See chapter&#XA0;<a href="#chap%3Aany">10</a> for details.</p><p>By default, omniidl separates the normal stub and skeleton file (the
<span style="font-family:monospace">SK.cc</span> file) from these &#X2018;dynamic&#X2019; stubs (the <span style="font-family:monospace">DynSK.cc</span>
file), so applications that do not need support for Any and TypeCode
for a particular IDL file do not waste space with unnecessary
definitions. It is possible to output both the normal stubs and the
dynamic stubs to a single file, by simply specifying the same
extension for both files. This command places both the normal stubs
and the dynamic stubs in <span style="font-family:monospace">aSK.cc</span>:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bcxx -Wba -Wbd=SK.cc a.idl</span>
</blockquote>
<!--TOC subsubsection id="sec83" Tie templates-->
<h4 id="sec83" class="subsubsection">5.2.1.2&#XA0;&#XA0;Tie templates</h4><!--SEC END --><p>As described in section&#XA0;<a href="#sec%3Atie">2.11</a>, tie templates can be used to
provide servant implementations, instead of using inheritance from the
normal skeleton classes. To generate tie templates, give the
<span style="font-family:monospace">-Wbtp</span> option to omniidl.</p><p>When using a pre-namespace C++ compiler, IDL modules are mapped to C++
classes, which causes a problem with tie templates. The C++ mapping
says that for the interface <span style="font-family:monospace">M::I</span>, the C++ tie template class
should be named <span style="font-family:monospace">POA_M::I_tie</span>. However, since template classes
cannot be declared inside other classes, this naming scheme cannot be
used if <span style="font-family:monospace">POA_M</span> is a class.</p><p>The C++ mapping has an alternative option of &#X2018;flattened&#X2019; tie class
names, in which the template class is declared at global scope with
the name <span style="font-family:monospace">POA_M_I_tie</span>. i.e. all occurrences of &#X2018;<span style="font-family:monospace">::</span>&#X2019;
are replaced by &#X2018;<span style="font-family:monospace">_</span>&#X2019;. Generate the flattened ties using the
<span style="font-family:monospace">-Wbtf</span> command line argument.</p>
<!--TOC subsubsection id="sec84" Asynchronous Method Invocation-->
<h4 id="sec84" class="subsubsection">5.2.1.3&#XA0;&#XA0;Asynchronous Method Invocation</h4><!--SEC END --><p>Generate asynchronous invocation operations and the various types
required by AMI by specifying <span style="font-family:monospace">-Wbami</span>. See
chapter&#XA0;<a href="#chap%3Aami">12</a> for details.</p>
<!--TOC subsubsection id="sec85" Example implementations-->
<h4 id="sec85" class="subsubsection">5.2.1.4&#XA0;&#XA0;Example implementations</h4><!--SEC END --><p>If you use the <span style="font-family:monospace">-Wbexample</span> flag, omniidl will generate an
example implementation file as well as the stubs and skeletons. For
IDL file <span style="font-family:monospace">foo.idl</span>, the example code is written to
<span style="font-family:monospace">foo_i.cc</span>. The example file contains class and method
declarations for the operations of all interfaces in the IDL file,
along with a <span style="font-family:monospace">main()</span> function which creates an instance of each
object. You still have to fill in the operation implementations, of
course.</p>
<!--TOC subsection id="sec86" Include file options-->
<h3 id="sec86" class="subsection">5.2.2&#XA0;&#XA0;Include file options</h3><!--SEC END --><p>IDL files regularly <span style="font-family:monospace">#include</span> other files. By default, if file
<span style="font-family:monospace">a.idl</span> says <span style="font-family:monospace">#include &lt;b/c.idl&gt;</span> then the generated
header <span style="font-family:monospace">a.hh</span> has an include of the form <span style="font-family:monospace">#include
&lt;c.idl&gt;</span>, and <span style="font-family:monospace">aSK.cc</span> and <span style="font-family:monospace">aDynSK.cc</span> contain only code
corresponding to the declarations in <span style="font-family:monospace">a.idl</span>.</p><p>If the <span style="font-family:monospace">-Wbinline</span> option is provided, all the
<span style="font-family:monospace">#include</span>d declarations are generated in <span style="font-family:monospace">a.hh</span>,
<span style="font-family:monospace">aSK.cc</span> and <span style="font-family:monospace">aDynSK.cc</span>, meaning the application code
should only use that single set of files.</p><p>If <span style="font-family:monospace">-Wbuse-quotes</span> is specified, then the directive in
<span style="font-family:monospace">a.hh</span> uses quotes rather than angle brackets:
<span style="font-family:monospace">#include "c.idl"</span>.</p><p>Normally any path details contained in the IDL <span style="font-family:monospace">#include</span>
directive are removed, leaving just the base name. If
<span style="font-family:monospace">-Wbkeep-inc-path</span> is specified, the directive in
<span style="font-family:monospace">a.hh</span> is <span style="font-family:monospace">#include &lt;b/c.idl&gt;</span>.</p>
<!--TOC subsection id="sec87" Object reference operations-->
<h3 id="sec87" class="subsection">5.2.3&#XA0;&#XA0;Object reference operations</h3><!--SEC END --><p>Some of the C++ mapping&#X2019;s parameter passing rules are problematic in
terms of memory management. For example, if an IDL operation has a
parameter of type <span style="font-family:monospace">inout string</span>, the standard mapping has a C++
parameter of type <span style="font-family:monospace">char*&amp;</span>. If application code passes a
<span style="font-family:monospace">String_var</span> for the parameter, some C++ compilers choose the
wrong conversion operator and cause a violation of the memory
management rules<sup><a id="text10" href="#note10">1</a></sup>.</p><p>To avoid this, omniORB uses some helper classes as the parameter types
in object reference operations, meaning that the correct memory
management rules are always followed. Normally, that is invisible to
application code, but occasionally it becomes problematic. One example
is that if a <span style="font-family:monospace">local interface</span> is derived from a normal
unconstrained interface, the C++ mapping of the local interface
derives from the object reference class, and so the base object
reference class must use the standard mapping rather than omniORB&#X2019;s
usual enhanced mapping. To choose the standard &#X2018;implementation
mapping&#X2019;, give the <span style="font-family:monospace">-Wbimpl-mapping</span> option to omniidl.</p><p>Similarly, omniidl usually uses non-virtual methods in its object
reference classes, since there is no usual need to override them. The
local interface situation also requires method overrides, so omniidl
must be instructed to generate object references as virtual. Use
<span style="font-family:monospace">-Wbvirtual-objref</span> to achieve this.</p><p>More details about the local interface mapping can be found in
section&#XA0;<a href="#sec%3ALocalInterfaces">11.8</a>.</p>
<!--TOC subsection id="sec88" Module splicing-->
<h3 id="sec88" class="subsection">5.2.4&#XA0;&#XA0;Module splicing</h3><!--SEC END --><p>On ancient C++ compilers without namespace support, IDL modules map to
C++ classes, and so cannot be reopened. For some IDL, it is possible
to &#X2018;splice&#X2019; reopened modules on to the first occurrence of the module,
so all module definitions are in a single class. It is possible in
this sort of situation:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {};</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M2</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">J</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small">::</span><span style="font-size:small">I</span><span style="font-size:small"> </span><span style="font-size:small">ok</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">K</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> </span><span style="font-size:small">still_ok</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>but not if there are cross-module dependencies:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {};</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M2</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">J</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small">::</span><span style="font-size:small">I</span><span style="font-size:small"> </span><span style="font-size:small">ok</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">M1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">K</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">attribute</span></span><span style="font-size:small"> </span><span style="font-size:small">M2</span><span style="font-size:small">::</span><span style="font-size:small">J</span><span style="font-size:small"> </span><span style="font-size:small">oh_dear</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>In both of these cases, the <span style="font-family:monospace">-Wbsplice-modules</span>
option causes omniidl to put all of the definitions for module
<span style="font-family:monospace">M1</span> into a single C++ class. For the first case, this will work
fine. For the second case, class <span style="font-family:monospace">M1::K</span> will contain a reference
to <span style="font-family:monospace">M2::J</span>, which has not yet been defined; the C++ compiler will
complain.</p>
<!--TOC section id="sec89" Examples-->
<h2 id="sec89" class="section">5.3&#XA0;&#XA0;Examples</h2><!--SEC END --><p>Generate the C++ headers and stubs for a file <span style="font-family:monospace">a.idl</span>:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bcxx a.idl</span>
</blockquote><p>Generate with Any support:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bcxx -Wba a.idl</span>
</blockquote><p>As above, but also generate Python stubs (assuming omniORBpy
is installed):</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bcxx -Wba -bpython a.idl</span>
</blockquote><p>Just check the IDL files for validity, generating no output:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl a.idl b.idl</span>
</blockquote>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note10" href="#text10">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">For this reason, the <span style="font-family:monospace">_var</span> types
define an <span style="font-family:monospace">inout()</span> method that ensures use of the correct
conversion and thus avoids this kind of trouble.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec90" Connection and Thread Management-->
<h1 id="sec90" class="chapter">Chapter&#XA0;6&#XA0;&#XA0;Connection and Thread Management</h1><!--SEC END --><p>
<a id="chap:connections"></a></p><p>This chapter describes how omniORB manages threads and network
connections.</p>
<!--TOC section id="sec91" Background-->
<h2 id="sec91" class="section">6.1&#XA0;&#XA0;Background</h2><!--SEC END --><p>In CORBA, the ORB is the &#X2018;middleware&#X2019; that allows a client to invoke
an operation on an object without regard to its implementation or
location. In order to invoke an operation on an object, a client needs
to &#X2018;bind&#X2019; to the object by acquiring its object reference. Such a
reference may be obtained as the result of an operation on another
object (such as a naming service or factory object) or by conversion
from a stringified representation. If the object is in a different
address space, the binding process involves the ORB building a proxy
object in the client&#X2019;s address space. The ORB arranges for invocations
on the proxy object to be transparently mapped to equivalent
invocations on the implementation object.</p><p>For the sake of interoperability, CORBA mandates that all ORBs should
support IIOP as the means to communicate remote invocations over a
TCP/IP connection. IIOP is usually<sup><a id="text11" href="#note11">1</a></sup>
asymmetric with respect to the roles of the parties at the two ends of
a connection. At one end is the client which can only initiate remote
invocations. At the other end is the server which can only receive
remote invocations.</p><p>Notice that in CORBA, as in most distributed systems, remote bindings
are established implicitly without application intervention. This
provides the illusion that all objects are local, a property known as
&#X2018;location transparency&#X2019;. CORBA does not specify when such bindings
should be established or how they should be multiplexed over the
underlying network connections. Instead, ORBs are free to implement
implicit binding by a variety of means.</p><p>The rest of this chapter describes how omniORB manages network
connections and the programming interface to fine tune the management
policy.</p>
<!--TOC section id="sec92" The model-->
<h2 id="sec92" class="section">6.2&#XA0;&#XA0;The model</h2><!--SEC END --><p>omniORB is designed from the ground up to be fully multi-threaded. The
objective is to maximise the degree of concurrency and at the same
time eliminate any unnecessary thread overhead. Another objective is
to minimise the interference by the activities of other threads on the
progress of a remote invocation. In other words, thread &#X2018;cross-talk&#X2019;
should be minimised within the ORB. To achieve these objectives, the
degree of multiplexing at every level is kept to a minimum by default.</p><p>Minimising multiplexing works well when the system is relatively
lightly loaded. However, when the ORB is under heavy load, it can
sometimes be beneficial to conserve operating system resources such as
threads and network connections by multiplexing at the ORB
level. omniORB has various options that control its multiplexing
behaviour.</p>
<!--TOC section id="sec93" Client side behaviour-->
<h2 id="sec93" class="section">6.3&#XA0;&#XA0;Client side behaviour</h2><!--SEC END --><p>On the client side of a connection, the thread that invokes on a proxy
object drives the GIOP protocol directly and blocks on the connection
to receive the reply. The first time the client makes a call to a
particular address space, the ORB opens a suitable connection to the
remote address space (based on the client transport rule as described
in section&#XA0;<a href="#sec%3AclientRule">6.7.1</a>). After the reply has been received,
the ORB caches the open network connection, ready for use by another
call.</p><p>If two (or more) threads in a multi-threaded client attempt to contact
the same address space simultaneously, there are two different ways to
proceed. The default way is to open another network connection to the
server. This means that neither the client or server ORB has to
perform any multiplexing on the network connections&#X2014;multiplexing is
performed by the operating system, which has to deal with multiplexing
anyway. The second possibility is for the client to multiplex the
concurrent requests on a single network connection. This conserves
operating system resources (network connections), but means that both
the client and server have to deal with multiplexing issues
themselves.</p><p>In the default one call per connection mode, there is a limit to the
number of concurrent connections that are opened, set with the
<span style="font-family:monospace">maxGIOPConnectionPerServer</span> parameter. To tell the ORB
that it may multiplex calls on a single connection, set the
<span style="font-family:monospace">oneCallPerConnection</span> parameter to zero. If the
<span style="font-family:monospace">oneCallPerConnection</span> parameter is set to the default
value of one, and there are more concurrent calls than specified by
<span style="font-family:monospace">maxGIOPConnectionPerServer</span>, calls block waiting for connections
to become free.</p><p>Note that some server-side ORBs, including omniORB versions before
version 4.0, are unable to deal with concurrent calls multiplexed on a
single connection, so they serialise the calls. It is usually best to
keep to the default mode of opening multiple connections.</p>
<!--TOC subsection id="sec94" Client side timeouts-->
<h3 id="sec94" class="subsection">6.3.1&#XA0;&#XA0;Client side timeouts</h3><!--SEC END --><p>
<a id="sec:timeoutAPI"></a></p><p>omniORB can associate a timeout with a call, meaning that if the call
takes too long a <span style="font-family:monospace">CORBA::TIMEOUT</span> exception<sup><a id="text12" href="#note12">2</a></sup> is
thrown. Timeouts can be set for the whole process, for a specific
thread, or for a specific object reference.</p><p>Timeouts are set using this API:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniORB</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setClientCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">millisecs</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setClientCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">millisecs</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setClientThreadCallTimeout</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">millisecs</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setClientConnectTimeout</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">millisecs</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p><span style="font-family:monospace">setClientCallTimeout()</span> sets either the global timeout or the
timeout for a specific object reference.
<span style="font-family:monospace">setClientThreadCallTimeout()</span> sets the timeout for the calling
thread. The calling thread must have an <span style="font-family:monospace">omni_thread</span> associated
with it. Setting any timeout value to zero disables it.</p><p>Accessing per-thread state is a relatively expensive operation, so per
thread timeouts are disabled by default. The
<span style="font-family:monospace">supportPerThreadTimeOut</span> parameter must be set <span style="font-family:monospace">true</span> to
enable them.</p><p>To choose the timeout value to use for a call, the ORB first looks to
see if there is a timeout for the object reference, then to the
calling thread, and finally to the global timeout.</p><p>When a client has no existing connection to communicate with a server,
it must open a new connection before performing the
call. <span style="font-family:monospace">setClientConnectTimeout()</span> sets an overriding timeout for
cases where a new connection must be established. The effect of the
connect timeout depends upon whether the connect timeout is greater
or less than the timeout that would otherwise be used.</p><p>As an example, imagine that the usual call timeout is 10 seconds:</p><!--TOC subsubsection id="sec95" Connect timeout &gt; usual timeout-->
<h4 id="sec95" class="subsubsection">Connect timeout &gt; usual timeout</h4><!--SEC END --><p>If the connect timeout is set to 20 seconds, then a call that
establishes a new connection will be permitted 20 seconds before it
times out. Subsequent calls using the same connection have the normal
10 second timeout. If establishing the connection takes 8 seconds,
then the call itself takes 5 seconds, the call succeeds despite having
taken 13 seconds in total, longer than the usual timeout.</p><p>This kind of configuration is good when connections are slow to be
established.</p><p>If an object reference has multiple possible endpoints available, and
connecting to the first endpoint times out, only that one endpoint
will have been tried before an exception is raised. However, once the
timeout has occurred, the object reference will switch to use the next
endpoint. If the application attempts to make another call, it will
use the next endpoint.</p><!--TOC subsubsection id="sec96" Connect timeout &lt; usual timeout-->
<h4 id="sec96" class="subsubsection">Connect timeout &lt; usual timeout</h4><!--SEC END --><p>If the connect timeout is set to 2 seconds, the actual network-level
connect is only permitted to take 2 seconds. As long as the connection
is established in less than 2 seconds, the call can proceed. The 10
second call timeout still applies to the time taken for the whole call
(including the connection establishment). So, if establishing the
connection takes 1.5 seconds, and the call itself takes 9.5 seconds,
the call will time out because although it met the connection timeout,
it exceeded the 10 second total call timeout. On the other hand, if
establishing the connection takes 3 seconds, the call will fail after
only 2 seconds, since only 2 seconds are permitted for the connect.</p><p>If an object reference has multiple possible endpoints available, the
client will attempt to connect to them in turn, until one succeeds.
The connect timeout applies to each connection attempt. So with a
connect timeout of 2 seconds, the client will spend up to 2 seconds
attempting to connect to the first address and then, if that fails, up
to 2 seconds trying the second address, and so on. The 10 second
timeout still applies to the call as a whole, so if the total time
taken on timed-out connection attempts exceeds 10 seconds, the call
will time out.</p><p>This kind of configuration is useful where calls may take a long time
to complete (so call timeouts are long), but a fast indication of
connection failure is required.</p>
<!--TOC section id="sec97" Server side behaviour-->
<h2 id="sec97" class="section">6.4&#XA0;&#XA0;Server side behaviour</h2><!--SEC END --><p>The server side has two primary modes of operation: thread per
connection and thread pooling. It is able to dynamically transition
between the two modes, and it supports a hybrid scheme that behaves
mostly like thread pooling, but has the same fast turn-around for
sequences of calls as thread per connection.</p>
<!--TOC subsection id="sec98" Thread per connection mode-->
<h3 id="sec98" class="subsection">6.4.1&#XA0;&#XA0;Thread per connection mode</h3><!--SEC END --><p>In thread per connection mode (the default, and the only option in
omniORB versions before 4.0), each connection has a single thread
dedicated to it. The thread blocks waiting for a request. When it
receives one, it unmarshals the arguments, makes the up-call to the
application code, marshals the reply, and goes back to watching the
connection. There is thus no thread switching along the call chain,
meaning the call is very efficient.</p><p>As explained above, a client can choose to multiplex multiple
concurrent calls on a single connection, so once the server has
received the request, and just before it makes the call into
application code, it marks the connection as &#X2018;selectable&#X2019;, meaning
that another thread should watch it to see if any other requests
arrive. If they do, extra threads are dispatched to handle the
concurrent calls. GIOP 1.2 actually allows the argument data for
multiple calls to be interleaved on a connection, so the unmarshalling
code has to handle that too. As soon as any multiplexing occurs on the
connection, the aim of removing thread switching cannot be met, and
there is inevitable inefficiency due to thread switching.</p><p>The <span style="font-family:monospace">maxServerThreadPerConnection</span> parameter can be set to limit
the number of threads that can be allocated to a single connection
containing concurrent calls. Setting the parameter to 1 mimics the
behaviour of omniORB versions before 4.0, that did not support
calls multiplexed on one connection.</p>
<!--TOC subsection id="sec99" Thread pool mode-->
<h3 id="sec99" class="subsection">6.4.2&#XA0;&#XA0;Thread pool mode</h3><!--SEC END --><p>
<a id="sec:watchConn"></a></p><p>In thread pool mode, selected by setting the
<span style="font-family:monospace">threadPerConnectionPolicy</span> parameter to zero, a single thread
watches all incoming connections. When a call arrives on one of them,
a thread is chosen from a pool of threads, and set to work
unmarshalling the arguments and performing the up-call. There is
therefore at least one thread switch for each call.</p><p>The thread pool is not pre-initialised. Instead, threads are started
on demand, and idle threads are stopped after a period of inactivity.
The maximum number of threads that can be started in the pool is set
with the <span style="font-family:monospace">maxServerThreadPoolSize</span> parameter. The default
is 100.</p><p>A common pattern in CORBA applications is for a client to make several
calls to a single object in quick succession. To handle this situation
most efficiently, the default behaviour is to not return a thread to
the pool immediately after a call is finished. Instead, it is set to
watch the connection it has just served for a short while, mimicking
the behaviour in thread per connection mode. If a new call comes in
during the watching period, the call is dispatched without any thread
switching, just as in thread per connection mode. Of course, if the
server is supporting a very large number of connections (more than the
size of the thread pool), this policy can delay a call coming from
another connection. If the <span style="font-family:monospace">threadPoolWatchConnection</span>
parameter is set to zero, connection watching is disabled and threads
return to the pool immediately after finishing a single request.</p><p>In the face of multiplexed calls on a single connection, multiple
threads from the pool can be dispatched for one connection, just as in
thread per connection mode. With <span style="font-family:monospace">threadPoolWatchConnection</span> set
to the default value of 1, only the last thread servicing a connection
will watch it when it finishes a request. Setting the parameter to a
larger number allows the last <em>n</em> connections to watch the
connection.</p>
<!--TOC subsection id="sec100" Policy transition-->
<h3 id="sec100" class="subsection">6.4.3&#XA0;&#XA0;Policy transition</h3><!--SEC END --><p>If the server is dealing with a relatively small number of
connections, it is most efficient to use thread per connection mode.
If the number of connections becomes too large, however, operating
system limits on the number of threads may cause a significant
slowdown, or even prevent the acceptance of new connections
altogether.</p><p>To give the most efficient response in all circumstances, omniORB
allows a server to start in thread per connection mode, and transition
to thread pooling if many connections arrive. This is controlled with
the <span style="font-family:monospace">threadPerConnectionUpperLimit</span> and
<span style="font-family:monospace">threadPerConnectionLowerLimit</span> parameters. The upper limit must
always be larger than the lower limit. The upper limit chooses the
number of connections at which time the ORB transitions to thread pool
mode; the lower limit selects the point at which the transition back
to thread per connection is made.</p><p>For example, setting the upper limit to 50 and the lower limit to 30
would mean that the first 49 connections would receive dedicated
threads. The 50th to arrive would trigger thread pooling. All future
connections to arrive would make use of threads from the pool. Note
that the existing dedicated threads continue to service their
connections until the connections are closed. If the number of
connections falls below 30, thread per connection is reactivated and
new connections receive their own dedicated threads (up to the limit
of 50 again). Once again, existing connections in thread pool mode
stay in that mode until they are closed.</p>
<!--TOC section id="sec101" Idle connection shutdown-->
<h2 id="sec101" class="section">6.5&#XA0;&#XA0;Idle connection shutdown</h2><!--SEC END --><p>
<a id="sec:connShutdown"></a></p><p>It is wasteful to leave a connection open when it has been left unused
for a considerable time. Too many idle connections could block out new
connections when the system runs out of spare communication channels.
For example, most platforms have a limit on the number of file handles
a process can open. Many platforms have a very small default limit
like 64. The value can often be increased to a maximum of a thousand
or more by changing the &#X2018;ulimit&#X2019; in the shell.</p><p>Every so often, a thread scans all open connections to see which are
idle. The scanning period (in seconds) is set with the
<span style="font-family:monospace">scanGranularity</span> parameter. The default is 5 seconds.</p><p>Outgoing connections (initiated by clients) and incoming connections
(initiated by servers) have separate idle timeouts. The timeouts are
set with the <span style="font-family:monospace">outConScanPeriod</span> and <span style="font-family:monospace">inConScanPeriod</span>
parameters respectively. The values are in seconds, and must be a
multiple of the scan granularity.</p><p>Beware that setting <span style="font-family:monospace">outConScanPeriod</span> or <span style="font-family:monospace">inConScanPeriod</span>
to be equal to (or less than) <span style="font-family:monospace">scanGranularity</span> means that
connections are considered candidates for closure immediately after
they are opened. That can mean that the connections are closed before
any calls have been sent through them. If oneway calls are used, such
connection closure can result in silent loss of calls.</p>
<!--TOC subsection id="sec102" Interoperability Considerations-->
<h3 id="sec102" class="subsection">6.5.1&#XA0;&#XA0;Interoperability Considerations</h3><!--SEC END --><p>The IIOP specification allows both the client and the server to
shutdown a connection unilaterally. When one end is about to shutdown
a connection, it should send a <span style="font-family:monospace">CloseConnection</span> message to the
other end. It should also make sure that the message will reach the
other end before it proceeds to shutdown the connection.</p><p>The client should distinguish between an orderly and an abnormal
connection shutdown. When a client receives a <span style="font-family:monospace">CloseConnection</span>
message before the connection is closed, the condition is an orderly
shutdown. If the message is not received, the condition is an
abnormal shutdown. In an abnormal shutdown, the ORB should raise a
<span style="font-family:monospace">COMM_FAILURE</span> exception whereas in an orderly shutdown, the ORB
should <em>not</em> raise an exception and should try to re-establish a
new connection transparently.</p><p>omniORB implements these semantics completely. However, it is known
that some ORBs are not (yet) able to distinguish between an orderly
and an abnormal shutdown. Usually this is manifested as the client in
these ORBs seeing a <span style="font-family:monospace">COMM_FAILURE</span> occasionally when connected
to an omniORB server. The work-around is either to catch the exception
in the application code and retry, or to turn off the idle connection
shutdown inside the omniORB server.</p>
<!--TOC section id="sec103" Transports and endpoints-->
<h2 id="sec103" class="section">6.6&#XA0;&#XA0;Transports and endpoints</h2><!--SEC END --><p>
<a id="sec:endpoints"></a></p><p>omniORB can support multiple network transports. All platforms
(usually) have a TCP transport available. Unix platforms support a
Unix domain socket transport. Platforms with the OpenSSL library
available can support an SSL transport.</p><p>Servers must be configured in two ways with regard to transports: the
transports and interfaces on which they listen, and the details that
are published in IORs for clients to see. Usually the published
details will be the same as the listening details, but there are times
when it is useful to publish different information.</p><p>Details are selected with the <span style="font-family:monospace">endPoint</span> family of parameters.
The simplest is plain <span style="font-family:monospace">endPoint</span>, which chooses a transport and
interface details, and publishes the information in IORs. Endpoint
parameters are in the form of URIs, with a scheme name of
&#X2018;<span style="font-family:monospace">giop:</span>&#X2019;, followed by the transport name. Different transports
have different parameters following the transport.</p><p>TCP endpoints have the format:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:</span><span style="font-style:italic">&lt;host&gt;</span><span style="font-family:monospace">:</span><span style="font-style:italic">&lt;port&gt;</span>
</blockquote><p>The host must be a valid host name or IP address for the
server machine. It determines the network interface on which the
server listens. The port selects the TCP port to listen on, which must
be unoccupied. Either the host or port, or both can be left empty. If
the host is empty, the ORB publishes the IP address of the first
non-loopback network interface it can find (or the loopback if that is
the only interface), but listens on <em>all</em> network interfaces. If
the port is empty, the operating system chooses an <span style="font-style:italic">ephemeral</span>
port.</p><p>Multiple TCP endpoints can be selected, either to specify multiple
network interfaces on which to listen, or (less usefully) to select
multiple TCP ports on which to listen.</p><p>If no <span style="font-family:monospace">endPoint</span> parameters are set, the ORB assumes a single
parameter of <span style="font-family:monospace">giop:tcp::</span>, meaning IORs contain the address of
the first non-loopback network interface, the ORB listens on all
interfaces, and the OS chooses a port number.</p><p>SSL endpoints have the same format as TCP ones, except &#X2018;<span style="font-family:monospace">tcp</span>&#X2019;
is replaced with &#X2018;<span style="font-family:monospace">ssl</span>&#X2019;. Unix domain socket endpoints have the
format:</p><blockquote class="quote">
<span style="font-family:monospace">giop:unix:</span><span style="font-style:italic">&lt;filename&gt;</span>
</blockquote><p>where the filename is the name of the socket within the
filesystem. If the filename is left blank, the ORB chooses a name
based on the process id and a timestamp.</p><p>To listen on an endpoint without publishing it in IORs, specify it
with the <span style="font-family:monospace">endPointNoPublish</span> configuration parameter. See below
for more details about endpoint publishing.</p>
<!--TOC subsection id="sec104" Port ranges-->
<h3 id="sec104" class="subsection">6.6.1&#XA0;&#XA0;Port ranges</h3><!--SEC END --><p>Sometimes it is useful to restrict a server to listen on one of a
range of ports, rather than pinning it to one particular port or
allowing the OS to choose an ephemeral port. omniORB 4.2 introduces
the ability to specify a range of ports using a hyphen. e.g. to
listen on a port between 5000 and 5010 inclusive:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp::5000-5010</span>
</blockquote><p>omniORB randomly chooses a port in the range. If it finds that the
chosen port is already occupied, it keeps trying different ports until
it finds a free one. If all the ports in the range are occupied, it
throws <span style="font-family:monospace">CORBA::INITIALIZE</span>.</p>
<!--TOC subsection id="sec105" IPv6-->
<h3 id="sec105" class="subsection">6.6.2&#XA0;&#XA0;IPv6</h3><!--SEC END --><p>On platforms where it is available, omniORB supports IPv6. On most
Unix platforms, IPv6 sockets accept both IPv6 and IPv4 connections, so
omniORB&#X2019;s default <span style="font-family:monospace">giop:tcp::</span> endpoint accepts both IPv4 and
IPv6 connections. On Windows versions before Windows Vista, each
socket type only accepts incoming connections of the same type, so an
IPv6 socket cannot be used with IPv4 clients. For this reason, the
default <span style="font-family:monospace">giop:tcp::</span> endpoint only listens for IPv4 connections.
Since endpoints with a specific host name or address only listen on a
single network interface, they are inherently limited to just one
protocol family.</p><p>To explicitly ask for just IPv4 or just IPv6, an endpoint with the
wildcard address for the protocol family should be used. For IPv4, the
wildcard address is &#X2018;<span style="font-family:monospace">0.0.0.0</span>&#X2019;, and for IPv6 it is &#X2018;<span style="font-family:monospace">::</span>&#X2019;.
So, to listen for IPv4 connections on all IPv4 network interfaces, use
an endpoint of:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:0.0.0.0:</span>
</blockquote><p>All IPv6 addresses contain colons, so the address portion in
URIs must be contained within <span style="font-family:monospace">[]</span> characters. Therefore, to
listen just for IPv6 connections on all IPv6 interfaces, use the
somewhat cryptic:</p><blockquote class="quote">
<span style="font-family:monospace">giop:tcp:[::]:</span>
</blockquote><p>To listen for both IPv4 and IPv6 connections on Windows
versions prior to Vista, both endpoints must be explicitly provided.</p>
<!--TOC subsubsection id="sec106" Link local addresses-->
<h4 id="sec106" class="subsubsection">6.6.2.1&#XA0;&#XA0;Link local addresses</h4><!--SEC END --><p>In IPv6, all network interfaces are assigned a <span style="font-style:italic">link local</span>
address, starting with the digits <span style="font-family:monospace">fe80</span>. The link local address
is only valid on the same &#X2018;link&#X2019; as the interface, meaning directly
connected to the interface, or possibly on the same subnet, depending
on how the network is switched. To connect to a server&#X2019;s link local
address, a client has to know which of its network interfaces is on
the same link as the server. Since there is no way for omniORB to know
which local interface a remote link local address may be connected to,
and in extreme circumstances may even end up contacting the wrong
server if it picks the wrong interface, link local addresses are not
considered valid. Servers do not publish link local addresses in their
IORs.</p>
<!--TOC subsection id="sec107" Endpoint publishing-->
<h3 id="sec107" class="subsection">6.6.3&#XA0;&#XA0;Endpoint publishing</h3><!--SEC END --><p>For clients to be able to connect to a server, the server publishes
endpoint information in its IORs (Interoperable Object References).
Normally, omniORB publishes the first available address for each of
the endpoints it is listening on.</p><p>The endpoint information to publish is determined by the
<span style="font-family:monospace">endPointPublish</span> configuration parameter. It contains a
comma-separated list of publish rules. The rules are applied in turn
to each of the configured endpoints; if a rule matches an endpoint, it
causes one or more endpoints to be published.</p><p>The following core rules are supported:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">addr</span></td><td style="vertical-align:top;text-align:left;" >the first natural address of the endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">ipv4</span></td><td style="vertical-align:top;text-align:left;" >the first IPv4 address of a TCP or SSL endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">ipv6</span></td><td style="vertical-align:top;text-align:left;" >the first IPv6 address of a TCP or SSL endpoint</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name</span></td><td style="vertical-align:top;text-align:left;" >the first address that can be resolved to a name</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">hostname</span></td><td style="vertical-align:top;text-align:left;" >the result of the gethostname() system call</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">fqdn</span></td><td style="vertical-align:top;text-align:left;" >the fully-qualified domain name</td></tr>
</table><p>The core rules can be combined using the vertical bar operator to
try several rules in turn until one succeeds. e.g:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name|ipv6|ipv4</span></td><td style="vertical-align:top;text-align:left;" >the name of the endpoint if it has one;
	failing that, its first IPv6 address;
	failing that, its first IPv4 address.
</td></tr>
</table><p>Multiple rules can be combined using the comma operator to
publish more than one endpoint. e.g.</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">name,addr</span></td><td style="vertical-align:top;text-align:left;" >the name of the endpoint (if it has one),
followed by its first address.
</td></tr>
</table><p>For endpoints with multiple addresses (e.g. TCP endpoints on
multi-homed machines), the <span style="font-family:monospace">all()</span> manipulator causes all
addresses to be published. e.g.:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name)</span></td><td style="vertical-align:top;text-align:left;" >all addresses that resolve to names are published</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name|addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published by name if they have
one, address otherwise.</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name,addr)</span></td><td style="vertical-align:top;text-align:left;" >all addresses are published by name (if they
have one), and by address.</td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">all(name), all(addr)</span></td><td style="vertical-align:top;text-align:left;" >first the names of all addresses are published,
followed by all the addresses.</td></tr>
</table><p>A specific endpoint can be published by giving its endpoint URI,
even if the server is not listening on that endpoint. e.g.:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">giop:tcp:not.my.host:12345</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;" ><span style="font-family:monospace">giop:unix:/not/my/socket-file</span></td></tr>
</table><p>If the host or port number for a TCP or SSL URI are missed out,
they are filled in with the details from each listening TCP/SSL
endpoint. This can be used to publish a different name for a
TCP/SSL endpoint that is using an ephemeral port, for example.</p><p>omniORB 4.0 supported two options related to endpoint publishing that
are superseded by the <span style="font-family:monospace">endPointPublish</span> parameter, and so are now
deprecated. Setting <span style="font-family:monospace">endPointPublishAllIFs</span> to 1 is equivalent to
setting <span style="font-family:monospace">endPointPublish</span> to &#X2018;<span style="font-family:monospace">all(addr)</span>&#X2019;. The
<span style="font-family:monospace">endPointNoListen</span> parameter is equivalent to adding endpoint
URIs to the <span style="font-family:monospace">endPointPublish</span> parameter.</p>
<!--TOC section id="sec108" Connection selection and acceptance-->
<h2 id="sec108" class="section">6.7&#XA0;&#XA0;Connection selection and acceptance</h2><!--SEC END --><p>In the face of IORs containing details about multiple different
endpoints, clients have to know how to choose the one to use to
connect a server. Similarly, servers may wish to restrict which
clients can connect to particular transports. This is achieved with
<span style="font-style:italic">transport rules</span>.</p>
<!--TOC subsection id="sec109" Client transport rules-->
<h3 id="sec109" class="subsection">6.7.1&#XA0;&#XA0;Client transport rules</h3><!--SEC END --><p>
<a id="sec:clientRule"></a></p><p>The <span style="font-family:monospace">clientTransportRule</span> parameter is used to filter and
prioritise the order in which transports specified in an IOR are
tried. Each rule has the form:</p><blockquote class="quote">
<span style="font-style:italic">&lt;address mask&gt; [action]+</span>
</blockquote><p>The address mask can be one of</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >1.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">localhost</span></td><td style="vertical-align:top;text-align:left;" >The address of this machine</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
2.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">w.x.y.z</span><span style="font-family:monospace">/</span><span style="font-style:italic">m1.m2.m3.m4</span></td><td style="vertical-align:top;text-align:left;" >An IPv4 address
with bits selected by the mask, e.g.
 <span style="font-family:monospace">172.16.0.0/255.240.0.0</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
3.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">w.x.y.z</span><span style="font-family:monospace">/</span><span style="font-style:italic">prefixlen</span></td><td style="vertical-align:top;text-align:left;" >An IPv4 address with
<span style="font-style:italic">prefixlen</span> significant bits, e.g.
 <span style="font-family:monospace">172.16.2.0/24</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
4.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-style:italic">a:b:c:d:e:f:g:h</span><span style="font-family:monospace">/</span><span style="font-style:italic">prefixlen</span></td><td style="vertical-align:top;text-align:left;" >An IPv6
address with <span style="font-style:italic">prefixlen</span> significant bits, e.g.
 <span style="font-family:monospace">3ffe:505:2:1::/64</span></td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >
5.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">*</span></td><td style="vertical-align:top;text-align:left;" >Wildcard that matches any address</td></tr>
</table><p>The action is one or more of the following:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >1.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">none</span></td><td style="vertical-align:top;text-align:left;" >Do not use this address</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >2.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">tcp</span></td><td style="vertical-align:top;text-align:left;" >Use a TCP transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >3.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">ssl</span></td><td style="vertical-align:top;text-align:left;" >Use an SSL transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >4.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">unix</span></td><td style="vertical-align:top;text-align:left;" >Use a Unix socket transport</td></tr>
<tr><td style="vertical-align:top;text-align:left;white-space:nowrap" >5.</td><td style="vertical-align:top;text-align:left;white-space:nowrap" ><span style="font-family:monospace">bidir</span></td><td style="vertical-align:top;text-align:left;" >Connections to this address can be used
bidirectionally (see section&#XA0;<a href="#sec%3Abidir">6.8</a>)</td></tr>
</table><p>The transport-selecting actions form a prioritised list, so
an action of &#X2018;<span style="font-family:monospace">unix,ssl,tcp</span>&#X2019; means to use a Unix transport if
there is one, failing that a SSL transport, failing <em>that</em> a TCP
transport. In the absence of any explicit rules, the client uses the
implicit rule of &#X2018;<span style="font-family:monospace">* unix,ssl,tcp</span>&#X2019;.</p><p>If more than one rule is specified, they are prioritised in the order
they are specified. For example, the configuration file might contain:</p><pre class="verbatim">  clientTransportRule = 192.168.1.0/255.255.255.0  unix,tcp
  clientTransportRule = 172.16.0.0/255.240.0.0     unix,tcp
                      =       *                    none
</pre><p>This would be useful if there is a fast network
(192.168.1.0) which should be used in preference to another network
(172.16.0.0), and connections to other networks are not permitted at
all.</p><p>In general, the result of filtering the endpoint specifications in an
IOR with the client transport rule will be a prioritised list of
transports and networks. (If the transport rules do not prioritise one
endpoint over another, the order the endpoints are listed in the IOR
is used.) When trying to contact an object, the ORB tries its
possible endpoints in turn, until it finds one with which it can
contact the object. Only after it has unsuccessfully tried all
permissible endpoints will it raise a <span style="font-family:monospace">TRANSIENT</span> exception to
indicate that the connect failed.</p>
<!--TOC subsection id="sec110" Server transport rules-->
<h3 id="sec110" class="subsection">6.7.2&#XA0;&#XA0;Server transport rules</h3><!--SEC END --><p>
<a id="sec:serverRule"></a></p><p>Server transport rules have the same format as client transport
rules. Rather than being used to select which of a set of ways to
contact a machine, they are used to determine whether or not to accept
connections from particular clients. In this example, we only allow
connections from our intranet:</p><pre class="verbatim">  serverTransportRule = localhost                  unix,tcp,ssl
                      = 172.16.0.0/255.240.0.0     tcp,ssl
                      = *                          none
</pre><p>And in this one, we accept only SSL connections if the
client is not on the intranet:</p><pre class="verbatim">  serverTransportRule = localhost                  unix,tcp,ssl
                      = 172.16.0.0/255.240.0.0     tcp,ssl
                      = *                          ssl,bidir
</pre><p>In the absence of any explicit rules, the server uses the
implicit rule of &#X2018;<span style="font-family:monospace">* unix,ssl,tcp</span>&#X2019;, meaning any kind of
connection is accepted from any client.</p>
<!--TOC section id="sec111" Bidirectional GIOP-->
<h2 id="sec111" class="section">6.8&#XA0;&#XA0;Bidirectional GIOP</h2><!--SEC END --><p>
<a id="sec:bidir"></a></p><p>omniORB supports bidirectional GIOP, which allows callbacks to be made
using a connection opened by the original client, rather than the
normal model where the server opens a new connection for the callback.
This is important for negotiating firewalls, since they tend not to
allow connections back on arbitrary ports.</p><p>There are several steps required for bidirectional GIOP to be enabled
for a callback. Both the client and server must be configured
correctly. On the client side, these conditions must be met:</p><ul class="itemize"><li class="li-itemize">The <span style="font-family:monospace">offerBiDirectionalGIOP</span> parameter must be set to <span style="font-family:monospace">true</span>. 
</li><li class="li-itemize">The client transport rule for the target server must contain the
<span style="font-family:monospace">bidir</span> action.
</li><li class="li-itemize">The POA containing the callback object (or objects) must have
been created with a <span style="font-family:monospace">BidirectionalPolicy</span> value of
<span style="font-family:monospace">BOTH</span>.</li></ul><p>On the server side, these conditions must be met:</p><ul class="itemize"><li class="li-itemize">The <span style="font-family:monospace">acceptBiDirectionalGIOP</span> parameter must be set to <span style="font-family:monospace">true</span>. 
</li><li class="li-itemize">The server transport rule for the requesting client must contain
the <span style="font-family:monospace">bidir</span> action.
</li><li class="li-itemize">The POA hosting the object contacted by the client must have
been created with a <span style="font-family:monospace">BidirectionalPolicy</span> value of
<span style="font-family:monospace">BOTH</span>.</li></ul>
<!--TOC section id="sec112" TLS / SSL transport-->
<h2 id="sec112" class="section">6.9&#XA0;&#XA0;TLS / SSL transport</h2><!--SEC END --><p>omniORB supports a TLS / SSL transport, using OpenSSL. It is only
built if OpenSSL is available. On platforms using Autoconf, it is
autodetected in many locations, or its location can be given with the
<span style="font-family:monospace">--with-openssl=</span> argument to <span style="font-family:monospace">configure</span>. On other
platforms, the <span style="font-family:monospace">OPEN_SSL_ROOT</span> make variable must be set in the
platform file.</p><p>To use the SSL transport, you must link your application with the
<span style="font-family:monospace">omnisslTP</span> library, and correctly set up certificates. See the
<span style="font-family:monospace">src/examples/ssl_echo</span> directory for an example. That directory
contains a <span style="font-family:monospace">README</span> file with more details.</p>
<!--TOC subsection id="sec113" Self-signed certificate authority-->
<h3 id="sec113" class="subsection">6.9.1&#XA0;&#XA0;Self-signed certificate authority</h3><!--SEC END --><p>By default, omniORB configures OpenSSL to require both clients and
servers to have certificates that are signed by a Certificate
Authority (CA). It is possible to use a public CA to obtain keys that
can be independently verified, but for many purposes, it is sufficient
to use a private CA to sign all the keys in use in an application. The
following is a brief description of how to become your own certificate
authority and issue and sign certificates, using the OpenSSL command
line tools.</p><p>Before starting, find the default <span style="font-family:monospace">openssl.cnf</span> file that was
installed with OpenSSL, copy it to a suitable location, and edit it as
you feel appropriate. Now, build a certificate directory structure,
authority key and certificate:</p><pre class="verbatim">  mkdir demoCA demoCA/private demoCA/newcerts

  openssl req -config openssl.cnf -x509 -newkey rsa:2048 \
     -keyout demoCA/private/cakey.pem -out demoCA/cacert.pem -days 3650

  echo 01 &gt;demoCA/serial
  touch demoCA/index.txt
</pre><p>Next, issue a key request and sign it:</p><pre class="verbatim">  openssl req -config openssl.cnf -new -keyout server_key.pem \
     -out server_req.pem -days 3650

  openssl ca -config openssl.cnf -policy policy_anything \
     -out server_cert.pem -in server_req.pem 
</pre><p>Amongst other things, you now have a server key file in
<span style="font-family:monospace">server_key.pem</span> and a certificate in <span style="font-family:monospace">server_cert.pem</span>. To
make a single file containing both the key and the certificate,
suitable for use in omniORB, concatenate the key and certificate files
together. You can skip the human-readable(ish) text in the
certificate file before the <code>-----BEGIN CERTIFICATE-----</code> marker.</p><p>If need be, create more certificates for servers and clients in the
same way.</p>
<!--TOC section id="sec114" ZIOP-->
<h2 id="sec114" class="section">6.10&#XA0;&#XA0;ZIOP</h2><!--SEC END --><p>omniORB has support for ZIOP, which compresses transmitted
messages. To use it, link with the <span style="font-family:monospace">omniZIOP4</span> library.</p><p>On Unix platforms, ZIOP support is automatically enabled if the
configure script detects zlib. To enable it on Windows, set the
<span style="font-family:monospace">EnableZIOP</span> make variable in the platform configuration file.</p><p>omniORB has an almost complete implementation of the ZIOP
specification, with the following extensions and differences:</p><ol class="enumerate" type=1><li class="li-enumerate">
To avoid a dependency on <span style="font-family:monospace">CORBA::Any</span>, compression policies
can be obtained with functions in the <span style="font-family:monospace">omniZIOP</span> namespace,
rather than with the standard <span style="font-family:monospace">orb-&gt;create_policy()</span>. See
<span style="font-family:monospace">include/omniORB4/omniZIOP.h</span> for details. To use <span style="font-family:monospace">Any</span>
with the standard <span style="font-family:monospace">orb-&gt;create_policy()</span>, link with the
<span style="font-family:monospace">omniZIOPDynamic4</span> library in addition to <span style="font-family:monospace">omniZIOP4</span>.</li><li class="li-enumerate">Client-side policies are global, set with
<span style="font-family:monospace">omniZIOP::setGlobalPolicies()</span>.
<span style="font-family:monospace">CORBA::Object::_set_policy_overrides()</span> is not supported.</li><li class="li-enumerate">POAs can be given ZIOP policies as shown in the
<span style="font-family:monospace">src/examples/ziop/ziop_impl.cc</span>, but they can also use the
global policies set with <span style="font-family:monospace">omniZIOP::setGlobalPolicies()</span>. This
is useful to apply ZIOP policies to the RootPOA or omniINSPOA.
</li></ol><p>In addition to the standard policies, whether or not to
enable ZIOP is determined by client and server transport rules. For a
client to use ZIOP, the matching client transport rule must include
&#X2018;<span style="font-family:monospace">ziop</span>&#X2019;; similarly, for a server to use ZIOP, the matching
server transport rule must include &#X2018;<span style="font-family:monospace">ziop</span>&#X2019;. e.g. to use the
examples:</p><pre class="verbatim">  ziop_impl -ORBserverTransportRule "* unix,ssl,tcp,ziop"

  ziop_clt -ORBclientTransportRule "* unix,ssl,tcp,ziop" IOR:...
</pre><p>This allows you to enable ZIOP for WAN links, but disable it
for LAN communication, for example.</p>
<!--TOC subsection id="sec115" Forcing ZIOP Policies-->
<h3 id="sec115" class="subsection">6.10.1&#XA0;&#XA0;Forcing ZIOP Policies</h3><!--SEC END --><p>The fact that a server supports ZIOP is encoded in its IORs. This
means that if a client uses a <span style="font-family:monospace">corbaloc</span> URI to reference an
object, the object reference does not contain ZIOP details, and thus
the communication cannot use ZIOP. If a client is absolutely certain
that a server supports ZIOP, it can extend an object reference with
ZIOP details using <span style="font-family:monospace">omniZIOP::setServerPolicies()</span>. Using the new
object reference, the client will be able to make ZIOP calls.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniZIOP</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">setServerPolicies</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">PolicyList</span><span style="font-size:small">&amp; </span><span style="font-size:small">policies</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Creating a ZIOP-enabling object reference in this way is dangerous!
If the server does not actually support ZIOP, it will receive
compressed messages that it cannot handle. A well-behaved server will
throw a <span style="font-family:monospace">CORBA::MARSHAL</span> exception in response, or perhaps just
drop the invalid connection.</p>
<!--TOC section id="sec116" Connection Management Extension-->
<h2 id="sec116" class="section">6.11&#XA0;&#XA0;Connection Management Extension</h2><!--SEC END --><p>The <span style="font-family:monospace">omniConnectionMgmt</span> library provides an omniORB-specific
extension for application-level connection management. Its purpose is
to allow clients and servers to negotiate private GIOP connections,
and to control how the connections are used in multi-threaded
situations.</p><p>The <span style="font-family:monospace">omniConnectionMgmt</span> library has two functions, defined in
<span style="font-family:monospace">include/omniORB4/omniConnectionMgmt.h</span>:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">omniConnectionMgmt</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">init</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">makeRestrictedReference</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small">      </span><span style="font-size:small">connection_id</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small">      </span><span style="font-size:small">max_connections</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small">      </span><span style="font-size:small">max_threads</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">    </span><span style="font-size:small">data_batch</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">    </span><span style="font-size:small">permit_interleaved</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                          </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">    </span><span style="font-size:small">server_hold_open</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The <span style="font-family:monospace">init()</span> function must be called before
<span style="font-family:monospace">CORBA::ORB_init()</span> in every process that is to take part in the
connection management.</p><p>The <span style="font-family:monospace">makeRestrictedReference()</span> function is the single entry-point to
the connection management functionality. It builds an annotated object
reference that contains information for the connection management
system. It returns a new reference, leaving the original object
reference unchanged.</p>
<!--TOC subsection id="sec117" Client-side parameters-->
<h3 id="sec117" class="subsection">6.11.1&#XA0;&#XA0;Client-side parameters</h3><!--SEC END --><p>These parameters affect the client side of a connection:</p><p><span style="font-family:monospace">connection_id</span></p><p>This number identifies the private connection set. All object
references with the same <span style="font-family:monospace">connection_id</span> will share the same set
of GIOP connections. Object references with different connection ids
are guaranteed to use different connections from each other, and from
object references that have not been annotated with
<span style="font-family:monospace">makeRestrictedReference()</span>.</p><p><span style="font-family:monospace">max_connections</span></p><p>This parameter overrides the omniORB <span style="font-family:monospace">maxGIOPConnectionPerServer</span>
configuration parameter for the given <span style="font-family:monospace">connection_id</span>. It
determines the maximum number of separate GIOP connections that will
be opened to the object&#X2019;s server to service concurrent calls. It is
common to set this value to 1, indicating that only one connection
will be used for the given <span style="font-family:monospace">connection_id</span>. Note that this
parameter can only be used to reduce the default
<span style="font-family:monospace">maxGIOPConnectionPerServer</span> value, not increase it.</p><p><span style="font-family:monospace">data_batch</span></p><p>omniORB usually configures its TCP connections to disable Nagle&#X2019;s
algorithm, which batches small messages together into single IP
packages, since that is best for the usual CORBA usage pattern of
two-way requests. Setting this parameter to true overrides that, and
enables Nagle&#X2019;s algorithm on TCP connections or equivalent
functionality on other transports. This can increase throughput if a
client is sending a large number of small oneway calls.</p><p><span style="font-family:monospace">permit_interleaved</span></p><p>This parameter overrides the <span style="font-family:monospace">oneCallPerConnection</span> configuration
parameter that determines whether multi-threaded clients can
interleave calls on a single connection, issuing a new request message
while a previous request is still waiting for a reply. If
<span style="font-family:monospace">permit_interleaved</span> is true, clients can interleave messages;
if it is false, they cannot.</p>
<!--TOC subsection id="sec118" Server-side parameters-->
<h3 id="sec118" class="subsection">6.11.2&#XA0;&#XA0;Server-side parameters</h3><!--SEC END --><p>These parameters affect the client side of a connection:</p><p><span style="font-family:monospace">max_threads</span></p><p>This parameter overrides the global
<span style="font-family:monospace">maxServerThreadPerConnection</span> configuration parameter that
determines the maximum number of concurrent threads the server will
use to service requests coming from a connection. Note that this
parameter is only relevant if either the client permits interleaved
calls, or if oneway operations are used, since those are the only
circumstances under which the server can receive a new request on a
connection while already handling a request. As with the
<span style="font-family:monospace">max_connections</span> client-side parameter, this parameter can only
reduce the default number of threads, not increase it.</p><p><span style="font-family:monospace">server_hold_open</span></p><p>Normally, both clients and servers can decide to close a GIOP
connection at any time. When using normal two-way calls, this is no
problem since if a server closes a connection, the client is
guaranteed to notice it when it waits for a reply, and can retry the
call if necessary. With oneway calls, however, if a server closes a
connection just as the client is sending a request, the client will
not know whether the oneway call was received or not, and the call
will potentially be lost. By setting the <span style="font-family:monospace">server_hold_open</span>
parameter to true, the server will not close the connection, relying
on the client to do so. In that case, oneway calls will not be lost
unless there is a network problem that breaks the GIOP connection.</p>
<!--TOC subsection id="sec119" Usage-->
<h3 id="sec119" class="subsection">6.11.3&#XA0;&#XA0;Usage</h3><!--SEC END --><p>The omniConnectionMgmt extension is very easy to use&#X2014;simply call the
<span style="font-family:monospace">init()</span> method in all processes involved, then restrict references
as required. The <span style="font-family:monospace">makeRestrictedReference()</span> function adds profile
information to the object reference&#X2019;s IOR, meaning that the parameters
become part of the object reference and are transmitted along with
it. In other words, a server can create a restricted reference and
send it to a client, and the client will automatically make use of the
restricted parameters when it invokes operations on the object
reference. Alternatively, a client can restrict a normal reference it
receives, in order to change its own behaviour.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note11" href="#text11">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">GIOP 1.2 supports
&#X2018;bidirectional GIOP&#X2019;, which permits the r&#XF4;les to be reversed.</div></dd><dt class="dt-thefootnotes"><a id="note12" href="#text12">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Or
<span style="font-family:monospace">CORBA::TRANSIENT</span> if the backwards-compatibility
<span style="font-family:monospace">throwTransientOnTimeout</span> parameter is set to <span style="font-family:monospace">1</span>.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec120" Interoperable Naming Service-->
<h1 id="sec120" class="chapter">Chapter&#XA0;7&#XA0;&#XA0;Interoperable Naming Service</h1><!--SEC END --><p>
<a id="chap:ins"></a></p><p>omniORB supports the Interoperable Naming Service (INS). The following
is a summary of its facilities.</p>
<!--TOC section id="sec121" Object URIs-->
<h2 id="sec121" class="section">7.1&#XA0;&#XA0;Object URIs</h2><!--SEC END --><p>As well as accepting IOR-format strings, <span style="font-family:monospace">ORB::string_to_object()</span>
also supports two Uniform Resource Identifier (URI)&#XA0;[<a href="#rfc2396">BLFIM98</a>]
formats, which can be used to specify objects in a convenient
human-readable form. IOR-format strings are now also considered URIs.</p>
<!--TOC subsection id="sec122" corbaloc-->
<h3 id="sec122" class="subsection">7.1.1&#XA0;&#XA0;corbaloc</h3><!--SEC END --><p><span style="font-family:monospace">corbaloc</span> URIs allow you to specify object references which
can be contacted by IIOP, or found through
<span style="font-family:monospace">ORB::resolve_initial_references()</span>. To specify an IIOP object
reference, you use a URI of the form:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:</span>&lt;<span style="font-style:italic">host</span>&gt;<span style="font-family:monospace">:</span>&lt;<span style="font-style:italic">port</span>&gt;<span style="font-family:monospace">/</span>&lt;<span style="font-style:italic">object key</span>&gt;
</blockquote><p>for example:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:myhost.example.com:1234/MyObjectKey</span>
</blockquote><p>which specifies an object with key &#X2018;MyObjectKey&#X2019; within a
process running on myhost.example.com listening on port 1234. Object
keys containing non-ASCII characters can use the standard URI %
escapes:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc:iiop:myhost.example.com:1234/My</span><span style="font-family:monospace">%</span><span style="font-family:monospace">efObjectKey</span>
</blockquote><p>denotes an object key with the value 239 (hex ef) in the
third octet.</p><p>The protocol name &#X2018;<span style="font-family:monospace">iiop</span>&#X2019; can be abbreviated to the empty
string, so the original URI can be written:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com:1234/MyObjectKey</span>
</blockquote><p>The IANA has assigned port number 2809<sup><a id="text13" href="#note13">1</a></sup> for use by <span style="font-family:monospace">corbaloc</span>, so if
the server is listening on that port, you can leave the port number
out. The following two URIs refer to the same object:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com:2809/MyObjectKey</span><br>
<span style="font-family:monospace">corbaloc::myhost.example.com/MyObjectKey</span>
</blockquote><p>You can specify an object which is available at more than
one location by separating the locations with commas:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::myhost.example.com,:localhost:1234/MyObjectKey</span>
</blockquote><p>Note that you must restate the protocol for each address,
hence the &#X2018;<span style="font-family:monospace">:</span>&#X2019; before &#X2018;<span style="font-family:monospace">localhost</span>&#X2019;. It could
equally have been written &#X2018;<span style="font-family:monospace">iiop:localhost</span>&#X2019;.</p><p>You can also specify an IIOP version number:</p><blockquote class="quote">
<span style="font-family:monospace">corbaloc::1.2@myhost.example.com/MyObjectKey</span>
</blockquote><p>Specifying IIOP versions above 1.0 is slightly risky since
higher versions make use of various information stored in IORs that is
not present in a corbaloc URI. It is generally best to contact initial
corbaloc objects with IIOP 1.0, and rely on higher versions for all
other object references.</p>
<!--TOC subsection id="sec123" Other transports-->
<h3 id="sec123" class="subsection">7.1.2&#XA0;&#XA0;Other transports</h3><!--SEC END --><p>The only transport specified in the CORBA standard is <span style="font-family:monospace">iiop</span>,
but omniORB also supports the following extensions:</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ssliop</span></span></dt><dd class="dd-description"><br>
Equivalent semantics to <span style="font-family:monospace">iiop</span>, but the server is contacted
using SSL / TLS. As with <span style="font-family:monospace">iiop</span>, the address details are of
the form <span style="font-family:monospace"><span style="font-style:italic">host</span></span><span style="font-family:monospace">:</span><span style="font-family:monospace"><span style="font-style:italic">port</span></span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">omniunix</span></span></dt><dd class="dd-description"><br>
The omniORB Unix domain socket transport. The address details are of
the form <span style="font-family:monospace"><span style="font-style:italic">filename</span></span>.</dd></dl>
<!--TOC subsection id="sec124" Resolve initial references-->
<h3 id="sec124" class="subsection">7.1.3&#XA0;&#XA0;Resolve initial references</h3><!--SEC END --><p>A <span style="font-family:monospace">corbaloc:</span> can also specify a call to
<span style="font-family:monospace">resolve_initial_references()</span>. This</p><div class="lstlisting"><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"corbaloc:rir:/NameService"</span></span><span style="font-size:small">);</span></div><p>is identical in behaviour to</p><div class="lstlisting"><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span></div>
<!--TOC subsection id="sec125" corbaname-->
<h3 id="sec125" class="subsection">7.1.4&#XA0;&#XA0;corbaname</h3><!--SEC END --><p>
<a id="sec:corbaname"></a></p><p><span style="font-family:monospace">corbaname</span> URIs cause <span style="font-family:monospace">string_to_object()</span> to look-up a
name in a CORBA Naming service. They are an extension of the
<span style="font-family:monospace">corbaloc</span> syntax:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname:</span>&lt;<span style="font-style:italic">corbaloc location</span>&gt;<span style="font-family:monospace">/</span>&lt;<span style="font-style:italic">object key</span>&gt;<span style="font-family:monospace">#</span>&lt;<span style="font-style:italic">stringified name</span>&gt;
</blockquote><p>for example:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost/NameService#project/example/echo.obj</span><br>
<span style="font-family:monospace">corbaname:rir:/NameService#project/example/echo.obj</span>
</blockquote><p>The object found with the <span style="font-family:monospace">corbaloc</span>-style portion
must be of type <span style="font-family:monospace">CosNaming::NamingContext</span>, or something
derived from it. If the object key (or <span style="font-family:monospace">rir</span> name) is
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019;, it can be left out:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost#project/example/echo.obj</span><br>
<span style="font-family:monospace">corbaname:rir:#project/example/echo.obj</span>
</blockquote><p>The stringified name portion can also be left out, in which
case the URI denotes the <span style="font-family:monospace">CosNaming::NamingContext</span> which would
have been used for a look-up:</p><blockquote class="quote">
<span style="font-family:monospace">corbaname::myhost.example.com</span><br>
<span style="font-family:monospace">corbaname:rir:</span>
</blockquote><p>The first of these examples is the easiest way of specifying
the location of a naming service.</p>
<!--TOC section id="sec126" Configuring resolve_initial_references-->
<h2 id="sec126" class="section">7.2&#XA0;&#XA0;Configuring resolve_initial_references</h2><!--SEC END --><p>
<a id="sec:insargs"></a></p><p>The INS specifies two standard command line arguments which provide a
portable way of configuring <span style="font-family:monospace">ORB::resolve_initial_references()</span>:</p>
<!--TOC subsection id="sec127" ORBInitRef-->
<h3 id="sec127" class="subsection">7.2.1&#XA0;&#XA0;ORBInitRef</h3><!--SEC END --><p><span style="font-family:monospace">-ORBInitRef</span> takes an argument of the form
&lt;<span style="font-style:italic">ObjectId</span>&gt;<span style="font-family:monospace">=</span>&lt;<span style="font-style:italic">ObjectURI</span>&gt;. So, for example,
with command line arguments of:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBInitRef NameService=corbaname::myhost.example.com</span>
</blockquote><p><span style="font-family:monospace">resolve_initial_references("NameService")</span> will
return a reference to the object with key &#X2018;NameService&#X2019; available on
myhost.example.com, port 2809. Since IOR-format strings are considered
URIs, you can also say things like:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBInitRef NameService=IOR:00ff...</span>
</blockquote>
<!--TOC subsection id="sec128" ORBDefaultInitRef-->
<h3 id="sec128" class="subsection">7.2.2&#XA0;&#XA0;ORBDefaultInitRef</h3><!--SEC END --><p><span style="font-family:monospace">-ORBDefaultInitRef</span> provides a prefix string which is used to
resolve otherwise unknown names. When
<span style="font-family:monospace">resolve_initial_references()</span> is unable to resolve a name which
has been specifically configured (with <span style="font-family:monospace">-ORBInitRef</span>), it
constructs a string consisting of the default prefix, a &#X2018;<span style="font-family:monospace">/</span>&#X2019;
character, and the name requested. The string is then fed to
<span style="font-family:monospace">string_to_object()</span>. So, for example, with a command line of:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBDefaultInitRef corbaloc::myhost.example.com</span>
</blockquote><p>a call to <span style="font-family:monospace">resolve_initial_references("MyService")</span>
will return the object reference denoted by
&#X2018;<span style="font-family:monospace">corbaloc::myhost.example.com/MyService</span>&#X2019;.</p><p>Similarly, a <span style="font-family:monospace">corbaname</span> prefix can be used to cause
look-ups in the naming service. Note, however, that since a
&#X2018;<span style="font-family:monospace">/</span>&#X2019; character is always added to the prefix, it is
impossible to specify a look-up in the root context of the naming
service&#X2014;you have to use a sub-context, like:</p><blockquote class="quote">
<span style="font-family:monospace">-ORBDefaultInitRef corbaname::myhost.example.com#services</span>
</blockquote>
<!--TOC section id="sec129" omniNames-->
<h2 id="sec129" class="section">7.3&#XA0;&#XA0;omniNames</h2><!--SEC END -->
<!--TOC subsection id="sec130" NamingContextExt-->
<h3 id="sec130" class="subsection">7.3.1&#XA0;&#XA0;NamingContextExt</h3><!--SEC END --><p>omniNames supports the extended <span style="font-family:monospace">CosNaming::NamingContextExt</span>
interface:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">CosNaming</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">NamingContextExt</span><span style="font-size:small"> : </span><span style="font-size:small">NamingContext</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">Address</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">URLString</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">StringName</span><span style="font-size:small">  </span><span style="font-size:small">to_string</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">n</span><span style="font-size:small">)        </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Name</span><span style="font-size:small">        </span><span style="font-size:small">to_name</span><span style="font-size:small">  (</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">sn</span><span style="font-size:small">) </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">exception</span></span><span style="font-size:small"> </span><span style="font-size:small">InvalidAddress</span><span style="font-size:small"> {};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">URLString</span><span style="font-size:small">   </span><span style="font-size:small">to_url</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Address</span><span style="font-size:small"> </span><span style="font-size:small">addr</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">sn</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">InvalidAddress</span><span style="font-size:small">, </span><span style="font-size:small">InvalidName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">Object</span></span><span style="font-size:small">      </span><span style="font-size:small">resolve_str</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">StringName</span><span style="font-size:small"> </span><span style="font-size:small">n</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">raises</span></span><span style="font-size:small">(</span><span style="font-size:small">NotFound</span><span style="font-size:small">, </span><span style="font-size:small">CannotProceed</span><span style="font-size:small">, </span><span style="font-size:small">InvalidName</span><span style="font-size:small">, </span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p><span style="font-family:monospace">to_string()</span> and <span style="font-family:monospace">to_name()</span> convert from <span style="font-family:monospace">CosNaming::Name</span>
sequences to flattened strings and vice-versa. Note that calling
these operations involves remote calls to the naming service, so they
are not particularly efficient. You can use the omniORB specific local
<span style="font-family:monospace">omniURI::nameToString()</span> and <span style="font-family:monospace">omniURI::stringToName()</span>
functions instead.</p><p>A <span style="font-family:monospace">CosNaming::Name</span> is stringified by separating name components
with &#X2018;<span style="font-family:monospace">/</span>&#X2019; characters. The <span style="font-family:monospace">kind</span> and <span style="font-family:monospace">id</span> fields of
each component are separated by &#X2018;<span style="font-family:monospace">.</span>&#X2019; characters. If the
<span style="font-family:monospace">kind</span> field is empty, the representation has no trailing
&#X2018;<span style="font-family:monospace">.</span>&#X2019;; if the <span style="font-family:monospace">id</span> is empty, the representation starts
with a &#X2018;<span style="font-family:monospace">.</span>&#X2019; character; if both <span style="font-family:monospace">id</span> and <span style="font-family:monospace">kind</span>
are empty, the representation is just a &#X2018;<span style="font-family:monospace">.</span>&#X2019;. The backslash
&#X2018;<span style="font-family:monospace">\</span>&#X2019; is used to escape the meaning of
&#X2018;<span style="font-family:monospace">/</span>&#X2019;, &#X2018;<span style="font-family:monospace">.</span>&#X2019; and &#X2018;<span style="font-family:monospace">\</span>&#X2019; itself.</p><p><span style="font-family:monospace">to_url()</span> takes a <span style="font-family:monospace">corbaloc</span> style address and key string
(but without the <span style="font-family:monospace">corbaloc:</span> part), and a stringified name,
and returns a <span style="font-family:monospace">corbaname</span> URI (incorrectly called a URL)
string, having properly escaped any invalid characters. The
specification does not make it clear whether or not the address string
should also be escaped by the operation; omniORB does not escape
it. For this reason, it is best to avoid calling <span style="font-family:monospace">to_url()</span> if the
address part contains escapable characters. To avoid remote calls,
omniORB provides the equivalent local function
<span style="font-family:monospace">omniURI::addrAndNameToURI()</span>.</p><p><span style="font-family:monospace">resolve_str()</span> is equivalent to calling <span style="font-family:monospace">to_name()</span> followed by
the inherited <span style="font-family:monospace">resolve()</span> operation. There are no string-based
equivalents of the various bind operations.</p>
<!--TOC subsection id="sec131" Use with corbaname-->
<h3 id="sec131" class="subsection">7.3.2&#XA0;&#XA0;Use with corbaname</h3><!--SEC END --><p>To make it easy to use omniNames with <span style="font-family:monospace">corbaname</span> URIs, it
starts with the default port of 2809, and an object key of
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019; for the root naming context.</p>
<!--TOC section id="sec132" omniMapper-->
<h2 id="sec132" class="section">7.4&#XA0;&#XA0;omniMapper</h2><!--SEC END --><p>omniMapper is a simple daemon which listens on port 2809 (or any other
port), and redirects IIOP requests for configured object keys to
associated persistent object references. It can be used to make a
naming service (even an old non-INS aware version of omniNames or
other ORB&#X2019;s naming service) appear on port 2809 with the object key
&#X2018;<span style="font-family:monospace">NameService</span>&#X2019;. The same goes for any other service you may
wish to specify, such as an interface repository. omniMapper is
started with a command line of:</p><blockquote class="quote">
<span style="font-family:monospace">omniMapper [-port </span>&lt;<span style="font-style:italic">port</span>&gt;<span style="font-family:monospace">] [-config </span>&lt;<span style="font-style:italic">config file</span>&gt;<span style="font-family:monospace">] [-v]</span>
</blockquote><p>The <span style="font-family:monospace">-port</span> option allows you to choose a port other
than 2809 to listen on. The <span style="font-family:monospace">-config</span> option specifies a
location for the configuration file. The default name is
<span style="font-family:monospace">/etc/omniMapper.cfg</span>, or <span style="font-family:monospace">C:\omniMapper.cfg</span> on
Windows. omniMapper does not normally print anything; the <span style="font-family:monospace">-v</span>
option makes it verbose so it prints configuration information and a
record of the redirections it makes, to standard output.</p><p>The configuration file is very simple. Each line contains a string to
be used as an object key, some white space, and an IOR (or any valid
URI) that it will redirect that object key to. Comments should be
prefixed with a &#X2018;<span style="font-family:monospace">#</span>&#X2019; character. For example:</p><blockquote class="quote">
<pre class="verbatim"># Example omniMapper.cfg
NameService         IOR:000f...
InterfaceRepository IOR:0100...
</pre>
</blockquote><p>omniMapper can either be run on a single machine, in much the same way
as omniNames, or it can be run on <em>every</em> machine, with a common
configuration file. That way, each machine&#X2019;s omniORB configuration
file could contain the line:</p><blockquote class="quote">
<pre class="verbatim">ORBDefaultInitRef corbaloc::localhost
</pre>
</blockquote>
<!--TOC section id="sec133" Creating objects with simple object keys-->
<h2 id="sec133" class="section">7.5&#XA0;&#XA0;Creating objects with simple object keys</h2><!--SEC END --><p>In normal use, omniORB creates object keys containing various
information including POA names and various non-ASCII characters.
Since object keys are supposed to be opaque, this is not usually a
problem. The INS breaks this opacity and requires servers to create
objects with human-friendly keys.</p><p>If you wish to make your objects available with human-friendly URIs,
there are two options. The first is to use omniMapper as described
above, in conjunction with a <span style="font-family:monospace">PERSISTENT</span> POA. The second is to
create objects with the required keys yourself. You do this with a
special POA with the name &#X2018;<span style="font-family:monospace">omniINSPOA</span>&#X2019;, acquired from
<span style="font-family:monospace">resolve_initial_references()</span>. This POA has the <span style="font-family:monospace">USER_ID</span>
and <span style="font-family:monospace">PERSISTENT</span> policies, and the special property that the
object keys it creates contain only the object ids given to the POA,
and no other data. It is a normal POA in all other respects, so you
can activate/deactivate it, create children, and so on, in the usual
way.</p><p>Children of the omniINSPOA do not inherit its special properties of
creating simple object keys. If the omniINSPOA&#X2019;s policies are not
suitable for your application, you cannot create a POA with different
policies (such as single threading, for example), and still generate
simple object keys. Instead, you can activate a servant in the
omniINSPOA that uses location forwarding to redirect requests to
objects in a different POA.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note13" href="#text13">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Not 2089 as
printed in [<a href="#inschapters">OMG00</a>]!</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec134" Code set conversion-->
<h1 id="sec134" class="chapter">Chapter&#XA0;8&#XA0;&#XA0;Code set conversion</h1><!--SEC END --><p>
<a id="chap:codesets"></a></p><p>omniORB supports full code set negotiation, used to select and
translate between different character code sets when transmitting
chars, strings, wchars and wstrings. The support is mostly transparent
to application code, but there are a number of options that can be
selected. This chapter covers the options, and also gives some
pointers about how to implement your own code sets, in case the ones
that come with omniORB are not sufficient.</p>
<!--TOC section id="sec135" Native code sets-->
<h2 id="sec135" class="section">8.1&#XA0;&#XA0;Native code sets</h2><!--SEC END --><p>For the ORB to know how to handle strings and wstrings given to it by
the application, it must know what code set they are represented
with, so it can properly translate them if need be. The defaults are
ISO 8859-1 (Latin 1) for char and string, and UTF-16 for wchar and
wstring. Different code sets can be chosen at initialisation time with
the <span style="font-family:monospace">nativeCharCodeSet</span> and <span style="font-family:monospace">nativeWCharCodeSet</span>
parameters. The supported code sets are printed out at initialisation
time if the ORB traceLevel is 15 or greater.</p><p>For most applications, the defaults are fine. Some applications may
need to set the native char code set to UTF-8, allowing the full
Unicode range to be supported in strings.</p><p>Note that the default for wchar is always UTF-16, even on Unix
platforms where wchar is a 32-bit type. Select the UCS-4 code set to
select characters outside the first plane without having to use UTF-16
surrogates<sup><a id="text14" href="#note14">1</a></sup>.</p>
<!--TOC section id="sec136" Default code sets-->
<h2 id="sec136" class="section">8.2&#XA0;&#XA0;Default code sets</h2><!--SEC END --><p>The way code set conversion is meant to work in CORBA communication is
that each client and server has a <span style="font-style:italic">native</span> code set that it uses
for character data in application code, and supports a number of
<span style="font-style:italic">transmission</span> code sets that is uses for communication. When a
client connects to a server, the client picks one of the server&#X2019;s
transmission code sets to use for the interaction. For that to work,
the client plainly has to know the server&#X2019;s supported transmission
code sets.</p><p>Code set information from servers is embedded in IORs. A client with
an IOR from a server should therefore know what transmission code sets
the server supports. This approach can fail for two reasons:</p><ol class="enumerate" type=1><li class="li-enumerate">
A <span style="font-family:monospace">corbaloc</span> URI (see chapter&#XA0;<a href="#chap%3Ains">7</a>) does
not contain any code set information.</li><li class="li-enumerate">Some badly-behaved servers that do support code set conversion
fail to put codeset information in their IORs.
</li></ol><p>The CORBA standard says that if a server has not specified
transmission code set information, clients must assume that they only
support ISO-8859-1 for char and string, and do not support wchar and
wstring at all. The effect is that client code receives
<span style="font-family:monospace">DATA_CONVERSION</span> or <span style="font-family:monospace">BAD_PARAM</span> exceptions.</p><p>To avoid this issue, omniORB allows you to configure <span style="font-style:italic">default</span>
code sets that are used as a server&#X2019;s transmission code sets if they
are not otherwise known. Set <span style="font-family:monospace">defaultCharCodeSet</span> for char and
string data, and <span style="font-family:monospace">defaultWCharCodeSet</span> for wchar and wstring data.</p>
<!--TOC section id="sec137" Code set library-->
<h2 id="sec137" class="section">8.3&#XA0;&#XA0;Code set library</h2><!--SEC END --><p>To save space in the main ORB core library, most of the code set
implementations are in a separate library named omniCodeSets4. To use
the extra code sets, you must link your application with that
library. On most platforms, if you are using dynamic linking,
specifying the omniCodeSets4 library in the link command is sufficient
to have it initialised, and for the code sets to be available. With
static linking, or platforms with less intelligent dynamic linkers,
you must force the linker to initialise the library. You do that by
including the <span style="font-family:monospace">omniORB4/optionalFeatures.h</span> header. By default,
that header enables several optional features. Look at the file
contents to see how to turn off particular features.</p>
<!--TOC section id="sec138" Implementing new code sets-->
<h2 id="sec138" class="section">8.4&#XA0;&#XA0;Implementing new code sets</h2><!--SEC END --><p>It is quite easy to implement new code sets, if you need support for
code sets (or marshalling formats) that do not come with the omniORB
distribution. There are extensive comments in the headers and ORB code
that explain how to implement a code set; this section just serves to
point you in the right direction.</p><p>The main definitions for the code set support are in
<span style="font-family:monospace">include/omniORB4/codeSets.h</span>. That defines a set of base classes
use to implement code sets, plus some derived classes that use look-up
tables to convert simple 8-bit and 16-bit code sets to Unicode.</p><p>When sending or receiving string data, there are a total of four code
sets in action: a native char code set, a transmission char code set,
a native wchar code set, and a transmission wchar code set. The native
code sets are as described above; the transmission code sets are the
ones selected to communicate with a remote machine. They are
responsible for understanding the GIOP marshalling formats, as well as
the code sets themselves. Each of the four code sets has an object
associated with it which contains methods for converting data.</p><p>There are two ways in which a string/wstring can be transmitted or
received. If the transmission code set in action knows how to deal
directly with the native code set (the trivial case being that they
are the same code set, but more complex cases are possible too), the
transmission code set object can directly marshal or unmarshal the
data into or out of the application buffer. If the transmission code
set does not know how to handle the native code set, it converts the
string/wstring into UTF-16, and passes that to the native code set
object (or vice-versa). All code set implementations must therefore
know how to convert to and from UTF-16.</p><p>With this explanation, the classes in <span style="font-family:monospace">codeSets.h</span> should be easy
to understand. The next place to look is in the various existing code
set implementations, which are files of the form <span style="font-family:monospace">cs-*.cc</span> in the
<span style="font-family:monospace">src/lib/omniORB/orbcore</span> and <span style="font-family:monospace">src/lib/omniORB/codesets</span>.
Note how all the 8-bit code sets (the ISO 8859-* family) consist
entirely of data and no code, since they are driven by look-up tables.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note14" href="#text14">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">If you have no idea what this means, don&#X2019;t
worry&#X2014;you&#X2019;re better off not knowing unless you <em>really</em> have
to.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec139" Interceptors-->
<h1 id="sec139" class="chapter">Chapter&#XA0;9&#XA0;&#XA0;Interceptors</h1><!--SEC END --><p>
<a id="chap:interceptors"></a></p><p>omniORB supports interceptors that allow the application to insert
processing in various points along the call chain, and in various
other locations. It does not (yet) support the standard Portable
Interceptors API.</p><p>The interceptor interfaces are defined in a single header,
<span style="font-family:monospace">include/omniORB4/omniInterceptors.h</span>. Each interception point
consists of a singleton object with <span style="font-family:monospace">add()</span> and <span style="font-family:monospace">remove()</span> methods,
and the definition of an &#X2018;interceptor info&#X2019; class. For example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">omniInterceptors</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  ...</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">clientSendRequest_T</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">info_T</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">GIOP_C</span><span style="font-size:small">&amp;                 </span><span style="font-size:small">giop_c</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">IOP</span><span style="font-size:small">::</span><span style="font-size:small">ServiceContextList</span><span style="font-size:small"> </span><span style="font-size:small">service_contexts</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">info_T</span><span style="font-size:small">(</span><span style="font-size:small">GIOP_C</span><span style="font-size:small">&amp; </span><span style="font-size:small">c</span><span style="font-size:small">) : </span><span style="font-size:small">giop_c</span><span style="font-size:small">(</span><span style="font-size:small">c</span><span style="font-size:small">), </span><span style="font-size:small">service_contexts</span><span style="font-size:small">(5) {}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">private</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">info_T</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">info_T</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">info_T</span><span style="font-size:small">&amp;);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">info_T</span><span style="font-size:small">&amp; </span><span style="font-size:small"><span style="font-weight:bold">operator</span></span><span style="font-size:small">=(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">info_T</span><span style="font-size:small">&amp;);</span><span style="font-size:small">
</span><span style="font-size:small">    };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> (*</span><span style="font-size:small">interceptFunc</span><span style="font-size:small">)(</span><span style="font-size:small">info_T</span><span style="font-size:small">&amp; </span><span style="font-size:small">info</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">add</span><span style="font-size:small">(</span><span style="font-size:small">interceptFunc</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">remove</span><span style="font-size:small">(</span><span style="font-size:small">interceptFunc</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">  ...</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>You can see that the interceptors themselves are functions
that take the <span style="font-family:monospace">info_T</span> object as their argument and return
boolean. Interceptors are called in the order they are registered;
normally, all interceptor functions return <span style="font-family:monospace">true</span>, meaning that
processing should continue with subsequent interceptors. If an
interceptor returns <span style="font-family:monospace">false</span>, later interceptors are not
called. You should only do that if you really know what you are doing.</p><p>Notice that the <span style="font-family:monospace">info_T</span> contains references to omniORB internal
data types. The definitions of these types can be found in other
header files within <span style="font-family:monospace">include/omniORB4</span> and
<span style="font-family:monospace">include/omniORB4/internal</span>.</p>
<!--TOC section id="sec140" Interceptor registration-->
<h2 id="sec140" class="section">9.1&#XA0;&#XA0;Interceptor registration</h2><!--SEC END --><p>All the interceptor singletons are registered within another singleton
object of class <span style="font-family:monospace">omniInterceptors</span>. You retrieve a pointer to the
object with the <span style="font-family:monospace">omniORB::getInterceptors()</span> function, which
must be called after the ORB has been initialised with
<span style="font-family:monospace">CORBA::ORB_init()</span>, but before the ORB is used. The code to
register an interceptor looks, for example, like:</p><div class="lstlisting"><span style="font-size:small">omniInterceptors</span><span style="font-size:small">* </span><span style="font-size:small">interceptors</span><span style="font-size:small"> = </span><span style="font-size:small">omniORB</span><span style="font-size:small">::</span><span style="font-size:small">getInterceptors</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">interceptors</span><span style="font-size:small">-&gt;</span><span style="font-size:small">clientSendRequest</span><span style="font-size:small">.</span><span style="font-size:small">add</span><span style="font-size:small">(</span><span style="font-size:small">myInterceptorFunc</span><span style="font-size:small">);</span></div>
<!--TOC section id="sec141" Available interceptors-->
<h2 id="sec141" class="section">9.2&#XA0;&#XA0;Available interceptors</h2><!--SEC END --><p>The following interceptors are available:</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold">encodeIOR</span></dt><dd class="dd-description"><br>
Called when encoding an IOR to represent an object reference. This
interception point allows the application to insert extra profile
components into IORs. Note that you must understand and adhere to the
rules about data stored in IORs, otherwise the IORs created may be
invalid. omniORB itself uses this interceptor to insert various items,
so you can see an example of its use in the
<span style="font-family:monospace">insertSupportedComponents()</span> function defined in
<span style="font-family:monospace">src/lib/omniORB/orbcore/ior.cc</span>.</dd><dt class="dt-description"><span style="font-weight:bold">decodeIOR</span></dt><dd class="dd-description"><br>
Called when decoding an IOR. The application can use this to get out
whatever information they put into IORs with encodeIOR. Again, see
<span style="font-family:monospace">extractSupportedComponents()</span> in
<span style="font-family:monospace">src/lib/omniORB/orbcore/ior.cc</span> for an example.</dd><dt class="dt-description"><span style="font-weight:bold">clientOpenConnection</span></dt><dd class="dd-description"><br>
Called as a client opens a new connection to a server, after the
connection is opened but before it is used to send a request. The
interceptor function can set the <span style="font-family:monospace">info_T</span>&#X2019;s <span style="font-family:monospace">reject</span> member
to <span style="font-family:monospace">true</span> to cause the client to immediately close the new
connection and throw CORBA::TRANSIENT to the calling code. In that
case, the interceptor function can also set the <span style="font-family:monospace">why</span> member to
provide a message that is logged.</dd><dt class="dt-description"><span style="font-weight:bold">clientSendRequest</span></dt><dd class="dd-description"><br>
Called just before a request header is sent over the network. The
application can use it to insert service contexts in the header. See
the <span style="font-family:monospace">setCodeSetServiceContext()</span> function in
<span style="font-family:monospace">src/lib/omniORB/orbcore/cdrStream.cc</span> for an example of its use.</dd><dt class="dt-description"><span style="font-weight:bold">clientReceiveReply</span></dt><dd class="dd-description"><br>
Called as the client receives a reply, just after unmarshalling the
reply header. Called for normal replies and exceptions.</dd><dt class="dt-description"><span style="font-weight:bold">serverAcceptConnection</span></dt><dd class="dd-description"><br>
Called when a server accepts a new incoming connection, but before it
reads any data from it. The interceptor function can set the
<span style="font-family:monospace">info_T</span>&#X2019;s <span style="font-family:monospace">reject</span> member to <span style="font-family:monospace">true</span> to cause the
server to immediately close the new connection. In that case, the
interceptor function can also set the <span style="font-family:monospace">why</span> member to provide a
message that is logged.</dd><dt class="dt-description"><span style="font-weight:bold">serverReceiveRequest</span></dt><dd class="dd-description"><br>
Called when the server receives a request, just after unmarshalling
the request header. See the <span style="font-family:monospace">getCodeSetServiceContext()</span> function in
<span style="font-family:monospace">src/lib/omniORB/orbcore/cdrStream.cc</span> for an example.</dd><dt class="dt-description"><span style="font-weight:bold">serverSendReply</span></dt><dd class="dd-description"><br>
Called just before the server marshals a reply header.</dd><dt class="dt-description"><span style="font-weight:bold">serverSendException</span></dt><dd class="dd-description"><br>
Called just before the server marshals an exception reply header.</dd><dt class="dt-description"><span style="font-weight:bold">createRope</span></dt><dd class="dd-description"><br>
Called when the ORB is about to create a &#X2018;rope&#X2019; that encapsulates a
bundle of connections (&#X2018;strands&#X2019;) to a remote address space. It allows
application code to override omniORB&#X2019;s normal connection management.</dd><dt class="dt-description"><span style="font-weight:bold">createIdentity</span></dt><dd class="dd-description"><br>
Called when the ORB is about to create an &#X2018;identity&#X2019; object to
represent a CORBA object. It allows application code to provide its
own identity implementations. It is very unlikely that an application
will need to do this.</dd><dt class="dt-description"><span style="font-weight:bold">createORBServer</span></dt><dd class="dd-description"><br>
Used internally by the ORB to register different kinds of server. At
present, only a GIOP server is registered. It is very unlikely that
application code will need to do this.</dd><dt class="dt-description"><span style="font-weight:bold">createThread</span></dt><dd class="dd-description"><br>
Called whenever the ORB creates a thread. The <span style="font-family:monospace">info_T</span> class for
this interceptor is<div class="lstlisting"><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">info_T</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">run</span><span style="font-size:small">() = 0;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">omni_thread</span><span style="font-size:small">* </span><span style="font-size:small">self</span><span style="font-size:small">() = 0;</span><span style="font-size:small">
</span><span style="font-size:small">    };</span></div><p>The interceptor is called in the context of the newly created thread.
The function <em>must</em> call the <span style="font-family:monospace">info_T</span>&#X2019;s <span style="font-family:monospace">run()</span> method, to
pass control to the thread body. <span style="font-family:monospace">run()</span> returns just before the
thread exits. This arrangement allows the interceptor to initialise
some per-thread state before the thread body runs, then release it
just before the thread exits.</p><p>The <span style="font-family:monospace">info_T</span>&#X2019;s <span style="font-family:monospace">self()</span> method returns a pointer to the
<span style="font-family:monospace">omni_thread</span> object for the thread, equivalent to calling
<span style="font-family:monospace">omni_thread::self()</span>.</p></dd><dt class="dt-description"><span style="font-weight:bold">assignUpcallThread</span></dt><dd class="dd-description"><br>
The ORB maintains a general thread pool, from which threads are drawn
for various purposes. One purpose is for performing upcalls to
application code, in response to incoming CORBA calls. The
<span style="font-family:monospace">assignUpcallThread</span> interceptor is called when a thread is
assigned to perform upcalls. In the thread per connection model, the
thread stays assigned to performing upcalls for the entire lifetime of
the underlying network connection; in the thread pool model, threads
are assigned for upcalls on a per call basis, so this interceptor is
triggered for every incoming call<sup><a id="text15" href="#note15">1</a></sup>. As with the <span style="font-family:monospace">createThread</span> interceptor, the
interceptor function must call the <span style="font-family:monospace">info_T</span>&#X2019;s <span style="font-family:monospace">run()</span> method to
pass control to the upcall.<p>When a thread finishes its assignment of processing upcalls, it
returns to the pool (even in thread per connection mode), so the same
thread can be reassigned to perform more upcalls, or reused for a
different purpose.</p></dd><dt class="dt-description"><span style="font-weight:bold">assignAMIThread</span></dt><dd class="dd-description"><br>
Asynchronous Method Invocation (AMI) uses threads to perform outgoing
calls. The <span style="font-family:monospace">assignAMIThread</span> interceptor is called when a thread
is assigned to perform AMI calls. As with the other thread
interceptors, the interceptor function must call the <span style="font-family:monospace">info_T</span>&#X2019;s
<span style="font-family:monospace">run()</span> method to pass control to the AMI call.<p>Unlike the other interceptors, the interceptor functions for
<span style="font-family:monospace">createThread</span>, <span style="font-family:monospace">assignUpcallThread</span> and
<span style="font-family:monospace">assignAMIThread</span> have no return values. Interceptor chaining is
performed by calls through the <span style="font-family:monospace">info_T::run()</span> method, rather than
by visiting interceptor functions in turn.</p></dd></dl>
<!--TOC section id="sec142" Server-side call interceptor-->
<h2 id="sec142" class="section">9.3&#XA0;&#XA0;Server-side call interceptor</h2><!--SEC END --><p>Calls can be intercepted on the server just before the upcall into
application code. This interceptor is registered with omniORB&#X2019;s
<span style="font-family:monospace">callDescriptor</span> class, which is responsible for encapsulating
the state of a call. Unlike the transport-related
<span style="font-family:monospace">serverReceiveRequest</span>, <span style="font-family:monospace">serverSendReply</span> and
<span style="font-family:monospace">serverSendException</span> interceptors, the <span style="font-family:monospace">callDescriptor</span>
interceptor is invoked for <em>all</em> calls, even ones from colocated
clients in the same address space.</p><p>The types used for the call interceptor are defined in
<span style="font-family:monospace">include/omniORB4/callDescriptor.h</span>. The interceptor takes the
form of a bare function with two parameters. The first parameter is a
pointer to the <span style="font-family:monospace">callDescriptor</span>; the second is a pointer to
<span style="font-family:monospace">omniServant</span>, which is the base class of all servant
classes. The interceptor function must call the
<span style="font-family:monospace">callDescriptor</span>&#X2019;s <span style="font-family:monospace">interceptedCall()</span> method to pass on the
call.</p><p>This interception point allows access to various parts of omniORB&#X2019;s
call machinery. The <span style="font-family:monospace">callDescriptor</span> includes access to the
operation name and, if cast to the concrete subclass defined by the
IDL compiler, the call arguments and return values too.</p>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note15" href="#text15">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Except that with the
<span style="font-family:monospace">threadPoolWatchConnection</span> parameter set <span style="font-family:monospace">true</span>, a thread
can perform multiple upcalls even when thread pool mode is
active.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec143" Type Any and TypeCode-->
<h1 id="sec143" class="chapter">Chapter&#XA0;10&#XA0;&#XA0;Type Any and TypeCode</h1><!--SEC END --><p>
<a id="chap:any"></a></p><p>The CORBA specification provides for a type that can hold the value of
any OMG IDL type. This type is known as type <span style="font-family:monospace">Any</span>. The OMG also
specifies a pseudo-object, <span style="font-family:monospace">TypeCode</span>, that can encode a
description of any type specifiable in OMG IDL.</p><p>In this chapter, an example demonstrating the use of type Any is
presented. The example code is in the <span style="font-family:monospace">src/examples/anyExample</span>
directory in the omniORB distribution. The example is followed by
sections describing the behaviour of type Any and TypeCode in omniORB.
For further information on type Any, refer to the C++ Mapping
specification., and for more information on TypeCode, refer to the
Interface Repository chapter in the CORBA core section of the CORBA
specification.</p>
<!--TOC section id="sec144" Example using type Any-->
<h2 id="sec144" class="section">10.1&#XA0;&#XA0;Example using type Any</h2><!--SEC END --><p>Before going through this example, you should make sure that you have
read and understood the examples in chapter&#XA0;<a href="#chap%3Abasic">2</a>.</p>
<!--TOC subsection id="sec145" Type Any in IDL-->
<h3 id="sec145" class="subsection">10.1.1&#XA0;&#XA0;Type Any in IDL</h3><!--SEC END --><p>
Type Any allows one to delay the decision on the type used in an
operation until run-time. To use type any in IDL, use the keyword
<span style="font-family:monospace">any</span>, as in the following example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">anyExample</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">any</span></span><span style="font-size:small"> </span><span style="font-size:small">testOp</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">any</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The operation <span style="font-family:monospace">testOp()</span> in this example can now take any
value expressible in OMG IDL as an argument, and can also return any
type expressible in OMG IDL.</p><p>Type Any is mapped into C++ as the type <span style="font-family:monospace">CORBA::Any</span>. When passed
as an argument or as a result of an operation, the following rules
apply:</p><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-weight:bold">In </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-weight:bold">InOut </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-weight:bold">Out </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-weight:bold">Return </span></span><span style="font-size:small"> </span></td></tr>
<tr><td class="hbar" colspan=4><span style="font-size:small"></span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-family:monospace">const CORBA::Any&amp; </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-family:monospace">CORBA::Any&amp; </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-family:monospace">CORBA::Any*&amp; </span></span></td><td style="text-align:left;white-space:nowrap" ><span style="font-size:small"><span style="font-family:monospace">CORBA::Any* </span></span><span style="font-size:small">
</span></td></tr>
</table><p>So, the above IDL would map to the following C++:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">anyExample_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_anyExample</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">anyExample_i</span><span style="font-size:small">() { }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">anyExample_i</span><span style="font-size:small">() { }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small">* </span><span style="font-size:small">testOp</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small">&amp; </span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div>
<!--TOC subsection id="sec146" Inserting and Extracting Basic Types from an Any-->
<h3 id="sec146" class="subsection">10.1.2&#XA0;&#XA0;Inserting and Extracting Basic Types from an Any</h3><!--SEC END --><p>The question now arises as to how values are inserted into and removed
from an Any. This is achieved using two overloaded operators:
<span style="font-family:monospace">&lt;&lt;=</span> and <span style="font-family:monospace">&gt;&gt;=</span>.</p><p>To insert a value into an Any, the <span style="font-family:monospace">&lt;&lt;=</span> operator is used, as
in this example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small"> </span><span style="font-size:small">an_any</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Long</span><span style="font-size:small"> </span><span style="font-size:small">l</span><span style="font-size:small"> = 100;</span><span style="font-size:small">
</span><span style="font-size:small">an_any</span><span style="font-size:small"> &lt;&lt;= </span><span style="font-size:small">l</span><span style="font-size:small">;</span></div><p>Note that the overloaded <span style="font-family:monospace">&lt;&lt;=</span> operator has a return
type of <span style="font-family:monospace">void</span>.</p><p>To extract a value, the <span style="font-family:monospace">&gt;&gt;=</span> operator is used, as in this
example (where the Any contains a long):</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Long</span><span style="font-size:small"> </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">an_any</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"This is a long: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">l</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span></div><p>The overloaded <span style="font-family:monospace">&gt;&gt;=</span> operator returns a <span style="font-family:monospace">CORBA::Boolean</span>.
If an attempt is made to extract a value from an Any when it contains
a different type of value (e.g. an attempt to extract a long from an
Any containing a double), the overloaded <span style="font-family:monospace">&gt;&gt;=</span> operator will
return <span style="font-family:monospace">false</span>; otherwise it will return <span style="font-family:monospace">true</span>. Thus, a
common tactic to extract values from an Any is as follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Long</span><span style="font-size:small"> </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Double</span><span style="font-size:small"> </span><span style="font-size:small">d</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">str</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">an_any</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">l</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Long: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">l</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">an_any</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">d</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Double: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">d</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">an_any</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">str</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"String: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">str</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// The storage of the extracted string is still owned by the any.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Unknown value."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<!--TOC subsection id="sec147" Inserting and Extracting Constructed Types from an Any-->
<h3 id="sec147" class="subsection">10.1.3&#XA0;&#XA0;Inserting and Extracting Constructed Types from an Any</h3><!--SEC END --><p>It is also possible to insert and extract constructed types and object
references from an Any. omniidl will generate insertion and extraction
operators for the constructed type. Note that it is necessary to
specify the <span style="font-family:monospace">-Wba</span> command-line flag when running omniidl in
order to generate these operators. The following example illustrates
the use of constructed types with type Any:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">testStruct</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">short</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">anyExample</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">any</span></span><span style="font-size:small"> </span><span style="font-size:small">testOp</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">any</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Upon compiling the above IDL with <span style="font-family:monospace">omniidl -bcxx -Wba</span>, the
following overloaded operators are generated:</p><ol class="enumerate" type=1><li class="li-enumerate">
<code>void operator&lt;&lt;=(CORBA::Any&amp;, const testStruct&amp;)</code>
</li><li class="li-enumerate"><code>void operator&lt;&lt;=(CORBA::Any&amp;, testStruct*)</code>
</li><li class="li-enumerate"><code>CORBA::Boolean operator&gt;&gt;=(const CORBA::Any&amp;,</code><br>
 <code>const testStruct*&amp;)</code>
</li></ol><p>Operators of this form are generated for all constructed types, and
for interfaces.</p><p>The first operator, <em>(1)</em>, copies the constructed type, and
inserts it into the Any. The second operator, <em>(2)</em>, inserts the
constructed type into the Any, and then manages it. Note that if the
second operator is used, the Any consumes the constructed type, and
the caller should not use the pointer to access the data after
insertion. The following is an example of how to insert a value into
an Any using operator <em>(1)</em>:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small"> </span><span style="font-size:small">an_any</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">testStruct</span><span style="font-size:small"> </span><span style="font-size:small">t</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">t</span><span style="font-size:small">.</span><span style="font-size:small">l</span><span style="font-size:small"> = 456;</span><span style="font-size:small">
</span><span style="font-size:small">t</span><span style="font-size:small">.</span><span style="font-size:small">s</span><span style="font-size:small"> = 8;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">an_any</span><span style="font-size:small"> &lt;&lt;= </span><span style="font-size:small">t</span><span style="font-size:small">;</span></div><p>The third operator, <em>(3)</em>, is used to extract the constructed
type from the Any, and can be used as follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small">testStruct</span><span style="font-size:small">* </span><span style="font-size:small">tp</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">an_any</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">tp</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"testStruct: l: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">tp</span><span style="font-size:small">-&gt;</span><span style="font-size:small">l</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"            s: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">tp</span><span style="font-size:small">-&gt;</span><span style="font-size:small">s</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">else</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Unknown value contained in Any."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>As with basic types, if an attempt is made to extract a type from an
Any that does not contain a value of that type, the extraction
operator returns <span style="font-family:monospace">false</span>. If the Any does contain that type, the
extraction operator returns <span style="font-family:monospace">true</span>. If the extraction is
successful, the caller&#X2019;s pointer will point to memory managed by the
Any. The caller must not delete or otherwise change this storage, and
should not use this storage after the contents of the Any are replaced
(either by insertion or assignment), or after the Any has been
destroyed. In particular, management of the pointer should not be
assigned to a <span style="font-family:monospace">_var</span> type.</p><p>If the extraction fails, the caller&#X2019;s pointer will be set to point to
null.</p><p>Note that there are special rules for inserting and extracting arrays
(using the <span style="font-family:monospace">_forany</span> types), and for inserting and extracting
bounded strings, booleans, chars, and octets. Please refer to the C++
Mapping specification for further information.</p>
<!--TOC section id="sec148" Type Any in omniORB-->
<h2 id="sec148" class="section">10.2&#XA0;&#XA0;Type Any in omniORB</h2><!--SEC END --><p>
<a id="anyOmniORB"></a></p><p>This section contains some notes on the use and behaviour of type Any
in omniORB.</p>
<!--TOC subsection id="sec149" Generating Insertion and Extraction Operators.-->
<h3 id="sec149" class="subsection">10.2.1&#XA0;&#XA0;Generating Insertion and Extraction Operators.</h3><!--SEC END --><p>
To generate type Any insertion and extraction operators for
constructed types and interfaces, the <span style="font-family:monospace">-Wba</span> command line flag
should be specified when running omniidl.</p>
<!--TOC subsection id="sec150" TypeCode comparison when extracting from an Any.-->
<h3 id="sec150" class="subsection">10.2.2&#XA0;&#XA0;TypeCode comparison when extracting from an Any.</h3><!--SEC END --><p>
When an attempt is made to extract a type from an Any, the TypeCode of
the type is checked for <em>equivalence</em> with the TypeCode of the
type stored by the Any. The <span style="font-family:monospace">equivalent()</span> test in the TypeCode
interface is used for this purpose. For example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 1</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small"> </span><span style="font-size:small">Double1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">Test1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">Double1</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small"> </span><span style="font-size:small">Double2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">Test1</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">Double2</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>If an attempt is made to extract the type <span style="font-family:monospace">Test1</span> defined in IDL
1 from an Any containing the <span style="font-family:monospace">Test1</span> defined in IDL 2, this will
succeed (and vice-versa), as the two types differ only by an alias.</p>
<!--TOC subsection id="sec151" Top-level aliases.-->
<h3 id="sec151" class="subsection">10.2.3&#XA0;&#XA0;Top-level aliases.</h3><!--SEC END --><p>
When a type is inserted into an Any, the Any stores both the value of
the type and the TypeCode for that type. However, in some cases, a
top-level alias can be lost due to the details of the C++ mapping. For
example, consider these IDL definitions:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 3</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">sequence</span></span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">seqDouble1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">sequence</span></span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">seqDouble2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">seqDouble2</span><span style="font-size:small">       </span><span style="font-size:small">seqDouble3</span><span style="font-size:small">;</span></div><p>omniidl generates distinct types for <span style="font-family:monospace">seqDouble1</span> and
<span style="font-family:monospace">seqDouble2</span>, and therefore each has its own set of C++ operators
for Any insertion and extraction. That means inserting a
<span style="font-family:monospace">seqDouble1</span> into an Any sets the Any&#X2019;s TypeCode to include the
alias &#X2018;seqDouble1&#X2019;, and inserting a <span style="font-family:monospace">seqDouble2</span> sets the
TypeCode to the alias &#X2018;seqDouble2&#X2019;.</p><p>However, in the C++ mapping, <span style="font-family:monospace">seqDouble3</span> is required to be just
a C++ typedef to <span style="font-family:monospace">seqDouble2</span>, so the C++ compiler uses the Any
insertion operator for <span style="font-family:monospace">seqDouble2</span>. Therefore, inserting a
<span style="font-family:monospace">seqDouble3</span> sets the Any&#X2019;s TypeCode to the <span style="font-family:monospace">seqDouble2</span>
alias. If this is not desirable, you can use the member function
&#X2018;<span style="font-family:monospace">void type(TypeCode_ptr)</span>&#X2019; of the Any interface to explicitly
set the TypeCode to the correct one.</p>
<!--TOC subsection id="sec152" Removing aliases from TypeCodes.-->
<h3 id="sec152" class="subsection">10.2.4&#XA0;&#XA0;Removing aliases from TypeCodes.</h3><!--SEC END --><p>
Some ORBs (such as old versions of Orbix) will not accept TypeCodes
containing <span style="font-family:monospace">tk_alias</span> TypeCodes. When using type Any while
interoperating with these ORBs, it is necessary to remove
<span style="font-family:monospace">tk_alias</span> TypeCodes from throughout the TypeCode representing a
constructed type.</p><p>To remove all <span style="font-family:monospace">tk_alias</span> TypeCodes from TypeCodes transmitted in
Anys, supply the <span style="font-family:monospace">-ORBtcAliasExpand 1</span> command-line flag when
running an omniORB executable. There will be some (small) performance
penalty when transmitting Any values.</p><p>Note that the <span style="font-family:monospace">_tc_</span> TypeCodes generated for all constructed
types will contain the complete TypeCode for the type (including any
<span style="font-family:monospace">tk_alias</span> TypeCodes), regardless of whether the
<span style="font-family:monospace">-ORBtcAliasExpand</span> flag is set to 1 or not. It is only when
Anys are transmitted that the aliases are stripped.</p>
<!--TOC subsection id="sec153" Recursive TypeCodes.-->
<h3 id="sec153" class="subsection">10.2.5&#XA0;&#XA0;Recursive TypeCodes.</h3><!--SEC END --><p>
omniORB supports recursive TypeCodes. This means that types such as
the following can be inserted or extracted from an Any:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 4</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">Test4</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">sequence</span></span><span style="font-size:small">&lt;</span><span style="font-size:small">Test4</span><span style="font-size:small">&gt; </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div>
<!--TOC subsection id="sec154" Threads and type Any.-->
<h3 id="sec154" class="subsection">10.2.6&#XA0;&#XA0;Threads and type Any.</h3><!--SEC END --><p>
Inserting and extracting simultaneously from the same Any (in 2
threads) results in undefined behaviour.</p><p>In versions of omniORB before 4.0, extracting simultaneously from the
same Any (in 2 or more different threads) also led to undefined
behaviour. That is no longer the case&#X2014;Any extraction is now thread
safe.</p>
<!--TOC section id="sec155" TypeCode in omniORB-->
<h2 id="sec155" class="section">10.3&#XA0;&#XA0;TypeCode in omniORB</h2><!--SEC END --><p>This section contains some notes on the use and behaviour of TypeCode
in omniORB</p>
<!--TOC subsection id="sec156" TypeCodes in IDL.-->
<h3 id="sec156" class="subsection">10.3.1&#XA0;&#XA0;TypeCodes in IDL.</h3><!--SEC END --><p>When using TypeCodes in IDL, note that they are defined in the CORBA
scope. Therefore, <span style="font-family:monospace">CORBA::TypeCode</span> should be used. Example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 5</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">Test5</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">length</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TypeCode</span><span style="font-size:small"> </span><span style="font-size:small">desc</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div>
<!--TOC subsection id="sec157" orb.idl-->
<h3 id="sec157" class="subsection">10.3.2&#XA0;&#XA0;orb.idl</h3><!--SEC END --><p>The CORBA specification says that IDL using <span style="font-family:monospace">CORBA::TypeCode</span>
must include the file <span style="font-family:monospace">orb.idl</span>. That is not required in omniORB,
but a suitable <span style="font-family:monospace">orb.idl</span> is available.</p>
<!--TOC subsection id="sec158" Generating TypeCodes for constructed types.-->
<h3 id="sec158" class="subsection">10.3.3&#XA0;&#XA0;Generating TypeCodes for constructed types.</h3><!--SEC END --><p>To generate a TypeCode for constructed types, specify the
<span style="font-family:monospace">-Wba</span> command-line flag when running omniidl. This will
generate a <span style="font-family:monospace">_tc_</span> TypeCode describing the type, at the same
scope as the type. Example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL 6</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">struct</span></span><span style="font-size:small"> </span><span style="font-size:small">Test6</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">sequence</span></span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">b</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>A TypeCode, <span style="font-family:monospace">_tc_Test6</span>, will be generated to describe the
struct <span style="font-family:monospace">Test6</span>. The operations defined in the TypeCode interface
can be used to query the TypeCode about the type it represents.</p><!--TOC chapter id="sec159" Objects by value, etc.-->
<h1 id="sec159" class="chapter">Chapter&#XA0;11&#XA0;&#XA0;Objects by value, abstract interfaces and local interfaces</h1><!--SEC END --><p>
<a id="chap:valuetype"></a></p><p>omniORB 4.1 supports objects by value, declared with the
<span style="font-family:monospace">valuetype</span> keyword in IDL, and both abstract and local
interfaces. This chapter outlines some issues to do with using these
types in omniORB. You are assumed to have read the relevant parts of
the CORBA specification, specifically chapters 3, 4, 5 and 6 of the
CORBA 2.6 specification, and sections 1.17, 1.18 and 1.35 of the C++
mapping specification, version 1.1.</p>
<!--TOC section id="sec160" Features-->
<h2 id="sec160" class="section">11.1&#XA0;&#XA0;Features</h2><!--SEC END --><p>omniORB supports the complete objects by value specification, with the
exception of custom valuetypes. All other valuetype features including
value boxes, value sharing semantics, abstract valuetypes, and
abstract interfaces are supported. Local interfaces are supported,
with a number of caveats outlined in
section&#XA0;<a href="#sec%3ALocalInterfaces">11.8</a>.</p>
<!--TOC section id="sec161" Reference counting-->
<h2 id="sec161" class="section">11.2&#XA0;&#XA0;Reference counting</h2><!--SEC END --><p>Values are reference counted. This means that, as long as your
application properly manages reference counts, values are usually
automatically deleted when they are no longer required. However, one
of the features of valuetypes is that they support the representation
of cyclic graph structures. In that kind of situation, the reference
counting garbage collection does not work, because references internal
to the graph prevent the reference counts ever becoming zero.</p><p>To avoid memory leaks, application code must explicitly break any
reference cycles in values it manipulates. This includes graphs of
values received as parameters and return values from CORBA operations.</p>
<!--TOC section id="sec162" Value sharing and local calls-->
<h2 id="sec162" class="section">11.3&#XA0;&#XA0;Value sharing and local calls</h2><!--SEC END --><p>When valuetypes are passed as parameters in CORBA calls (i.e. calls
on CORBA objects declared with <span style="font-family:monospace">interface</span> in IDL), the structure
of related values is maintained. Consider, for example, the following
IDL definitions (which are from the example code in
<span style="font-family:monospace">src/examples/valuetype/simple</span>:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">   </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Test</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>If the client to the <span style="font-family:monospace">Test</span> object passes the same value in both
parameters, just one value is transmitted, and the object
implementation receives a copy of the single value, with references to
it in both parameters.</p><p>In the case that the object is remote from the client, there is
obviously a copying step involved. In the case that the object is in
the same address space as the client, the same copying semantics must
be maintained so that the object implementation can modify the values
it receives without the client seeing the modifications. To support
that, omniORB must copy the entire parameter list in one operation, in
case there is sharing between different parameters. Such copying is a
rather more time-consuming process than the parameter-by-parameter
copy that takes place in calls not involving valuetypes.</p><p>To avoid the overhead of copying parameters in this way, applications
can choose to relax the semantics of value copying in local calls, so
values are not copied at all, but are passed by reference. In that
case, the client to a call <em>will</em> see any modifications to the
values it passes as parameters (and similarly, the object
implementation will see any changes the client makes to returned
values). To choose this option, set the <span style="font-family:monospace">copyValuesInLocalCalls</span>
configuration parameter to zero.</p>
<!--TOC section id="sec163" Value box factories-->
<h2 id="sec163" class="section">11.4&#XA0;&#XA0;Value box factories</h2><!--SEC END --><p>With normal valuetypes, omniidl generates factory classes (with names
ending <span style="font-family:monospace">_init</span>) as required by the C++ mapping specification.
The application is responsible for registering the factories with the
ORB.</p><p>Unfortunately, the C++ mapping makes no mention of factories for value
boxes. In omniORB, factories for value boxes are automatically
registered with the ORB, and there are no application-visible factory
classes generated for them. Some other CORBA implementations generate
application visible factories, and the application <em>does</em> have to
register the factories with the ORB.</p>
<!--TOC section id="sec164" Standard value boxes-->
<h2 id="sec164" class="section">11.5&#XA0;&#XA0;Standard value boxes</h2><!--SEC END --><p>The standard <span style="font-family:monospace">CORBA::StringValue</span> and <span style="font-family:monospace">CORBA::WStringValue</span>
value boxes are available to application code. To make the definitions
available in IDL, #include the standard <span style="font-family:monospace">orb.idl</span>.</p>
<!--TOC section id="sec165" Covariant returns-->
<h2 id="sec165" class="section">11.6&#XA0;&#XA0;Covariant returns</h2><!--SEC END --><p>As required by the C++ mapping, on C++ compilers that support
covariant return types, omniidl generates code for the
<span style="font-family:monospace">_copy_value()</span> function that returns the most derived type of the
value. On older compilers, <span style="font-family:monospace">_copy_value()</span> returns
<span style="font-family:monospace">CORBA::ValueBase</span>.</p><p>If you write code that calls <span style="font-family:monospace">_copy_value()</span>, and you need to
support older compilers, you should assign the result to a variable of
type <span style="font-family:monospace">CORBA::ValueBase*</span> and downcast to the target type, rather
than using the covariant return.</p><p>If you are overriding <span style="font-family:monospace">_copy_value()</span>, you must correctly take
account of the <span style="font-family:monospace">OMNI_HAVE_COVARIANT_RETURNS</span> preprocessor
definition.</p>
<!--TOC section id="sec166" Values inside Anys-->
<h2 id="sec166" class="section">11.7&#XA0;&#XA0;Values inside Anys</h2><!--SEC END --><p>Valuetypes inserted into Anys cause a number of interesting issues.
Even when inside Anys, values are required to support complete sharing
semantics. Take this IDL for example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small">   </span><span style="font-size:small">l</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">AnyTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">Any</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Now, suppose the client behaves as follows:</p><div class="lstlisting"><span style="font-size:small">ValueTest</span><span style="font-size:small">::</span><span style="font-size:small">One</span><span style="font-size:small">* </span><span style="font-size:small">v</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">One_impl</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"hello"</span></span><span style="font-size:small">, 123);</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> &lt;&lt;= </span><span style="font-size:small">v</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">obj</span><span style="font-size:small">-&gt;</span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small">a</span><span style="font-size:small">);</span></div><p>then on the server side:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">AnyTest_impl</span><span style="font-size:small">::</span><span style="font-size:small">op1</span><span style="font-size:small">(</span><span style="font-size:small">ValueTest</span><span style="font-size:small">::</span><span style="font-size:small">One</span><span style="font-size:small">* </span><span style="font-size:small">v</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Any</span><span style="font-size:small">&amp; </span><span style="font-size:small">a</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">ValueTest</span><span style="font-size:small">::</span><span style="font-size:small">One</span><span style="font-size:small">* </span><span style="font-size:small">v2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">a</span><span style="font-size:small"> &gt;&gt;= </span><span style="font-size:small">v2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">assert</span><span style="font-size:small">(</span><span style="font-size:small">v2</span><span style="font-size:small"> == </span><span style="font-size:small">v</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>This is all very well in this kind of simple situation, but problems
can arise if truncatable valuetypes are used. Imagine this derived
value:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ValueTest</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">Two</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">truncatable</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">double</span></span><span style="font-size:small"> </span><span style="font-size:small">d</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Now, suppose that the client shown above sends an instance of
valuetype <span style="font-family:monospace">Two</span> in both parameters, and suppose that the server
has not seen the definition of valuetype <span style="font-family:monospace">Two</span>. In this
situation, as the first parameter is unmarshalled, it will be
truncated to valuetype <span style="font-family:monospace">One</span>, as required. Now, when the Any is
unmarshalled, it refers to the same value, which has been truncated.
So, even though the TypeCode in the Any indicates that the value has
type <span style="font-family:monospace">Two</span>, the stored value actually has type <span style="font-family:monospace">One</span>. If the
receiver of the Any tries to pass it on, transmission will fail
because the Any&#X2019;s value does not match its TypeCode.</p><p>In the opposite situation, where an Any parameter comes before a
valuetype parameter, a different problem occurs. In that case, as the
Any is unmarshalled, there is no type information available for
valuetype <span style="font-family:monospace">Two</span>, so the value inside the Any has an internal
omniORB type used for unknown valuetypes. As the next parameter is
unmarshalled, omniORB sees that the shared value is unknown, and is
able to convert it to the target <span style="font-family:monospace">One</span> valuetype with
truncation. In this case, the Any and the plain valuetype both have
the correct types and values, but the fact that both should have
referred to the same value has been lost.</p><p>Because of these issues, it is best to avoid defining interfaces that
mix valuetypes and Anys in a single operation, and certainly to avoid
trying to share plain values with values inside Anys.</p>
<!--TOC subsection id="sec167" Values inside DynAnys-->
<h3 id="sec167" class="subsection">11.7.1&#XA0;&#XA0;Values inside DynAnys</h3><!--SEC END --><p>The sharing semantics of valuetypes can also cause difficulties for
DynAny. The CORBA 2.6 specification does not mention how shared values
inside DynAnys should be handled; the CORBA 3.x specification slightly
clarifies the situation, but it is still unclear. To write portable
code it is best to avoid manipulating DynAnys containing values that
are shared.</p><p>In omniORB, when a value inside an Any is converted into a DynAny, the
value&#X2019;s state is copied into the DynAny, and manipulated there. When
converting back to an Any a new value is created. This means that any
other references to the original value (whether themselves inside Anys
of not) still relate to the original value, with unchanged state.
However, this copying only occurs when a DynValue is actually created,
so for example a structure with two value members referring to the
same value can manipulated inside a DynAny without breaking the
sharing, provided the value members are not accessed as DynAnys.
Extracting the value members as ValueBase will reveal the sharing, for
example.</p>
<!--TOC section id="sec168" Local Interfaces-->
<h2 id="sec168" class="section">11.8&#XA0;&#XA0;Local Interfaces</h2><!--SEC END --><p>
<a id="sec:LocalInterfaces"></a></p><p>Local interfaces are somewhat under-specified in the C++ mapping. This
section outlines the way local interfaces are supported in omniORB,
and details the limitations and issues.</p>
<!--TOC subsection id="sec169" Simple local interfaces-->
<h3 id="sec169" class="subsection">11.8.1&#XA0;&#XA0;Simple local interfaces</h3><!--SEC END --><p>With simple IDL, there are no particular issues:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">Test</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">local</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Example</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">arg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The IDL compiler generates an abstract base class
<span style="font-family:monospace">Test::Example</span>. The application defines a class derived from it
that implements the abstract <span style="font-family:monospace">hello()</span> member function. Instances of
that class can then be used where the IDL specifies interface
<span style="font-family:monospace">Example</span>.</p><p>Note that, by default, local interface implementations have no
reference counting behaviour. If the local object should be deleted
when the last reference is released, the application must implement
the <span style="font-family:monospace">_add_ref()</span> and <span style="font-family:monospace">_remove_ref()</span> virtual member functions
within the implementation class. Make sure that the implementations
are thread safe.</p>
<!--TOC subsection id="sec170" Inheritance from unconstrained interfaces-->
<h3 id="sec170" class="subsection">11.8.2&#XA0;&#XA0;Inheritance from unconstrained interfaces</h3><!--SEC END --><p>Local interfaces can inherit from unconstrained (i.e. non-local)
interfaces:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">Test</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">problem</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">inout</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">arg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">local</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Two</span><span style="font-size:small"> : </span><span style="font-size:small">One</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Receiver</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">setOne</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">One</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  };</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>IDL like this leads to two issues to do with omniORB&#X2019;s C++ mapping
implementation.</p><p>First, an instance of local interface <span style="font-family:monospace">Two</span> should be suitable to
pass as the argument to the <span style="font-family:monospace">setOne()</span> method of a <span style="font-family:monospace">Receiver</span>
object (as long as the object is in the same address space as the
caller). Therefore, the <span style="font-family:monospace">Two</span> abstract base class has to inherit
from the internal class omniORB uses to map object references of type
<span style="font-family:monospace">One</span>. For performance reasons, the class that implements
<span style="font-family:monospace">One</span> object references normally has non-virtual member
functions. That means that the application-supplied <span style="font-family:monospace">problem()</span>
member function for the implementation of local interface <span style="font-family:monospace">Two</span>
will not override the base class&#X2019;s version. To overcome this, the IDL
for the base unconstrained interface must be compiled with the
<span style="font-family:monospace">-Wbvirtual-objref</span> switch to omniidl. That makes the member
functions of the mapping of <span style="font-family:monospace">One</span> into virtual functions, so they
can be overridden.</p><p>The second problem is that, in some cases, omniORB uses a different
mapping for object reference member functions than the mapping used in
servant classes. For example, in the <span style="font-family:monospace">problem()</span> operation, it uses
an internal type for the inout string argument that avoids memory
issues if the application uses a <span style="font-family:monospace">String_var</span> in the argument.
This means that the abstract member function declared in the
<span style="font-family:monospace">Two</span> class (and implemented by the application) has a different
signature to the member function in the base class. The
application-supplied class will therefore not properly override the
base class method. In all likelihood, the C++ compiler will also
complain that the two member functions are ambiguous. The solution to
this problem is to use the implementation mapping in the base object
reference class, rather than the normal object reference mapping,
using the <span style="font-family:monospace">-Wbimpl-mapping</span> switch to omniidl. The consequence
of this is that some uses of <span style="font-family:monospace">_var</span> types for inout arguments
that are normally acceptable in omniORB can now lead to memory
management problems.</p><p>In summary, to use local interfaces derived from normal unconstrained
interfaces, you should compile all your IDL with the omniidl flags:</p><blockquote class="quote">
<span style="font-family:monospace">-Wbvirtual-objref -Wbimpl-mapping</span>
</blockquote>
<!--TOC subsection id="sec171" Valuetypes supporting local interfaces-->
<h3 id="sec171" class="subsection">11.8.3&#XA0;&#XA0;Valuetypes supporting local interfaces</h3><!--SEC END --><p>According to the IDL specification, it should be possible to declare a
valuetype that supports a local interface:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">local</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">my_operation</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">V</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">supports</span></span><span style="font-size:small"> </span><span style="font-size:small">I</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">s</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>omniidl accepts the IDL, but unfortunately the resulting C++ code does
not compile. The C++ mapping specification has a problem in that both
the <span style="font-family:monospace">CORBA::LocalObject</span> and <span style="font-family:monospace">CORBA::ValueBase</span>
classes have <span style="font-family:monospace">_add_ref()</span> and <span style="font-family:monospace">_remove_ref()</span> member
functions defined. The classes generated for the valuetype inherit
from both these base classes, and therefore have an ambiguity. Until
the C++ mapping resolves this conflict, valuetypes supporting local
interfaces cannot be used in omniORB.</p>
<!--TOC chapter id="sec172" Asynchronous Method Invocation-->
<h1 id="sec172" class="chapter">Chapter&#XA0;12&#XA0;&#XA0;Asynchronous Method Invocation</h1><!--SEC END --><p>
<a id="chap:ami"></a></p><p>omniORB 4.2 supports Asynchronous Method Invocation, AMI, as defined
in the CORBA Messaging specification. It supports both the polling and
callback models of asynchronous calls. Note that omniORB does not
support the other parts of the Messaging specification such as Quality
of Service, Routing and Persistent requests.</p><p>While omniORB mainly targets the 2.6 version of the CORBA
specification, the AMI support follows the CORBA Messaging
specification as described in the CORBA 3.1 specification, chapter
17&#XA0;[<a href="#corba31-spec">OMG08</a>]. That version of the specification is largely
the same as the one in CORBA 2.6. The only significant difference is
that exception replies in the callback model use a simpler
interface-independent mapping.</p>
<!--TOC section id="sec173" Implied IDL-->
<h2 id="sec173" class="section">12.1&#XA0;&#XA0;Implied IDL</h2><!--SEC END --><p>AMI works by defining some additional <span style="font-style:italic">implied IDL</span> for each
interface in the real IDL. The implied IDL contains type and
operation definitions that enable asynchronous calls.</p><p>As a guide to the implied IDL, there is a special <span style="font-family:monospace">ami</span>
back-end to omniidl that outputs the implied IDL for the given input
IDL. For example, given the Echo example IDL:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// echo.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>You can output the implied IDL using</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bami echo.idl</span>
</blockquote><p>That outputs the following to standard out:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ReplyHandler for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">AMI_EchoHandler</span><span style="font-size:small"> : </span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">ReplyHandler</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_return_val</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString_excep</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> ::</span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">ExceptionHolder</span><span style="font-size:small"> </span><span style="font-size:small">excep_holder</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Poller valuetype for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">abstract</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">valuetype</span></span><span style="font-size:small"> </span><span style="font-size:small">AMI_EchoPoller</span><span style="font-size:small"> : </span><span style="font-size:small">Messaging</span><span style="font-size:small">::</span><span style="font-size:small">Poller</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">long</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_timeout</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">out</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">ami_return_val</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// AMI implied operations for interface Echo</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">sendc_echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> ::</span><span style="font-size:small">AMI_EchoHandler</span><span style="font-size:small"> </span><span style="font-size:small">ami_handler</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  ::</span><span style="font-size:small">AMI_EchoPoller</span><span style="font-size:small"> </span><span style="font-size:small">sendp_echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Alternatively, you can use the <span style="font-family:monospace">-Wbdump</span> option to
output an interleaved version that shows the original IDL and the
implied IDL together.</p><p>Note that the implied IDL output is for information only. You should
not compile it, but rather instruct the omniidl C++ back-end to
generate the corresponding C++ definitions.</p>
<!--TOC section id="sec174" Generating AMI stubs-->
<h2 id="sec174" class="section">12.2&#XA0;&#XA0;Generating AMI stubs</h2><!--SEC END --><p>To generate stub code including AMI types and operations, give the
<span style="font-family:monospace">-Wbami</span> command line option to omniidl&#X2019;s <span style="font-family:monospace">cxx</span>
back-end:</p><blockquote class="quote">
<span style="font-family:monospace">omniidl -bcxx -Wbami echo.idl</span>
</blockquote><p>That generates the normal C++ stubs and skeletons, plus all
the definitions in the implied IDL.</p>
<!--TOC section id="sec175" AMI examples-->
<h2 id="sec175" class="section">12.3&#XA0;&#XA0;AMI examples</h2><!--SEC END --><p>Example AMI clients for the <span style="font-family:monospace">Echo</span> server can be found in
<span style="font-family:monospace">src/examples/ami</span>.</p>
<!--TOC chapter id="sec176" Interface Type Checking-->
<h1 id="sec176" class="chapter">Chapter&#XA0;13&#XA0;&#XA0;Interface Type Checking</h1><!--SEC END --><p>
<a id="ch_intf"></a></p><p>This chapter describes the mechanism used by omniORB to ensure type
safety when object references are exchanged across the network. This
mechanism is handled completely within the ORB. There is no
programming interface visible at the application level. However, for
the sake of diagnosing the problem when there is a type violation, it
is useful to understand the underlying mechanism in order to interpret
the error conditions reported by the ORB.</p>
<!--TOC section id="sec177" Introduction-->
<h2 id="sec177" class="section">13.1&#XA0;&#XA0;Introduction</h2><!--SEC END --><p>In GIOP/IIOP, an object reference is encoded as an Interoperable
Object Reference (IOR) when it is sent across a network connection.
The IOR contains a Repository ID (RepoId) and one or more
communication profiles. The communication profiles describe where and
how the object can be contacted. The RepoId is a string which uniquely
identifies the IDL interface of the object.</p><p>Unless the <span style="font-family:monospace">ID</span> pragma is specified in the IDL, the ORB generates
the RepoId string in the so-called OMG IDL Format<sup><a id="text16" href="#note16">1</a></sup>. For instance, the RepoId for the <span style="font-family:monospace">Echo</span>
interface used in the examples of chapter&#XA0;<a href="#chap%3Abasic">2</a> is
<span style="font-family:monospace">IDL:Echo:1.0</span>.</p><p>When interface inheritance is used in the IDL, the ORB always sends the
RepoId of the most derived interface. For example:</p><div class="lstlisting"><span style="font-size:small">   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL</span></span></span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">A</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">     ...</span><span style="font-size:small">
</span><span style="font-size:small">   };</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">B</span><span style="font-size:small"> : </span><span style="font-size:small">A</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">     ...</span><span style="font-size:small">
</span><span style="font-size:small">   };</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">C</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">op</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small">A</span><span style="font-size:small"> </span><span style="font-size:small">arg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">   };</span></div><div class="lstlisting"><span style="font-size:small">   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">C_ptr</span><span style="font-size:small"> </span><span style="font-size:small">server</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">B_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objB</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">A_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objA</span><span style="font-size:small"> = </span><span style="font-size:small">objB</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small">server</span><span style="font-size:small">-&gt;</span><span style="font-size:small">op</span><span style="font-size:small">(</span><span style="font-size:small">objA</span><span style="font-size:small">);  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Send B as A</span></span></span></div><p>In the example, the operation <span style="font-family:monospace">C::op()</span> accepts an object reference
of type <span style="font-family:monospace">A</span>. The real type of the reference passed to <span style="font-family:monospace">C::op()</span>
is <span style="font-family:monospace">B</span>, which inherits from <span style="font-family:monospace">A</span>. In this case, the RepoId of
<span style="font-family:monospace">B</span>, and not that of <span style="font-family:monospace">A</span>, is sent across the network.</p><p>The GIOP/IIOP specification allows an ORB to send a null string in the
RepoId field of an IOR. It is up to the receiving end to work out the
real type of the object. omniORB never sends out null strings as
RepoIds, but it may receive null RepoIds from other ORBs. In that
case, it will use the mechanism described below to ensure type safety.</p>
<!--TOC section id="sec178" Interface Inheritance-->
<h2 id="sec178" class="section">13.2&#XA0;&#XA0;Interface Inheritance</h2><!--SEC END --><p>When the ORB receives an IOR of interface type B when it expects the
type to be A, it must find out if B inherits from A. When the ORB has
no local knowledge of the type B, it must work out the type of B
dynamically.</p><p>The CORBA specification defines an Interface Repository (IR) from
which IDL interfaces can be queried dynamically. In the above
situation, the ORB could contact the IR to find out the type of B.
However, this approach assumes that an IR is always available and
contains the up-to-date information of all the interfaces used in the
domain. This assumption may not be valid in many applications.</p><p>An alternative is to use the <span style="font-family:monospace">_is_a()</span> operation to work out the
actual type of an object. This approach is simpler and more robust
than the previous one because no 3rd party is involved, so this is
what omniORB does.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Object</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">_is_a</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">type_id</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The <span style="font-family:monospace">_is_a()</span> operation is part of the <span style="font-family:monospace">CORBA::Object</span>
interface and must be implemented by every object. The input argument
is a RepoId. The function returns <span style="font-family:monospace">true</span> if the object is really
an instance of that type, including if that type is a base type of the
most derived type of that object.</p><p>In the situation above, the ORB would invoke the <span style="font-family:monospace">_is_a()</span>
operation on the object and ask if the object is of type A
<em>before</em> it processes any application invocation on the object.</p><p>Notice that the <span style="font-family:monospace">_is_a()</span> call is <em>not</em> performed when the IOR
is unmarshalled. It is performed just prior to the first application
invocation on the object. This leads to some interesting failure modes
if B reports that it is not an A. Consider the following example:</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// IDL</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">A</span><span style="font-size:small"> { ... };</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">B</span><span style="font-size:small"> : </span><span style="font-size:small">A</span><span style="font-size:small"> { ... };</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">D</span><span style="font-size:small"> { ... };</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">C</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">A</span><span style="font-size:small">      </span><span style="font-size:small">op1</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">Object</span></span><span style="font-size:small"> </span><span style="font-size:small">op2</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// C++</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">C_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objC</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">A_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objA</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objR</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">objA</span><span style="font-size:small"> =  </span><span style="font-size:small">objC</span><span style="font-size:small">-&gt;</span><span style="font-size:small">op1</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">) </span><span style="font-size:small">objA</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_non_existent</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">objR</span><span style="font-size:small"> =  </span><span style="font-size:small">objC</span><span style="font-size:small">-&gt;</span><span style="font-size:small">op2</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">objA</span><span style="font-size:small"> =  </span><span style="font-size:small">A</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">objR</span><span style="font-size:small">);</span></div><p>If the stubs of A,B,C,D are linked into the executable and:</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold">Case 1</span></dt><dd class="dd-description"> <span style="font-family:monospace">C::op1()</span> and <span style="font-family:monospace">C::op2()</span> return a B. Lines 6&#X2013;10
complete successfully. The remote object is only contacted at line 7.</dd><dt class="dt-description"><span style="font-weight:bold">Case 2</span></dt><dd class="dd-description"> <span style="font-family:monospace">C::op1()</span> and <span style="font-family:monospace">C::op2()</span> return a D. This condition
only occurs if the runtime of the remote end is buggy. Even though the
IDL definitions show that D is not derived from A, omniORB gives it
the benefit of the doubt, in case it actually has a more derived
interface that is derived from both A and D. At line 7, the object is
contacted to ask if it is an A. The answer is no, so a
<span style="font-family:monospace">CORBA::INV_OBJREF</span> exception is raised. At line 10, the narrow
operation will fail, and objA will be set to nil.
</dd></dl><p>If only the stubs of A are linked into the executable and:</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold">Case 1</span></dt><dd class="dd-description"> <span style="font-family:monospace">C::op1()</span> and <span style="font-family:monospace">C::op2()</span> return a B. Lines 6&#X2013;10
complete successfully. When lines 7 and 10 are executed, the object is
contacted to ask if it is an A.</dd><dt class="dt-description"><span style="font-weight:bold">Case 2</span></dt><dd class="dd-description"> <span style="font-family:monospace">C::op1()</span> and <span style="font-family:monospace">C::op2()</span> return a D. This condition
only occurs if the runtime of the remote end is buggy. Line 6
completes and no exception is raised. At line 7, the object is
contacted to ask if it is an A. If the answer is no, a
<span style="font-family:monospace">CORBA::INV_OBJREF</span> exception is raised. At line 10, the narrow
operation will fail, and objA will be set to nil.
</dd></dl>
<!--BEGIN NOTES chapter-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note16" href="#text16">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">For further
details of the repository ID formats, see section 10.6 in the CORBA
2.6 specification.</div></dd></dl>
<!--END NOTES-->
<!--TOC chapter id="sec179" Packaging stubs into DLLs-->
<h1 id="sec179" class="chapter">Chapter&#XA0;14&#XA0;&#XA0;Packaging stubs into DLLs</h1><!--SEC END --><p>
<a id="chap:dlls"></a></p><p>omniORB&#X2019;s stubs can be packaged into shared libraries or DLLs. On Unix
platforms this is mostly painless, but on Windows things are slightly
more tricky.</p>
<!--TOC section id="sec180" Dynamic loading and unloading-->
<h2 id="sec180" class="section">14.1&#XA0;&#XA0;Dynamic loading and unloading</h2><!--SEC END --><p>As long as your platform supports running static initialisers and
destructors as libraries are loaded and unloaded, you can package
stubs into shared libraries / DLLs, and load them dynamically at
runtime.</p><p>There is one minor problem with this, which is that normally nil
object references are heap allocated, and only deallocated when the
ORB is destroyed. That means that if you unload a stub library from
which nil references have been obtained (just by creating an object
reference _var for example), there is a risk of a segmentation fault
when the ORB is destroyed. To avoid that problem, define the
<span style="font-family:monospace">OMNI_UNLOADABLE_STUBS</span> C pre-processor symbol while you are
compiling the stub files. Unfortunately, with that define set, there
is a risk that object reference _vars at global scope will segfault
as they are unloaded. You must not create _vars at global scope if
you are using <span style="font-family:monospace">OMNI_UNLOADABLE_STUBS</span>.</p>
<!--TOC section id="sec181" Windows DLLs-->
<h2 id="sec181" class="section">14.2&#XA0;&#XA0;Windows DLLs</h2><!--SEC END --><p>On Unix platforms, the linker figures out how to link the symbols
exported by a library in to the running program. On Windows,
unfortunately, you have to tell the linker where symbols are coming
from. This causes all manner of difficulties.</p>
<!--TOC subsection id="sec182" Exporting symbols-->
<h3 id="sec182" class="subsection">14.2.1&#XA0;&#XA0;Exporting symbols</h3><!--SEC END --><p>To (statically) link with a DLL file in Windows, you link with a LIB
file which references the symbols exported from the DLL. To build the
LIB and DLL files, the correct symbols must be exported. One way to do
that is to decorate the source code with magic tags that tell the
compiler to export the symbols. The alternative is to provide a DEF
file that lists all the symbols to be exported. omniORB uses a DEF
file.</p><p>The question is, how do you create the DEF file? The answer is to use
a Python script named <span style="font-family:monospace">makedeffile.py</span> that lives in the
<span style="font-family:monospace">bin\scripts</span> directory in the omniORB distribution.
<span style="font-family:monospace">makedeffile.py</span> runs the dumpbin program that comes with
Visual C++, and processes its output to extract the necessary symbols.
Although it is designed for exporting the symbols from omniORB stub
files, it can actually be used for arbitrary C++ code. To use it to
create a DLL from a single source file, use the following steps:</p><ol class="enumerate" type=1><li class="li-enumerate">
Compile the source:<p><span style="font-family:monospace">cl -c -O2 -MD -GX -Fofoo.o -Tpfoo.cc</span></p></li><li class="li-enumerate">Build a static library (It probably won&#X2019;t work on its own due to
the -MD switch to cl, but we just need it to get the symbols
out):<p><span style="font-family:monospace">lib -out:foo_static.lib foo.o</span></p></li><li class="li-enumerate">Use the script to build a .def file:<p><span style="font-family:monospace">makedeffile.py foo_static.lib foo 1.0 foo.def</span></p></li><li class="li-enumerate">Build the .dll and .lib with the def file.<p><span style="font-family:monospace">link -out:foo.dll -dll -def:foo.def -implib:foo.lib foo.o</span>
</p></li></ol><p>Of course, you can link together many separate C++ files, rather than
just the one shown here.</p>
<!--TOC subsection id="sec183" Importing constant symbols-->
<h3 id="sec183" class="subsection">14.2.2&#XA0;&#XA0;Importing constant symbols</h3><!--SEC END --><p>As if exporting the symbols from a DLL was not complicated enough, any
constant values exported by a DLL have to be explicitly
<em>imported</em> into the code using them. omniORB&#X2019;s stub files declare
a number of such constants. This time, the constant declarations in
the generated header files are decorated in a way that tells the
compiler what to do. When the stub headers are #included, the correct
pre-processor defines must be set. If things are not set correctly,
the code all links without problems, but then mysteriously blows up at
run time.</p><p>Depending on how complex your situation is, there are a range of
solutions. Starting with the simplest, here are some scenarios you may
find yourself in:</p><ol class="enumerate" type=1><li class="li-enumerate">All stub code, and all code that uses it is wrapped up in a
single DLL.<p>Do nothing special.</p></li><li class="li-enumerate">All stub code is in a single DLL. Code using it is in another
DLL, or not in a DLL at all.<p><span style="font-family:monospace">#define USE_stub_in_nt_dll</span> before <span style="font-family:monospace">#include</span> of
the stub headers.</p></li><li class="li-enumerate">The stubs for each IDL file are in separate DLLs, one DLL per
IDL file.<p>In this case, if the IDL files <span style="font-family:monospace">#include</span> each other, then
when the stub files are compiled, import declarations are needed
so that references between the separate DLLs work. To do this,
first compile the IDL files with the <span style="font-family:monospace">-Wbdll_stubs</span>
flag:</p><p><span style="font-family:monospace">omniidl -bcxx -Wbdll_stubs example.idl</span></p><p>Then define the <span style="font-family:monospace">INCLUDED_stub_in_nt_dll</span> pre-processor
symbol when compiling the stub files. As above, define
<span style="font-family:monospace">USE_stub_in_nt_dll</span> when including the stub headers
into application code.</p></li><li class="li-enumerate">Stubs and application code are packaged into multiple DLLs, but
DLLs contain the stubs for more than one IDL file.<p>This situation is handled by &#X2018;annotating&#X2019; the IDL files to
indicate which DLLs they will be compiled into. The annotation
takes the form of some <span style="font-family:monospace">#ifdefs</span> to be inserted in the
stub headers. For example,</p><div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// one.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #</span><span style="font-size:small">ifndef</span><span style="font-size:small"> </span><span style="font-size:small">COMPILING_FIRST_DLL</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> # </span><span style="font-size:small">ifndef</span><span style="font-size:small"> </span><span style="font-size:small">USE_stub_in_nt_dll</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #   </span><span style="font-size:small">define</span><span style="font-size:small"> </span><span style="font-size:small">USE_stub_in_nt_dll</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> # </span><span style="font-size:small">endif</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #</span><span style="font-size:small">endif</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">two</span><span style="font-size:small">.</span><span style="font-size:small">idl</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">module</span></span><span style="font-size:small"> </span><span style="font-size:small">ModuleOne</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  ...</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// two.idl</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #</span><span style="font-size:small">ifndef</span><span style="font-size:small"> </span><span style="font-size:small">COMPILING_SECOND_DLL</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> # </span><span style="font-size:small">ifndef</span><span style="font-size:small"> </span><span style="font-size:small">USE_stub_in_nt_dll</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #   </span><span style="font-size:small">define</span><span style="font-size:small"> </span><span style="font-size:small">USE_stub_in_nt_dll</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> # </span><span style="font-size:small">endif</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#pragma</span></span><span style="font-size:small"> </span><span style="font-size:small">hh</span><span style="font-size:small"> #</span><span style="font-size:small">endif</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">three</span><span style="font-size:small">.</span><span style="font-size:small">idl</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">...</span></div><p>Here, <span style="font-family:monospace">one.idl</span> is packaged into <span style="font-family:monospace">first.dll</span> and
<span style="font-family:monospace">two.idl</span> is in <span style="font-family:monospace">second.dll</span>. When compiling
<span style="font-family:monospace">first.dll</span>, the <span style="font-family:monospace">COMPILING_FIRST_DLL</span> define is
set, meaning definitions from <span style="font-family:monospace">one.idl</span> (and any other
files in that DLL) are not imported. Any other module that
includes the stub header for <span style="font-family:monospace">one.idl</span> does not define
<span style="font-family:monospace">COMPILING_FIRST_DLL</span>, and thus imports the necessary
symbols from the DLL.</p><p>Rather than explicitly listing all the pre-processor code, it
can be cleaner to use a C++ header file for each DLL. See the
COS services IDL files in <span style="font-family:monospace">idl/COS</span> for an example.</p></li></ol>
<!--TOC chapter id="sec184" Resources-->
<h1 id="sec184" class="chapter">Chapter&#XA0;15&#XA0;&#XA0;Resources</h1><!--SEC END --><p>There are a number of useful online resources related to omniORB:</p><ul class="itemize"><li class="li-itemize"><a href="https://www.omniorb.net/"><span style="font-family:monospace">https://www.omniorb.net/</span></a> is the main omniORB web
site.</li><li class="li-itemize">The omniORB mailing list is the first port of call for questions
that are not answered in this document or in the FAQ. Subscription
information and archives are at
<a href="https://www.omniorb.net/list.html"><span style="font-family:monospace">https://www.omniorb.net/list.html</span></a></li><li class="li-itemize">Commercial support is available from
<a href="https://www.omniorb-support.com/"><span style="font-family:monospace">https://www.omniorb-support.com/</span></a></li></ul><!--TOC chapter id="sec185" References-->
<h1 id="sec185" class="chapter">References</h1><!--SEC END --><dl class="thebibliography"><dt class="dt-thebibliography">
<a id="rfc2396">[BLFIM98]</a></dt><dd class="dd-thebibliography">
T. Berners-Lee, R. Fielding, U.C. Irvine, and L. Masinter.
<em>U</em><em>niform </em><em>R</em><em>esource </em><em>I</em><em>dentifiers (</em><em>URI</em><em>): Generic Syntax</em>.
RFC 2396, August 1998.</dd><dt class="dt-thebibliography"><a id="henning1999">[HV99]</a></dt><dd class="dd-thebibliography">
Michi Henning and Steve Vinoski.
<em>Advanced </em><em>CORBA</em><em> Programming with </em><em>C++</em>.
Addison-Wesley professional computing series, 1999.</dd><dt class="dt-thebibliography"><a id="corbaservices">[OMG98]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>CORBAServices</em><em>: Common Object Services Specification</em>, December
1998.</dd><dt class="dt-thebibliography"><a id="inschapters">[OMG00]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>Interoperable Naming Service revised chapters</em>, August 2000.
From <a href="http://www.omg.org/cgi-bin/doc?ptc/00-08-07"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?ptc/00-08-07</span></a>.</dd><dt class="dt-thebibliography"><a id="corba26-spec">[OMG01]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>The </em><em>C</em><em>ommon </em><em>O</em><em>bject </em><em>R</em><em>equest </em><em>B</em><em>roker: </em><em>A</em><em>rchitecture and
Specification</em>, 2.6 edition, December 2001.
From <a href="http://www.omg.org/cgi-bin/doc?formal/01-12-01"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?formal/01-12-01</span></a>.</dd><dt class="dt-thebibliography"><a id="cxxmapping">[OMG03]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>C++ Language Mapping</em>, 1.1 edition, 2003.
From <a href="http://www.omg.org/cgi-bin/doc?formal/03-06-03"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?formal/03-06-03</span></a>.</dd><dt class="dt-thebibliography"><a id="corba31-spec">[OMG08]</a></dt><dd class="dd-thebibliography">
Object Management Group.
<em>The </em><em>C</em><em>ommon </em><em>O</em><em>bject </em><em>R</em><em>equest </em><em>B</em><em>roker: </em><em>A</em><em>rchitecture and
Specification</em>, 3.1 edition, January 2008.
From <a href="http://www.omg.org/cgi-bin/doc?formal/08-01-04"><span style="font-family:monospace">http://www.omg.org/cgi-bin/doc?formal/08-01-04</span></a>.</dd><dt class="dt-thebibliography"><a id="tjr96a">[Ric96]</a></dt><dd class="dd-thebibliography">
Tristan Richardson.
<em>The </em><em>OMNI</em><em> Thread Abstraction</em>.
AT&amp;T Laboratories Cambridge, October 1996.</dd></dl><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
