<!DOCTYPE html>
<html >
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.32">
<link rel="stylesheet" type="text/css" href="omniORB.css">
<title>The Basics</title>
</head>
<body >
<a href="omniORB001.html"><img src="previous_motif.svg" alt="Previous"></a>
<a href="index.html"><img src="contents_motif.svg" alt="Up"></a>
<a href="omniORB003.html"><img src="next_motif.svg" alt="Next"></a>
<hr>
<h1 id="sec8" class="chapter">Chapter&#XA0;2&#XA0;&#XA0;The Basics</h1>
<p>
<a id="chap:basic"></a></p><p>In this chapter, we go through three examples to illustrate the
practical steps to use omniORB. By going through the source code of
each example, the essential concepts and APIs are introduced. If you
have no previous experience with using CORBA, you should study this
chapter in detail. There are pointers to other essential documents you
should be familiar with.</p><p>If you have experience with using other ORBs, you should still go
through this chapter because it provides important information about
the features and APIs that are necessarily omniORB specific. With the
Portable Object Adapter, there are very few omniORB specific details.</p>
<h2 id="sec9" class="section">2.1&#XA0;&#XA0;The Echo Object Example</h2>
<p>Our example is an object which has only one method. The method simply
echos the argument string. We have to:</p><ol class="enumerate" type=1><li class="li-enumerate">define the object interface in IDL
</li><li class="li-enumerate">use the IDL compiler to generate the stub code, which provides
the object mapping as defined in the CORBA specification
</li><li class="li-enumerate">provide the <span style="font-style:italic">servant</span> object implementation
</li><li class="li-enumerate">write the client code.</li></ol><p>These examples are in the <span style="font-family:monospace">src/examples/echo</span> directory of the
omniORB distribution; there are several other examples in
<span style="font-family:monospace">src/examples</span>.</p>
<h2 id="sec10" class="section">2.2&#XA0;&#XA0;Specifying the Echo interface in IDL</h2>
<p>We define an object interface, called <span style="font-family:monospace">Echo</span>, as follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">interface</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">in</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">string</span></span><span style="font-size:small"> </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>If you are new to IDL, you can learn about its syntax in Chapter 3 of
the CORBA 2.6 specification&#XA0;[<a href="omniORB016.html#corba26-spec">OMG01</a>]. For the moment, you
only need to know that the interface consists of a single operation,
<span style="font-family:monospace">echoString()</span>, which takes a string as an input argument and returns
a copy of the same string.</p><p>The interface is written in a file, called <span style="font-family:monospace">echo.idl</span>. It is part
of the CORBA standard that all IDL files must have the extension
&#X2018;<span style="font-family:monospace">.idl</span>&#X2019;, although omniORB does not enforce this. In the omniORB
distribution, this file is in <span style="font-family:monospace">idl/echo.idl</span>.</p><p>For simplicity, the interface is defined in the global IDL namespace.
You should normally avoid this practice for the sake of object
reusability. If every CORBA developer defines their interfaces in the
global IDL namespace, there is a danger of name clashes between two
independently defined interfaces. Therefore, it is better to qualify
your interfaces by defining them inside <span style="font-family:monospace">module</span> names. Of
course, this does not eliminate the chance of a name clash unless some
form of naming convention is agreed globally. Nevertheless, a
well-chosen module name can help a lot.</p>
<h2 id="sec11" class="section">2.3&#XA0;&#XA0;Generating the C++ stubs</h2>
<p>From the IDL file, we use the IDL compiler to produce the C++ mapping
of the interface. The IDL compiler for omniORB is called omniidl.
Given the IDL file, omniidl produces two stub files: a C++ header file
and a C++ source file. For example, from the file <span style="font-family:monospace">echo.idl</span>, the
following files are produced:</p><ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">echo.hh</span>
</li><li class="li-itemize"><span style="font-family:monospace">echoSK.cc</span>
</li></ul><p>omniidl must be invoked with the <span style="font-family:monospace">-bcxx</span> argument to
tell it to generate C++ stubs. The following command line generates
the stubs for <span style="font-family:monospace">echo.idl</span>:</p><div class="lstlisting"><span style="font-size:small">omniidl</span><span style="font-size:small"> -</span><span style="font-size:small">bcxx</span><span style="font-size:small"> </span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">idl</span></div><p>Note that the names <span style="font-family:monospace">echo.hh</span> and <span style="font-family:monospace">echoSK.cc</span> are not
defined in the C++ mapping standard. Other CORBA implementations may
use different file names. To aid migration omniidl from other
implementations, omniidl has options to override the default output
file names. See section&#XA0;<a href="omniORB005.html#sec%3Acxx_backend">5.2</a> for details.</p><p>If you are using our make environment, you don&#X2019;t need to invoke
omniidl explicitly. In the example file <span style="font-family:monospace">dir.mk</span>, we have the
following line:</p><div class="lstlisting"><span style="font-size:small">CORBA_INTERFACES</span><span style="font-size:small"> = </span><span style="font-size:small">echo</span></div><p>That is all we need to instruct the build system to generate
the stubs. You won&#X2019;t find the stubs in your working directory because
all stubs are written into the <span style="font-family:monospace">stub</span> directory at the top level
of your build tree.</p><p>The full arguments to omniidl are detailed in
chapter&#XA0;<a href="omniORB005.html#chap%3Aomniidl">5</a>.</p>
<h2 id="sec12" class="section">2.4&#XA0;&#XA0;Object References and Servants</h2>
<p>We contact a CORBA object through an <span style="font-style:italic">object reference</span>. The
actual implementation of a CORBA object is termed a <span style="font-style:italic">servant</span>.</p><p>Object references and servants are quite separate entities, and it is
important not to confuse the two. Client code deals purely with object
references, so there can be no confusion; object implementation code
must deal with both object references and servants. omniORB uses
distinct C++ types for object references and servants, so the C++
compiler will complain if you use a servant when an object reference
is expected, or vice-versa.</p>
<h2 id="sec13" class="section">2.5&#XA0;&#XA0;A quick look at the C++ mapping</h2>
<p>The C++ stubs conform to the standard mapping defined in the CORBA
specification&#XA0;[<a href="omniORB016.html#cxxmapping">OMG03</a>]. Sadly, since it pre-dates the C++
standard library, the C++ language mapping is quite hard to use,
especially because it has complex memory management rules.</p><p>The best way to understand the mapping is to read either the
specification or, better, a book about using CORBA from C++. Reading
the code generated by omniidl is hard-going, and it is difficult to
distinguish the parts you need to know from the implementation
details.</p>
<h3 id="sec14" class="subsection">2.5.1&#XA0;&#XA0;Mapping overview</h3>
<p>For interface <span style="font-family:monospace">Echo</span>, omniidl generates four things of note:</p><ul class="itemize"><li class="li-itemize">
class <span style="font-family:monospace">Echo</span>, containing static functions and type
definitions</li><li class="li-itemize"><span style="font-family:monospace">Echo_ptr</span>, an <em>object reference</em> type with pointer
semantics</li><li class="li-itemize"><span style="font-family:monospace">Echo_var</span>, a memory management helper for
<span style="font-family:monospace">Echo_ptr</span></li><li class="li-itemize">class <span style="font-family:monospace">POA_Echo</span>, the server-side <em>skeleton</em> class</li></ul>
<h3 id="sec15" class="subsection">2.5.2&#XA0;&#XA0;Interface scope type</h3>
<p>A C++ class <span style="font-family:monospace">Echo</span> is defined to hold a number of static
functions and type definitions. It looks like this:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">_var_type</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_duplicate</span><span style="font-size:small">(</span><span style="font-size:small">_ptr_type</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">_ptr_type</span><span style="font-size:small"> </span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The <span style="font-family:monospace">_ptr_type</span> and <span style="font-family:monospace">_var_type</span> typedefs are there to
facilitate template programming. The static functions are described
below.</p>
<h3 id="sec16" class="subsection">2.5.3&#XA0;&#XA0;Object reference pointer type</h3>
<p>For interface <span style="font-family:monospace">Echo</span>, the mapping defines the object reference
type <span style="font-family:monospace">Echo_ptr</span> which has pointer semantics. The <span style="font-family:monospace">_ptr</span>
type provides access to the interface&#X2019;s operations. The concrete type
of an object reference is opaque, i.e. you must not make any
assumptions about how an object reference is implemented. You can
imagine it looks something like this:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">private_class</span></span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">some_base_class</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">typedef</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-style:italic">something</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small">;</span></div><p>To use an object reference, you use the arrow operator &#X2018;<span style="font-family:monospace">-&gt;</span>&#X2019; to
invoke its operations, but you must not use it as a C++ pointer in any
other respect. It is non-compliant to convert it to <span style="font-family:monospace">void*</span>,
perform arithmetic or relational operations including testing for
equality using <span style="font-family:monospace">operator==</span>.</p><p>In some CORBA implementations, <span style="font-family:monospace">Echo_ptr</span> is a typedef to
<span style="font-family:monospace">Echo*</span>. In omniORB, it is not&#X2014;the object reference type is
distinct from class <span style="font-family:monospace">Echo</span>.</p>
<h4 id="sec17" class="subsubsection">2.5.3.1&#XA0;&#XA0;Nil object reference</h4>
<p>Object references can be <em>nil</em>. To obtain a nil object reference
for interface <span style="font-family:monospace">Echo</span>, call <span style="font-family:monospace">Echo::_nil()</span>. To test if an
object reference is nil, use <span style="font-family:monospace">CORBA::_is_nil()</span>:</p><div class="lstlisting"><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">true_result</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">());</span></div><p><span style="font-family:monospace">Echo::_nil()</span> is the only compliant way to obtain a nil Echo
reference, and <span style="font-family:monospace">CORBA::is_nil()</span> is the only compliant way to check
if an object reference is nil. You should not use the equality
<span style="font-family:monospace">operator==</span>. Many C++ ORBs use the null pointer to represent a
nil object reference, but <em>omniORB does not</em>.</p>
<h4 id="sec18" class="subsubsection">2.5.3.2&#XA0;&#XA0;Object reference lifecycle</h4>
<p>Object references are reference counted. That is, the opaque C++
objects on the client side that implement <span style="font-family:monospace">Echo_ptr</span> are
reference counted, so they are deleted when the count goes to zero.
The lifetime of an object reference has no bearing at all on the
lifetime of the CORBA object to which it is a reference&#X2014;when an
object reference is deleted, it has <em>no effect</em> on the object in
the server.</p><p>Reference counting for <span style="font-family:monospace">Echo</span> object references is performed with
<span style="font-family:monospace">Echo::_duplicate()</span> and <span style="font-family:monospace">CORBA::release()</span>.</p><p>The <span style="font-family:monospace">_duplicate()</span> function returns a new object reference of the
Echo interface. The new object reference can be used interchangeably
with the old object reference to perform an operation on the same
object.</p><p>To indicate that an object reference will no longer be accessed, you
must call the <span style="font-family:monospace">CORBA::release()</span> operation. Its signature is as
follows:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">release</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// other methods</span></span></span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>Once you have called <span style="font-family:monospace">CORBA::release()</span> on an object reference, you
may no longer use that reference. This is because the associated
resources may have been deallocated. Remember that we are referring to
the resources associated with the object reference and <em>not the
servant object</em>. Servant objects are not affected by the lifetimes
of object references. In particular, servants are not deleted when all
references to them have been released&#X2014;CORBA does not perform
distributed garbage collection.</p><p>Nil object references are <em>not</em> reference counted, so there is no
need to call <span style="font-family:monospace">_duplicate()</span> and <span style="font-family:monospace">release()</span> with them, although it
does no harm.</p><p>Since object references must be released explicitly, their usage is
prone to error and can lead to memory leaks or invalid memory
accesses. The mapping defines the <span style="font-style:italic">object reference variable</span>
type <span style="font-family:monospace">Echo_var</span> to make life somewhat easier.</p><p>The <span style="font-family:monospace">Echo_var</span> is more convenient to use because it
automatically releases its object reference when it goes out of scope
or when assigned a new object reference. For many operations, mixing
data of type <span style="font-family:monospace">Echo_var</span> and <span style="font-family:monospace">Echo_ptr</span> is possible without
any explicit operations or casting. For instance, the <span style="font-family:monospace">echoString()</span>
operation can be called using the arrow (&#X2018;<span style="font-family:monospace">-&gt;</span>&#X2019;) on a
<span style="font-family:monospace">Echo_var</span>, as one can do with a <span style="font-family:monospace">Echo_ptr</span>.</p><p>The usage of <span style="font-family:monospace">Echo_var</span> is illustrated below:</p><div class="lstlisting"><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">p</span><span style="font-size:small"> = ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// somehow obtain an object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small">p</span><span style="font-size:small">;           </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// a assumes ownership of p, must not use p any more</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">;  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// implicit _duplicate</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">p</span><span style="font-size:small"> = ...          </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// somehow obtain another object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">a</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_duplicate</span><span style="font-size:small">(</span><span style="font-size:small">p</span><span style="font-size:small">);     </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// release old object reference</span></span></span><span style="font-size:small">
</span><span style="font-size:small">                             </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// a now holds a copy of p.</span></span></span></div><p>The mappings of many other IDL data types include <span style="font-family:monospace">_var</span> types
with similar semantics.</p>
<h4 id="sec19" class="subsubsection">2.5.3.3&#XA0;&#XA0;Object reference inheritance</h4>
<p>All CORBA objects inherit from the generic object
<span style="font-family:monospace">CORBA::Object</span>. <span style="font-family:monospace">CORBA::Object_ptr</span> is the object
reference type for base <span style="font-family:monospace">CORBA::Object</span>. Object references can be
implicitly <em>widened</em> to base interface types, so this is valid:</p><div class="lstlisting"><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">echo_ref</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// get reference from somewhere</span></span></span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">base_ref</span><span style="font-size:small"> = </span><span style="font-size:small">echo_ref</span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// widen</span></span></span></div><p>An object reference such as <span style="font-family:monospace">Echo_ptr</span> can be used in places
where a <span style="font-family:monospace">CORBA::Object_ptr</span> is expected. Conversely, the
<span style="font-family:monospace">Echo::_narrow()</span> function takes an argument of type
<span style="font-family:monospace">CORBA::Object_ptr</span> and returns a new object reference of the
<span style="font-family:monospace">Echo</span> interface. If the actual (runtime) type of the argument
object reference can be narrowed to <span style="font-family:monospace">Echo_ptr</span>, <span style="font-family:monospace">_narrow()</span>
will return a valid object reference. Otherwise it will return a nil
object reference. Note that <span style="font-family:monospace">_narrow()</span> performs an implicit
duplication of the object reference, so the result must be released.
Note also that <span style="font-family:monospace">_narrow()</span> may involve a remote call to check the
type of the object, so it may throw CORBA system exceptions such as
<span style="font-family:monospace">TRANSIENT</span> or <span style="font-family:monospace">OBJECT_NOT_EXIST</span>.</p>
<h4 id="sec20" class="subsubsection">2.5.3.4&#XA0;&#XA0;Object reference equivalence</h4>
<p>As described above, the equality <span style="font-family:monospace">operator==</span> should not be used
on object references. To test if two object references are equivalent,
the member function <span style="font-family:monospace">_is_equivalent()</span> of the generic object
<span style="font-family:monospace">CORBA::Object</span> can be used. Here is an example of its usage:</p><div class="lstlisting"><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">...            </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// initialise a to a valid object reference </span></span></span><span style="font-size:small">
</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">b</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">true_result</span><span style="font-size:small"> = </span><span style="font-size:small">a</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_is_equivalent</span><span style="font-size:small">(</span><span style="font-size:small">a</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: the above call is guaranteed to be true</span></span></span></div><p><span style="font-family:monospace">_is_equivalent()</span> does <em>not</em> contact the object to check for
equivalence&#X2014;it uses purely local knowledge, meaning that it is
possible to construct situations in which two object references refer
to the same object, but <span style="font-family:monospace">_is_equivalent()</span> does not consider them
equivalent. If you need a strong sense of object identity, you must
implement it with explicit IDL operations.</p>
<h3 id="sec21" class="subsection">2.5.4&#XA0;&#XA0;Servant Object Implementation</h3>
<p>
<a id="stubobjimpl"></a></p><p>For each object interface, a <span style="font-style:italic">skeleton</span> class is generated. In
our example, the POA specification says that the skeleton class for
interface <span style="font-family:monospace">Echo</span> is named <span style="font-family:monospace">POA_Echo</span>. A servant
implementation can be written by creating an implementation class that
derives from the skeleton class.</p><p>The skeleton class <span style="font-family:monospace">POA_Echo</span> is defined in <span style="font-family:monospace">echo.hh</span>. The
relevant section of the code is reproduced below.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small"> :</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ServantBase</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> * </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">) = 0;</span><span style="font-size:small">
</span><span style="font-size:small">};</span></div><p>The code fragment shows the only member functions that can be used in
the object implementation code. Other member functions are generated
for internal use only. As with the code generated for object
references, other POA-based ORBs will generate code which looks
different, but is functionally equivalent to this.</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">echoString()</span></span></dt><dd class="dd-description"><br>
It is through this abstract function that an implementation class
provides the implementation of the <span style="font-family:monospace">echoString()</span> operation. Notice
that its signature is the same as the <span style="font-family:monospace">echoString()</span> function that
can be invoked via the <span style="font-family:monospace">Echo_ptr</span> object reference. This will be
the case most of the time, but object reference operations for certain
parameter types use special helper classes to facilitate correct
memory management.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">_this()</span></span></dt><dd class="dd-description"><br>
The <span style="font-family:monospace">_this()</span> function returns an object reference for the target
object, provided the POA policies permit it. The returned value must
be deallocated via <span style="font-family:monospace">CORBA::release()</span>. See
section&#XA0;<a href="#objeg1">2.8</a> for an example of how this function is used.</dd></dl>
<h2 id="sec22" class="section">2.6&#XA0;&#XA0;Writing the servant implementation</h2>
<p>
<a id="objimpl"></a></p><p>You define a class to provide the servant implementation. There is
little constraint on how you design your implementation class except
that it has to inherit from the skeleton class<sup><a id="text1" href="#note1">1</a></sup> and to
implement all the abstract functions defined in the skeleton
class. Each of these abstract functions corresponds to an operation of
the interface. They are the hooks for the ORB to perform upcalls to
your implementation. Here is a simple implementation of the Echo
object.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div><p>There are four points to note here:</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold">Storage Responsibilities</span></dt><dd class="dd-description"><br>
String, which is used both as an in argument and the return value of
<span style="font-family:monospace">echoString()</span>, is a variable sized data type. Other examples of
variable sized data types include sequences, type &#X2018;any&#X2019;, etc. For
these data types, you must be clear about whose responsibility it is
to allocate and release the associated storage. As a rule of thumb,
the client (or the caller to the implementation functions) owns the
storage of all <em>in</em> arguments, the object implementation (or the
callee) must copy the data if it wants to retain a copy. For
<em>out</em> arguments and return values, the object implementation
allocates the storage and passes the ownership to the client. The
client must release the storage when the variables will no longer be
used. For details, see the C++ mapping specification.</dd><dt class="dt-description"><span style="font-weight:bold">Multi-threading</span></dt><dd class="dd-description"><br>
As omniORB is fully multithreaded, multiple threads may perform the
same upcall to your implementation concurrently. It is up to your
implementation to synchronise the threads&#X2019; accesses to shared data.
In our simple example, we have no shared data to protect so no thread
synchronisation is necessary.<p>Alternatively, you can create a POA which has the
<span style="font-family:monospace">SINGLE_THREAD_MODEL</span> Thread Policy. This guarantees that all
calls to that POA are processed sequentially.</p></dd><dt class="dt-description"><span style="font-weight:bold">Reference Counting</span></dt><dd class="dd-description"><br>
All servant objects are reference counted. The base
<span style="font-family:monospace">PortableServer::ServantBase</span> class from which all servant
skeleton classes derive defines member functions named <span style="font-family:monospace">_add_ref()</span>
and <span style="font-family:monospace">_remove_ref()</span><sup><a id="text2" href="#note2">2</a></sup>. The reference
counting means that an <span style="font-family:monospace">Echo_i</span> instance will be deleted when no
more references to it are held by application code or the POA
itself. Note that this is totally separate from the reference counting
which is associated with object references&#X2014;a servant object is
<em>never</em> deleted due to a CORBA object reference being released.</dd><dt class="dt-description"><span style="font-weight:bold">Instantiation</span></dt><dd class="dd-description"><br>
Servants are usually instantiated on the heap, i.e. using the
<span style="font-family:monospace">new</span> operator. However, they can also be created on the stack as
automatic variables. If you do that, it is vital to make sure that the
servant has been deactivated, and thus released by the POA, before the
variable goes out of scope and is destroyed.</dd></dl>
<h2 id="sec23" class="section">2.7&#XA0;&#XA0;Writing the client</h2>
<p>Here is an example of how an <span style="font-family:monospace">Echo_ptr</span> object reference is
used.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"cannot invoke on a nil object reference."</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said,\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" The Object said,\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\""</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The <span style="font-family:monospace">hello()</span> function accepts a generic object reference. The
object reference (<span style="font-family:monospace">obj</span>) is narrowed to <span style="font-family:monospace">Echo_ptr</span>. If the
object reference returned by <span style="font-family:monospace">Echo::_narrow()</span> is not nil, the
operation <span style="font-family:monospace">echoString()</span> is invoked. Finally, both the argument to
and the return value of <span style="font-family:monospace">echoString()</span> are printed to <span style="font-family:monospace">cout</span>.</p><p>The example also illustrates how <span style="font-family:monospace">T_var</span> types are used. As was
explained in the previous section, <span style="font-family:monospace">T_var</span> types take care of
storage allocation and release automatically when variables are
reassigned or when the variables go out of scope.</p><p>In line 4, the variable <span style="font-family:monospace">e</span> takes over the storage responsibility
of the object reference returned by <span style="font-family:monospace">Echo::_narrow()</span>. The object
reference is released by the destructor of <span style="font-family:monospace">e</span>. It is called
automatically when the function returns. Lines 6 and 15 show how a
<span style="font-family:monospace">Echo_var</span> variable is used. As explained earlier, the
<span style="font-family:monospace">Echo_var</span> type can be used interchangeably with the
<span style="font-family:monospace">Echo_ptr</span> type.</p><p>The argument and the return value of <span style="font-family:monospace">echoString()</span> are stored in
<span style="font-family:monospace">CORBA::String_var</span> variables <span style="font-family:monospace">src</span> and <span style="font-family:monospace">dest</span>
respectively. The strings managed by the variables are deallocated by
the destructor of <span style="font-family:monospace">CORBA::String_var</span>. It is called
automatically when the variable goes out of scope (as the function
returns). Line 15 shows how <span style="font-family:monospace">CORBA::String_var</span> variables are
used. They can be used in place of a string (for which the mapping is
<span style="font-family:monospace">char*</span>)<sup><a id="text3" href="#note3">3</a></sup>. As used in line 12, assigning a constant string
(<span style="font-family:monospace">const char*</span>) to a <span style="font-family:monospace">CORBA::String_var</span> causes the string
to be copied. On the other hand, assigning a <span style="font-family:monospace">char*</span> to a
<span style="font-family:monospace">CORBA::String_var</span>, as used in line 15, causes the latter to
assume the ownership of the string<sup><a id="text4" href="#note4">4</a></sup>.</p><p>Under the C++ mapping, <span style="font-family:monospace">T_var</span> types are provided for all the
non-basic data types. One should use automatic variables whenever
possible both to avoid memory leaks and to maximise performance.
However, when one has to allocate data items on the heap, it is a good
practice to use the <span style="font-family:monospace">T_var</span> types to manage the heap storage.</p>
<h2 id="sec24" class="section">2.8&#XA0;&#XA0;Example 1 &#X2014; Colocated Client and Servant</h2>
<p>
<a id="objeg1"></a></p><p>Having introduced the client and the object implementation, we can now
describe how to link up the two via the ORB and POA. In this section,
we describe an example in which both the client and the object
implementation are in the same address space. In the next two
sections, we shall describe the case where the two are in different
address spaces.</p><p>The code for this example is reproduced below:</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-size:small">"omniORB4"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoref</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">myechoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The example illustrates several important interactions among the ORB,
the POA, the servant, and the client. Here are the details:</p>
<h3 id="sec25" class="subsection">2.8.1&#XA0;&#XA0;ORB initialisation</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 4</span></dt><dd class="dd-description"><br>
The ORB is initialised by calling the <span style="font-family:monospace">CORBA::ORB_init()</span>
function. The function uses the optional 3rd argument to determine
which ORB should be returned. Unless you are using omniORB specific
features, it is usually best to leave it out, and get the default
ORB. To explicitly ask for omniORB 4.x, this argument must be
&#X2018;omniORB4&#X2019;<sup><a id="text5" href="#note5">5</a></sup>.<p><span style="font-family:monospace">CORBA::ORB_init()</span> takes the list of command line arguments and
processes any that start &#X2018;<span style="font-family:monospace">-ORB</span>&#X2019;. It removes these arguments
from the list, so application code does not have to deal with them.</p><p>If any error occurs during ORB initialisation, such as invalid ORB
arguments, or an invalid configuration file, the
<span style="font-family:monospace">CORBA::INITIALIZE</span> system exception is raised.</p></dd></dl>
<h3 id="sec26" class="subsection">2.8.2&#XA0;&#XA0;Obtaining the Root POA</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 6&#X2013;7</span></dt><dd class="dd-description"><br>
To activate our servant object and make it available to clients, we
must register it with a POA. In this example, we use the <span style="font-style:italic">Root
POA</span>, rather than creating any child POAs. The Root POA is found with
<span style="font-family:monospace">orb-&gt;resolve_initial_references()</span>, which returns a plain
<span style="font-family:monospace">CORBA::Object</span>. In line 7, we narrow the reference to the right
type for a POA.<p>A POA&#X2019;s behaviour is governed by its <span style="font-style:italic">policies</span>. The Root POA has
suitable policies for many simple servers, and closely matches the
&#X2018;policies&#X2019; used by omniORB 2&#X2019;s BOA. See Chapter 11 of the CORBA 2.6
specification[<a href="omniORB016.html#corba26-spec">OMG01</a>] for details of all the POA policies
which are available.</p></dd></dl>
<h3 id="sec27" class="subsection">2.8.3&#XA0;&#XA0;Object initialisation</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 9</span></dt><dd class="dd-description"><br>
An instance of the Echo servant is initialised using the <span style="font-family:monospace">new</span>
operator. The <span style="font-family:monospace">PortableServer::Servant_var&lt;&gt;</span> template
automatically is analogous to the <span style="font-family:monospace">T_var</span> types generated by the
IDL compiler. It releases our reference to the servant when it goes
out of scope.</dd><dt class="dt-description"><span style="font-weight:bold">Line 10</span></dt><dd class="dd-description"><br>
The servant object is activated in the Root POA using
<span style="font-family:monospace">poa-&gt;activate_object()</span>, which returns an object identifier
(of type <span style="font-family:monospace">PortableServer::ObjectId*</span>). The object id must
be passed back to various POA operations. The caller is responsible
for freeing the object id, so it is assigned to a <span style="font-family:monospace">_var</span> type.</dd><dt class="dt-description"><span style="font-weight:bold">Line 12</span></dt><dd class="dd-description"><br>
The object reference is obtained from the servant object by calling
its <span style="font-family:monospace">_this()</span> method. Like all object references, the return value
of <span style="font-family:monospace">_this()</span> must be released by <span style="font-family:monospace">CORBA::release()</span> when it is no
longer needed. In this case, we assign it to a <span style="font-family:monospace">_var</span> type, so
the release is implicit at the end of the function.<p>One of the important characteristics of an object reference is that it
is completely location transparent. A client can invoke on the object
using its object reference without any need to know whether the
servant object is colocated in the same address space or is in a
different address space.</p><p>In the case of colocated client and servant, omniORB is able to
short-circuit the client calls so they do not involve IIOP. The calls
still go through the POA, however, so the various POA policies affect
local calls in the same way as remote ones. This optimisation is
applicable not only to object references returned by <span style="font-family:monospace">_this()</span>, but
to any object references that are passed around within the same
address space or received from other address spaces via remote calls.</p></dd></dl>
<h3 id="sec28" class="subsection">2.8.4&#XA0;&#XA0;Activating the POA</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Lines 15&#X2013;16</span></dt><dd class="dd-description"><br>
POAs are initially in the <span style="font-style:italic">holding</span> state, meaning that incoming
requests are blocked. Lines 15 and 16 acquire a reference to the POA&#X2019;s
POA manager, and use it to put the POA into the <span style="font-style:italic">active</span> state.
Incoming requests are now served. <span style="font-weight:bold">Failing to activate the POA
is one of the most common programming mistakes. If your program
appears deadlocked, make sure you activated the POA!</span></dd></dl>
<h3 id="sec29" class="subsection">2.8.5&#XA0;&#XA0;Performing a call</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 18</span></dt><dd class="dd-description"><br>
At long last, we can call <span style="font-family:monospace">hello()</span> with this object reference. The
argument is widened implicitly to the generic object reference
<span style="font-family:monospace">CORBA::Object_ptr</span>.</dd></dl>
<h3 id="sec30" class="subsection">2.8.6&#XA0;&#XA0;ORB destruction</h3>
<dl class="description"><dt class="dt-description"><span style="font-weight:bold">Line 20</span></dt><dd class="dd-description"><br>
Shutdown the ORB permanently. This call causes the ORB to release all
its resources, e.g. internal threads, and also to deactivate any
servant objects which are currently active. When it deactivates the
<span style="font-family:monospace">Echo_i</span> instance, the servant&#X2019;s reference count drops to zero,
so the servant is deleted.<p>This call is particularly important when writing a CORBA DLL on
Windows NT that is to be used from ActiveX. If this call is absent,
the application will hang when the CORBA DLL is unloaded.</p></dd></dl>
<h2 id="sec31" class="section">2.9&#XA0;&#XA0;Example 2 &#X2014; Different Address Spaces</h2>
<p>In this example, the client and the object implementation reside in
two different address spaces. The code of this example is almost the
same as the previous example. The only difference is the extra work
which needs to be done to pass the object reference from the object
implementation to the client.</p><p>The simplest (and quite primitive) way to pass an object reference
between two address spaces is to produce a <span style="font-style:italic">stringified</span> version
of the object reference and to pass this string to the client as a
command-line argument. The string is then converted by the client
into a proper object reference. This method is used in this
example. In the next example, we shall introduce a better way of
passing the object reference using the CORBA Naming Service.</p>
<h3 id="sec32" class="subsection">2.9.1&#XA0;&#XA0;Making a Stringified Object Reference</h3>
<p>The <span style="font-family:monospace">main()</span> function of the server side is reproduced below. The
full listing (<span style="font-family:monospace">eg2_impl.cc</span>) can be found at the end of this
chapter.</p><div class="lstlisting"><span style="font-size:xx-small">   1</span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small">   2</span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small">   3</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   4</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   5</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   6</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">   7</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">   8</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">   9</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  10</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small">  11</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  12</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  13</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:xx-small">  14</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  15</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  16</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  17</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  18</span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small">  19</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  20</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small">  21</span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small">  22</span><span style="font-size:small"> </span><span style="font-size:small">}</span></div><p>The stringified object reference is obtained by calling the ORB&#X2019;s
<span style="font-family:monospace">object_to_string()</span> function (line 13). This results in a
string starting with the signature &#X2018;<span style="font-family:monospace">IOR:</span>&#X2019; and followed by quite
a lot of hexadecimal digits. All CORBA compliant ORBs are able to
convert the string into its internal representation of a so-called
Interoperable Object Reference (IOR). The IOR contains the location
information and a key to uniquely identify the object implementation
in its own address space. From the IOR, an object reference can be
constructed.</p>
<h3 id="sec33" class="subsection">2.9.2&#XA0;&#XA0;Client: Using a Stringified Object Reference</h3>
<p>
<a id="clnt2"></a></p><p>The stringified object reference is passed to the client as a
command-line argument. The client uses the ORB&#X2019;s
<span style="font-family:monospace">string_to_object()</span> function to convert the string into a generic
object reference (<span style="font-family:monospace">CORBA::Object_ptr</span>). The relevant section of
the code is reproduced below. The full listing (<span style="font-family:monospace">eg2_clt.cc</span>) can
be found at the end of this chapter.</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">argv</span><span style="font-size:small">[1]);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">  ... </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// code to handle transient exception...</span></span></span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec34" class="subsection">2.9.3&#XA0;&#XA0;Catching System Exceptions</h3>
<p>When omniORB detects an error condition, it may raise a system
exception. The CORBA specification defines a series of exceptions
covering most of the error conditions that an ORB may encounter. The
client may choose to catch these exceptions and recover from the error
condition<sup><a id="text6" href="#note6">6</a></sup>. For instance, the code fragment, shown in
section&#XA0;<a href="#clnt2">2.9.2</a>, catches the <span style="font-family:monospace">TRANSIENT</span> system exception
which indicates that the object could not be contacted at the time of
the call, usually meaning the server is not running.</p><p>All system exceptions inherit from <span style="font-family:monospace">CORBA::SystemException</span>.
Unless you have a truly ancient C++ compiler, a single catch of
<span style="font-family:monospace">CORBA::SystemException</span> will catch all the different system
exceptions.</p>
<h3 id="sec35" class="subsection">2.9.4&#XA0;&#XA0;Lifetime of a CORBA object</h3>
<p>CORBA objects are either <span style="font-style:italic">transient</span> or <span style="font-style:italic">persistent</span>. The
majority are transient, meaning that the lifetime of the CORBA object
(as contacted through an object reference) is the same as the lifetime
of its servant object. Persistent objects can live beyond the
destruction of their servant object, the POA they were created in, and
even their process. Persistent objects are, of course, only
contactable when their associated server processes are running, and
their servants are active or can be activated by their POA with a
servant manager<sup><a id="text7" href="#note7">7</a></sup>. A reference to a persistent object can
be published, and will remain valid even if the server process is
restarted.</p><p>To support persistent objects, the servants must be activated in their
POA with the same object identifier each time. Also, the server must
be configured with the same <span style="font-style:italic">endpoint</span> details so it is
contactable in the same way as previous invocations. See
section&#XA0;<a href="omniORB006.html#sec%3Aendpoints">6.6</a> for details.</p><p>A POA&#X2019;s Lifespan Policy determines whether objects created within it
are transient or persistent. The Root POA has the <span style="font-family:monospace">TRANSIENT</span>
policy.</p><p>An alternative to creating persistent objects is to register object
references in a <span style="font-style:italic">naming service</span> and bind them to fixed path
names. Clients can bind to the object implementations at run time by
asking the naming service to resolve the path names to the object
references. CORBA defines a standard naming service, which is a
component of the Common Object Services (COS)&#XA0;[<a href="omniORB016.html#corbaservices">OMG98</a>],
that can be used for this purpose. The next section describes an
example of how to use the COS Naming Service.</p>
<h2 id="sec36" class="section">2.10&#XA0;&#XA0;Example 3 &#X2014; Using the Naming Service</h2>
<p>In this example, the object implementation uses the Naming
Service&#XA0;[<a href="omniORB016.html#corbaservices">OMG98</a>] to pass on the object reference to the
client. This method is often more practical than using stringified
object references. The full listing of the object implementation
(<span style="font-family:monospace">eg3_impl.cc</span>) and the client (<span style="font-family:monospace">eg3_clt.cc</span>) can be found
at the end of this chapter.</p><p>The names used by the Naming service consist of a sequence of
<span style="font-style:italic">name components</span>. Each name component has an <span style="font-style:italic">id</span> and a
<span style="font-style:italic">kind</span> field, both of which are strings. All name components
except the last one are bound to a naming context. A naming context is
analogous to a directory in a filing system: it can contain names of
object references or other naming contexts. The last name component is
bound to an object reference.</p><p>Sequences of name components can be represented as a flat string,
using &#X2018;.&#X2019; to separate the id and kind fields, and &#X2018;/&#X2019; to separate name
components from each other<sup><a id="text8" href="#note8">8</a></sup>. In our example, the Echo object
reference is bound to the stringified name
&#X2018;<span style="font-family:monospace">test.my_context/Echo.Object</span>&#X2019;.</p><p>The kind field is intended to describe the name in a
syntax-independent way. The naming service does not interpret, assign,
or manage these values. However, both the name and the kind attribute
must match for a name lookup to succeed. In this example, the kind
values for <span style="font-family:monospace">test</span> and <span style="font-family:monospace">Echo</span> are chosen to be
&#X2018;<span style="font-family:monospace">my_context</span>&#X2019; and &#X2018;<span style="font-family:monospace">Object</span>&#X2019; respectively. This is an
arbitrary choice as there is no standardised set of kind values.</p>
<h3 id="sec37" class="subsection">2.10.1&#XA0;&#XA0;Obtaining the Root Context Object Reference</h3>
<p>
<a id="resolveinit"></a></p><p>The initial contact with the Naming Service can be established via the
<span style="font-style:italic">root</span> context. The object reference to the root context is
provided by the ORB and can be obtained by calling
<span style="font-family:monospace">resolve_initial_references()</span>. The following code fragment shows
how it is used:</p><div class="lstlisting"><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">,</span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span></div><p>Remember from section&#XA0;<a href="omniORB001.html#sec%3Asetup">1.2</a>, omniORB constructs its internal
list of initial references at initialisation time using the
information provided in the configuration file <span style="font-family:monospace">omniORB.cfg</span>, or
given on the command line. If this file is not present, the internal
list will be empty and <span style="font-family:monospace">resolve_initial_references()</span> will raise a
<span style="font-family:monospace">CORBA::ORB::InvalidName</span> exception.</p>
<h3 id="sec38" class="subsection">2.10.2&#XA0;&#XA0;The Naming Service Interface</h3>
<p>It is beyond the scope of this chapter to describe in detail the
Naming Service interface. You should consult the CORBA services
specification&#XA0;[<a href="omniORB016.html#corbaservices">OMG98</a>] (chapter 3). The code listed in
<span style="font-family:monospace">eg3_impl.cc</span> and <span style="font-family:monospace">eg3_clt.cc</span> are good examples of how the
service can be used.</p>
<h2 id="sec39" class="section">2.11&#XA0;&#XA0;Example 4 &#X2014; Using tie implementation templates</h2>
<p>
<a id="sec:tie"></a></p><p>omniORB supports <span style="font-style:italic">tie</span> implementation templates as an alternative
way of providing servant classes. If you use the <span style="font-family:monospace">-Wbtp</span> option
to omniidl, it generates an extra template class for each interface.
This template class can be used to tie a C++ class to the skeleton
class of the interface.</p><p>The source code in <span style="font-family:monospace">eg3_tieimpl.cc</span> at the end of this chapter
illustrates how the template class can be used. The code is almost
identical to <span style="font-family:monospace">eg3_impl.cc</span> with only a few changes.</p><p>Firstly, the servant class <span style="font-family:monospace">Echo_i</span> does not inherit from any
skeleton classes. This is the main benefit of using the template class
because there are applications in which it is difficult to require
every servant class to derive from CORBA classes.</p><p>Secondly, the instantiation of a CORBA object now involves creating an
instance of the implementation class <em>and</em> an instance of the
template. Here is the relevant code fragment:</p><div class="lstlisting"><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> { ... };</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Echo_i</span><span style="font-size:small"> *</span><span style="font-size:small">myimpl</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">POA_Echo_tie</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small">(</span><span style="font-size:small">myimpl</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(&amp;</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span></div><p>For interface <span style="font-family:monospace">Echo</span>, the name of its tie implementation template
is <span style="font-family:monospace">POA_Echo_tie</span>. The template parameter is the servant
class that contains an implementation of each of the operations
defined in the interface. As used above, the tie template takes
ownership of the <span style="font-family:monospace">Echo_i</span> instance, and deletes it when the tie
object goes out of scope. The tie constructor has an optional boolean
argument (defaulted to <span style="font-family:monospace">true</span>) which indicates whether or not it
should delete the servant object. For full details of using tie
templates, see the CORBA C++ mapping specification.</p>
<h2 id="sec40" class="section">2.12&#XA0;&#XA0;Source Listings</h2>
<h3 id="sec41" class="subsection">2.12.1&#XA0;&#XA0;eg1.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg1.cc - This is the source code of example 1 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          In this example, both the object implementation and the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//          client are in the same process.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg1</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Memory management rules say we must return a newly allocated</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This function acts as a client to the object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small">( </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">) ) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"hello: The object reference is nil!"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// String literals are (char*) rather than (const char*) on some</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// old compilers.  Thus it is essential to cast to (const char*)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// here to ensure that the string is copied, so that the</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// CORBA::String_var does not attempt to 'delete' the string</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// literal.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Initialise the ORB.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root POA.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// We allocate the servant (implementation object) on the heap.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// The servant is reference counted. We start out holding a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// reference, and when the object is activated, the POA holds</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// another reference. The PortableServer::Servant_var&lt;&gt; template</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// automatically releases our reference when it goes out of scope.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Activate the object. This tells the POA that this object is</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// ready to accept requests.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoref</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a POAManager, and tell the POA to start accepting</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// requests on its objects.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Do the client-side call.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">myechoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Clean up all the resources.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec42" class="subsection">2.12.2&#XA0;&#XA0;eg2_impl.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg2_impl.cc - This is the source code of example 2 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg2_impl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is printed to cout as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        stringified IOR. This string should be used as the argument to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        eg2_clt.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Upcall: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">mesg</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and print it out as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// stringified IOR.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Block until the ORB is shut down.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec43" class="subsection">2.12.3&#XA0;&#XA0;eg2_clt.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg2_clt.cc - This is the source code of example 2 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              This is the client. The object reference is given as a</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              stringified IOR on the command line.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg2_clt &lt;object reference&gt;</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">argc</span><span style="font-size:small"> != 2) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"usage:  eg2_clt &lt;object reference&gt;"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">string_to_object</span><span style="font-size:small">(</span><span style="font-size:small">argv</span><span style="font-size:small">[1]);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">echoref</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Can't narrow reference to type Echo (or it was nil)."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">for</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">count</span><span style="font-size:small">=0; </span><span style="font-size:small">count</span><span style="font-size:small">&lt;10; </span><span style="font-size:small">count</span><span style="font-size:small">++)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"server."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec44" class="subsection">2.12.4&#XA0;&#XA0;eg3_impl.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_impl.cc - This is the source code of example 3 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_impl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is registered with the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service. The client uses the naming service to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        locate this object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              test  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> : </span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small"> </span><span style="font-size:small">POA_Echo</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">virtual</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">Servant_var</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and register it in</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// the naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">-&gt;</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">sior</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">object_to_string</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cout</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">sior</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (!</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">obj</span><span style="font-size:small">))</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objref</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind a context called "test" to the root context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">contextName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">testContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind the context to root.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind_new_context</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// If the context already exists, this exception will be raised.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// In this case, just resolve the name and assign testContext</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// to the object returned:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">testContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">      }</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind objref with name Echo to the testContext:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">objectName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">rebind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: Using rebind() will overwrite any Object previously bound</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       to /test/Echo with obj.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       Alternatively, bind() can be used, which will raise a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       CosNaming::NamingContext::AlreadyBound exception if the name</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       supplied is already bound to an object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec45" class="subsection">2.12.5&#XA0;&#XA0;eg3_clt.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_clt.cc - This is the source code of example 3 used in Chapter 2</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              "The Basics" of the omniORB user guide.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              This is the client. It uses the COSS naming service</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              to obtain the object reference.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_clt</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the client lookup the object reference from the</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              text  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">void</span></span><span style="font-size:small"> </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">Echo_ptr</span><span style="font-size:small"> </span><span style="font-size:small">e</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">e</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"hello: The object reference is nil!\n"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">src</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Hello!"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">String_var</span><span style="font-size:small"> </span><span style="font-size:small">dest</span><span style="font-size:small"> = </span><span style="font-size:small">e</span><span style="font-size:small">-&gt;</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small">src</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"I said, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">src</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">       &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"The Echo object replied, \""</span></span><span style="font-size:small"> &lt;&lt; (</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*)</span><span style="font-size:small">dest</span><span style="font-size:small"> &lt;&lt;</span><span style="font-size:small"><span style="font-size:small">"\"."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small">
</span><span style="font-size:small">main</span><span style="font-size:small"> (</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small"> **</span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_var</span><span style="font-size:small"> </span><span style="font-size:small">echoref</span><span style="font-size:small"> = </span><span style="font-size:small">Echo</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">for</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ULong</span><span style="font-size:small"> </span><span style="font-size:small">count</span><span style="font-size:small">=0; </span><span style="font-size:small">count</span><span style="font-size:small"> &lt; 10; </span><span style="font-size:small">count</span><span style="font-size:small">++)</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">hello</span><span style="font-size:small">(</span><span style="font-size:small">echoref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">destroy</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"server."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">
</span><span style="font-size:small">getObjectReference</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Create a name object, containing the name test/context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">name</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(2);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[1].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">name</span><span style="font-size:small">[1].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Resolve the name to an object reference.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">name</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">NotFound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This exception is thrown if any of the components of the</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// path [contexts or the object] aren't found:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Context not found."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object</span><span style="font-size:small">::</span><span style="font-size:small">_nil</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<h3 id="sec46" class="subsection">2.12.6&#XA0;&#XA0;eg3_tieimpl.cc</h3>
<div class="lstlisting"><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// eg3_tieimpl.cc - This example is similar to eg3_impl.cc except that</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//                  the tie implementation skeleton is used.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               This is the object implementation.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Usage: eg3_tieimpl</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        On startup, the object reference is registered with the </span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        COS naming service. The client uses the naming service to</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        locate this object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//        The name which the object is bound to is as follows:</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              root  [context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              test  [context] kind [my_context]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//               |</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//              Echo  [object]  kind [Object]</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">echo</span><span style="font-size:small">.</span><span style="font-size:small">hh</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">HAVE_STD</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small">   </span><span style="font-size:small"><span style="font-weight:bold">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#  include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small"> </span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This is the object implementation.  Notice that it does not inherit</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// from any skeleton class, and notice that the echoString() member</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// function does not have to be virtual.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">class</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">public</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">inline</span></span><span style="font-size:small"> ~</span><span style="font-size:small">Echo_i</span><span style="font-size:small">() {}</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">};</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">Echo_i</span><span style="font-size:small">::</span><span style="font-size:small">echoString</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">* </span><span style="font-size:small">mesg</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">string_dup</span><span style="font-size:small">(</span><span style="font-size:small">mesg</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-weight:bold">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_var</span><span style="font-size:small">          </span><span style="font-size:small">orb</span><span style="font-size:small"> = </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_init</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small">       </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"RootPOA"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA_var</span><span style="font-size:small"> </span><span style="font-size:small">poa</span><span style="font-size:small"> = </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POA</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note that the &lt;myecho&gt; tie object is constructed on the stack</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// here. It will delete its implementation (myimpl) when it it</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// itself destroyed (when it goes out of scope).  It is essential</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// however to ensure that such servants are not deleted whilst</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// still activated.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Tie objects can of course be allocated on the heap using new,</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// in which case they are deleted when their reference count</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// becomes zero, as with any other servant object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">Echo_i</span><span style="font-size:small">* </span><span style="font-size:small">myimpl</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="font-weight:bold">new</span></span><span style="font-size:small"> </span><span style="font-size:small">Echo_i</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">POA_Echo_tie</span><span style="font-size:small">&lt;</span><span style="font-size:small">Echo_i</span><span style="font-size:small">&gt; </span><span style="font-size:small">myecho</span><span style="font-size:small">(</span><span style="font-size:small">myimpl</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">ObjectId_var</span><span style="font-size:small"> </span><span style="font-size:small">myechoid</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate_object</span><span style="font-size:small">(&amp;</span><span style="font-size:small">myecho</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the object, and register it in</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// the naming service.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">myecho</span><span style="font-size:small">.</span><span style="font-size:small">_this</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (!</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">obj</span><span style="font-size:small">))</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">PortableServer</span><span style="font-size:small">::</span><span style="font-size:small">POAManager_var</span><span style="font-size:small"> </span><span style="font-size:small">pman</span><span style="font-size:small"> = </span><span style="font-size:small">poa</span><span style="font-size:small">-&gt;</span><span style="font-size:small">the_POAManager</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pman</span><span style="font-size:small">-&gt;</span><span style="font-size:small">activate</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">run</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught CORBA::Exception: "</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//////////////////////////////////////////////////////////////////////</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="font-weight:bold">static</span></span><span style="font-size:small"> </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Boolean</span><span style="font-size:small">
</span><span style="font-size:small">bindObjectToName</span><span style="font-size:small">(</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB_ptr</span><span style="font-size:small"> </span><span style="font-size:small">orb</span><span style="font-size:small">, </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_ptr</span><span style="font-size:small"> </span><span style="font-size:small">objref</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">rootContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Obtain a reference to the root context of the Name service:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">orb</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve_initial_references</span><span style="font-size:small">(</span><span style="font-size:small"><span style="font-size:small">"NameService"</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Narrow the reference returned.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">rootContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">rootContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow the root naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">NO_RESOURCES</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught NO_RESOURCES exception. You must configure omniORB "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"with the location"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"of the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">ORB</span><span style="font-size:small">::</span><span style="font-size:small">InvalidName</span><span style="font-size:small">&amp;) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// This should not happen!</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Service required is invalid [does not exist]."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind a context called "test" to the root context:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">contextName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"test"</span></span><span style="font-size:small">;       </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">contextName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"my_context"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note on kind: The kind field is used to indicate the type</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// of the object. This is to avoid conventions such as that used</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// by files (name.type -- e.g. test.ps = postscript etc.)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext_var</span><span style="font-size:small"> </span><span style="font-size:small">testContext</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind the context to root.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind_new_context</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// If the context already exists, this exception will be raised.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// In this case, just resolve the name and assign testContext</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// to the object returned:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">Object_var</span><span style="font-size:small"> </span><span style="font-size:small">obj</span><span style="font-size:small"> = </span><span style="font-size:small">rootContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">resolve</span><span style="font-size:small">(</span><span style="font-size:small">contextName</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small"> = </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">_narrow</span><span style="font-size:small">(</span><span style="font-size:small">obj</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="font-weight:bold">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">is_nil</span><span style="font-size:small">(</span><span style="font-size:small">testContext</span><span style="font-size:small">)) {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Failed to narrow naming context."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">      }</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Bind objref with name Echo to the testContext:</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">Name</span><span style="font-size:small"> </span><span style="font-size:small">objectName</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">.</span><span style="font-size:small">length</span><span style="font-size:small">(1);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">id</span><span style="font-size:small">   = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Echo"</span></span><span style="font-size:small">;   </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">objectName</span><span style="font-size:small">[0].</span><span style="font-size:small">kind</span><span style="font-size:small"> = (</span><span style="font-size:small"><span style="font-weight:bold">const</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="font-weight:bold">char</span></span><span style="font-size:small">*) </span><span style="font-size:small"><span style="font-size:small">"Object"</span></span><span style="font-size:small">; </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// string copied</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">try</span></span><span style="font-size:small"> {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">bind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small">(</span><span style="font-size:small">CosNaming</span><span style="font-size:small">::</span><span style="font-size:small">NamingContext</span><span style="font-size:small">::</span><span style="font-size:small">AlreadyBound</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">testContext</span><span style="font-size:small">-&gt;</span><span style="font-size:small">rebind</span><span style="font-size:small">(</span><span style="font-size:small">objectName</span><span style="font-size:small">, </span><span style="font-size:small">objref</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">// Note: Using rebind() will overwrite any Object previously bound</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       to /test/Echo with obj.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       Alternatively, bind() can be used, which will raise a</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       CosNaming::NamingContext::AlreadyBound exception if the name</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-style:italic"><span style="font-size:small">//       supplied is already bound to an object.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">TRANSIENT</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught system exception TRANSIENT -- unable to contact the "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Make sure the naming server is running and that omniORB is "</span></span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"configured correctly."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small">CORBA</span><span style="font-size:small">::</span><span style="font-size:small">SystemException</span><span style="font-size:small">&amp; </span><span style="font-size:small">ex</span><span style="font-size:small">) {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">"Caught a CORBA::"</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">ex</span><span style="font-size:small">.</span><span style="font-size:small">_name</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small">         &lt;&lt; </span><span style="font-size:small"><span style="font-size:small">" while using the naming service."</span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 0;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="font-weight:bold">return</span></span><span style="font-size:small"> 1;</span><span style="font-size:small">
</span><span style="font-size:small">}</span></div>
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note1" href="#text1">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Rather than
deriving from the skeleton class, an alternative is to use a
<span style="font-style:italic">tie</span> template, described in section&#XA0;<a href="#sec%3Atie">2.11</a>.</div></dd><dt class="dt-thefootnotes"><a id="note2" href="#text2">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">In the previous 1.0 version of the C++
mapping, servant reference counting was optional, chosen by inheriting
from a mixin class named <span style="font-family:monospace">RefCountServantBase</span>. That has been
deprecated in the 1.1 version of the C++ mapping, but the class is
still available as an empty struct, so existing code that inherits
from <span style="font-family:monospace">RefCountServantBase</span> will continue to work.</div></dd><dt class="dt-thefootnotes"><a id="note3" href="#text3">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">A conversion operator of
<span style="font-family:monospace">CORBA::String_var</span> converts a <span style="font-family:monospace">CORBA::String_var</span>
to a <span style="font-family:monospace">char*</span>.</div></dd><dt class="dt-thefootnotes"><a id="note4" href="#text4">4</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">Please refer to the C++
mapping specification for details of the String_var mapping.</div></dd><dt class="dt-thefootnotes"><a id="note5" href="#text5">5</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">For backwards compatibility, the ORB identifiers
&#X2018;omniORB2&#X2019; and &#X2018;omniORB3&#X2019; are also accepted.</div></dd><dt class="dt-thefootnotes"><a id="note6" href="#text6">6</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">If a system exception is not caught, the C++
runtime will call the <span style="font-family:monospace">terminate()</span> function. This function is
defaulted to abort the whole process and on some systems will cause a
core file to be produced.</div></dd><dt class="dt-thefootnotes"><a id="note7" href="#text7">7</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">The POA itself can be activated on demand
with an adapter activator.</div></dd><dt class="dt-thefootnotes"><a id="note8" href="#text8">8</a></dt><dd class="dd-thefootnotes"><div class="footnotetext">There are escaping rules to cope
with id and kind fields which contain &#X2018;.&#X2019; and &#X2018;/&#X2019; characters. See
chapter&#XA0;<a href="omniORB007.html#chap%3Ains">7</a> of this manual, and chapter 3 of the CORBA
services specification, as updated for the Interoperable Naming
Service&#XA0;[<a href="omniORB016.html#inschapters">OMG00</a>].</div></dd></dl>
<hr>
<a href="omniORB001.html"><img src="previous_motif.svg" alt="Previous"></a>
<a href="index.html"><img src="contents_motif.svg" alt="Up"></a>
<a href="omniORB003.html"><img src="next_motif.svg" alt="Next"></a>
</body>
</html>
